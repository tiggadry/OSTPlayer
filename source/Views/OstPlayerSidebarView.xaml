<!--
====================================================================
FILE: OstPlayerSidebarView.xaml
PROJECT: OstPlayer - Playnite Plugin for Game Soundtrack Management
MODULE: Views
LOCATION: Views/
VERSION: 1.2.0
CREATED: 2025-08-06
UPDATED: 2025-08-06
AUTHOR: TiggAdry
====================================================================

PURPOSE:
Main sidebar UserControl providing comprehensive UI for game selection,
music playback, and metadata display. Implements clean MVVM pattern with
data binding to OstPlayerSidebarViewModel and extensive custom converters.
Enhanced with Discogs metadata refresh capabilities and complete XAML
Command Binding refactoring for consistent MVVM architecture.

FEATURES:
- Game selection with search and filtering capabilities
- Track listing with metadata preview and playback controls
- MP3 metadata display with embedded cover art
- Discogs metadata integration with external links
- Discogs metadata refresh functionality for updates
- Progress tracking and volume control
- Responsive layout with scrollable content areas
- Custom converters for visibility and formatting
- Accessibility support with keyboard navigation
- Conditional UI elements based on metadata availability
- Complete XAML Command Binding implementation

UI ENHANCEMENTS:
- Dynamic button visibility for load vs refresh operations
- Intelligent metadata state management
- User feedback for refresh operations
- Tooltip guidance for refresh functionality
- Consistent command pattern for all user interactions
- Proper IsEnabled binding for button state management

COMMAND BINDING REFACTORING:
- All Button.Click events replaced with Command bindings
- Image click events converted to InputBindings with MouseBinding
- Consistent RelayCommand usage throughout UI
- IsEnabled binding replaces CanExecute predicate issues
- Clean separation between UI and business logic
- Minimal code-behind with UI-specific operations only

DEPENDENCIES:
- OstPlayer.Views.OstPlayerSidebarView (code-behind)
- OstPlayer.Converters.* (custom visibility converters)
- OstPlayer.ViewModels.OstPlayerSidebarViewModel (MVVM binding)
- OstPlayer.Utils.RelayCommand (command pattern implementation)
- Styles.xaml (shared styling resources)
- System.Windows.Controls (WPF framework)

UI STRUCTURE:
- Grid layout with 6 rows for organized content
- Game selection ComboBox with editable search
- Two-column layout for track list and metadata
- Track list with numbered items and duration display
- Metadata sections for MP3 and Discogs information
- Playback controls with progress slider and volume
- Conditional metadata refresh buttons
- Responsive GroupBox visibility based on data availability

DESIGN PATTERNS:
- MVVM (data binding with command-based interactions)
- Command Pattern (consistent user interaction handling)
- Responsive Design (adaptive layout and visibility)
- Resource Management (merged dictionaries and converters)
- State-Based UI (conditional visibility and content)
- Input Binding Pattern (mouse interactions through commands)

DATA BINDING:
- Two-way binding for user input controls
- One-way binding for display-only elements
- Multi-binding for complex visibility logic
- Command binding for user actions
- IsEnabled binding for button state control
- Property change notifications for live updates
- State-dependent button visibility

CONVERTERS USED:
- NullOrEmptyToVisibilityConverter: Hide elements for empty strings
- IntToVisibilityConverter: Show elements for positive integers
- BooleanToVisibilityConverter: Standard boolean visibility
- InverseBoolToVisibilityConverter: Inverted boolean logic
- DiscogsGroupBoxVisibilityConverter: Complex Discogs metadata visibility
- Mp3GroupBoxVisibilityConverter: Complex MP3 metadata visibility
- NullToVisibilityConverter: Show elements when data is null
- NotNullToVisibilityConverter: Show elements when data exists

REFRESH FUNCTIONALITY:
- Load button: Appears when no Discogs metadata exists
- Refresh button: Appears when Discogs metadata already loaded
- Clear cache and force API reload capability
- User feedback and error handling integration
- Command-based implementation for consistency

PERFORMANCE NOTES:
- Efficient converter-based visibility management
- Minimal layout recalculation during state changes
- Optimized binding expressions for real-time updates
- Resource sharing through merged dictionaries
- Command execution optimization for UI responsiveness

LIMITATIONS:
- Single metadata refresh at a time
- No batch refresh for multiple games
- Limited error recovery visualization
- Converter-dependent visibility logic
- Some complex UI events still require code-behind

FUTURE REFACTORING:
FUTURE: Add batch metadata refresh capabilities
FUTURE: Implement visual loading indicators for refresh operations
FUTURE: Add keyboard shortcuts for refresh functionality
FUTURE: Extract metadata section UI to user controls
FUTURE: Implement drag-and-drop support for music files
FUTURE: Add context menu for metadata operations
FUTURE: Implement visual feedback for cache invalidation
FUTURE: Add progress indicators for long-running operations
FUTURE: Add accessibility improvements for screen readers
FUTURE: Convert remaining event handlers to InputBindings
FUTURE: Implement proper CanExecuteChanged notifications in RelayCommand
FUTURE: Extract complex ComboBox filtering to Behaviors
CONSIDER: Template-based metadata section generation
CONSIDER: User-configurable UI layouts and themes
IDEA: Real-time metadata validation and conflict resolution
IDEA: Integration with external metadata correction services
IDEA: Visual diff for metadata updates

TESTING:
- UI automation tests for refresh functionality
- Command binding integration tests
- State transition validation tests
- Converter behavior verification tests
- Accessibility compliance testing
- IsEnabled binding validation tests

USAGE EXAMPLES:
- Initial load: Shows "Load metadata from Discogs" button
- After load: Shows "Refresh Discogs metadata" button
- Refresh operation: Clears cache and reloads from API
- Play/Pause: Command binding with proper state management
- Error handling: Displays user-friendly error messages

COMPATIBILITY:
- .NET Framework 4.6.2
- C# 7.3
- WPF 4.6.2
- Windows 7+
- Playnite SDK 6.x

CHANGELOG:
2025-08-06 v1.0.0 - Initial implementation with comprehensive MVVM UI and metadata integration
2025-08-06 v1.1.0 - Added Discogs metadata refresh functionality with conditional button visibility
2025-08-06 v1.2.0 - Completed XAML Command Binding refactoring for consistent MVVM architecture
====================================================================
-->
<UserControl
  x:Class="OstPlayer.Views.OstPlayerSidebarView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:OstPlayer"
  xmlns:sys="clr-namespace:System;assembly=mscorlib"
  xmlns:conv="clr-namespace:OstPlayer.Converters"
  mc:Ignorable="d"
  d:DesignHeight="1200"
  d:DesignWidth="1920"
>
  <UserControl.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="../Styles.xaml" />
      </ResourceDictionary.MergedDictionaries>
      <!-- Converters for visibility and formatting -->
      <conv:NullOrEmptyToVisibilityConverter x:Key="NullOrEmptyToVisibilityConverter" />
      <conv:IntToVisibilityConverter x:Key="IntToVisibilityConverter" />
      <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
      <conv:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />
      <conv:DiscogsGroupBoxVisibilityConverter x:Key="DiscogsGroupBoxVisibilityConverter" />
      <conv:Mp3GroupBoxVisibilityConverter x:Key="Mp3GroupBoxVisibilityConverter" />
      <conv:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
      <conv:NotNullToVisibilityConverter x:Key="NotNullToVisibilityConverter" />
    </ResourceDictionary>
  </UserControl.Resources>
  <Grid Margin="10">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>
    <!-- Game selection -->
    <StackPanel Grid.Row="0" Margin="0,0,0,10">
      <TextBlock Text="Select Game:" FontWeight="Bold" Margin="0,0,0,5" Foreground="White" />
      <ComboBox
        Name="GameComboBox"
        ItemsSource="{Binding Games}"
        SelectedItem="{Binding SelectedGame}"
        DisplayMemberPath="Name"
        IsEditable="True"
        IsTextSearchEnabled="False"
        StaysOpenOnEdit="True"
        SelectionChanged="GameComboBox_SelectionChanged"
        KeyUp="GameComboBox_KeyUp"
        DropDownOpened="GameComboBox_DropDownOpened"
        LostFocus="GameComboBox_LostFocus"
      />
    </StackPanel>
    <!-- Main content: track list and metadata -->
    <Grid Grid.Row="1" Grid.RowSpan="2" Margin="0,0,0,10">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>
      <!-- Left: track list -->
      <Border Grid.Column="0" Padding="8,0,8,8" Background="#222" Margin="2,0,5,0">
        <Grid Margin="0,0,0,0" VerticalAlignment="Stretch">
          <GroupBox
            Header="Track List"
            FontWeight="Bold"
            FontSize="20"
            Foreground="White"
            Margin="0,0,0,0"
          >
            <GroupBox.Style>
              <Style TargetType="GroupBox">
                <Setter Property="Visibility" Value="Visible" />
              </Style>
            </GroupBox.Style>
            <!-- List of tracks with sorting capabilities -->
            <DataGrid
              Padding="4"
              Background="#222"
              Name="MusicDataGrid"
              ItemsSource="{Binding MusicFiles}"
              SelectedValue="{Binding SelectedMusicFile, Mode=TwoWay}"
              SelectedValuePath="FilePath"
              AutoGenerateColumns="False"
              CanUserAddRows="False"
              CanUserDeleteRows="False"
              CanUserResizeRows="False"
              CanUserReorderColumns="True"
              CanUserSortColumns="True"
              GridLinesVisibility="None"
              HeadersVisibility="Column"
              SelectionMode="Single"
              IsReadOnly="True"
              AlternatingRowBackground="#2A2A2A"
              RowBackground="#222"
              Foreground="White"
              HorizontalScrollBarVisibility="Disabled"
              VerticalScrollBarVisibility="Auto"
              MouseDoubleClick="MusicDataGrid_MouseDoubleClick"
              KeyUp="MusicDataGrid_KeyUp"
            >
              <DataGrid.ColumnHeaderStyle>
                <Style TargetType="DataGridColumnHeader">
                  <Setter Property="Background" Value="#333" />
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="Bold" />
                  <Setter Property="Padding" Value="8,4" />
                  <Setter Property="BorderBrush" Value="#555" />
                  <Setter Property="BorderThickness" Value="0,0,1,1" />
                  <Setter Property="HorizontalContentAlignment" Value="Left" />
                  <Setter Property="Cursor" Value="Hand" />
                </Style>
              </DataGrid.ColumnHeaderStyle>
              <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                  <Setter Property="Background" Value="#222" />
                  <Setter Property="Foreground" Value="White" />
                  <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                      <Setter Property="Background" Value="#444" />
                    </Trigger>
                    <Trigger Property="IsSelected" Value="True">
                      <Setter Property="Background" Value="#007ACC" />
                    </Trigger>
                  </Style.Triggers>
                </Style>
              </DataGrid.RowStyle>
              <DataGrid.CellStyle>
                <Style TargetType="DataGridCell">
                  <Setter Property="BorderThickness" Value="0" />
                  <Setter Property="Padding" Value="4,2" />
                  <Style.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                      <Setter Property="Background" Value="Transparent" />
                      <Setter Property="Foreground" Value="White" />
                    </Trigger>
                  </Style.Triggers>
                </Style>
              </DataGrid.CellStyle>
              <DataGrid.Columns>
                <!-- Track Number Column - Expandable only (current behavior preserved) -->
                <DataGridTextColumn
                  Header="#"
                  Binding="{Binding TrackNumber}"
                  Width="40"
                  CanUserResize="True"
                  MinWidth="40"
                  MaxWidth="200"
                  SortDirection="Ascending"
                >
                  <DataGridTextColumn.ElementStyle>
                    <Style TargetType="TextBlock">
                      <Setter Property="HorizontalAlignment" Value="Center" />
                      <Setter Property="FontFamily" Value="Consolas" />
                      <Setter Property="Foreground" Value="Gray" />
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding TrackNumber}" Value="0">
                          <Setter Property="Text" Value="--" />
                          <Setter Property="Foreground" Value="#666" />
                        </DataTrigger>
                      </Style.Triggers>
                    </Style>
                  </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Track Title Column - Resizable, affects Duration indirectly -->
                <DataGridTextColumn
                  Header="Track Title"
                  Binding="{Binding TrackTitle}"
                  Width="2*"
                  CanUserResize="True"
                  MinWidth="250"
                >
                  <DataGridTextColumn.ElementStyle>
                    <Style TargetType="TextBlock">
                      <Setter Property="TextWrapping" Value="NoWrap" />
                      <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                      <Setter Property="ToolTip" Value="{Binding TrackTitle}" />
                      <Setter Property="VerticalAlignment" Value="Center" />
                      <Setter Property="Margin" Value="4,0" />
                    </Style>
                  </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Duration Column - Star sizing fills remaining space, right-anchored -->
                <DataGridTextColumn
                  Header="Duration"
                  Binding="{Binding TrackDuration}"
                  Width="*"
                  CanUserResize="True"
                  MinWidth="80"
                >
                  <DataGridTextColumn.ElementStyle>
                    <Style TargetType="TextBlock">
                      <Setter Property="HorizontalAlignment" Value="Right" />
                      <Setter Property="FontFamily" Value="Consolas" />
                      <Setter Property="Foreground" Value="Gray" />
                      <Setter Property="VerticalAlignment" Value="Center" />
                      <Setter Property="Margin" Value="0,0,8,0" />
                    </Style>
                  </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
              </DataGrid.Columns>
            </DataGrid>
          </GroupBox>
        </Grid>
      </Border>
      <!-- Right: metadata -->
      <Border Grid.Column="1" Padding="8,0,8,8" Background="#222" Margin="2,0,0,0">
        <Grid Margin="0,0,0,0" VerticalAlignment="Stretch">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>
          <!-- MP3 metadata section -->
          <Grid Grid.Row="0">
            <GroupBox FontWeight="Bold" FontSize="20" Foreground="White" Margin="0,0,0,0">
              <GroupBox.Style>
                <Style TargetType="GroupBox">
                  <Setter Property="Visibility">
                    <Setter.Value>
                      <MultiBinding Converter="{StaticResource Mp3GroupBoxVisibilityConverter}">
                        <Binding Path="IsMp3MetadataVisible" />
                        <Binding Path="TrackTitle" />
                      </MultiBinding>
                    </Setter.Value>
                  </Setter>
                  <Style.Triggers>
                    <!-- Hide if no track title -->
                    <DataTrigger Binding="{Binding TrackTitle}" Value="{x:Null}">
                      <Setter Property="Visibility" Value="Collapsed" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </GroupBox.Style>
              <GroupBox.Header>
                <TextBlock
                  Text="Track Metadata"
                  FontWeight="Bold"
                  FontSize="20"
                  Foreground="White"
                  VerticalAlignment="Center"
                />
              </GroupBox.Header>
              <StackPanel Orientation="Horizontal" Margin="0,0,0,0">
                <!-- Track cover image -->
                <Image
                  Width="200"
                  Height="200"
                  Source="{Binding TrackCover}"
                  Stretch="UniformToFill"
                  Margin="7,7,14,7"
                  Cursor="Hand"
                >
                  <Image.InputBindings>
                    <MouseBinding
                      MouseAction="LeftClick"
                      Command="{Binding ShowTrackCoverCommand}"
                    />
                  </Image.InputBindings>
                </Image>
                <StackPanel>
                  <!-- Track metadata fields -->
                  <TextBlock FontSize="18" Foreground="White" Margin="0,6,0,6">
                    <Run Text="Title: " />
                    <Run Text="{Binding TrackTitle}" />
                  </TextBlock>
                  <TextBlock FontSize="15" Foreground="White" Margin="0,0,0,2">
                    <Run Text="Artist: " />
                    <Run Text="{Binding TrackArtist}" />
                  </TextBlock>
                  <TextBlock FontSize="15" Foreground="White" Margin="0,0,0,2">
                    <Run Text="Album: " />
                    <Run Text="{Binding TrackAlbum}" />
                  </TextBlock>
                  <TextBlock FontSize="15" Foreground="White" Margin="0,0,0,2">
                    <Run Text="Year: " />
                    <Run Text="{Binding TrackYear}" />
                  </TextBlock>
                  <TextBlock FontSize="15" Foreground="White" Margin="0,0,0,2">
                    <Run Text="Genre: " />
                    <Run Text="{Binding TrackGenre}" />
                  </TextBlock>
                  <TextBlock FontSize="15" Foreground="White" Margin="0,0,0,2">
                    <Run Text="Duration: " />
                    <Run Text="{Binding TrackDuration}" />
                  </TextBlock>
                  <!-- Track number (if present) -->
                  <TextBlock FontSize="15" Foreground="White" Margin="0,0,0,2">
                    <TextBlock.Style>
                      <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible" />
                        <Style.Triggers>
                          <DataTrigger Binding="{Binding TrackNumber}" Value="0">
                            <Setter Property="Visibility" Value="Collapsed" />
                          </DataTrigger>
                        </Style.Triggers>
                      </Style>
                    </TextBlock.Style>
                    <Run Text="Track: " />
                    <Run Text="{Binding TrackNumber}" />
                  </TextBlock>
                  <!-- Total tracks (if present) -->
                  <TextBlock FontSize="15" Foreground="White" Margin="0,0,0,2">
                    <TextBlock.Style>
                      <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible" />
                        <Style.Triggers>
                          <DataTrigger Binding="{Binding TotalTracks}" Value="0">
                            <Setter Property="Visibility" Value="Collapsed" />
                          </DataTrigger>
                        </Style.Triggers>
                      </Style>
                    </TextBlock.Style>
                    <Run Text="Total Tracks: " />
                    <Run Text="{Binding TotalTracks}" />
                  </TextBlock>
                  <!-- Track comment (if present) -->
                  <TextBlock
                    FontSize="15"
                    Foreground="Gray"
                    FontStyle="Italic"
                    TextWrapping="Wrap"
                    Margin="0,0,0,2"
                  >
                    <TextBlock.Style>
                      <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible" />
                        <Style.Triggers>
                          <DataTrigger Binding="{Binding TrackComment}" Value="">
                            <Setter Property="Visibility" Value="Collapsed" />
                          </DataTrigger>
                          <DataTrigger Binding="{Binding TrackComment}" Value="{x:Null}">
                            <Setter Property="Visibility" Value="Collapsed" />
                          </DataTrigger>
                        </Style.Triggers>
                      </Style>
                    </TextBlock.Style>
                    <Run Text="Comment: " />
                    <Run Text="{Binding TrackComment}" />
                  </TextBlock>
                </StackPanel>
              </StackPanel>
            </GroupBox>
            <!-- Button to hide MP3 metadata section -->
            <Button
              Content="âœ–"
              Width="16"
              Height="15"
              Padding="0"
              FontSize="12"
              Command="{Binding DataContext.HideMetadataSectionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
              CommandParameter="mp3"
              ToolTip="Hide section"
              BorderThickness="0"
              Foreground="White"
              Cursor="Hand"
              HorizontalAlignment="Right"
              VerticalAlignment="Top"
              Margin="0,7,7,0"
              Panel.ZIndex="100"
            >
              <Button.Visibility>
                <MultiBinding Converter="{StaticResource Mp3GroupBoxVisibilityConverter}">
                  <Binding Path="IsMp3MetadataVisible" />
                  <Binding Path="TrackTitle" />
                </MultiBinding>
              </Button.Visibility>
            </Button>
          </Grid>
          <!-- Discogs metadata section -->
          <Grid Grid.Row="1">
            <GroupBox FontSize="20" Foreground="White" Margin="0,0,0,0">
              <GroupBox.Style>
                <Style TargetType="GroupBox">
                  <Setter Property="Visibility">
                    <Setter.Value>
                      <MultiBinding Converter="{StaticResource DiscogsGroupBoxVisibilityConverter}">
                        <Binding Path="IsDiscogsMetadataVisible" />
                        <Binding Path="DiscogsMetadata" />
                      </MultiBinding>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Margin" Value="0,10,0,0" />
                  <Style.Triggers>
                    <!-- Remove margin if no track is selected -->
                    <DataTrigger Binding="{Binding TrackTitle}" Value="{x:Null}">
                      <Setter Property="Margin" Value="0,0,0,0" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding TrackTitle}" Value="{x:Static sys:String.Empty}">
                      <Setter Property="Margin" Value="0,0,0,0" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </GroupBox.Style>
              <GroupBox.Header>
                <TextBlock
                  Text="Discogs Metadata"
                  FontWeight="Bold"
                  FontSize="20"
                  Foreground="White"
                  VerticalAlignment="Center"
                />
              </GroupBox.Header>
              <ScrollViewer VerticalScrollBarVisibility="Auto">
                <Grid>
                  <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                  </Grid.RowDefinitions>
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="150" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                  </Grid.ColumnDefinitions>
                  <!-- Cover image (top right) -->
                  <Image
                    Grid.Row="0"
                    Grid.Column="2"
                    Grid.RowSpan="8"
                    Width="200"
                    Height="200"
                    Margin="10,10,40,10"
                    Stretch="UniformToFill"
                    Source="{Binding DiscogsMetadata.CoverUrl}"
                    Visibility="{Binding DiscogsMetadata.CoverUrl, Converter={StaticResource NullOrEmptyToVisibilityConverter}}"
                    Cursor="Hand"
                  >
                    <Image.InputBindings>
                      <MouseBinding
                        MouseAction="LeftClick"
                        Command="{Binding ShowDiscogsCoverCommand}"
                      />
                    </Image.InputBindings>
                  </Image>
                  <!-- Title -->
                  <TextBlock
                    Grid.Row="0"
                    Grid.Column="0"
                    FontWeight="Bold"
                    FontSize="19"
                    Text="Title:"
                    Margin="5,5,0,5"
                  />
                  <TextBlock
                    Grid.Row="0"
                    Grid.Column="1"
                    Text="{Binding DiscogsMetadata.Title}"
                    FontSize="18"
                    Margin="0,5,0,5"
                  />
                  <!-- Discogs URL -->
                  <TextBlock
                    Grid.Row="1"
                    Grid.Column="0"
                    FontWeight="Bold"
                    FontSize="16"
                    Text="Discogs URL:"
                    Margin="5,7,0,0"
                  />
                  <TextBlock Grid.Row="1" Grid.Column="1" FontWeight="Bold" FontSize="15">
                    <Hyperlink
                      NavigateUri="{Binding DiscogsMetadata.DiscogsUrl}"
                      RequestNavigate="DiscogsUrl_RequestNavigate"
                    >
                      <TextBlock
                        Text="{Binding DiscogsMetadata.DiscogsUrl}"
                        Foreground="Blue"
                        FontWeight="Bold"
                        FontSize="15"
                        Margin="0,7,0,0"
                      />
                    </Hyperlink>
                  </TextBlock>
                  <!-- Artist -->
                  <TextBlock
                    Grid.Row="2"
                    Grid.Column="0"
                    FontWeight="Bold"
                    FontSize="16"
                    Text="Artist:"
                    Margin="5,7,0,0"
                  />
                  <TextBlock
                    Grid.Row="2"
                    Grid.Column="1"
                    FontSize="15"
                    Text="{Binding DiscogsMetadata.Artist}"
                    Margin="0,7,0,0"
                  />
                  <!-- Album (hidden if empty) -->
                  <TextBlock
                    Grid.Row="3"
                    Grid.Column="0"
                    FontWeight="Bold"
                    FontSize="16"
                    Text="Album:"
                    Margin="5,7,0,0"
                  >
                    <TextBlock.Style>
                      <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible" />
                        <Style.Triggers>
                          <DataTrigger Binding="{Binding DiscogsMetadata.Album}" Value="">
                            <Setter Property="Visibility" Value="Collapsed" />
                          </DataTrigger>
                          <DataTrigger Binding="{Binding DiscogsMetadata.Album}" Value="{x:Null}">
                            <Setter Property="Visibility" Value="Collapsed" />
                          </DataTrigger>
                        </Style.Triggers>
                      </Style>
                    </TextBlock.Style>
                  </TextBlock>
                  <TextBlock
                    Grid.Row="3"
                    Grid.Column="1"
                    FontSize="15"
                    Text="{Binding DiscogsMetadata.Album}"
                    Margin="0,7,0,0"
                  >
                    <TextBlock.Style>
                      <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible" />
                        <Style.Triggers>
                          <DataTrigger Binding="{Binding DiscogsMetadata.Album}" Value="">
                            <Setter Property="Visibility" Value="Collapsed" />
                          </DataTrigger>
                          <DataTrigger Binding="{Binding DiscogsMetadata.Album}" Value="{x:Null}">
                            <Setter Property="Visibility" Value="Collapsed" />
                          </DataTrigger>
                        </Style.Triggers>
                      </Style>
                    </TextBlock.Style>
                  </TextBlock>
                  <!-- Label -->
                  <TextBlock
                    Grid.Row="4"
                    Grid.Column="0"
                    FontWeight="Bold"
                    FontSize="16"
                    Text="Label:"
                    Margin="5,7,0,0"
                  />
                  <TextBlock
                    Grid.Row="4"
                    Grid.Column="1"
                    FontSize="15"
                    Text="{Binding DiscogsMetadata.Label}"
                    Margin="0,7,0,0"
                  />
                  <!-- Released -->
                  <TextBlock
                    Grid.Row="5"
                    Grid.Column="0"
                    FontWeight="Bold"
                    FontSize="16"
                    Text="Released:"
                    Margin="5,7,0,0"
                  />
                  <TextBlock
                    Grid.Row="5"
                    Grid.Column="1"
                    FontSize="15"
                    Text="{Binding DiscogsMetadata.Released}"
                    Margin="0,7,0,0"
                  />
                  <!-- Genres -->
                  <TextBlock
                    Grid.Row="6"
                    Grid.Column="0"
                    FontWeight="Bold"
                    FontSize="16"
                    Text="Genres:"
                    Margin="5,7,0,0"
                  />
                  <ItemsControl
                    Grid.Row="6"
                    Grid.Column="1"
                    ItemsSource="{Binding DiscogsMetadata.Genres}"
                  >
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <TextBlock FontSize="15" Margin="0,7,0,0">
                          <TextBlock.Text>
                            <Binding Path="." StringFormat="â€¢ {0}" />
                          </TextBlock.Text>
                        </TextBlock>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                  <!-- Styles -->
                  <TextBlock
                    Grid.Row="7"
                    Grid.Column="0"
                    FontWeight="Bold"
                    FontSize="16"
                    Text="Styles:"
                    Margin="5,7,0,0"
                  />
                  <ItemsControl
                    Grid.Row="7"
                    Grid.Column="1"
                    ItemsSource="{Binding DiscogsMetadata.Styles}"
                  >
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <TextBlock FontSize="15" Margin="0,7,0,0">
                          <TextBlock.Text>
                            <Binding Path="." StringFormat="â€¢ {0}" />
                          </TextBlock.Text>
                        </TextBlock>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                  <!-- Notes (full width) -->
                  <TextBlock
                    Grid.Row="10"
                    Grid.Column="0"
                    Grid.ColumnSpan="3"
                    FontWeight="Bold"
                    FontSize="16"
                    Text="Notes:"
                    Margin="5,7,5,0"
                  />
                  <TextBlock
                    Grid.Row="10"
                    Grid.Column="1"
                    Grid.ColumnSpan="2"
                    FontSize="15"
                    Text="{Binding DiscogsMetadata.Notes}"
                    TextWrapping="Wrap"
                    Margin="0,7,0,0"
                  />
                  <!-- Tracklist (full width) -->
                  <TextBlock
                    Grid.Row="11"
                    Grid.Column="0"
                    Grid.ColumnSpan="3"
                    FontWeight="Bold"
                    FontSize="16"
                    Text="Tracklist:"
                    Margin="5,7,0,0"
                  />
                  <ItemsControl
                    Grid.Row="11"
                    Grid.Column="1"
                    Grid.ColumnSpan="2"
                    ItemsSource="{Binding DiscogsMetadata.Tracklist}"
                    Margin="0,7,0,5"
                  >
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                          <TextBlock
                            FontSize="15"
                            Text="{Binding Title}"
                            VerticalAlignment="Center"
                          />
                          <TextBlock
                            FontSize="15"
                            Text=" ("
                            Foreground="Gray"
                            VerticalAlignment="Center"
                          />
                          <TextBlock
                            FontSize="15"
                            Text="{Binding Duration}"
                            Foreground="Gray"
                            VerticalAlignment="Center"
                          />
                          <TextBlock
                            FontSize="15"
                            Text=")"
                            Foreground="Gray"
                            VerticalAlignment="Center"
                          />
                        </StackPanel>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </Grid>
              </ScrollViewer>
            </GroupBox>
            <!-- Button to hide Discogs metadata section -->
            <Button
              Content="âœ–"
              Width="16"
              Height="15"
              Padding="0"
              FontSize="12"
              Command="{Binding DataContext.HideMetadataSectionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
              CommandParameter="discogs"
              ToolTip="Hide section"
              BorderThickness="0"
              Foreground="White"
              Cursor="Hand"
              HorizontalAlignment="Right"
              VerticalAlignment="Top"
              Margin="0,7,7,0"
              Panel.ZIndex="100"
            >
              <Button.Visibility>
                <MultiBinding Converter="{StaticResource DiscogsGroupBoxVisibilityConverter}">
                  <Binding Path="IsDiscogsMetadataVisible" />
                  <Binding Path="DiscogsMetadata" />
                </MultiBinding>
              </Button.Visibility>
            </Button>
          </Grid>
        </Grid>
      </Border>
    </Grid>
    <!-- Controls -->
    <StackPanel Grid.Row="4" Margin="0,0,0,10">
      <!-- Buttons split left and right -->
      <Grid Margin="0,0,0,10">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Grid.Column="0">
          <Button
            Name="PlayPauseButton"
            Content="{Binding PlayPauseButtonContent}"
            Width="50"
            Height="35"
            Margin="5,0"
            Command="{Binding PlayPauseCommand}"
            IsEnabled="{Binding CanPlayPause}"
            ToolTip="{Binding PlayPauseButtonToolTip}"
          />
          <Button
            Name="StopButton"
            Content="â¹"
            Width="50"
            Height="35"
            Margin="5,0"
            Command="{Binding StopCommand}"
            IsEnabled="{Binding CanStop}"
            ToolTip="Stop playback"
          />
        </StackPanel>
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Grid.Column="1">
          <!-- Button to load Discogs metadata -->
          <Button
            Content="Load metadata from Discogs"
            Margin="5"
            Padding="5"
            Command="{Binding LoadDiscogsMetadataCommand}"
            Visibility="{Binding DiscogsMetadata, Converter={StaticResource NullToVisibilityConverter}}"
          />
          <!-- Button to refresh existing Discogs metadata -->
          <Button
            Content="Refresh Discogs metadata"
            Margin="5"
            Padding="5"
            Command="{Binding RefreshDiscogsMetadataCommand}"
            Visibility="{Binding DiscogsMetadata, Converter={StaticResource NotNullToVisibilityConverter}}"
            ToolTip="Update metadata from Discogs (overwrites cached data)"
          />
          <!-- Toggle MP3 metadata section -->
          <Button
            Content="{Binding Mp3MetadataToggleText}"
            Visibility="{Binding TrackTitle, Converter={StaticResource NullOrEmptyToVisibilityConverter}}"
            Command="{Binding Mp3MetadataToggleCommand}"
            Margin="5"
            Padding="5"
          />
          <!-- Toggle Discogs metadata section -->
          <Button
            Content="{Binding DiscogsMetadataToggleText}"
            Visibility="{Binding DiscogsMetadata, Converter={StaticResource NotNullToVisibilityConverter}}"
            Command="{Binding DiscogsMetadataToggleCommand}"
            Margin="5"
            Padding="5"
          />
        </StackPanel>
      </Grid>
      <!-- Progress slider and time info -->
      <StackPanel Margin="0,5,0,0">
        <TextBlock Text="Track Position:" FontWeight="Bold" Margin="0,0,0,5" Foreground="White" />
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>
          <!-- Current time -->
          <TextBlock
            Grid.Column="0"
            Text="{Binding CurrentTime}"
            Margin="0,0,8,0"
            VerticalAlignment="Center"
            FontFamily="Consolas"
            FontSize="11"
            MinWidth="35"
            TextAlignment="Center"
            Foreground="White"
          />
          <!-- Progress slider -->
          <Slider
            Grid.Column="1"
            Name="ProgressSlider"
            Minimum="0"
            Maximum="{Binding Duration}"
            Value="{Binding Position}"
            TickFrequency="1"
            IsSnapToTickEnabled="False"
            ValueChanged="ProgressSlider_ValueChanged"
            PreviewMouseDown="ProgressSlider_PreviewMouseDown"
            PreviewMouseUp="ProgressSlider_PreviewMouseUp"
            Margin="5,0,5,0"
          >
            <Slider.Resources>
              <Style TargetType="Thumb" BasedOn="{StaticResource LargeThumb}" />
            </Slider.Resources>
          </Slider>
          <!-- Total duration -->
          <TextBlock
            Grid.Column="2"
            Text="{Binding DurationTime}"
            Margin="8,0,0,0"
            VerticalAlignment="Center"
            FontFamily="Consolas"
            FontSize="11"
            MinWidth="35"
            TextAlignment="Center"
            Foreground="White"
          />
        </Grid>
      </StackPanel>
    </StackPanel>
    <!-- Volume control -->
    <StackPanel Grid.Row="5" Margin="0,0,0,10">
      <TextBlock Text="Volume:" FontWeight="Bold" Margin="0,0,0,5" Foreground="White" />
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <TextBlock
          Grid.Column="0"
          Text="ðŸ”Š"
          Margin="0,0,5,0"
          VerticalAlignment="Center"
          Foreground="White"
        />
        <Slider
          Grid.Column="1"
          Name="VolumeSlider"
          Minimum="0"
          Maximum="100"
          Value="{Binding Volume}"
          TickFrequency="10"
          IsSnapToTickEnabled="False"
          ValueChanged="VolumeSlider_ValueChanged"
        >
          <Slider.Resources>
            <Style TargetType="Thumb" BasedOn="{StaticResource LargeThumb}" />
          </Slider.Resources>
        </Slider>
        <TextBlock
          Grid.Column="2"
          Text="{Binding VolumeDisplay}"
          Margin="5,0,0,0"
          VerticalAlignment="Center"
          MinWidth="35"
          TextAlignment="Right"
          Foreground="White"
        />
      </Grid>
    </StackPanel>
  </Grid>
</UserControl>
