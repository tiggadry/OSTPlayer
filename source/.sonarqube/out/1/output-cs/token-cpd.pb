้
?C:\Playnite\_github\OstPlayer\source\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str U
)U V
]V W
[ 
assembly 	
:	 

AssemblyDescription 
( 
$str			 ๆ
)

 
]

 
[ 
assembly 	
:	 
!
AssemblyConfiguration  
(  !
$str! #
)# $
]$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str %
)% &
]& '
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str &
)& '
]' (
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str =
)= >
]> ?
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
['' 
assembly'' 	
:''	 

AssemblyVersion'' 
('' 
$str'' $
)''$ %
]''% &
[(( 
assembly(( 	
:((	 

AssemblyFileVersion(( 
((( 
$str(( (
)((( )
](() *ค้
GC:\Playnite\_github\OstPlayer\source\Views\OstPlayerSidebarView.xaml.cs
	namespaceงง 	
	OstPlayer
งง
 
.
งง 
Views
งง 
{จจ 
public
ญญ 

partial
ญญ 
class
ญญ "
OstPlayerSidebarView
ญญ -
:
ญญ. /
UserControl
ญญ0 ;
{
ฎฎ 
private
ฑฑ '
OstPlayerSidebarViewModel
ฑฑ )
	viewModel
ฑฑ* 3
;
ฑฑ3 4
private
ฒฒ '
DataGridColumnPersistence
ฒฒ ) 
_columnPersistence
ฒฒ* <
;
ฒฒ< =
public
ธธ "
OstPlayerSidebarView
ธธ #
(
ธธ# $
	OstPlayer
ธธ$ -
plugin
ธธ. 4
,
ธธ4 5
Game
ธธ6 :
preselectGame
ธธ; H
=
ธธI J
null
ธธK O
)
ธธO P
{
นน 	
if
บบ 
(
บบ 
plugin
บบ 
==
บบ 
null
บบ 
)
บบ 
throw
ปป 
new
ปป #
ArgumentNullException
ปป /
(
ปป/ 0
nameof
ปป0 6
(
ปป6 7
plugin
ปป7 =
)
ปป= >
,
ปป> ?
$str
ปป@ Z
)
ปปZ [
;
ปป[ \
try
ฝฝ 
{
พพ !
InitializeComponent
ฟฟ #
(
ฟฟ# $
)
ฟฟ$ %
;
ฟฟ% &
	viewModel
ภภ 
=
ภภ 
new
ภภ '
OstPlayerSidebarViewModel
ภภ  9
(
ภภ9 :
plugin
ภภ: @
,
ภภ@ A
preselectGame
ภภB O
)
ภภO P
;
ภภP Q
DataContext
มม 
=
มม 
	viewModel
มม '
;
มม' ($
ConnectViewModelEvents
ยย &
(
ยย& '
)
ยย' (
;
ยย( ))
InitializeColumnPersistence
รร +
(
รร+ ,
)
รร, -
;
รร- .
Unloaded
ลล 
+=
ลล 

OnUnloaded
ลล &
;
ลล& '
Loaded
ฦฦ 
+=
ฦฦ 
OnLoaded
ฦฦ "
;
ฦฦ" #
}
วว 
catch
ศศ 
(
ศศ 
	Exception
ศศ 
ex
ศศ 
)
ศศ  
{
ษษ 
var
สส 
logger
สส 
=
สส 
Playnite
สส %
.
สส% &
SDK
สส& )
.
สส) *

LogManager
สส* 4
.
สส4 5
	GetLogger
สส5 >
(
สส> ?
)
สส? @
;
สส@ A
logger
หห 
.
หห 
Error
หห 
(
หห 
ex
หห 
,
หห  
$"
หห! #
$str
หห# L
{
หหL M
ex
หหM O
.
หหO P
Message
หหP W
}
หหW X
"
หหX Y
)
หหY Z
;
หหZ [
throw
ฬฬ 
;
ฬฬ 
}
ออ 
}
ฮฮ 	
private
ำำ 
async
ำำ 
void
ำำ 
OnLoaded
ำำ #
(
ำำ# $
object
ำำ$ *
sender
ำำ+ 1
,
ำำ1 2
RoutedEventArgs
ำำ3 B
e
ำำC D
)
ำำD E
{
ิิ 	
var
ีี 
logger
ีี 
=
ีี 
Playnite
ีี !
.
ีี! "
SDK
ีี" %
.
ีี% &

LogManager
ีี& 0
.
ีี0 1
	GetLogger
ีี1 :
(
ีี: ;
)
ีี; <
;
ีี< =
try
ึึ 
{
ืื 
await
ุุ 
	viewModel
ุุ 
.
ุุ  
InitializeAsync
ุุ  /
(
ุุ/ 0
)
ุุ0 1
;
ุุ1 2
}
ูู 
catch
ฺฺ 
(
ฺฺ 
	Exception
ฺฺ 
ex
ฺฺ 
)
ฺฺ  
{
 
logger
 
.
 
Error
 
(
 
ex
 
,
  
$"
! #
$str
# D
{
D E
ex
E G
.
G H
Message
H O
}
O P
"
P Q
)
Q R
;
R S
if
 
(
 
	viewModel
 
!=
  
null
! %
)
% &
{
฿฿ 
	viewModel
เเ 
.
เเ 

StatusText
เเ (
=
เเ) *
$str
แแ Q
;
แแQ R
}
โโ 
}
ใใ 
}
ไไ 	
private
้้ 
void
้้ )
InitializeColumnPersistence
้้ 0
(
้้0 1
)
้้1 2
{
๊๊ 	
try
๋๋ 
{
์์ 
var
๎๎ 
plugin
๎๎ 
=
๎๎ $
GetPluginFromViewModel
๎๎ 3
(
๎๎3 4
)
๎๎4 5
;
๎๎5 6
if
๏๏ 
(
๏๏ 
plugin
๏๏ 
==
๏๏ 
null
๏๏ "
)
๏๏" #
{
๐๐ 
return
๑๑ 
;
๑๑ 
}
๒๒  
_columnPersistence
๔๔ "
=
๔๔# $
new
๔๔% ('
DataGridColumnPersistence
๔๔) B
(
๔๔B C
MusicDataGrid
๔๔C P
,
๔๔P Q
plugin
๔๔R X
)
๔๔X Y
;
๔๔Y Z
Loaded
๗๗ 
+=
๗๗ 
(
๗๗ 
s
๗๗ 
,
๗๗ 
e
๗๗ 
)
๗๗  
=>
๗๗! #
{
๘๘ 
try
๙๙ 
{
๚๚  
_columnPersistence
๛๛ *
?
๛๛* +
.
๛๛+ ,
LoadColumnWidths
๛๛, <
(
๛๛< =
)
๛๛= >
;
๛๛> ?
}
 
catch
 
(
 
	Exception
 $
ex
% '
)
' (
{
 
var
 
logger
 "
=
# $
Playnite
% -
.
- .
SDK
. 1
.
1 2

LogManager
2 <
.
< =
	GetLogger
= F
(
F G
)
G H
;
H I
logger
 
.
 
Warn
 #
(
# $
ex
$ &
,
& '
$str
( F
)
F G
;
G H
}
 
}
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
var
 
logger
 
=
 
Playnite
 %
.
% &
SDK
& )
.
) *

LogManager
* 4
.
4 5
	GetLogger
5 >
(
> ?
)
? @
;
@ A
logger
 
.
 
Error
 
(
 
ex
 
,
  
$"
! #
$str
# L
{
L M
ex
M O
.
O P
Message
P W
}
W X
"
X Y
)
Y Z
;
Z [
}
 
}
 	
private
 
	OstPlayer
 $
GetPluginFromViewModel
 0
(
0 1
)
1 2
{
 	
try
 
{
 
var
 
pluginField
 
=
  !
typeof
" (
(
( )'
OstPlayerSidebarViewModel
) B
)
B C
.
C D
GetField
D L
(
L M
$str
 
,
 
System
 
.
 

Reflection
 %
.
% &
BindingFlags
& 2
.
2 3
	NonPublic
3 <
|
 
System
  
.
  !

Reflection
! +
.
+ ,
BindingFlags
, 8
.
8 9
Instance
9 A
)
 
;
 
return
 
pluginField
 "
?
" #
.
# $
GetValue
$ ,
(
, -
	viewModel
- 6
)
6 7
as
8 :
	OstPlayer
; D
;
D E
}
 
catch
 
{
 
return
 
null
 
;
 
}
 
}
 	
private
ฃฃ 
void
ฃฃ $
ConnectViewModelEvents
ฃฃ +
(
ฃฃ+ ,
)
ฃฃ, -
{
คค 	
	viewModel
ฅฅ 
.
ฅฅ '
OnShowTrackCoverRequested
ฅฅ /
+=
ฅฅ0 2
ShowTrackCover
ฅฅ3 A
;
ฅฅA B
	viewModel
ฆฆ 
.
ฆฆ )
OnShowDiscogsCoverRequested
ฆฆ 1
+=
ฆฆ2 4
ShowDiscogsCover
ฆฆ5 E
;
ฆฆE F
	viewModel
งง 
.
งง "
OnShowErrorRequested
งง *
+=
งง+ -
ShowErrorMessage
งง. >
;
งง> ?
	viewModel
จจ 
.
จจ !
OnShowInfoRequested
จจ )
+=
จจ* ,
ShowInfoMessage
จจ- <
;
จจ< =
	viewModel
ฉฉ 
.
ฉฉ -
OnSelectDiscogsReleaseRequested
ฉฉ 5
+=
ฉฉ6 8&
ShowDiscogsReleaseDialog
ฉฉ9 Q
;
ฉฉQ R
}
ชช 	
private
ฐฐ 
void
ฐฐ '
Hyperlink_RequestNavigate
ฐฐ .
(
ฐฐ. /
object
ฐฐ/ 5
sender
ฐฐ6 <
,
ฐฐ< =&
RequestNavigateEventArgs
ฐฐ> V
e
ฐฐW X
)
ฐฐX Y
{
ฑฑ 	
try
ฒฒ 
{
ณณ 
Process
ดด 
.
ดด 
Start
ดด 
(
ดด 
new
ดด !
ProcessStartInfo
ดด" 2
(
ดด2 3
e
ดด3 4
.
ดด4 5
Uri
ดด5 8
.
ดด8 9
AbsoluteUri
ดด9 D
)
ดดD E
{
ดดF G
UseShellExecute
ดดH W
=
ดดX Y
true
ดดZ ^
}
ดด_ `
)
ดด` a
;
ดดa b
}
ตต 
catch
ถถ 
{
ถถ 
}
ถถ 
e
ทท 
.
ทท 
Handled
ทท 
=
ทท 
true
ทท 
;
ทท 
}
ธธ 	
private
บบ 
void
บบ (
DiscogsUrl_RequestNavigate
บบ /
(
บบ/ 0
object
บบ0 6
sender
บบ7 =
,
บบ= >&
RequestNavigateEventArgs
บบ? W
e
บบX Y
)
บบY Z
{
ปป 	
try
ผผ 
{
ฝฝ 
if
พพ 
(
พพ 
!
พพ 
string
พพ 
.
พพ  
IsNullOrWhiteSpace
พพ .
(
พพ. /
e
พพ/ 0
.
พพ0 1
Uri
พพ1 4
?
พพ4 5
.
พพ5 6
AbsoluteUri
พพ6 A
)
พพA B
)
พพB C
{
ฟฟ 
Process
ภภ 
.
ภภ 
Start
ภภ !
(
ภภ! "
new
มม 
ProcessStartInfo
มม ,
(
มม, -
e
มม- .
.
มม. /
Uri
มม/ 2
.
มม2 3
AbsoluteUri
มม3 >
)
มม> ?
{
มม@ A
UseShellExecute
มมB Q
=
มมR S
true
มมT X
}
มมY Z
)
ยย 
;
ยย 
}
รร 
}
ฤฤ 
catch
ลล 
(
ลล 
	Exception
ลล 
ex
ลล 
)
ลล  
{
ฦฦ 

MessageBox
วว 
.
วว 
Show
วว 
(
วว  
$"
วว  "
$str
วว" 4
{
วว4 5
ex
วว5 7
.
วว7 8
Message
วว8 ?
}
วว? @
"
วว@ A
)
ววA B
;
ววB C
}
ศศ 
e
ษษ 
.
ษษ 
Handled
ษษ 
=
ษษ 
true
ษษ 
;
ษษ 
}
สส 	
private
ฬฬ 
void
ฬฬ +
GameComboBox_SelectionChanged
ฬฬ 2
(
ฬฬ2 3
object
ฬฬ3 9
sender
ฬฬ: @
,
ฬฬ@ A'
SelectionChangedEventArgs
ฬฬB [
e
ฬฬ\ ]
)
ฬฬ] ^
{
ออ 	
	viewModel
ฮฮ 
.
ฮฮ 
StopCommand
ฮฮ !
.
ฮฮ! "
Execute
ฮฮ" )
(
ฮฮ) *
null
ฮฮ* .
)
ฮฮ. /
;
ฮฮ/ 0
}
ฯฯ 	
private
ัั 
void
ัั  
GameComboBox_KeyUp
ัั '
(
ัั' (
object
ัั( .
sender
ัั/ 5
,
ัั5 6
KeyEventArgs
ัั7 C
e
ััD E
)
ััE F
{
าา 	
if
ิิ 
(
ิิ 
e
ีี 
.
ีี 
Key
ีี 
==
ีี 
Key
ีี 
.
ีี 
Up
ีี 
||
ึึ 
e
ึึ 
.
ึึ 
Key
ึึ 
==
ึึ 
Key
ึึ 
.
ึึ  
Down
ึึ  $
||
ืื 
e
ืื 
.
ืื 
Key
ืื 
==
ืื 
Key
ืื 
.
ืื  
Enter
ืื  %
||
ุุ 
e
ุุ 
.
ุุ 
Key
ุุ 
==
ุุ 
Key
ุุ 
.
ุุ  
Tab
ุุ  #
||
ูู 
e
ูู 
.
ูู 
Key
ูู 
==
ูู 
Key
ูู 
.
ูู  
Escape
ูู  &
)
ฺฺ 
{
 
return
 
;
 
}
  
FilterAndShowGames
฿฿ 
(
฿฿ 
)
฿฿  
;
฿฿  !
}
เเ 	
private
โโ 
void
โโ $
GameComboBox_LostFocus
โโ +
(
โโ+ ,
object
โโ, 2
sender
โโ3 9
,
โโ9 :
RoutedEventArgs
โโ; J
e
โโK L
)
โโL M
{
ใใ 	
var
ไไ 
comboBox
ไไ 
=
ไไ 
GameComboBox
ไไ '
;
ไไ' (
var
ๅๅ 

searchText
ๅๅ 
=
ๅๅ 
comboBox
ๅๅ %
.
ๅๅ% &
Text
ๅๅ& *
?
ๅๅ* +
.
ๅๅ+ ,
Trim
ๅๅ, 0
(
ๅๅ0 1
)
ๅๅ1 2
??
ๅๅ3 5
$str
ๅๅ6 8
;
ๅๅ8 9
if
็็ 
(
็็ 
!
็็ 
string
็็ 
.
็็ 
IsNullOrEmpty
็็ %
(
็็% &

searchText
็็& 0
)
็็0 1
&&
็็2 4
comboBox
็็5 =
.
็็= >
SelectedItem
็็> J
==
็็K M
null
็็N R
)
็็R S
{
่่ 
var
้้ 
matchingGame
้้  
=
้้! "
	viewModel
้้# ,
.
้้, -
FindGameByName
้้- ;
(
้้; <

searchText
้้< F
)
้้F G
;
้้G H
if
๊๊ 
(
๊๊ 
matchingGame
๊๊  
!=
๊๊! #
null
๊๊$ (
)
๊๊( )
{
๋๋ 
comboBox
์์ 
.
์์ 
SelectedItem
์์ )
=
์์* +
matchingGame
์์, 8
;
์์8 9
}
ํํ 
}
๎๎ 
}
๏๏ 	
private
๑๑ 
void
๑๑ )
GameComboBox_DropDownOpened
๑๑ 0
(
๑๑0 1
object
๑๑1 7
sender
๑๑8 >
,
๑๑> ?
	EventArgs
๑๑@ I
e
๑๑J K
)
๑๑K L
{
๒๒ 	
FilterGames
๓๓ 
(
๓๓ 
)
๓๓ 
;
๓๓ 
}
๔๔ 	
private
๖๖ 
void
๖๖ ,
MusicDataGrid_MouseDoubleClick
๖๖ 3
(
๖๖3 4
object
๖๖4 :
sender
๖๖; A
,
๖๖A B"
MouseButtonEventArgs
๖๖C W
e
๖๖X Y
)
๖๖Y Z
{
๗๗ 	+
PlaySelectedMusicFromDataGrid
๘๘ )
(
๘๘) *
sender
๘๘* 0
)
๘๘0 1
;
๘๘1 2
}
๙๙ 	
private
๛๛ 
void
๛๛ !
MusicDataGrid_KeyUp
๛๛ (
(
๛๛( )
object
๛๛) /
sender
๛๛0 6
,
๛๛6 7
KeyEventArgs
๛๛8 D
e
๛๛E F
)
๛๛F G
{
 	
if
 
(
 
e
 
.
 
Key
 
==
 
Key
 
.
 
Enter
 "
)
" #
{
 +
PlaySelectedMusicFromDataGrid
 -
(
- .
sender
. 4
)
4 5
;
5 6
}
 
}
 	
private
 
void
 +
PlaySelectedMusicFromDataGrid
 2
(
2 3
object
3 9
sender
: @
)
@ A
{
 	
var
 
dataGrid
 
=
 
sender
 !
as
" $
DataGrid
% -
;
- .
var
 
selectedItem
 
=
 
dataGrid
 '
?
' (
.
( )
SelectedItem
) 5
as
6 8
TrackListItem
9 F
;
F G
if
 
(
 
selectedItem
 
!=
 
null
  $
)
$ %
{
 
	viewModel
 
.
 *
PlaySelectedMusicFromListBox
 6
(
6 7
selectedItem
7 C
)
C D
;
D E
}
 
}
 	
private
 
void
 +
MusicListBox_MouseDoubleClick
 2
(
2 3
object
3 9
sender
: @
,
@ A"
MouseButtonEventArgs
B V
e
W X
)
X Y
{
 	*
PlaySelectedMusicFromListBox
 (
(
( )
sender
) /
)
/ 0
;
0 1
}
 	
private
 
void
  
MusicListBox_KeyUp
 '
(
' (
object
( .
sender
/ 5
,
5 6
KeyEventArgs
7 C
e
D E
)
E F
{
 	
if
 
(
 
e
 
.
 
Key
 
==
 
Key
 
.
 
Enter
 "
)
" #
{
 *
PlaySelectedMusicFromListBox
 ,
(
, -
sender
- 3
)
3 4
;
4 5
}
 
}
 	
private
 
void
 *
PlaySelectedMusicFromListBox
 1
(
1 2
object
2 8
sender
9 ?
)
? @
{
 	
var
 
listBox
 
=
 
sender
  
as
! #
ListBox
$ +
;
+ ,
var
 
selectedItem
 
=
 
listBox
 &
?
& '
.
' (
SelectedItem
( 4
as
5 7
TrackListItem
8 E
;
E F
if
 
(
 
selectedItem
 
!=
 
null
  $
)
$ %
{
 
	viewModel
 
.
 *
PlaySelectedMusicFromListBox
 6
(
6 7
selectedItem
7 C
)
C D
;
D E
}
กก 
}
ขข 	
private
คค 
void
คค -
ProgressSlider_PreviewMouseDown
คค 4
(
คค4 5
object
คค5 ;
sender
คค< B
,
คคB C"
MouseButtonEventArgs
คคD X
e
คคY Z
)
คคZ [
{
ฅฅ 	
	viewModel
ฆฆ 
.
ฆฆ 
SetUserDragging
ฆฆ %
(
ฆฆ% &
true
ฆฆ& *
)
ฆฆ* +
;
ฆฆ+ ,
}
งง 	
private
ฉฉ 
void
ฉฉ +
ProgressSlider_PreviewMouseUp
ฉฉ 2
(
ฉฉ2 3
object
ฉฉ3 9
sender
ฉฉ: @
,
ฉฉ@ A"
MouseButtonEventArgs
ฉฉB V
e
ฉฉW X
)
ฉฉX Y
{
ชช 	
	viewModel
ซซ 
.
ซซ 
SetUserDragging
ซซ %
(
ซซ% &
false
ซซ& +
)
ซซ+ ,
;
ซซ, -
}
ฌฌ 	
private
ฎฎ 
void
ฎฎ )
ProgressSlider_ValueChanged
ฎฎ 0
(
ฎฎ0 1
object
ฏฏ 
sender
ฏฏ 
,
ฏฏ ,
RoutedPropertyChangedEventArgs
ฐฐ *
<
ฐฐ* +
double
ฐฐ+ 1
>
ฐฐ1 2
e
ฐฐ3 4
)
ฑฑ 	
{
ฒฒ 	
}
ดด 	
private
ถถ 
void
ถถ '
VolumeSlider_ValueChanged
ถถ .
(
ถถ. /
object
ทท 
sender
ทท 
,
ทท ,
RoutedPropertyChangedEventArgs
ธธ *
<
ธธ* +
double
ธธ+ 1
>
ธธ1 2
e
ธธ3 4
)
นน 	
{
บบ 	
}
ผผ 	
private
ยย 
void
ยย 
FilterGames
ยย  
(
ยย  !
)
ยย! "
{
รร 	
var
ฤฤ 
comboBox
ฤฤ 
=
ฤฤ 
GameComboBox
ฤฤ '
;
ฤฤ' (
var
ลล 

searchText
ลล 
=
ลล 
comboBox
ลล %
.
ลล% &
Text
ลล& *
?
ลล* +
.
ลล+ ,
ToLower
ลล, 3
(
ลล3 4
)
ลล4 5
??
ลล6 8
$str
ลล9 ;
;
ลล; <
	viewModel
ฦฦ 
.
ฦฦ 
FilterGames
ฦฦ !
(
ฦฦ! "

searchText
ฦฦ" ,
)
ฦฦ, -
;
ฦฦ- .
}
วว 	
private
ษษ 
void
ษษ  
FilterAndShowGames
ษษ '
(
ษษ' (
)
ษษ( )
{
สส 	
var
หห 
comboBox
หห 
=
หห 
GameComboBox
หห '
;
หห' (
var
ฬฬ 

searchText
ฬฬ 
=
ฬฬ 
comboBox
ฬฬ %
.
ฬฬ% &
Text
ฬฬ& *
?
ฬฬ* +
.
ฬฬ+ ,
ToLower
ฬฬ, 3
(
ฬฬ3 4
)
ฬฬ4 5
??
ฬฬ6 8
$str
ฬฬ9 ;
;
ฬฬ; <
	viewModel
ฮฮ 
.
ฮฮ 
FilterGames
ฮฮ !
(
ฮฮ! "

searchText
ฮฮ" ,
)
ฮฮ, -
;
ฮฮ- .
if
ะะ 
(
ะะ 
string
ะะ 
.
ะะ  
IsNullOrWhiteSpace
ะะ )
(
ะะ) *

searchText
ะะ* 4
)
ะะ4 5
)
ะะ5 6
{
ัั 
comboBox
าา 
.
าา 
IsDropDownOpen
าา '
=
าา( )
false
าา* /
;
าา/ 0
}
ำำ 
else
ิิ 
{
ีี 
if
ืื 
(
ืื 
comboBox
ืื 
.
ืื 
SelectedItem
ืื )
!=
ืื* ,
null
ืื- 1
)
ืื1 2
{
ุุ 
var
ูู 
selectedText
ูู $
=
ูู% &
comboBox
ูู' /
.
ูู/ 0
Text
ูู0 4
;
ูู4 5
comboBox
ฺฺ 
.
ฺฺ 
SelectedItem
ฺฺ )
=
ฺฺ* +
null
ฺฺ, 0
;
ฺฺ0 1
comboBox
 
.
 
Text
 !
=
" #
selectedText
$ 0
;
0 1
}
 
if
฿฿ 
(
฿฿ 
	viewModel
฿฿ 
.
฿฿ 
Games
฿฿ #
.
฿฿# $
Count
฿฿$ )
>
฿฿* +
$num
฿฿, -
)
฿฿- .
{
เเ 
if
แแ 
(
แแ 
!
แแ 
comboBox
แแ !
.
แแ! "
IsDropDownOpen
แแ" 0
)
แแ0 1
{
โโ 
comboBox
ใใ  
.
ใใ  !
IsDropDownOpen
ใใ! /
=
ใใ0 1
true
ใใ2 6
;
ใใ6 7
}
ไไ 
}
ๅๅ 
else
ๆๆ 
{
็็ 
comboBox
่่ 
.
่่ 
IsDropDownOpen
่่ +
=
่่, -
false
่่. 3
;
่่3 4
}
้้ 
}
๊๊ 
}
๋๋ 	
private
๑๑ 
void
๑๑ 
ShowTrackCover
๑๑ #
(
๑๑# $
BitmapImage
๑๑$ /

trackCover
๑๑0 :
)
๑๑: ;
{
๒๒ 	
var
๓๓ 
preview
๓๓ 
=
๓๓ 
new
๓๓  
CoverPreviewWindow
๓๓ 0
(
๓๓0 1
embeddedImage
๓๓1 >
:
๓๓> ?

trackCover
๓๓@ J
)
๓๓J K
;
๓๓K L
preview
๔๔ 
.
๔๔ 
Owner
๔๔ 
=
๔๔ 
Window
๔๔ "
.
๔๔" #
	GetWindow
๔๔# ,
(
๔๔, -
this
๔๔- 1
)
๔๔1 2
;
๔๔2 3
preview
๕๕ 
.
๕๕ 
Show
๕๕ 
(
๕๕ 
)
๕๕ 
;
๕๕ 
}
๖๖ 	
private
๘๘ 
void
๘๘ 
ShowDiscogsCover
๘๘ %
(
๘๘% &
string
๘๘& ,
coverUrl
๘๘- 5
)
๘๘5 6
{
๙๙ 	
var
๚๚ 
preview
๚๚ 
=
๚๚ 
new
๚๚  
CoverPreviewWindow
๚๚ 0
(
๚๚0 1
imageUrl
๚๚1 9
:
๚๚9 :
coverUrl
๚๚; C
)
๚๚C D
;
๚๚D E
preview
๛๛ 
.
๛๛ 
Owner
๛๛ 
=
๛๛ 
Window
๛๛ "
.
๛๛" #
	GetWindow
๛๛# ,
(
๛๛, -
this
๛๛- 1
)
๛๛1 2
;
๛๛2 3
preview
 
.
 
Show
 
(
 
)
 
;
 
}
 	
private
 
void
 
ShowErrorMessage
 %
(
% &
string
& ,
message
- 4
)
4 5
{
 	

MessageBox
 
.
 
Show
 
(
 
message
 #
,
# $
$str
% ,
,
, -
MessageBoxButton
. >
.
> ?
OK
? A
,
A B
MessageBoxImage
C R
.
R S
Error
S X
)
X Y
;
Y Z
}
 	
private
 
void
 
ShowInfoMessage
 $
(
$ %
string
% +
message
, 3
)
3 4
{
 	

MessageBox
 
.
 
Show
 
(
 
message
 
,
 
$str
 
,
 
MessageBoxButton
  
.
  !
OK
! #
,
# $
MessageBoxImage
 
.
  
Information
  +
)
 
;
 
}
 	
private
 "
DiscogsMetadataModel
 $&
ShowDiscogsReleaseDialog
% =
(
= >
List
 
<
 "
DiscogsMetadataModel
 %
>
% &
results
' .
,
. /
String
 
token
 
)
 	
{
 	
var
 
dialog
 
=
 
new
 (
DiscogsReleaseSelectDialog
 7
(
7 8
results
8 ?
,
? @
token
A F
)
F G
;
G H
dialog
 
.
 
Owner
 
=
 
Window
 !
.
! "
	GetWindow
" +
(
+ ,
this
, 0
)
0 1
;
1 2
if
 
(
 
dialog
 
.
 

ShowDialog
 !
(
! "
)
" #
==
$ &
true
' +
&&
, .
dialog
/ 5
.
5 6
SelectedRelease
6 E
!=
F H
null
I M
)
M N
{
 
return
 
dialog
 
.
 
SelectedRelease
 -
;
- .
}
 
return
 
null
 
;
 
}
 	
public
ขข 
void
ขข 
	StopMusic
ขข 
(
ขข 
)
ขข 
{
ฃฃ 	
	viewModel
คค 
?
คค 
.
คค 
StopCommand
คค "
.
คค" #
Execute
คค# *
(
คค* +
null
คค+ /
)
คค/ 0
;
คค0 1
}
ฅฅ 	
private
ฐฐ 
void
ฐฐ 

OnUnloaded
ฐฐ 
(
ฐฐ  
object
ฐฐ  &
sender
ฐฐ' -
,
ฐฐ- .
RoutedEventArgs
ฐฐ/ >
e
ฐฐ? @
)
ฐฐ@ A
{
ฑฑ 	
try
ฒฒ 
{
ณณ 
if
ถถ 
(
ถถ 
	viewModel
ถถ 
!=
ถถ  
null
ถถ! %
)
ถถ% &
{
ทท 
try
ธธ 
{
นน 
	viewModel
บบ !
.
บบ! "
StopCommand
บบ" -
?
บบ- .
.
บบ. /
Execute
บบ/ 6
(
บบ6 7
null
บบ7 ;
)
บบ; <
;
บบ< =
System
ปป 
.
ปป 
Diagnostics
ปป *
.
ปป* +
Debug
ปป+ 0
.
ปป0 1
	WriteLine
ปป1 :
(
ปป: ;
$str
ผผ R
)
ฝฝ 
;
ฝฝ 
}
พพ 
catch
ฟฟ 
(
ฟฟ 
	Exception
ฟฟ $
musicEx
ฟฟ% ,
)
ฟฟ, -
{
ภภ 
System
มม 
.
มม 
Diagnostics
มม *
.
มม* +
Debug
มม+ 0
.
มม0 1
	WriteLine
มม1 :
(
มม: ;
$"
ยย 
$str
ยย L
{
ยยL M
musicEx
ยยM T
.
ยยT U
Message
ยยU \
}
ยย\ ]
"
ยย] ^
)
รร 
;
รร 
}
ลล 
}
ฦฦ  
_columnPersistence
ษษ "
?
ษษ" #
.
ษษ# $
Dispose
ษษ$ +
(
ษษ+ ,
)
ษษ, -
;
ษษ- . 
_columnPersistence
สส "
=
สส# $
null
สส% )
;
สส) *
if
ออ 
(
ออ 
	viewModel
ออ 
!=
ออ  
null
ออ! %
)
ออ% &
{
ฮฮ 
	viewModel
ฯฯ 
.
ฯฯ '
OnShowTrackCoverRequested
ฯฯ 7
-=
ฯฯ8 :
ShowTrackCover
ฯฯ; I
;
ฯฯI J
	viewModel
ะะ 
.
ะะ )
OnShowDiscogsCoverRequested
ะะ 9
-=
ะะ: <
ShowDiscogsCover
ะะ= M
;
ะะM N
	viewModel
ัั 
.
ัั "
OnShowErrorRequested
ัั 2
-=
ัั3 5
ShowErrorMessage
ัั6 F
;
ััF G
	viewModel
าา 
.
าา !
OnShowInfoRequested
าา 1
-=
าา2 4
ShowInfoMessage
าา5 D
;
าาD E
	viewModel
ำำ 
.
ำำ -
OnSelectDiscogsReleaseRequested
ำำ =
-=
ำำ> @&
ShowDiscogsReleaseDialog
ำำA Y
;
ำำY Z
}
ิิ 
}
ีี 
catch
ึึ 
(
ึึ 
	Exception
ึึ 
ex
ึึ 
)
ึึ  
{
ืื 
System
ุุ 
.
ุุ 
Diagnostics
ุุ "
.
ุุ" #
Debug
ุุ# (
.
ุุ( )
	WriteLine
ุุ) 2
(
ุุ2 3
$"
ุุ3 5
$str
ุุ5 K
{
ุุK L
ex
ุุL N
.
ุุN O
Message
ุุO V
}
ุุV W
"
ุุW X
)
ุุX Y
;
ุุY Z
}
ูู 
}
ฺฺ 	
}
 
} ฦ
QC:\Playnite\_github\OstPlayer\source\Views\Settings\OstPlayerSettingsView.xaml.cs
	namespace^^ 	
	OstPlayer^^
 
.^^ 
Views^^ 
.^^ 
Settings^^ "
{__ 
public`` 

partial`` 
class`` !
OstPlayerSettingsView`` .
:``/ 0
UserControl``1 <
{aa 
publicbb !
OstPlayerSettingsViewbb $
(bb$ %
)bb% &
{cc 	
InitializeComponentdd 
(dd  
)dd  !
;dd! "
}hh 	
}ii 
}jj อฦ
9C:\Playnite\_github\OstPlayer\source\OstPlayerSettings.cs
	namespaceVV 	
	OstPlayerVV
 
{WW 
public\\ 

class\\ 
OstPlayerSettings\\ "
:\\# $
ObservableObject\\% 5
{]] 
private__ 
string__ 
discogsToken__ #
=__$ %
$str__& (
;__( )
private`` 
double`` 
defaultVolume`` $
=``% &
$num``' +
;``+ ,
privateaa 
boolaa 
autoPlayNextaa !
=aa" #
trueaa$ (
;aa( )
privatebb 
boolbb 
enableMetadataCachebb (
=bb) *
truebb+ /
;bb/ 0
privatecc 
boolcc $
showMp3MetadataByDefaultcc -
=cc. /
truecc0 4
;cc4 5
privatedd 
booldd (
showDiscogsMetadataByDefaultdd 1
=dd2 3
truedd4 8
;dd8 9
privateee 
boolee $
pausePlayniteSoundOnPlayee -
=ee. /
trueee0 4
;ee4 5
privatehh 
inthh !
metadataCacheTTLHourshh )
=hh* +
$numhh, -
;hh- .
privateii 
intii 
maxCacheSizeii  
=ii! "
$numii# '
;ii' (
privatejj 
booljj *
enableMemoryPressureAdjustmentjj 3
=jj4 5
truejj6 :
;jj: ;
privatekk 
boolkk 
enableCacheWarmingkk '
=kk( )
truekk* .
;kk. /
privatell 
intll '
cacheCleanupIntervalMinutesll /
=ll0 1
$numll2 3
;ll3 4
privateoo 
doubleoo "
trackNumberColumnWidthoo -
=oo. /
$numoo0 4
;oo4 5
privatepp 
doublepp !
trackTitleColumnWidthpp ,
=pp- .
$numpp/ 4
;pp4 5
privateqq 
doubleqq 
durationColumnWidthqq *
=qq+ ,
$numqq- 2
;qq2 3
privatett 
doublett &
titleDurationSplitterRatiott 1
=tt2 3
$numtt4 8
;tt8 9
public{{ 
string{{ 
DiscogsToken{{ "
{|| 	
get}} 
=>}} 
this}} 
.}} 
discogsToken}} $
;}}$ %
set~~ 
{ 
this
 
.
 
discogsToken
 !
=
" #
value
$ )
;
) *
this
 
.
 
OnPropertyChanged
 &
(
& '
)
' (
;
( )
}
 
}
 	
[
 	
DefaultValue
	 
(
 
$num
 
)
 
]
 
public
 
double
 
DefaultVolume
 #
{
 	
get
 
=>
 
this
 
.
 
defaultVolume
 %
;
% &
set
 
{
 
this
 
.
 
defaultVolume
 "
=
# $
Math
% )
.
) *
Max
* -
(
- .
$num
. /
,
/ 0
Math
1 5
.
5 6
Min
6 9
(
9 :
$num
: =
,
= >
value
? D
)
D E
)
E F
;
F G
this
 
.
 
OnPropertyChanged
 &
(
& '
)
' (
;
( )
}
 
}
 	
[
 	
DefaultValue
	 
(
 
true
 
)
 
]
 
public
 
bool
 
AutoPlayNext
  
{
 	
get
 
=>
 
this
 
.
 
autoPlayNext
 $
;
$ %
set
 
{
 
this
 
.
 
autoPlayNext
 !
=
" #
value
$ )
;
) *
this
 
.
 
OnPropertyChanged
 &
(
& '
)
' (
;
( )
}
 
}
 	
[
คค 	
DefaultValue
คค	 
(
คค 
true
คค 
)
คค 
]
คค 
public
ฅฅ 
bool
ฅฅ &
PausePlayniteSoundOnPlay
ฅฅ ,
{
ฆฆ 	
get
งง 
=>
งง 
this
งง 
.
งง &
pausePlayniteSoundOnPlay
งง 0
;
งง0 1
set
จจ 
{
ฉฉ 
this
ชช 
.
ชช &
pausePlayniteSoundOnPlay
ชช -
=
ชช. /
value
ชช0 5
;
ชช5 6
this
ซซ 
.
ซซ 
OnPropertyChanged
ซซ &
(
ซซ& '
)
ซซ' (
;
ซซ( )
}
ฌฌ 
}
ญญ 	
[
ทท 	
DefaultValue
ทท	 
(
ทท 
$num
ทท 
)
ทท 
]
ทท 
public
ธธ 
double
ธธ $
TrackNumberColumnWidth
ธธ ,
{
นน 	
get
บบ 
=>
บบ 
this
บบ 
.
บบ $
trackNumberColumnWidth
บบ .
;
บบ. /
set
ปป 
{
ผผ 
this
ฝฝ 
.
ฝฝ $
trackNumberColumnWidth
ฝฝ +
=
ฝฝ, -
Math
ฝฝ. 2
.
ฝฝ2 3
Max
ฝฝ3 6
(
ฝฝ6 7
$num
ฝฝ7 9
,
ฝฝ9 :
Math
ฝฝ; ?
.
ฝฝ? @
Min
ฝฝ@ C
(
ฝฝC D
$num
ฝฝD G
,
ฝฝG H
value
ฝฝI N
)
ฝฝN O
)
ฝฝO P
;
ฝฝP Q
this
พพ 
.
พพ 
OnPropertyChanged
พพ &
(
พพ& '
)
พพ' (
;
พพ( )
}
ฟฟ 
}
ภภ 	
[
วว 	
DefaultValue
วว	 
(
วว 
$num
วว 
)
วว 
]
วว 
public
ศศ 
double
ศศ #
TrackTitleColumnWidth
ศศ +
{
ษษ 	
get
สส 
=>
สส 
this
สส 
.
สส #
trackTitleColumnWidth
สส -
;
สส- .
set
หห 
{
ฬฬ 
this
ออ 
.
ออ #
trackTitleColumnWidth
ออ *
=
ออ+ ,
Math
ออ- 1
.
ออ1 2
Max
ออ2 5
(
ออ5 6
$num
ออ6 9
,
ออ9 :
value
ออ; @
)
ออ@ A
;
ออA B
this
ฮฮ 
.
ฮฮ 
OnPropertyChanged
ฮฮ &
(
ฮฮ& '
)
ฮฮ' (
;
ฮฮ( )
}
ฯฯ 
}
ะะ 	
[
ืื 	
DefaultValue
ืื	 
(
ืื 
$num
ืื 
)
ืื 
]
ืื 
public
ุุ 
double
ุุ !
DurationColumnWidth
ุุ )
{
ูู 	
get
ฺฺ 
=>
ฺฺ 
this
ฺฺ 
.
ฺฺ !
durationColumnWidth
ฺฺ +
;
ฺฺ+ ,
set
 
{
 
this
 
.
 !
durationColumnWidth
 (
=
) *
Math
+ /
.
/ 0
Max
0 3
(
3 4
$num
4 6
,
6 7
value
8 =
)
= >
;
> ?
this
 
.
 
OnPropertyChanged
 &
(
& '
)
' (
;
( )
}
฿฿ 
}
เเ 	
[
็็ 	
DefaultValue
็็	 
(
็็ 
$num
็็ 
)
็็ 
]
็็ 
public
่่ 
double
่่ (
TitleDurationSplitterRatio
่่ 0
{
้้ 	
get
๊๊ 
=>
๊๊ 
this
๊๊ 
.
๊๊ (
titleDurationSplitterRatio
๊๊ 2
;
๊๊2 3
set
๋๋ 
{
์์ 
this
ํํ 
.
ํํ (
titleDurationSplitterRatio
ํํ /
=
ํํ0 1
Math
ํํ2 6
.
ํํ6 7
Max
ํํ7 :
(
ํํ: ;
$num
ํํ; >
,
ํํ> ?
Math
ํํ@ D
.
ํํD E
Min
ํํE H
(
ํํH I
$num
ํํI L
,
ํํL M
value
ํํN S
)
ํํS T
)
ํํT U
;
ํํU V
this
๎๎ 
.
๎๎ 
OnPropertyChanged
๎๎ &
(
๎๎& '
)
๎๎' (
;
๎๎( )
}
๏๏ 
}
๐๐ 	
[
๙๙ 	
DefaultValue
๙๙	 
(
๙๙ 
true
๙๙ 
)
๙๙ 
]
๙๙ 
public
๚๚ 
bool
๚๚ &
ShowMp3MetadataByDefault
๚๚ ,
{
๛๛ 	
get
 
=>
 
this
 
.
 &
showMp3MetadataByDefault
 0
;
0 1
set
 
{
 
this
 
.
 &
showMp3MetadataByDefault
 -
=
. /
value
0 5
;
5 6
this
 
.
 
OnPropertyChanged
 &
(
& '
)
' (
;
( )
}
 
}
 	
[
 	
DefaultValue
	 
(
 
true
 
)
 
]
 
public
 
bool
 *
ShowDiscogsMetadataByDefault
 0
{
 	
get
 
=>
 
this
 
.
 *
showDiscogsMetadataByDefault
 4
;
4 5
set
 
{
 
this
 
.
 *
showDiscogsMetadataByDefault
 1
=
2 3
value
4 9
;
9 :
this
 
.
 
OnPropertyChanged
 &
(
& '
)
' (
;
( )
}
 
}
 	
[
 	
DefaultValue
	 
(
 
true
 
)
 
]
 
public
 
bool
 !
EnableMetadataCache
 '
{
 	
get
 
=>
 
this
 
.
 !
enableMetadataCache
 +
;
+ ,
set
 
{
 
this
 
.
 !
enableMetadataCache
 (
=
) *
value
+ 0
;
0 1
this
กก 
.
กก 
OnPropertyChanged
กก &
(
กก& '
)
กก' (
;
กก( )
this
ขข 
.
ขข 
OnPropertyChanged
ขข &
(
ขข& '
nameof
ขข' -
(
ขข- .
this
ขข. 2
.
ขข2 3)
IsCacheConfigurationEnabled
ขข3 N
)
ขขN O
)
ขขO P
;
ขขP Q
}
ฃฃ 
}
คค 	
[
ซซ 	
DefaultValue
ซซ	 
(
ซซ 
$num
ซซ 
)
ซซ 
]
ซซ 
public
ฌฌ 
int
ฌฌ #
MetadataCacheTTLHours
ฌฌ (
{
ญญ 	
get
ฎฎ 
=>
ฎฎ 
this
ฎฎ 
.
ฎฎ #
metadataCacheTTLHours
ฎฎ -
;
ฎฎ- .
set
ฏฏ 
{
ฐฐ 
this
ฑฑ 
.
ฑฑ #
metadataCacheTTLHours
ฑฑ *
=
ฑฑ+ ,
Math
ฑฑ- 1
.
ฑฑ1 2
Max
ฑฑ2 5
(
ฑฑ5 6
$num
ฑฑ6 7
,
ฑฑ7 8
Math
ฑฑ9 =
.
ฑฑ= >
Min
ฑฑ> A
(
ฑฑA B
$num
ฑฑB D
,
ฑฑD E
value
ฑฑF K
)
ฑฑK L
)
ฑฑL M
;
ฑฑM N
this
ฒฒ 
.
ฒฒ 
OnPropertyChanged
ฒฒ &
(
ฒฒ& '
)
ฒฒ' (
;
ฒฒ( )
}
ณณ 
}
ดด 	
[
ปป 	
DefaultValue
ปป	 
(
ปป 
$num
ปป 
)
ปป 
]
ปป 
public
ผผ 
int
ผผ 
MaxCacheSize
ผผ 
{
ฝฝ 	
get
พพ 
=>
พพ 
this
พพ 
.
พพ 
maxCacheSize
พพ $
;
พพ$ %
set
ฟฟ 
{
ภภ 
this
มม 
.
มม 
maxCacheSize
มม !
=
มม" #
Math
มม$ (
.
มม( )
Max
มม) ,
(
มม, -
$num
มม- 0
,
มม0 1
Math
มม2 6
.
มม6 7
Min
มม7 :
(
มม: ;
$num
มม; @
,
มม@ A
value
มมB G
)
มมG H
)
มมH I
;
มมI J
this
ยย 
.
ยย 
OnPropertyChanged
ยย &
(
ยย& '
)
ยย' (
;
ยย( )
}
รร 
}
ฤฤ 	
[
สส 	
DefaultValue
สส	 
(
สส 
true
สส 
)
สส 
]
สส 
public
หห 
bool
หห ,
EnableMemoryPressureAdjustment
หห 2
{
ฬฬ 	
get
ออ 
=>
ออ 
this
ออ 
.
ออ ,
enableMemoryPressureAdjustment
ออ 6
;
ออ6 7
set
ฮฮ 
{
ฯฯ 
this
ะะ 
.
ะะ ,
enableMemoryPressureAdjustment
ะะ 3
=
ะะ4 5
value
ะะ6 ;
;
ะะ; <
this
ัั 
.
ัั 
OnPropertyChanged
ัั &
(
ัั& '
)
ัั' (
;
ัั( )
}
าา 
}
ำำ 	
[
ูู 	
DefaultValue
ูู	 
(
ูู 
true
ูู 
)
ูู 
]
ูู 
public
ฺฺ 
bool
ฺฺ  
EnableCacheWarming
ฺฺ &
{
 	
get
 
=>
 
this
 
.
  
enableCacheWarming
 *
;
* +
set
 
{
 
this
฿฿ 
.
฿฿  
enableCacheWarming
฿฿ '
=
฿฿( )
value
฿฿* /
;
฿฿/ 0
this
เเ 
.
เเ 
OnPropertyChanged
เเ &
(
เเ& '
)
เเ' (
;
เเ( )
}
แแ 
}
โโ 	
[
้้ 	
DefaultValue
้้	 
(
้้ 
$num
้้ 
)
้้ 
]
้้ 
public
๊๊ 
int
๊๊ )
CacheCleanupIntervalMinutes
๊๊ .
{
๋๋ 	
get
์์ 
=>
์์ 
this
์์ 
.
์์ )
cacheCleanupIntervalMinutes
์์ 3
;
์์3 4
set
ํํ 
{
๎๎ 
this
๏๏ 
.
๏๏ )
cacheCleanupIntervalMinutes
๏๏ 0
=
๏๏1 2
Math
๏๏3 7
.
๏๏7 8
Max
๏๏8 ;
(
๏๏; <
$num
๏๏< =
,
๏๏= >
Math
๏๏? C
.
๏๏C D
Min
๏๏D G
(
๏๏G H
$num
๏๏H J
,
๏๏J K
value
๏๏L Q
)
๏๏Q R
)
๏๏R S
;
๏๏S T
this
๐๐ 
.
๐๐ 
OnPropertyChanged
๐๐ &
(
๐๐& '
)
๐๐' (
;
๐๐( )
}
๑๑ 
}
๒๒ 	
public
 
bool
 )
IsCacheConfigurationEnabled
 /
=>
0 2
this
3 7
.
7 8!
EnableMetadataCache
8 K
;
K L
public
 
TimeSpan
 
MetadataCacheTTL
 (
=>
) +
TimeSpan
, 4
.
4 5
	FromHours
5 >
(
> ?
this
? C
.
C D#
MetadataCacheTTLHours
D Y
)
Y Z
;
Z [
public
 
TimeSpan
 "
CacheCleanupInterval
 ,
=>
- /
TimeSpan
 
.
 
FromMinutes
  
(
  !
this
! %
.
% &)
CacheCleanupIntervalMinutes
& A
)
A B
;
B C
public
 
string
 "
EstimatedMemoryUsage
 *
{
 	
get
 
{
 
if
 
(
 
!
 
this
 
.
 !
EnableMetadataCache
 -
)
- .
return
 
$str
 2
;
2 3
var
 
estimatedMB
 
=
  !
(
" #
this
# '
.
' (
MaxCacheSize
( 4
*
5 6
$num
7 ;
)
; <
/
= >
(
? @
$num
@ D
*
E F
$num
G K
)
K L
;
L M
return
 
$"
 
$str
 
{
 
estimatedMB
 &
}
& '
$str
' *
"
* +
;
+ ,
}
 
}
 	
public
ฅฅ 
List
ฅฅ 
<
ฅฅ 
string
ฅฅ 
>
ฅฅ 
Validate
ฅฅ $
(
ฅฅ$ %
)
ฅฅ% &
{
ฆฆ 	
var
งง 
errors
งง 
=
งง 
new
งง 
List
งง !
<
งง! "
string
งง" (
>
งง( )
(
งง) *
)
งง* +
;
งง+ ,
if
ชช 
(
ชช 
this
ชช 
.
ชช 
DefaultVolume
ชช "
<
ชช# $
$num
ชช% &
||
ชช' )
this
ชช* .
.
ชช. /
DefaultVolume
ชช/ <
>
ชช= >
$num
ชช? B
)
ชชB C
errors
ซซ 
.
ซซ 
Add
ซซ 
(
ซซ 
$str
ซซ E
)
ซซE F
;
ซซF G
if
ฎฎ 
(
ฎฎ 
this
ฎฎ 
.
ฎฎ !
EnableMetadataCache
ฎฎ (
)
ฎฎ( )
{
ฏฏ 
if
ฐฐ 
(
ฐฐ 
this
ฐฐ 
.
ฐฐ #
MetadataCacheTTLHours
ฐฐ .
<
ฐฐ/ 0
$num
ฐฐ1 2
||
ฐฐ3 5
this
ฐฐ6 :
.
ฐฐ: ;#
MetadataCacheTTLHours
ฐฐ; P
>
ฐฐQ R
$num
ฐฐS U
)
ฐฐU V
errors
ฑฑ 
.
ฑฑ 
Add
ฑฑ 
(
ฑฑ 
$str
ฑฑ I
)
ฑฑI J
;
ฑฑJ K
if
ณณ 
(
ณณ 
this
ณณ 
.
ณณ 
MaxCacheSize
ณณ %
<
ณณ& '
$num
ณณ( +
||
ณณ, .
this
ณณ/ 3
.
ณณ3 4
MaxCacheSize
ณณ4 @
>
ณณA B
$num
ณณC H
)
ณณH I
errors
ดด 
.
ดด 
Add
ดด 
(
ดด 
$str
ดด V
)
ดดV W
;
ดดW X
if
ถถ 
(
ถถ 
this
ถถ 
.
ถถ )
CacheCleanupIntervalMinutes
ถถ 4
<
ถถ5 6
$num
ถถ7 8
||
ถถ9 ;
this
ถถ< @
.
ถถ@ A)
CacheCleanupIntervalMinutes
ถถA \
>
ถถ] ^
$num
ถถ_ a
)
ถถa b
errors
ทท 
.
ทท 
Add
ทท 
(
ทท 
$str
ทท X
)
ททX Y
;
ททY Z
var
บบ 
estimatedMB
บบ 
=
บบ  !
(
บบ" #
this
บบ# '
.
บบ' (
MaxCacheSize
บบ( 4
*
บบ5 6
$num
บบ7 ;
)
บบ; <
/
บบ= >
(
บบ? @
$num
บบ@ D
*
บบE F
$num
บบG K
)
บบK L
;
บบL M
if
ปป 
(
ปป 
estimatedMB
ปป 
>
ปป  !
$num
ปป" $
)
ปป$ %
{
ผผ 
errors
ฝฝ 
.
ฝฝ 
Add
ฝฝ 
(
ฝฝ 
$"
ฝฝ !
$str
ฝฝ! D
{
ฝฝD E
estimatedMB
ฝฝE P
}
ฝฝP Q
$str
ฝฝQ ]
"
ฝฝ] ^
)
ฝฝ^ _
;
ฝฝ_ `
}
พพ 
}
ฟฟ 
return
มม 
errors
มม 
;
มม 
}
ยย 	
public
ษษ 
List
ษษ 
<
ษษ 
string
ษษ 
>
ษษ +
GetPerformanceRecommendations
ษษ 9
(
ษษ9 :
)
ษษ: ;
{
สส 	
var
หห 
recommendations
หห 
=
หห  !
new
หห" %
List
หห& *
<
หห* +
string
หห+ 1
>
หห1 2
(
หห2 3
)
หห3 4
;
หห4 5
if
ออ 
(
ออ 
!
ออ 
this
ออ 
.
ออ !
EnableMetadataCache
ออ )
)
ออ) *
{
ฮฮ 
recommendations
ฯฯ 
.
ฯฯ  
Add
ฯฯ  #
(
ฯฯ# $
$str
ฯฯ$ b
)
ฯฯb c
;
ฯฯc d
}
ะะ 
else
ัั 
{
าา 
if
ำำ 
(
ำำ 
this
ำำ 
.
ำำ #
MetadataCacheTTLHours
ำำ .
<
ำำ/ 0
$num
ำำ1 2
)
ำำ2 3
{
ิิ 
recommendations
ีี #
.
ีี# $
Add
ีี$ '
(
ีี' (
$str
ึึ h
)
ืื 
;
ืื 
}
ุุ 
if
ฺฺ 
(
ฺฺ 
this
ฺฺ 
.
ฺฺ 
MaxCacheSize
ฺฺ %
<
ฺฺ& '
$num
ฺฺ( ,
)
ฺฺ, -
{
 
recommendations
 #
.
# $
Add
$ '
(
' (
$str
 t
)
 
;
 
}
฿฿ 
if
แแ 
(
แแ 
!
แแ 
this
แแ 
.
แแ ,
EnableMemoryPressureAdjustment
แแ 8
)
แแ8 9
{
โโ 
recommendations
ใใ #
.
ใใ# $
Add
ใใ$ '
(
ใใ' (
$str
ไไ Y
)
ๅๅ 
;
ๅๅ 
}
ๆๆ 
if
่่ 
(
่่ 
!
่่ 
this
่่ 
.
่่  
EnableCacheWarming
่่ ,
)
่่, -
{
้้ 
recommendations
๊๊ #
.
๊๊# $
Add
๊๊$ '
(
๊๊' (
$str
๋๋ [
)
์์ 
;
์์ 
}
ํํ 
if
๏๏ 
(
๏๏ 
this
๏๏ 
.
๏๏ )
CacheCleanupIntervalMinutes
๏๏ 4
>
๏๏5 6
$num
๏๏7 9
)
๏๏9 :
{
๐๐ 
recommendations
๑๑ #
.
๑๑# $
Add
๑๑$ '
(
๑๑' (
$str
๒๒ `
)
๓๓ 
;
๓๓ 
}
๔๔ 
}
๕๕ 
return
๗๗ 
recommendations
๗๗ "
;
๗๗" #
}
๘๘ 	
public
 
Services
 
.
 !
MetadataCacheConfig
 +
CreateCacheConfig
, =
(
= >
)
> ?
{
 	
if
 
(
 
!
 
this
 
.
 !
EnableMetadataCache
 )
)
) *
{
 
return
 
new
 
Services
 #
.
# $!
MetadataCacheConfig
$ 7
{
 
MaxCacheSize
  
=
! "
$num
# $
,
$ %,
EnableMemoryPressureAdjustment
 2
=
3 4
false
5 :
,
: ; 
EnableCacheWarming
 &
=
' (
false
) .
,
. /
}
 
;
 
}
 
return
 
new
 
Services
 
.
  !
MetadataCacheConfig
  3
{
 
TrackMetadataTTL
  
=
! "
TimeSpan
# +
.
+ ,
	FromHours
, 5
(
5 6
this
6 :
.
: ;#
MetadataCacheTTLHours
; P
/
Q R
$num
S T
)
T U
,
U V
AlbumMetadataTTL
  
=
! "
this
# '
.
' (
MetadataCacheTTL
( 8
,
8 9!
ExternalMetadataTTL
 #
=
$ %
TimeSpan
& .
.
. /
	FromHours
/ 8
(
8 9
this
9 =
.
= >#
MetadataCacheTTLHours
> S
*
T U
$num
V W
)
W X
,
X Y
MaxCacheSize
 
=
 
this
 #
.
# $
MaxCacheSize
$ 0
,
0 1
CleanupInterval
 
=
  !
this
" &
.
& '"
CacheCleanupInterval
' ;
,
; <,
EnableMemoryPressureAdjustment
 .
=
/ 0
this
1 5
.
5 6,
EnableMemoryPressureAdjustment
6 T
,
T U 
EnableCacheWarming
 "
=
# $
this
% )
.
) * 
EnableCacheWarming
* <
,
< =
}
 
;
 
}
 	
[
ฃฃ 	
Obsolete
ฃฃ	 
(
ฃฃ 
$str
ฃฃ ,
)
ฃฃ, -
]
ฃฃ- .
[
คค 	
DefaultValue
คค	 
(
คค 
$num
คค 
)
คค 
]
คค 
public
ฅฅ 
int
ฅฅ 
MetadataCacheSize
ฅฅ $
{
ฆฆ 	
get
งง 
=>
งง 
Math
งง 
.
งง 
Min
งง 
(
งง 
this
งง  
.
งง  !
MaxCacheSize
งง! -
,
งง- .
$num
งง/ 3
)
งง3 4
;
งง4 5
set
จจ 
{
ฉฉ 
this
ซซ 
.
ซซ 
MaxCacheSize
ซซ !
=
ซซ" #
Math
ซซ$ (
.
ซซ( )
Max
ซซ) ,
(
ซซ, -
$num
ซซ- 0
,
ซซ0 1
Math
ซซ2 6
.
ซซ6 7
Min
ซซ7 :
(
ซซ: ;
$num
ซซ; ?
,
ซซ? @
value
ซซA F
)
ซซF G
)
ซซG H
;
ซซH I
this
ฌฌ 
.
ฌฌ 
OnPropertyChanged
ฌฌ &
(
ฌฌ& '
)
ฌฌ' (
;
ฌฌ( )
this
ญญ 
.
ญญ 
OnPropertyChanged
ญญ &
(
ญญ& '
nameof
ญญ' -
(
ญญ- .
this
ญญ. 2
.
ญญ2 3
MaxCacheSize
ญญ3 ?
)
ญญ? @
)
ญญ@ A
;
ญญA B
}
ฎฎ 
}
ฏฏ 	
}
ฒฒ 
}ณณ ฏ
1C:\Playnite\_github\OstPlayer\source\OstPlayer.cs
	namespace{{ 	
	OstPlayer{{
 
{|| 
public
 

class
 
	OstPlayer
 
:
 
GenericPlugin
 *
{
 
private
 
readonly
 
ServiceContainer
 )
serviceContainer
* :
;
: ;
private
 
readonly
 
ILogger
  
logger
! '
;
' (
private
 
readonly
 "
ErrorHandlingService
 -
errorHandler
. :
;
: ;
private
 
readonly
 
IGameService
 %
gameService
& 1
;
1 2
private
 
readonly
 
IAudioService
 &
audioService
' 3
;
3 4
private
 
readonly
 
IMetadataService
 )
metadataService
* 9
;
9 :
private
 (
OstPlayerSettingsViewModel
 *
settings
+ 3
{
4 5
get
6 9
;
9 :
set
; >
;
> ?
}
@ A
internal
 
SidebarItem
 
SidebarItem
 (
{
) *
get
+ .
;
. /
set
0 3
;
3 4
}
5 6
private
 "
OstPlayerSidebarView
 $
lastSidebarView
% 4
=
5 6
null
7 ;
;
; <
private
 
bool
 $
playniteSoundWasPaused
 +
=
, -
false
. 3
;
3 4
public
 
override
 
Guid
 
Id
 
{
  !
get
" %
;
% &
}
' (
=
) *
Guid
+ /
.
/ 0
Parse
0 5
(
5 6
$str
6 \
)
\ ]
;
] ^
public
 
	OstPlayer
 
(
 
IPlayniteAPI
 %
api
& )
)
) *
:
 
base
 
(
 
api
 
)
 
{
 	
try
 
{
 
this
ขข 
.
ขข 
serviceContainer
ขข %
=
ขข& '
ServiceContainer
ขข( 8
.
ขข8 9
Instance
ขข9 A
;
ขขA B
this
ฃฃ 
.
ฃฃ +
InitializeDependencyInjection
ฃฃ 2
(
ฃฃ2 3
api
ฃฃ3 6
)
ฃฃ6 7
;
ฃฃ7 8
try
ฆฆ 
{
งง 
this
จจ 
.
จจ 
logger
จจ 
=
จจ  !
this
ฉฉ 
.
ฉฉ 
serviceContainer
ฉฉ -
.
ฉฉ- .

GetService
ฉฉ. 8
<
ฉฉ8 9
ILogger
ฉฉ9 @
>
ฉฉ@ A
(
ฉฉA B
)
ฉฉB C
??
ฉฉD F

LogManager
ฉฉG Q
.
ฉฉQ R
	GetLogger
ฉฉR [
(
ฉฉ[ \
)
ฉฉ\ ]
;
ฉฉ] ^
this
ชช 
.
ชช 
errorHandler
ชช %
=
ชช& '
this
ซซ 
.
ซซ 
serviceContainer
ซซ -
.
ซซ- .

GetService
ซซ. 8
<
ซซ8 9"
ErrorHandlingService
ซซ9 M
>
ซซM N
(
ซซN O
)
ซซO P
??
ฌฌ 
new
ฌฌ "
ErrorHandlingService
ฌฌ 3
(
ฌฌ3 4
)
ฌฌ4 5
;
ฌฌ5 6
this
ญญ 
.
ญญ 
gameService
ญญ $
=
ญญ% &
this
ญญ' +
.
ญญ+ ,
serviceContainer
ญญ, <
.
ญญ< =

GetService
ญญ= G
<
ญญG H
IGameService
ญญH T
>
ญญT U
(
ญญU V
)
ญญV W
;
ญญW X
this
ฎฎ 
.
ฎฎ 
audioService
ฎฎ %
=
ฎฎ& '
this
ฎฎ( ,
.
ฎฎ, -
serviceContainer
ฎฎ- =
.
ฎฎ= >

GetService
ฎฎ> H
<
ฎฎH I
IAudioService
ฎฎI V
>
ฎฎV W
(
ฎฎW X
)
ฎฎX Y
;
ฎฎY Z
this
ฏฏ 
.
ฏฏ 
metadataService
ฏฏ (
=
ฏฏ) *
this
ฏฏ+ /
.
ฏฏ/ 0
serviceContainer
ฏฏ0 @
.
ฏฏ@ A

GetService
ฏฏA K
<
ฏฏK L
IMetadataService
ฏฏL \
>
ฏฏ\ ]
(
ฏฏ] ^
)
ฏฏ^ _
;
ฏฏ_ `
}
ฐฐ 
catch
ฑฑ 
(
ฑฑ 
	Exception
ฑฑ  
	serviceEx
ฑฑ! *
)
ฑฑ* +
{
ฒฒ 
var
ดด 
fallbackLogger
ดด &
=
ดด' (

LogManager
ดด) 3
.
ดด3 4
	GetLogger
ดด4 =
(
ดด= >
)
ดด> ?
;
ดด? @
fallbackLogger
ตต "
.
ตต" #
Warn
ตต# '
(
ตต' (
	serviceEx
ถถ !
,
ถถ! "
$str
ทท U
)
ธธ 
;
ธธ 
}
นน 
this
ผผ 
.
ผผ  
InitializeSettings
ผผ '
(
ผผ' (
)
ผผ( )
;
ผผ) *
this
ฟฟ 
.
ฟฟ #
InitializeSidebarItem
ฟฟ *
(
ฟฟ* +
)
ฟฟ+ ,
;
ฟฟ, -
}
ภภ 
catch
มม 
(
มม 
	Exception
มม 
ex
มม 
)
มม  
{
ยย 
var
รร 
fallbackLogger
รร "
=
รร# $

LogManager
รร% /
.
รร/ 0
	GetLogger
รร0 9
(
รร9 :
)
รร: ;
;
รร; <
fallbackLogger
ฤฤ 
.
ฤฤ 
Error
ฤฤ $
(
ฤฤ$ %
ex
ฤฤ% '
,
ฤฤ' (
$str
ฤฤ) \
)
ฤฤ\ ]
;
ฤฤ] ^
try
วว 
{
ศศ 
var
ษษ "
fallbackErrorHandler
ษษ ,
=
ษษ- .
new
ษษ/ 2"
ErrorHandlingService
ษษ3 G
(
ษษG H
)
ษษH I
;
ษษI J"
fallbackErrorHandler
สส (
.
สส( )!
HandlePlaybackError
สส) <
(
สส< =
ex
สส= ?
,
สส? @
$str
สสA [
)
สส[ \
;
สส\ ]
}
หห 
catch
ฬฬ 
{
ออ 
System
ฯฯ 
.
ฯฯ 
Diagnostics
ฯฯ &
.
ฯฯ& '
Debug
ฯฯ' ,
.
ฯฯ, -
	WriteLine
ฯฯ- 6
(
ฯฯ6 7
$"
ะะ 
$str
ะะ E
{
ะะE F
ex
ะะF H
.
ะะH I
Message
ะะI P
}
ะะP Q
"
ะะQ R
)
ัั 
;
ัั 
}
าา 
throw
ิิ 
;
ิิ 
}
ีี 
}
ึึ 	
private
 
void
 +
InitializeDependencyInjection
 2
(
2 3
IPlayniteAPI
3 ?
api
@ C
)
C D
{
฿฿ 	
try
เเ 
{
แแ 
this
ใใ 
.
ใใ 
serviceContainer
ใใ %
.
ใใ% &
Clear
ใใ& +
(
ใใ+ ,
)
ใใ, -
;
ใใ- .
this
ๆๆ 
.
ๆๆ 
serviceContainer
ๆๆ %
.
ๆๆ% &
RegisterSingleton
ๆๆ& 7
<
ๆๆ7 8
IPlayniteAPI
ๆๆ8 D
>
ๆๆD E
(
ๆๆE F
api
ๆๆF I
)
ๆๆI J
;
ๆๆJ K
this
็็ 
.
็็ 
serviceContainer
็็ %
.
็็% &
RegisterSingleton
็็& 7
<
็็7 8
	OstPlayer
็็8 A
>
็็A B
(
็็B C
this
็็C G
)
็็G H
;
็็H I
this
่่ 
.
่่ 
serviceContainer
่่ %
.
่่% &
RegisterSingleton
่่& 7
<
่่7 8
ILogger
่่8 ?
>
่่? @
(
่่@ A

LogManager
่่A K
.
่่K L
	GetLogger
่่L U
(
่่U V
)
่่V W
)
่่W X
;
่่X Y
this
๋๋ 
.
๋๋ 
serviceContainer
๋๋ %
.
๋๋% &
RegisterSingleton
๋๋& 7
<
๋๋7 8"
ErrorHandlingService
์์ (
,
์์( )"
ErrorHandlingService
ํํ (
>
๎๎ 
(
๎๎ 
)
๎๎ 
;
๎๎ 
this
๑๑ 
.
๑๑ 
serviceContainer
๑๑ %
.
๑๑% &
RegisterTransient
๑๑& 7
<
๑๑7 8"
MusicPlaybackService
๒๒ (
,
๒๒( )"
MusicPlaybackService
๓๓ (
>
๔๔ 
(
๔๔ 
)
๔๔ 
;
๔๔ 
this
๗๗ 
.
๗๗ 
serviceContainer
๗๗ %
.
๗๗% &
RegisterSingleton
๗๗& 7
<
๗๗7 8!
MetadataCacheConfig
๗๗8 K
>
๗๗K L
(
๗๗L M
provider
๗๗M U
=>
๗๗V X
{
๘๘ 
return
๙๙ 
new
๙๙ !
MetadataCacheConfig
๙๙ 2
{
๚๚ 
TrackMetadataTTL
๛๛ (
=
๛๛) *
TimeSpan
๛๛+ 3
.
๛๛3 4
	FromHours
๛๛4 =
(
๛๛= >
$num
๛๛> ?
)
๛๛? @
,
๛๛@ A
AlbumMetadataTTL
 (
=
) *
TimeSpan
+ 3
.
3 4
	FromHours
4 =
(
= >
$num
> ?
)
? @
,
@ A!
ExternalMetadataTTL
 +
=
, -
TimeSpan
. 6
.
6 7
	FromHours
7 @
(
@ A
$num
A C
)
C D
,
D E
MaxCacheSize
 $
=
% &
$num
' +
,
+ ,
CleanupInterval
 '
=
( )
TimeSpan
* 2
.
2 3
FromMinutes
3 >
(
> ?
$num
? @
)
@ A
,
A B,
EnableMemoryPressureAdjustment
 6
=
7 8
true
9 =
,
= > 
EnableCacheWarming
 *
=
+ ,
true
- 1
,
1 2
}
 
;
 
}
 
)
 
;
 
this
 
.
 
serviceContainer
 %
.
% &
RegisterSingleton
& 7
<
7 8
MetadataCache
8 E
,
E F
MetadataCache
G T
>
T U
(
U V
)
V W
;
W X
this
 
.
 
serviceContainer
 %
.
% &
RegisterSingleton
& 7
<
7 8"
DiscogsClientService
 (
,
( )"
DiscogsClientService
 (
>
 
(
 
)
 
;
 
this
 
.
 
serviceContainer
 %
.
% &
RegisterSingleton
& 7
<
7 8&
MusicBrainzClientService
 ,
,
, -&
MusicBrainzClientService
 ,
>
 
(
 
)
 
;
 
this
 
.
 
serviceContainer
 %
.
% &
RegisterSingleton
& 7
<
7 8
IDiscogsClient
8 F
>
F G
(
G H
provider
H P
=>
Q S
provider
 
.
 

GetService
 '
<
' ("
DiscogsClientService
( <
>
< =
(
= >
)
> ?
)
 
;
 
this
 
.
 
serviceContainer
 %
.
% &
RegisterSingleton
& 7
<
7 8 
IMusicBrainzClient
8 J
>
J K
(
K L
provider
L T
=>
U W
provider
 
.
 

GetService
 '
<
' (&
MusicBrainzClientService
( @
>
@ A
(
A B
)
B C
)
 
;
 
this
 
.
 
serviceContainer
 %
.
% &
RegisterSingleton
& 7
<
7 8
IGameService
8 D
,
D E
GameService
F Q
>
Q R
(
R S
)
S T
;
T U
this
 
.
 
serviceContainer
 %
.
% &
RegisterSingleton
& 7
<
7 8
IMetadataService
8 H
,
H I
MetadataService
J Y
>
Y Z
(
Z [
)
[ \
;
\ ]
this
 
.
 
serviceContainer
 %
.
% &
RegisterTransient
& 7
<
7 8
IAudioService
8 E
,
E F
AudioService
G S
>
S T
(
T U
)
U V
;
V W
try
กก 
{
ขข 
this
ฃฃ 
.
ฃฃ 
serviceContainer
ฃฃ )
.
ฃฃ) *
ValidateServices
ฃฃ* :
(
ฃฃ: ;
)
ฃฃ; <
;
ฃฃ< =
}
คค 
catch
ฅฅ 
(
ฅฅ 
	Exception
ฅฅ  
validationEx
ฅฅ! -
)
ฅฅ- .
{
ฆฆ 
System
งง 
.
งง 
Diagnostics
งง &
.
งง& '
Debug
งง' ,
.
งง, -
	WriteLine
งง- 6
(
งง6 7
$"
จจ 
$str
จจ =
{
จจ= >
validationEx
จจ> J
.
จจJ K
Message
จจK R
}
จจR S
"
จจS T
)
ฉฉ 
;
ฉฉ 
}
ซซ 
}
ญญ 
catch
ฎฎ 
(
ฎฎ 
	Exception
ฎฎ 
ex
ฎฎ 
)
ฎฎ  
{
ฏฏ 
System
ฐฐ 
.
ฐฐ 
Diagnostics
ฐฐ "
.
ฐฐ" #
Debug
ฐฐ# (
.
ฐฐ( )
	WriteLine
ฐฐ) 2
(
ฐฐ2 3
$"
ฑฑ 
$str
ฑฑ ;
{
ฑฑ; <
ex
ฑฑ< >
.
ฑฑ> ?
Message
ฑฑ? F
}
ฑฑF G
"
ฑฑG H
)
ฒฒ 
;
ฒฒ 
throw
ณณ 
new
ณณ '
InvalidOperationException
ณณ 3
(
ณณ3 4
$str
ดด @
,
ดด@ A
ex
ตต 
)
ถถ 
;
ถถ 
}
ทท 
}
ธธ 	
private
ฝฝ 
void
ฝฝ  
InitializeSettings
ฝฝ '
(
ฝฝ' (
)
ฝฝ( )
{
พพ 	
try
ฟฟ 
{
ภภ 
this
รร 
.
รร 
settings
รร 
=
รร 
new
รร  #(
OstPlayerSettingsViewModel
รร$ >
(
รร> ?
this
รร? C
)
รรC D
;
รรD E
this
ฤฤ 
.
ฤฤ 

Properties
ฤฤ 
=
ฤฤ  !
new
ฤฤ" %%
GenericPluginProperties
ฤฤ& =
{
ฤฤ> ?
HasSettings
ฤฤ@ K
=
ฤฤL M
true
ฤฤN R
}
ฤฤS T
;
ฤฤT U
}
ลล 
catch
ฦฦ 
(
ฦฦ 
	Exception
ฦฦ 
ex
ฦฦ 
)
ฦฦ  
{
วว 
this
ศศ 
.
ศศ 
logger
ศศ 
.
ศศ 
Error
ศศ !
(
ศศ! "
ex
ศศ" $
,
ศศ$ %
$str
ศศ& L
)
ศศL M
;
ศศM N
this
ษษ 
.
ษษ 
errorHandler
ษษ !
.
ษษ! "!
HandlePlaybackError
ษษ" 5
(
ษษ5 6
ex
ษษ6 8
,
ษษ8 9
$str
ษษ: Z
)
ษษZ [
;
ษษ[ \
this
ฬฬ 
.
ฬฬ 
settings
ฬฬ 
=
ฬฬ 
null
ฬฬ  $
;
ฬฬ$ %
this
ออ 
.
ออ 

Properties
ออ 
=
ออ  !
new
ออ" %%
GenericPluginProperties
ออ& =
{
ออ> ?
HasSettings
ออ@ K
=
ออL M
false
ออN S
}
ออT U
;
ออU V
}
ฮฮ 
}
ฯฯ 	
private
ึึ 
void
ึึ #
InitializeSidebarItem
ึึ *
(
ึึ* +
)
ึึ+ ,
{
ืื 	
try
ุุ 
{
ูู 
this
ฺฺ 
.
ฺฺ 
SidebarItem
ฺฺ  
=
ฺฺ! "
new
ฺฺ# &
SidebarItem
ฺฺ' 2
{
 
Type
 
=
 
SiderbarItemType
 +
.
+ ,
View
, 0
,
0 1
Title
 
=
 
$str
 '
,
' (
Icon
 
=
 
this
 
.
  
GetPluginIcon
  -
(
- .
)
. /
,
/ 0
Visible
฿฿ 
=
฿฿ 
true
฿฿ "
,
฿฿" #
Opened
เเ 
=
เเ 
this
เเ !
.
เเ! "
CreateSidebarView
เเ" 3
,
เเ3 4
Closed
แแ 
=
แแ 
this
แแ !
.
แแ! " 
CleanupSidebarView
แแ" 4
,
แแ4 5
}
โโ 
;
โโ 
}
ใใ 
catch
ไไ 
(
ไไ 
	Exception
ไไ 
ex
ไไ 
)
ไไ  
{
ๅๅ 
this
ๆๆ 
.
ๆๆ 
logger
ๆๆ 
.
ๆๆ 
Error
ๆๆ !
(
ๆๆ! "
ex
ๆๆ" $
,
ๆๆ$ %
$str
ๆๆ& Q
)
ๆๆQ R
;
ๆๆR S
this
็็ 
.
็็ 
errorHandler
็็ !
.
็็! "!
HandlePlaybackError
็็" 5
(
็็5 6
ex
็็6 8
,
็็8 9
$str
็็: U
)
็็U V
;
็็V W
this
๊๊ 
.
๊๊ 
SidebarItem
๊๊  
=
๊๊! "
new
๊๊# &
SidebarItem
๊๊' 2
{
๋๋ 
Type
์์ 
=
์์ 
SiderbarItemType
์์ +
.
์์+ ,
View
์์, 0
,
์์0 1
Title
ํํ 
=
ํํ 
$str
ํํ 2
,
ํํ2 3
Visible
๎๎ 
=
๎๎ 
true
๎๎ "
,
๎๎" #
Opened
๏๏ 
=
๏๏ 
(
๏๏ 
)
๏๏ 
=>
๏๏  "
this
๐๐ 
.
๐๐ 
CreateErrorView
๐๐ ,
(
๐๐, -
$str
๑๑ S
)
๒๒ 
,
๒๒ 
Closed
๓๓ 
=
๓๓ 
(
๓๓ 
)
๓๓ 
=>
๓๓  "
{
๓๓# $
}
๓๓% &
,
๓๓& '
}
๔๔ 
;
๔๔ 
}
๕๕ 
}
๖๖ 	
private
๛๛ 
UserControl
๛๛ 
CreateSidebarView
๛๛ -
(
๛๛- .
)
๛๛. /
{
 	
try
 
{
 %
PausePlayniteSoundMusic
 '
(
' (
this
( ,
.
, -
PlayniteApi
- 8
)
8 9
;
9 :
this
 
.
 $
playniteSoundWasPaused
 +
=
, -
true
. 2
;
2 3
Game
 

activeGame
 
=
  !
null
" &
;
& '
try
 
{
 

activeGame
 
=
  
this
! %
.
% &
PlayniteApi
& 1
.
1 2
MainView
2 :
.
: ;
SelectedGames
; H
?
H I
.
I J
FirstOrDefault
J X
(
X Y
)
Y Z
;
Z [
}
 
catch
 
(
 
	Exception
  
ex
! #
)
# $
{
 
this
 
.
 
logger
 
.
  
Warn
  $
(
$ %
ex
 
,
 
$str
 W
)
 
;
 

activeGame
 
=
  
null
! %
;
% &
}
 "
OstPlayerSidebarView
 $
view
% )
;
) *
if
 
(
 

activeGame
 
!=
 !
null
" &
)
& '
{
 
view
 
=
 
new
 "
OstPlayerSidebarView
 3
(
3 4
this
4 8
,
8 9

activeGame
: D
)
D E
;
E F
}
 
else
 
{
 
view
 
=
 
new
 "
OstPlayerSidebarView
 3
(
3 4
this
4 8
)
8 9
;
9 :
}
 
this
 
.
 
lastSidebarView
 $
=
% &
view
' +
;
+ ,
return
 
view
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
กก 
this
ขข 
.
ขข 
logger
ขข 
.
ขข 
Error
ขข !
(
ขข! "
ex
ขข" $
,
ขข$ %
$str
ขข& [
)
ขข[ \
;
ขข\ ]
this
ฃฃ 
.
ฃฃ 
errorHandler
ฃฃ !
.
ฃฃ! "!
HandlePlaybackError
ฃฃ" 5
(
ฃฃ5 6
ex
ฃฃ6 8
,
ฃฃ8 9
$str
ฃฃ: O
)
ฃฃO P
;
ฃฃP Q
return
คค 
this
คค 
.
คค 
CreateErrorView
คค +
(
คค+ ,
$str
คค, b
)
คคb c
;
คคc d
}
ฅฅ 
}
ฆฆ 	
private
ซซ 
string
ซซ 
GetPluginIcon
ซซ $
(
ซซ$ %
)
ซซ% &
{
ฌฌ 	
try
ญญ 
{
ฎฎ 
return
ฏฏ 
Path
ฏฏ 
.
ฏฏ 
Combine
ฏฏ #
(
ฏฏ# $
Path
ฐฐ 
.
ฐฐ 
GetDirectoryName
ฐฐ )
(
ฐฐ) *
System
ฑฑ 
.
ฑฑ 

Reflection
ฑฑ )
.
ฑฑ) *
Assembly
ฑฑ* 2
.
ฑฑ2 3"
GetExecutingAssembly
ฑฑ3 G
(
ฑฑG H
)
ฑฑH I
.
ฑฑI J
Location
ฑฑJ R
)
ฒฒ 
,
ฒฒ 
$str
ณณ #
)
ดด 
;
ดด 
}
ตต 
catch
ถถ 
(
ถถ 
	Exception
ถถ 
ex
ถถ 
)
ถถ  
{
ทท 
this
ธธ 
.
ธธ 
logger
ธธ 
.
ธธ 
Warn
ธธ  
(
ธธ  !
ex
ธธ! #
,
ธธ# $
$str
ธธ% E
)
ธธE F
;
ธธF G
return
นน 
null
นน 
;
นน 
}
บบ 
}
ปป 	
private
ภภ 
UserControl
ภภ 
CreateErrorView
ภภ +
(
ภภ+ ,
string
ภภ, 2
errorMessage
ภภ3 ?
)
ภภ? @
{
มม 	
try
ยย 
{
รร 
var
ฤฤ 
errorControl
ฤฤ  
=
ฤฤ! "
new
ฤฤ# &
UserControl
ฤฤ' 2
(
ฤฤ2 3
)
ฤฤ3 4
;
ฤฤ4 5
var
ลล 
	textBlock
ลล 
=
ลล 
new
ลล  #
	TextBlock
ลล$ -
{
ฦฦ 
Text
วว 
=
วว 
$"
วว 
$str
วว 1
{
วว1 2
errorMessage
วว2 >
}
วว> ?
"
วว? @
,
วว@ A
Margin
ศศ 
=
ศศ 
new
ศศ  
System
ศศ! '
.
ศศ' (
Windows
ศศ( /
.
ศศ/ 0
	Thickness
ศศ0 9
(
ศศ9 :
$num
ศศ: <
)
ศศ< =
,
ศศ= >
TextWrapping
ษษ  
=
ษษ! "
System
ษษ# )
.
ษษ) *
Windows
ษษ* 1
.
ษษ1 2
TextWrapping
ษษ2 >
.
ษษ> ?
Wrap
ษษ? C
,
ษษC D

Foreground
สส 
=
สส  
System
สส! '
.
สส' (
Windows
สส( /
.
สส/ 0
Media
สส0 5
.
สส5 6
Brushes
สส6 =
.
สส= >
Red
สส> A
,
สสA B
}
หห 
;
หห 
errorControl
ฬฬ 
.
ฬฬ 
Content
ฬฬ $
=
ฬฬ% &
	textBlock
ฬฬ' 0
;
ฬฬ0 1
return
ออ 
errorControl
ออ #
;
ออ# $
}
ฮฮ 
catch
ฯฯ 
(
ฯฯ 
	Exception
ฯฯ 
ex
ฯฯ 
)
ฯฯ  
{
ะะ 
this
ัั 
.
ัั 
logger
ัั 
.
ัั 
Error
ัั !
(
ัั! "
ex
ัั" $
,
ัั$ %
$str
ัั& C
)
ััC D
;
ััD E
return
ำำ 
new
ำำ 
UserControl
ำำ &
(
ำำ& '
)
ำำ' (
;
ำำ( )
}
ิิ 
}
ีี 	
private
 
void
  
CleanupSidebarView
 '
(
' (
)
( )
{
 	
try
 
{
 
if
เเ 
(
เเ 
this
เเ 
.
เเ 
lastSidebarView
เเ (
!=
เเ) +
null
เเ, 0
)
เเ0 1
{
แแ 
try
โโ 
{
ใใ 
if
ๅๅ 
(
ๅๅ 
this
ๅๅ  
.
ๅๅ  !
audioService
ๅๅ! -
!=
ๅๅ. 0
null
ๅๅ1 5
)
ๅๅ5 6
{
ๆๆ 
var
็็ 
stopTask
็็  (
=
็็) *
this
็็+ /
.
็็/ 0
audioService
็็0 <
.
็็< =
	StopAsync
็็= F
(
็็F G
)
็็G H
;
็็H I
if
่่ 
(
่่  
!
่่  !
stopTask
่่! )
.
่่) *
Wait
่่* .
(
่่. /
$num
่่/ 3
)
่่3 4
)
่่4 5
{
้้ 
this
๊๊  $
.
๊๊$ %
logger
๊๊% +
.
๊๊+ ,
Warn
๊๊, 0
(
๊๊0 1
$str
๊๊1 Y
)
๊๊Y Z
;
๊๊Z [
}
๋๋ 
else
์์  
{
ํํ 
System
๎๎  &
.
๎๎& '
Diagnostics
๎๎' 2
.
๎๎2 3
Debug
๎๎3 8
.
๎๎8 9
	WriteLine
๎๎9 B
(
๎๎B C
$str
๏๏$ d
)
๐๐  !
;
๐๐! "
}
๑๑ 
}
๒๒ 
try
๖๖ 
{
๗๗ 
this
๘๘  
.
๘๘  !
lastSidebarView
๘๘! 0
.
๘๘0 1
	StopMusic
๘๘1 :
(
๘๘: ;
)
๘๘; <
;
๘๘< =
System
๙๙ "
.
๙๙" #
Diagnostics
๙๙# .
.
๙๙. /
Debug
๙๙/ 4
.
๙๙4 5
	WriteLine
๙๙5 >
(
๙๙> ?
$str
๚๚  d
)
๛๛ 
;
๛๛ 
}
 
catch
 
(
 
	Exception
 (

fallbackEx
) 3
)
3 4
{
 
this
  
.
  !
logger
! '
.
' (
Warn
( ,
(
, -

fallbackEx
  *
,
* +
$str
  Q
)
 
;
 
}
 
}
 
catch
 
(
 
	Exception
 $
ex
% '
)
' (
{
 
this
 
.
 
logger
 #
.
# $
Warn
$ (
(
( )
ex
 
,
 
$str
 R
)
 
;
 
try
 
{
 
this
  
.
  !
lastSidebarView
! 0
.
0 1
	StopMusic
1 :
(
: ;
)
; <
;
< =
System
 "
.
" #
Diagnostics
# .
.
. /
Debug
/ 4
.
4 5
	WriteLine
5 >
(
> ?
$str
  Y
)
 
;
 
}
 
catch
 
(
 
	Exception
 (
finalEx
) 0
)
0 1
{
 
this
  
.
  !
logger
! '
.
' (
Error
( -
(
- .
finalEx
  '
,
' (
$str
  N
)
 
;
 
}
 
}
 
finally
 
{
 
this
 
.
 
lastSidebarView
 ,
=
- .
null
/ 3
;
3 4
}
 
}
 
if
ฃฃ 
(
ฃฃ 
this
ฃฃ 
.
ฃฃ $
playniteSoundWasPaused
ฃฃ /
)
ฃฃ/ 0
{
คค 
try
ฅฅ 
{
ฆฆ 
this
งง 
.
งง &
ResumePlayniteSoundMusic
งง 5
(
งง5 6
)
งง6 7
;
งง7 8
}
จจ 
catch
ฉฉ 
(
ฉฉ 
	Exception
ฉฉ $
ex
ฉฉ% '
)
ฉฉ' (
{
ชช 
this
ซซ 
.
ซซ 
logger
ซซ #
.
ซซ# $
Warn
ซซ$ (
(
ซซ( )
ex
ซซ) +
,
ซซ+ ,
$str
ซซ- [
)
ซซ[ \
;
ซซ\ ]
}
ฌฌ 
finally
ญญ 
{
ฎฎ 
this
ฏฏ 
.
ฏฏ $
playniteSoundWasPaused
ฏฏ 3
=
ฏฏ4 5
false
ฏฏ6 ;
;
ฏฏ; <
}
ฐฐ 
}
ฑฑ 
}
ฒฒ 
catch
ณณ 
(
ณณ 
	Exception
ณณ 
ex
ณณ 
)
ณณ  
{
ดด 
this
ตต 
.
ตต 
logger
ตต 
.
ตต 
Error
ตต !
(
ตต! "
ex
ตต" $
,
ตต$ %
$str
ตต& P
)
ตตP Q
;
ตตQ R
}
ทท 
}
ธธ 	
public
ฟฟ 
static
ฟฟ 
void
ฟฟ %
PausePlayniteSoundMusic
ฟฟ 2
(
ฟฟ2 3
IPlayniteAPI
ฟฟ3 ?
api
ฟฟ@ C
)
ฟฟC D
{
ภภ 	
try
มม 
{
ยย 
Process
รร 
.
รร 
Start
รร 
(
รร 
$str
รร A
)
รรA B
;
รรB C
}
ฤฤ 
catch
ลล 
(
ลล 
	Exception
ลล 
ex
ลล 
)
ลล  
{
ฦฦ 

LogManager
วว 
.
วว 
	GetLogger
วว $
(
วว$ %
)
วว% &
.
วว& '
Warn
วว' +
(
วว+ ,
ex
วว, .
,
วว. /
$str
วว0 ]
)
วว] ^
;
วว^ _
}
ศศ 
}
ษษ 	
private
ฮฮ 
void
ฮฮ &
ResumePlayniteSoundMusic
ฮฮ -
(
ฮฮ- .
)
ฮฮ. /
{
ฯฯ 	
try
ะะ 
{
ัั 
Process
าา 
.
าา 
Start
าา 
(
าา 
$str
าา B
)
าาB C
;
าาC D
}
ำำ 
catch
ิิ 
(
ิิ 
	Exception
ิิ 
ex
ิิ 
)
ิิ  
{
ีี 
this
ึึ 
.
ึึ 
logger
ึึ 
.
ึึ 
Warn
ึึ  
(
ึึ  !
ex
ึึ! #
,
ึึ# $
$str
ึึ% S
)
ึึS T
;
ึึT U
}
ืื 
}
ุุ 	
public
฿฿ 
override
฿฿ 
IEnumerable
฿฿ #
<
฿฿# $
SidebarItem
฿฿$ /
>
฿฿/ 0
GetSidebarItems
฿฿1 @
(
฿฿@ A
)
฿฿A B
{
เเ 	
try
แแ 
{
โโ 
return
ใใ 
new
ใใ 
List
ใใ 
<
ใใ  
SidebarItem
ใใ  +
>
ใใ+ ,
{
ใใ- .
this
ใใ/ 3
.
ใใ3 4
SidebarItem
ใใ4 ?
}
ใใ@ A
;
ใใA B
}
ไไ 
catch
ๅๅ 
(
ๅๅ 
	Exception
ๅๅ 
ex
ๅๅ 
)
ๅๅ  
{
ๆๆ 
this
็็ 
.
็็ 
logger
็็ 
.
็็ 
Error
็็ !
(
็็! "
ex
็็" $
,
็็$ %
$str
็็& K
)
็็K L
;
็็L M
return
่่ 
new
่่ 
List
่่ 
<
่่  
SidebarItem
่่  +
>
่่+ ,
(
่่, -
)
่่- .
;
่่. /
}
้้ 
}
๊๊ 	
public
๏๏ 
static
๏๏ 
string
๏๏ 
GetGameMusicPath
๏๏ -
(
๏๏- .
IPlayniteAPI
๏๏. :
api
๏๏; >
,
๏๏> ?
Game
๏๏@ D
game
๏๏E I
)
๏๏I J
{
๐๐ 	
try
๑๑ 
{
๒๒ 
var
๔๔ 
	container
๔๔ 
=
๔๔ 
ServiceContainer
๔๔  0
.
๔๔0 1
Instance
๔๔1 9
;
๔๔9 :
if
๕๕ 
(
๕๕ 
	container
๕๕ 
.
๕๕ 
IsRegistered
๕๕ *
<
๕๕* +
IGameService
๕๕+ 7
>
๕๕7 8
(
๕๕8 9
)
๕๕9 :
)
๕๕: ;
{
๖๖ 
var
๗๗ 
gameService
๗๗ #
=
๗๗$ %
	container
๗๗& /
.
๗๗/ 0

GetService
๗๗0 :
<
๗๗: ;
IGameService
๗๗; G
>
๗๗G H
(
๗๗H I
)
๗๗I J
;
๗๗J K
return
๙๙ 
gameService
๙๙ &
.
๚๚ $
GetMusicDirectoryAsync
๚๚ /
(
๚๚/ 0
game
๚๚0 4
)
๚๚4 5
.
๛๛ 
ConfigureAwait
๛๛ '
(
๛๛' (
false
๛๛( -
)
๛๛- .
.
 

GetAwaiter
 #
(
# $
)
$ %
.
 
	GetResult
 "
(
" #
)
# $
;
$ %
}
 
return
 
Utils
 
.
 
MusicFileHelper
 ,
.
, -
GetGameMusicPath
- =
(
= >
api
> A
,
A B
game
C G
)
G H
;
H I
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 

LogManager
 
.
 
	GetLogger
 
(
 
)
  
.
 
Warn
 
(
 
ex
 
,
 
$"
  
$str
  C
{
C D
game
D H
?
H I
.
I J
Name
J N
??
O Q
$str
R [
}
[ \
"
\ ]
)
] ^
;
^ _
try
 
{
 
return
 
Utils
  
.
  !
MusicFileHelper
! 0
.
0 1
GetGameMusicPath
1 A
(
A B
api
B E
,
E F
game
G K
)
K L
;
L M
}
 
catch
 
{
 
return
 
string
 !
.
! "
Empty
" '
;
' (
}
 
}
 
}
 	
public
 
static
 
List
 
<
 
string
 !
>
! "
GetGameMusicFiles
# 4
(
4 5
IPlayniteAPI
5 A
api
B E
,
E F
Game
G K
game
L P
)
P Q
{
 	
try
 
{
 
var
 
	container
 
=
 
ServiceContainer
  0
.
0 1
Instance
1 9
;
9 :
if
 
(
 
	container
 
.
 
IsRegistered
 *
<
* +
IGameService
+ 7
>
7 8
(
8 9
)
9 :
)
: ;
{
 
var
 
gameService
 #
=
$ %
	container
& /
.
/ 0

GetService
0 :
<
: ;
IGameService
; G
>
G H
(
H I
)
I J
;
J K
return
 
gameService
 &
.
กก  
GetMusicFilesAsync
กก +
(
กก+ ,
game
กก, 0
)
กก0 1
.
ขข 
ConfigureAwait
ขข '
(
ขข' (
false
ขข( -
)
ขข- .
.
ฃฃ 

GetAwaiter
ฃฃ #
(
ฃฃ# $
)
ฃฃ$ %
.
คค 
	GetResult
คค "
(
คค" #
)
คค# $
;
คค$ %
}
ฅฅ 
return
จจ 
Utils
จจ 
.
จจ 
MusicFileHelper
จจ ,
.
จจ, -
GetGameMusicFiles
จจ- >
(
จจ> ?
api
จจ? B
,
จจB C
game
จจD H
)
จจH I
;
จจI J
}
ฉฉ 
catch
ชช 
(
ชช 
	Exception
ชช 
ex
ชช 
)
ชช  
{
ซซ 

LogManager
ฌฌ 
.
ญญ 
	GetLogger
ญญ 
(
ญญ 
)
ญญ  
.
ฎฎ 
Warn
ฎฎ 
(
ฎฎ 
ex
ฎฎ 
,
ฎฎ 
$"
ฎฎ  
$str
ฎฎ  D
{
ฎฎD E
game
ฎฎE I
?
ฎฎI J
.
ฎฎJ K
Name
ฎฎK O
??
ฎฎP R
$str
ฎฎS \
}
ฎฎ\ ]
"
ฎฎ] ^
)
ฎฎ^ _
;
ฎฎ_ `
try
ฐฐ 
{
ฑฑ 
return
ฒฒ 
Utils
ฒฒ  
.
ฒฒ  !
MusicFileHelper
ฒฒ! 0
.
ฒฒ0 1
GetGameMusicFiles
ฒฒ1 B
(
ฒฒB C
api
ฒฒC F
,
ฒฒF G
game
ฒฒH L
)
ฒฒL M
;
ฒฒM N
}
ณณ 
catch
ดด 
{
ตต 
return
ถถ 
new
ถถ 
List
ถถ #
<
ถถ# $
string
ถถ$ *
>
ถถ* +
(
ถถ+ ,
)
ถถ, -
;
ถถ- .
}
ทท 
}
ธธ 
}
นน 	
public
พพ 
override
พพ 
void
พพ 
OnGameInstalled
พพ ,
(
พพ, -&
OnGameInstalledEventArgs
พพ- E
args
พพF J
)
พพJ K
{
พพL M
}
พพN O
public
ภภ 
override
ภภ 
void
ภภ 
OnGameStarted
ภภ *
(
ภภ* +$
OnGameStartedEventArgs
ภภ+ A
args
ภภB F
)
ภภF G
{
ภภH I
}
ภภJ K
public
ยย 
override
ยย 
void
ยย 
OnGameStarting
ยย +
(
ยย+ ,%
OnGameStartingEventArgs
ยย, C
args
ยยD H
)
ยยH I
{
ยยJ K
}
ยยL M
public
ฤฤ 
override
ฤฤ 
void
ฤฤ 
OnGameStopped
ฤฤ *
(
ฤฤ* +$
OnGameStoppedEventArgs
ฤฤ+ A
args
ฤฤB F
)
ฤฤF G
{
ฤฤH I
}
ฤฤJ K
public
ฦฦ 
override
ฦฦ 
void
ฦฦ 
OnGameUninstalled
ฦฦ .
(
ฦฦ. /(
OnGameUninstalledEventArgs
ฦฦ/ I
args
ฦฦJ N
)
ฦฦN O
{
ฦฦP Q
}
ฦฦR S
public
ศศ 
override
ศศ 
void
ศศ "
OnApplicationStarted
ศศ 1
(
ศศ1 2+
OnApplicationStartedEventArgs
ศศ2 O
args
ศศP T
)
ศศT U
{
ศศV W
}
ศศX Y
public
สส 
override
สส 
void
สส "
OnApplicationStopped
สส 1
(
สส1 2+
OnApplicationStoppedEventArgs
สส2 O
args
สสP T
)
สสT U
{
สสV W
}
สสX Y
public
ฬฬ 
override
ฬฬ 
void
ฬฬ 
OnLibraryUpdated
ฬฬ -
(
ฬฬ- .'
OnLibraryUpdatedEventArgs
ฬฬ. G
args
ฬฬH L
)
ฬฬL M
{
ฬฬN O
}
ฬฬP Q
public
ำำ 
override
ำำ 
	ISettings
ำำ !
GetSettings
ำำ" -
(
ำำ- .
bool
ำำ. 2
firstRunSettings
ำำ3 C
)
ำำC D
{
ิิ 	
try
ีี 
{
ึึ 
if
ืื 
(
ืื 
this
ืื 
.
ืื 
settings
ืื !
==
ืื" $
null
ืื% )
)
ืื) *
{
ุุ 
this
ฺฺ 
.
ฺฺ 
settings
ฺฺ !
=
ฺฺ" #
new
ฺฺ$ '(
OstPlayerSettingsViewModel
ฺฺ( B
(
ฺฺB C
this
ฺฺC G
)
ฺฺG H
;
ฺฺH I
}
 
return
 
this
 
.
 
settings
 $
;
$ %
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
฿฿ 
this
เเ 
.
เเ 
logger
เเ 
.
เเ 
Error
เเ !
(
เเ! "
ex
เเ" $
,
เเ$ %
$str
เเ& E
)
เเE F
;
เเF G
this
แแ 
.
แแ 
errorHandler
แแ !
.
แแ! "!
HandlePlaybackError
แแ" 5
(
แแ5 6
ex
แแ6 8
,
แแ8 9
$str
แแ: N
)
แแN O
;
แแO P
return
โโ 
null
โโ 
;
โโ 
}
ใใ 
}
ไไ 	
public
้้ 
override
้้ 
UserControl
้้ #
GetSettingsView
้้$ 3
(
้้3 4
bool
้้4 8
firstRunView
้้9 E
)
้้E F
{
๊๊ 	
try
๋๋ 
{
์์ 
var
ํํ 
settingsView
ํํ  
=
ํํ! "
new
ํํ# &#
OstPlayerSettingsView
ํํ' <
(
ํํ< =
)
ํํ= >
;
ํํ> ?
if
๐๐ 
(
๐๐ 
this
๐๐ 
.
๐๐ 
settings
๐๐ !
==
๐๐" $
null
๐๐% )
)
๐๐) *
{
๑๑ 
this
๒๒ 
.
๒๒ 
settings
๒๒ !
=
๒๒" #
new
๒๒$ '(
OstPlayerSettingsViewModel
๒๒( B
(
๒๒B C
this
๒๒C G
)
๒๒G H
;
๒๒H I
}
๓๓ 
settingsView
๖๖ 
.
๖๖ 
DataContext
๖๖ (
=
๖๖) *
this
๖๖+ /
.
๖๖/ 0
settings
๖๖0 8
;
๖๖8 9
return
๘๘ 
settingsView
๘๘ #
;
๘๘# $
}
๙๙ 
catch
๚๚ 
(
๚๚ 
	Exception
๚๚ 
ex
๚๚ 
)
๚๚  
{
๛๛ 
this
 
.
 
logger
 
.
 
Error
 !
(
! "
ex
" $
,
$ %
$str
& F
)
F G
;
G H
this
 
.
 
errorHandler
 !
.
! "!
HandlePlaybackError
" 5
(
5 6
ex
6 8
,
8 9
$str
: R
)
R S
;
S T
return
 
this
 
.
 
CreateErrorView
 +
(
+ ,
$str
 Q
)
 
;
 
}
 
}
 	
public
 
ServiceContainer
 !
GetServiceContainer
  3
(
3 4
)
4 5
{
 	
return
 
this
 
.
 
serviceContainer
 (
;
( )
}
 	
public
 
T
 

GetService
 
<
 
T
 
>
 
(
 
)
  
{
 	
return
 
this
 
.
 
serviceContainer
 (
.
( )

GetService
) 3
<
3 4
T
4 5
>
5 6
(
6 7
)
7 8
;
8 9
}
 	
public
 
bool
 !
IsServiceRegistered
 '
<
' (
T
( )
>
) *
(
* +
)
+ ,
{
 	
return
 
this
 
.
 
serviceContainer
 (
.
( )
IsRegistered
) 5
<
5 6
T
6 7
>
7 8
(
8 9
)
9 :
;
: ;
}
 	
	protected
ขข 
void
ขข 
Dispose
ขข 
(
ขข 
bool
ขข #
	disposing
ขข$ -
)
ขข- .
{
ฃฃ 	
if
คค 
(
คค 
	disposing
คค 
)
คค 
{
ฅฅ 
try
ฆฆ 
{
งง 
this
จจ 
.
จจ 
logger
จจ 
.
จจ  
Info
จจ  $
(
จจ$ %
$str
จจ% W
)
จจW X
;
จจX Y
if
ซซ 
(
ซซ 
this
ซซ 
.
ซซ 
audioService
ซซ )
is
ซซ* ,
IDisposable
ซซ- 8
disposableAudio
ซซ9 H
)
ซซH I
disposableAudio
ฌฌ '
.
ฌฌ' (
Dispose
ฌฌ( /
(
ฌฌ/ 0
)
ฌฌ0 1
;
ฌฌ1 2
if
ญญ 
(
ญญ 
this
ญญ 
.
ญญ 
metadataService
ญญ ,
is
ญญ- /
IDisposable
ญญ0 ; 
disposableMetadata
ญญ< N
)
ญญN O 
disposableMetadata
ฎฎ *
.
ฎฎ* +
Dispose
ฎฎ+ 2
(
ฎฎ2 3
)
ฎฎ3 4
;
ฎฎ4 5
if
ฏฏ 
(
ฏฏ 
this
ฏฏ 
.
ฏฏ 
gameService
ฏฏ (
is
ฏฏ) +
IDisposable
ฏฏ, 7
disposableGame
ฏฏ8 F
)
ฏฏF G
disposableGame
ฐฐ &
.
ฐฐ& '
Dispose
ฐฐ' .
(
ฐฐ. /
)
ฐฐ/ 0
;
ฐฐ0 1
this
ณณ 
.
ณณ 
serviceContainer
ณณ )
?
ณณ) *
.
ณณ* +
Dispose
ณณ+ 2
(
ณณ2 3
)
ณณ3 4
;
ณณ4 5
this
ตต 
.
ตต 
logger
ตต 
.
ตต  
Info
ตต  $
(
ตต$ %
$str
ตต% V
)
ตตV W
;
ตตW X
}
ถถ 
catch
ทท 
(
ทท 
	Exception
ทท  
ex
ทท! #
)
ทท# $
{
ธธ 
this
นน 
.
นน 
logger
นน 
.
นน  
Error
นน  %
(
นน% &
ex
นน& (
,
นน( )
$str
นน* M
)
นนM N
;
นนN O
}
บบ 
}
ปป 
}
ผผ 	
}
ฝฝ 
}พพ ฤ
GC:\Playnite\_github\OstPlayer\source\Models\MusicBrainzMetadataModel.cs
	namespaceaa 	
	OstPlayeraa
 
.aa 
Modelsaa 
{aa 
publiccc 

classcc $
MusicBrainzMetadataModelcc )
{cc* +
publicdd 
stringdd 
	ReleaseIddd 
{dd  !
getdd" %
;dd% &
setdd' *
;dd* +
}dd, -
publicff 
stringff 
Titleff 
{ff 
getff !
;ff! "
setff# &
;ff& '
}ff( )
publichh 
stringhh 
Artisthh 
{hh 
gethh "
;hh" #
sethh$ '
;hh' (
}hh) *
publicjj 
stringjj 
ReleaseDatejj !
{jj" #
getjj$ '
;jj' (
setjj) ,
;jj, -
}jj. /
publicll 
stringll 
Countryll 
{ll 
getll  #
;ll# $
setll% (
;ll( )
}ll* +
publicnn 
stringnn 
Statusnn 
{nn 
getnn "
;nn" #
setnn$ '
;nn' (
}nn) *
publicpp 
stringpp 
Albumpp 
{pp 
getpp !
;pp! "
setpp# &
;pp& '
}pp( )
publicrr 
stringrr 
Yearrr 
{rr 
getrr  
;rr  !
setrr" %
;rr% &
}rr' (
publictt 
stringtt 
Genrett 
{tt 
gettt !
;tt! "
settt# &
;tt& '
}tt( )
publicvv 
stringvv 
Commentvv 
{vv 
getvv  #
;vv# $
setvv% (
;vv( )
}vv* +
publicxx 
stringxx 
CoverUrlxx 
{xx  
getxx! $
;xx$ %
setxx& )
;xx) *
}xx+ ,
}yy 
}zz 7
AC:\Playnite\_github\OstPlayer\source\Clients\MusicBrainzClient.cs
	namespace]] 	
	OstPlayer]]
 
.]] 
Clients]] 
{]] 
publicaa 

classaa $
MusicBrainzReleaseResultaa )
{aa* +
publicbb 
Listbb 
<bb 
Releasebb 
>bb 
releasesbb %
{bb& '
getbb( +
;bb+ ,
setbb- 0
;bb0 1
}bb2 3
}cc 
publichh 

classhh 
Releasehh 
{hh 
publicii 
stringii 
titleii 
{ii 
getii !
;ii! "
setii# &
;ii& '
}ii( )
publicjj 
stringjj 
datejj 
{jj 
getjj  
;jj  !
setjj" %
;jj% &
}jj' (
publickk 
stringkk 
statuskk 
{kk 
getkk "
;kk" #
setkk$ '
;kk' (
}kk) *
publicll 
stringll 
countryll 
{ll 
getll  #
;ll# $
setll% (
;ll( )
}ll* +
publicmm 
stringmm 
idmm 
{mm 
getmm 
;mm 
setmm  #
;mm# $
}mm% &
}nn 
publictt 

statictt 
classtt 
MusicBrainzClienttt )
{tt* +
private}} 
static}} 
readonly}} 
Lazy}}  $
<}}$ %

HttpClient}}% /
>}}/ 0
_httpClientLazy}}1 @
=}}A B
new}}C F
Lazy}}G K
<}}K L

HttpClient}}L V
>}}V W
(}}W X
CreateHttpClient}}X h
)}}h i
;}}i j
private
 
static
 

HttpClient
 !

HttpClient
" ,
=>
- /
_httpClientLazy
0 ?
.
? @
Value
@ E
;
E F
private
 
const
 
string
 
BaseUrl
 $
=
% &
$str
 Y
;
Y Z
private
 
static
 

HttpClient
 !
CreateHttpClient
" 2
(
2 3
)
3 4
{
5 6
var
 
handler
 
=
 
new
 
HttpClientHandler
 /
(
/ 0
)
0 1
{
2 3$
AutomaticDecompression
 &
=
' (
System
) /
.
/ 0
Net
0 3
.
3 4"
DecompressionMethods
4 H
.
H I
GZip
I M
|
N O
System
P V
.
V W
Net
W Z
.
Z ["
DecompressionMethods
[ o
.
o p
Deflate
p w
}
 
;
 
var
 
client
 
=
 
new
 

HttpClient
 '
(
' (
handler
( /
)
/ 0
;
0 1
client
 
.
 #
DefaultRequestHeaders
 (
.
( )
	UserAgent
) 2
.
2 3
ParseAdd
3 ;
(
; <
$str
< `
)
` a
;
a b
client
ขข 
.
ขข 
Timeout
ขข 
=
ขข 
TimeSpan
ขข %
.
ขข% &
FromSeconds
ขข& 1
(
ขข1 2
$num
ขข2 4
)
ขข4 5
;
ขข5 6
client
ฆฆ 
.
ฆฆ #
DefaultRequestHeaders
ฆฆ (
.
ฆฆ( )
Add
ฆฆ) ,
(
ฆฆ, -
$str
ฆฆ- 5
,
ฆฆ5 6
$str
ฆฆ7 I
)
ฆฆI J
;
ฆฆJ K
return
จจ 
client
จจ 
;
จจ 
}
ฉฉ 	
public
ถถ 
static
ถถ 
async
ถถ 
Task
ถถ  
<
ถถ  !&
MusicBrainzReleaseResult
ถถ! 9
>
ถถ9 : 
SearchReleaseAsync
ถถ; M
(
ถถM N
string
ถถN T
artist
ถถU [
,
ถถ[ \
string
ถถ] c
album
ถถd i
)
ถถi j
{
ถถk l
if
ทท 
(
ทท 
string
ทท 
.
ทท  
IsNullOrWhiteSpace
ทท )
(
ทท) *
artist
ทท* 0
)
ทท0 1
||
ทท2 4
string
ทท5 ;
.
ทท; < 
IsNullOrWhiteSpace
ทท< N
(
ททN O
album
ททO T
)
ททT U
)
ททU V
return
ธธ 
null
ธธ 
;
ธธ 
var
บบ 
url
บบ 
=
บบ 
string
บบ 
.
บบ 
Format
บบ #
(
บบ# $
BaseUrl
ปป 
,
ปป 
Uri
ผผ 
.
ผผ 
EscapeDataString
ผผ $
(
ผผ$ %
artist
ผผ% +
)
ผผ+ ,
,
ผผ, -
Uri
ฝฝ 
.
ฝฝ 
EscapeDataString
ฝฝ $
(
ฝฝ$ %
album
ฝฝ% *
)
ฝฝ* +
)
พพ 
;
พพ 
try
ภภ 
{
ภภ 
var
ยย 
response
ยย 
=
ยย 
await
ยย $

HttpClient
ยย% /
.
ยย/ 0
GetAsync
ยย0 8
(
ยย8 9
url
ยย9 <
)
ยย< =
;
ยย= >
if
ฤฤ 
(
ฤฤ 
!
ฤฤ 
response
ฤฤ 
.
ฤฤ !
IsSuccessStatusCode
ฤฤ 1
)
ฤฤ1 2
return
ลล 
null
ลล 
;
ลล  
var
วว 
json
วว 
=
วว 
await
วว  
response
วว! )
.
วว) *
Content
วว* 1
.
วว1 2
ReadAsStringAsync
วว2 C
(
ววC D
)
ววD E
;
ววE F
var
ศศ 
result
ศศ 
=
ศศ 
JsonConvert
ศศ (
.
ศศ( )
DeserializeObject
ศศ) :
<
ศศ: ;&
MusicBrainzReleaseResult
ศศ; S
>
ศศS T
(
ศศT U
json
ศศU Y
)
ศศY Z
;
ศศZ [
return
ษษ 
result
ษษ 
;
ษษ 
}
สส 
catch
หห 
(
หห "
HttpRequestException
หห '
)
หห' (
{
หห) *
return
ออ 
null
ออ 
;
ออ 
}
ฮฮ 
catch
ฯฯ 
(
ฯฯ 
JsonException
ฯฯ  
)
ฯฯ  !
{
ฯฯ" #
return
ัั 
null
ัั 
;
ัั 
}
าา 
}
ำำ 	
public
 
static
 &
MusicBrainzReleaseResult
 .
SearchRelease
/ <
(
< =
string
= C
artist
D J
,
J K
string
L R
album
S X
)
X Y
{
Z [
return
เเ  
SearchReleaseAsync
เเ %
(
เเ% &
artist
เเ& ,
,
เเ, -
album
เเ. 3
)
เเ3 4
.
เเ4 5

GetAwaiter
เเ5 ?
(
เเ? @
)
เเ@ A
.
เเA B
	GetResult
เเB K
(
เเK L
)
เเL M
;
เเM N
}
แแ 	
}
ไไ 
}ๅๅ ย
?C:\Playnite\_github\OstPlayer\source\Models\Mp3MetadataModel.cs
	namespaceff 	
	OstPlayerff
 
.ff 
Modelsff 
{ff 
publicll 

classll 
Mp3MetadataModelll !
{ll" #
privaterr 
stringrr 
titlerr 
;rr 
privateww 
stringww 
albumww 
;ww 
public
 
string
 
Title
 
{
 
get
 
=>
 
title
 
;
 
set
 
=>
 
title
 
=
 
value
  
;
  !
}
 	
public
 
string
 
Artist
 
{
 
get
 "
;
" #
set
$ '
;
' (
}
) *
public
 
string
 
Album
 
{
 
get
 
=>
 
(
 
album
 
==
 
title
 "
)
" #
?
$ %
null
& *
:
+ ,
album
- 2
;
2 3
set
 
=>
 
album
 
=
 
value
  
;
  !
}
 	
public
 
string
 
Year
 
{
 
get
  
;
  !
set
" %
;
% &
}
' (
public
คค 
string
คค 
Genre
คค 
{
คค 
get
คค !
;
คค! "
set
คค# &
;
คค& '
}
คค( )
public
ซซ 
string
ซซ 
Comment
ซซ 
{
ซซ 
get
ซซ  #
;
ซซ# $
set
ซซ% (
;
ซซ( )
}
ซซ* +
public
ทท 
string
ทท 
CoverBase64
ทท !
{
ทท" #
get
ทท$ '
;
ทท' (
set
ทท) ,
;
ทท, -
}
ทท. /
public
ฟฟ 
List
ฟฟ 
<
ฟฟ 
	TrackInfo
ฟฟ 
>
ฟฟ 
Tracks
ฟฟ %
{
ฟฟ& '
get
ฟฟ( +
;
ฟฟ+ ,
set
ฟฟ- 0
;
ฟฟ0 1
}
ฟฟ2 3
public
ะะ 
static
ะะ 
string
ะะ 
Sanitize
ะะ %
(
ะะ% &
string
ะะ& ,
input
ะะ- 2
)
ะะ2 3
{
ะะ4 5
return
ำำ 
string
ำำ 
.
ำำ 
Concat
ำำ  
(
ำำ  !
input
ำำ! &
.
ำำ& '
Split
ำำ' ,
(
ำำ, -
System
ำำ- 3
.
ำำ3 4
IO
ำำ4 6
.
ำำ6 7
Path
ำำ7 ;
.
ำำ; <%
GetInvalidFileNameChars
ำำ< S
(
ำำS T
)
ำำT U
)
ำำU V
)
ำำV W
;
ำำW X
}
ิิ 	
public
ใใ 
class
ใใ 
	TrackInfo
ใใ 
{
ใใ  
public
่่ 
string
่่ 
Title
่่ 
{
่่  !
get
่่" %
;
่่% &
set
่่' *
;
่่* +
}
่่, -
public
๓๓ 
TimeSpan
๓๓ 
Duration
๓๓ $
{
๓๓% &
get
๓๓' *
;
๓๓* +
set
๓๓, /
;
๓๓/ 0
}
๓๓1 2
public
๙๙ 
uint
๙๙ 
TrackNumber
๙๙ #
{
๙๙$ %
get
๙๙& )
;
๙๙) *
set
๙๙+ .
;
๙๙. /
}
๙๙0 1
public
 
uint
 
TotalTracks
 #
{
$ %
get
& )
;
) *
set
+ .
;
. /
}
0 1
}
 	
}
 
} 2
?C:\Playnite\_github\OstPlayer\source\Utils\MetadataJsonSaver.cs
	namespaceee 	
	OstPlayeree
 
.ee 
Utilsee 
{ff 
publicmm 

staticmm 
classmm 
MetadataJsonSavermm )
{nn 
publiczz 
staticzz 
voidzz !
SaveMp3MetadataToJsonzz 0
(zz0 1
Guid{{ 

databaseId{{ 
,{{ 
Mp3MetadataModel|| 
metadata|| %
,||% &
IPlayniteAPI}} 
playniteApi}} $
)~~ 	
{ 	
var
 
metadataDir
 
=
 $
GetMusicFilesDirectory
 4
(
4 5

databaseId
5 ?
,
? @
playniteApi
A L
)
L M
;
M N#
EnsureDirectoryExists
 !
(
! "
metadataDir
" -
)
- .
;
. /
var
 
fileName
 
=
 
$"
 
{
 

databaseId
 (
}
( )
$str
) 2
"
2 3
;
3 4
var
 
filePath
 
=
 
Path
 
.
  
Combine
  '
(
' (
metadataDir
( 3
,
3 4
fileName
5 =
)
= >
;
> ?
var
 
json
 
=
 
JsonConvert
 "
.
" #
SerializeObject
# 2
(
2 3
metadata
3 ;
,
; <

Formatting
= G
.
G H
Indented
H P
)
P Q
;
Q R
File
 
.
 
WriteAllText
 
(
 
filePath
 &
,
& '
json
( ,
)
, -
;
- .
}
 	
public
 
static
 
void
 '
SaveDiscogsMetadataToJson
 4
(
4 5
Guid
 

databaseId
 
,
 "
DiscogsMetadataModel
  
metadata
! )
,
) *
IPlayniteAPI
 
playniteApi
 $
)
 	
{
กก 	
var
ฃฃ 
metadataDir
ฃฃ 
=
ฃฃ $
GetMusicFilesDirectory
ฃฃ 4
(
ฃฃ4 5

databaseId
ฃฃ5 ?
,
ฃฃ? @
playniteApi
ฃฃA L
)
ฃฃL M
;
ฃฃM N#
EnsureDirectoryExists
คค !
(
คค! "
metadataDir
คค" -
)
คค- .
;
คค. /
var
งง 
fileName
งง 
=
งง 
$"
งง 
{
งง 

databaseId
งง (
}
งง( )
$str
งง) 6
"
งง6 7
;
งง7 8
var
จจ 
filePath
จจ 
=
จจ 
Path
จจ 
.
จจ  
Combine
จจ  '
(
จจ' (
metadataDir
จจ( 3
,
จจ3 4
fileName
จจ5 =
)
จจ= >
;
จจ> ?
var
ฌฌ 
json
ฌฌ 
=
ฌฌ 
JsonConvert
ฌฌ "
.
ฌฌ" #
SerializeObject
ฌฌ# 2
(
ฌฌ2 3
metadata
ฌฌ3 ;
,
ฌฌ; <

Formatting
ฌฌ= G
.
ฌฌG H
Indented
ฌฌH P
)
ฌฌP Q
;
ฌฌQ R
File
ญญ 
.
ญญ 
WriteAllText
ญญ 
(
ญญ 
filePath
ญญ &
,
ญญ& '
json
ญญ( ,
)
ญญ, -
;
ญญ- .
}
ฎฎ 	
public
นน 
static
นน 
void
นน +
SaveMusicBrainzMetadataToJson
นน 8
(
นน8 9
Guid
บบ 

databaseId
บบ 
,
บบ &
MusicBrainzMetadataModel
ปป $
metadata
ปป% -
,
ปป- .
IPlayniteAPI
ผผ 
playniteApi
ผผ $
)
ฝฝ 	
{
พพ 	
var
ภภ 
metadataDir
ภภ 
=
ภภ $
GetMusicFilesDirectory
ภภ 4
(
ภภ4 5

databaseId
ภภ5 ?
,
ภภ? @
playniteApi
ภภA L
)
ภภL M
;
ภภM N#
EnsureDirectoryExists
มม !
(
มม! "
metadataDir
มม" -
)
มม- .
;
มม. /
var
ฤฤ 
fileName
ฤฤ 
=
ฤฤ 
$"
ฤฤ 
{
ฤฤ 

databaseId
ฤฤ (
}
ฤฤ( )
$str
ฤฤ) :
"
ฤฤ: ;
;
ฤฤ; <
var
ลล 
filePath
ลล 
=
ลล 
Path
ลล 
.
ลล  
Combine
ลล  '
(
ลล' (
metadataDir
ลล( 3
,
ลล3 4
fileName
ลล5 =
)
ลล= >
;
ลล> ?
var
ศศ 
json
ศศ 
=
ศศ 
JsonConvert
ศศ "
.
ศศ" #
SerializeObject
ศศ# 2
(
ศศ2 3
metadata
ศศ3 ;
,
ศศ; <

Formatting
ศศ= G
.
ศศG H
Indented
ศศH P
)
ศศP Q
;
ศศQ R
File
ษษ 
.
ษษ 
WriteAllText
ษษ 
(
ษษ 
filePath
ษษ &
,
ษษ& '
json
ษษ( ,
)
ษษ, -
;
ษษ- .
}
สส 	
private
ูู 
static
ูู 
string
ูู $
GetMusicFilesDirectory
ูู 4
(
ูู4 5
Guid
ูู5 9

databaseId
ูู: D
,
ููD E
IPlayniteAPI
ููF R
api
ููS V
)
ููV W
{
ฺฺ 	
return
โโ 
Path
โโ 
.
โโ 
Combine
โโ 
(
โโ  
api
ใใ 
.
ใใ 
Paths
ใใ 
.
ใใ 
ConfigurationPath
ใใ +
,
ใใ+ ,
$str
ไไ 
,
ไไ  
$str
ๅๅ 
,
ๅๅ 

databaseId
ๆๆ 
.
ๆๆ 
ToString
ๆๆ #
(
ๆๆ# $
)
ๆๆ$ %
,
ๆๆ% &
$str
็็ 
)
่่ 
;
่่ 
}
้้ 	
private
๒๒ 
static
๒๒ 
void
๒๒ #
EnsureDirectoryExists
๒๒ 1
(
๒๒1 2
string
๒๒2 8
path
๒๒9 =
)
๒๒= >
{
๓๓ 	
if
๘๘ 
(
๘๘ 
!
๘๘ 
	Directory
๘๘ 
.
๘๘ 
Exists
๘๘ !
(
๘๘! "
path
๘๘" &
)
๘๘& '
)
๘๘' (
{
๙๙ 
	Directory
 
.
 
CreateDirectory
 )
(
) *
path
* .
)
. /
;
/ 0
}
 
}
 	
}
ะะ 
}ัั 
AC:\Playnite\_github\OstPlayer\source\Utils\MetadataJsonStorage.cs
	namespacebb 	
	OstPlayerbb
 
.bb 
Utilsbb 
{cc 
publicjj 

staticjj 
classjj 
MetadataJsonStoragejj +
{kk 
publicww 
staticww 
voidww !
SaveMp3MetadataToJsonww 0
(ww0 1
Guidxx 

databaseIdxx 
,xx 
stringyy 

folderPathyy 
,yy 
Mp3MetadataModelzz 
metadatazz %
){{ 	
{|| 	
string 
filePath 
= 
Path "
." #
Combine# *
(* +

folderPath+ 5
,5 6
$"7 9
{9 :

databaseId: D
}D E
$strE N
"N O
)O P
;P Q
SaveJsonToFile
 
(
 
filePath
 #
,
# $
metadata
% -
)
- .
;
. /
}
 	
public
 
static
 
void
 +
SaveMusicBrainzMetadataToJson
 8
(
8 9
Guid
 

databaseId
 
,
 
string
 

folderPath
 
,
 &
MusicBrainzMetadataModel
 $
metadata
% -
)
 	
{
 	
string
 
filePath
 
=
 
Path
 "
.
" #
Combine
# *
(
* +

folderPath
+ 5
,
5 6
$"
7 9
{
9 :

databaseId
: D
}
D E
$str
E V
"
V W
)
W X
;
X Y
SaveJsonToFile
 
(
 
filePath
 #
,
# $
metadata
% -
)
- .
;
. /
}
 	
public
 
static
 
void
 '
SaveDiscogsMetadataToJson
 4
(
4 5
Guid
กก 

databaseId
กก 
,
กก 
string
ขข 

folderPath
ขข 
,
ขข "
DiscogsMetadataModel
ฃฃ  
metadata
ฃฃ! )
)
คค 	
{
ฅฅ 	
string
งง 
filePath
งง 
=
งง 
Path
งง "
.
งง" #
Combine
งง# *
(
งง* +

folderPath
งง+ 5
,
งง5 6
$"
งง7 9
{
งง9 :

databaseId
งง: D
}
งงD E
$str
งงE R
"
งงR S
)
งงS T
;
งงT U
SaveJsonToFile
จจ 
(
จจ 
filePath
จจ #
,
จจ# $
metadata
จจ% -
)
จจ- .
;
จจ. /
}
ฉฉ 	
private
ดด 
static
ดด 
void
ดด 
SaveJsonToFile
ดด *
<
ดด* +
T
ดด+ ,
>
ดด, -
(
ดด- .
string
ดด. 4
filePath
ดด5 =
,
ดด= >
T
ดด? @
metadata
ดดA I
)
ดดI J
{
ตต 	
string
ธธ 
json
ธธ 
=
ธธ 
JsonConvert
ธธ %
.
ธธ% &
SerializeObject
ธธ& 5
(
ธธ5 6
metadata
ธธ6 >
,
ธธ> ?

Formatting
ธธ@ J
.
ธธJ K
Indented
ธธK S
)
ธธS T
;
ธธT U
File
ผผ 
.
ผผ 
WriteAllText
ผผ 
(
ผผ 
filePath
ผผ &
,
ผผ& '
json
ผผ( ,
)
ผผ, -
;
ผผ- .
}
ฝฝ 	
public
ฬฬ 
static
ฬฬ  
AlbumMetadataModel
ฬฬ ('
LoadAndMergeAlbumMetadata
ฬฬ) B
(
ฬฬB C
Guid
ออ 

databaseId
ออ 
,
ออ 
string
ฮฮ 

folderPath
ฮฮ 
)
ฯฯ 	
{
ะะ 	
var
าา 
result
าา 
=
าา 
new
าา  
AlbumMetadataModel
าา /
(
าา/ 0
)
าา0 1
;
าา1 2
T
ูู 
LoadJson
ูู 
<
ูู 
T
ูู 
>
ูู 
(
ูู 
string
ูู  
fileName
ูู! )
)
ูู) *
where
ฺฺ 
T
ฺฺ 
:
ฺฺ 
class
ฺฺ 
{
 
string
 
path
 
=
 
Path
 "
.
" #
Combine
# *
(
* +

folderPath
+ 5
,
5 6
fileName
7 ?
)
? @
;
@ A
if
เเ 
(
เเ 
!
เเ 
File
เเ 
.
เเ 
Exists
เเ  
(
เเ  !
path
เเ! %
)
เเ% &
)
เเ& '
return
แแ 
null
แแ 
;
แแ  
try
ใใ 
{
ไไ 
string
ๆๆ 
json
ๆๆ 
=
ๆๆ  !
File
ๆๆ" &
.
ๆๆ& '
ReadAllText
ๆๆ' 2
(
ๆๆ2 3
path
ๆๆ3 7
)
ๆๆ7 8
;
ๆๆ8 9
return
๊๊ 
JsonConvert
๊๊ &
.
๊๊& '
DeserializeObject
๊๊' 8
<
๊๊8 9
T
๊๊9 :
>
๊๊: ;
(
๊๊; <
json
๊๊< @
)
๊๊@ A
;
๊๊A B
}
๋๋ 
catch
์์ 
{
ํํ 
return
๑๑ 
null
๑๑ 
;
๑๑  
}
๒๒ 
}
๓๓ 
var
 
mp3Metadata
 
=
 
LoadJson
 &
<
& '
Mp3MetadataModel
' 7
>
7 8
(
8 9
$"
9 ;
{
; <

databaseId
< F
}
F G
$str
G P
"
P Q
)
Q R
;
R S
var
 

mbMetadata
 
=
 
LoadJson
 %
<
% &&
MusicBrainzMetadataModel
& >
>
> ?
(
? @
$"
@ B
{
B C

databaseId
C M
}
M N
$str
N _
"
_ `
)
` a
;
a b
var
 
discogsMetadata
 
=
  !
LoadJson
" *
<
* +"
DiscogsMetadataModel
+ ?
>
? @
(
@ A
$"
A C
{
C D

databaseId
D N
}
N O
$str
O \
"
\ ]
)
] ^
;
^ _
if
 
(
 
mp3Metadata
 
!=
 
null
 #
)
# $
{
 
result
 
.
 
Title
 
=
 
mp3Metadata
 *
.
* +
Title
+ 0
;
0 1
result
 
.
 
Artist
 
=
 
mp3Metadata
  +
.
+ ,
Artist
, 2
;
2 3
result
 
.
 
Album
 
=
 
mp3Metadata
 *
.
* +
Album
+ 0
;
0 1
result
 
.
 
Comment
 
=
  
mp3Metadata
! ,
.
, -
Comment
- 4
;
4 5
result
 
.
 
Cover
 
=
 '
LoadBitmapImageFromBase64
 8
(
8 9
mp3Metadata
9 D
.
D E
CoverBase64
E P
)
P Q
;
Q R
if
 
(
 
mp3Metadata
 
.
  
Tracks
  &
!=
' )
null
* .
)
. /
result
 
.
 
	Tracklist
 $
=
% &
mp3Metadata
' 2
.
2 3
Tracks
3 9
.
9 :

ConvertAll
: D
(
D E
t
E F
=>
G I
t
J K
.
K L
Title
L Q
)
Q R
;
R S
}
 
if
กก 
(
กก 

mbMetadata
กก 
!=
กก 
null
กก "
)
กก" #
{
ขข 
if
ฅฅ 
(
ฅฅ 
string
ฅฅ 
.
ฅฅ 
IsNullOrEmpty
ฅฅ (
(
ฅฅ( )
result
ฅฅ) /
.
ฅฅ/ 0
Title
ฅฅ0 5
)
ฅฅ5 6
)
ฅฅ6 7
result
ฆฆ 
.
ฆฆ 
Title
ฆฆ  
=
ฆฆ! "

mbMetadata
ฆฆ# -
.
ฆฆ- .
Title
ฆฆ. 3
;
ฆฆ3 4
if
งง 
(
งง 
string
งง 
.
งง 
IsNullOrEmpty
งง (
(
งง( )
result
งง) /
.
งง/ 0
Artist
งง0 6
)
งง6 7
)
งง7 8
result
จจ 
.
จจ 
Artist
จจ !
=
จจ" #

mbMetadata
จจ$ .
.
จจ. /
Artist
จจ/ 5
;
จจ5 6
if
ฉฉ 
(
ฉฉ 
string
ฉฉ 
.
ฉฉ 
IsNullOrEmpty
ฉฉ (
(
ฉฉ( )
result
ฉฉ) /
.
ฉฉ/ 0
Album
ฉฉ0 5
)
ฉฉ5 6
)
ฉฉ6 7
result
ชช 
.
ชช 
Album
ชช  
=
ชช! "

mbMetadata
ชช# -
.
ชช- .
Album
ชช. 3
;
ชช3 4
if
ฎฎ 
(
ฎฎ 
string
ฎฎ 
.
ฎฎ 
IsNullOrEmpty
ฎฎ (
(
ฎฎ( )
result
ฎฎ) /
.
ฎฎ/ 0
Released
ฎฎ0 8
)
ฎฎ8 9
&&
ฎฎ: <

mbMetadata
ฎฎ= G
.
ฎฎG H
ReleaseDate
ฎฎH S
!=
ฎฎT V
null
ฎฎW [
)
ฎฎ[ \
result
ฏฏ 
.
ฏฏ 
Released
ฏฏ #
=
ฏฏ$ %

mbMetadata
ฏฏ& 0
.
ฏฏ0 1
ReleaseDate
ฏฏ1 <
;
ฏฏ< =
if
ฑฑ 
(
ฑฑ 
string
ฑฑ 
.
ฑฑ 
IsNullOrEmpty
ฑฑ (
(
ฑฑ( )
result
ฑฑ) /
.
ฑฑ/ 0
Comment
ฑฑ0 7
)
ฑฑ7 8
)
ฑฑ8 9
result
ฒฒ 
.
ฒฒ 
Comment
ฒฒ "
=
ฒฒ# $

mbMetadata
ฒฒ% /
.
ฒฒ/ 0
Comment
ฒฒ0 7
;
ฒฒ7 8
if
ถถ 
(
ถถ 
result
ถถ 
.
ถถ 
Cover
ถถ  
==
ถถ! #
null
ถถ$ (
&&
ถถ) +
!
ถถ, -
string
ถถ- 3
.
ถถ3 4
IsNullOrEmpty
ถถ4 A
(
ถถA B

mbMetadata
ถถB L
.
ถถL M
CoverUrl
ถถM U
)
ถถU V
)
ถถV W
result
ทท 
.
ทท 
Cover
ทท  
=
ทท! "$
LoadBitmapImageFromUrl
ทท# 9
(
ทท9 :

mbMetadata
ทท: D
.
ททD E
CoverUrl
ททE M
)
ททM N
;
ททN O
}
ธธ 
if
ภภ 
(
ภภ 
discogsMetadata
ภภ 
!=
ภภ  "
null
ภภ# '
)
ภภ' (
{
มม 
if
รร 
(
รร 
string
รร 
.
รร 
IsNullOrEmpty
รร (
(
รร( )
result
รร) /
.
รร/ 0
Title
รร0 5
)
รร5 6
)
รร6 7
result
ฤฤ 
.
ฤฤ 
Title
ฤฤ  
=
ฤฤ! "
discogsMetadata
ฤฤ# 2
.
ฤฤ2 3
Title
ฤฤ3 8
;
ฤฤ8 9
if
ลล 
(
ลล 
string
ลล 
.
ลล 
IsNullOrEmpty
ลล (
(
ลล( )
result
ลล) /
.
ลล/ 0
Artist
ลล0 6
)
ลล6 7
)
ลล7 8
result
ฦฦ 
.
ฦฦ 
Artist
ฦฦ !
=
ฦฦ" #
discogsMetadata
ฦฦ$ 3
.
ฦฦ3 4
Artist
ฦฦ4 :
;
ฦฦ: ;
if
วว 
(
วว 
string
วว 
.
วว 
IsNullOrEmpty
วว (
(
วว( )
result
วว) /
.
วว/ 0
Album
วว0 5
)
วว5 6
)
วว6 7
result
ศศ 
.
ศศ 
Album
ศศ  
=
ศศ! "
discogsMetadata
ศศ# 2
.
ศศ2 3
Album
ศศ3 8
;
ศศ8 9
if
ษษ 
(
ษษ 
string
ษษ 
.
ษษ 
IsNullOrEmpty
ษษ (
(
ษษ( )
result
ษษ) /
.
ษษ/ 0
Released
ษษ0 8
)
ษษ8 9
)
ษษ9 :
result
สส 
.
สส 
Released
สส #
=
สส$ %
discogsMetadata
สส& 5
.
สส5 6
Released
สส6 >
;
สส> ?
if
ฮฮ 
(
ฮฮ 
(
ฯฯ 
result
ฯฯ 
.
ฯฯ 
Genres
ฯฯ "
==
ฯฯ# %
null
ฯฯ& *
||
ฯฯ+ -
result
ฯฯ. 4
.
ฯฯ4 5
Genres
ฯฯ5 ;
.
ฯฯ; <
Count
ฯฯ< A
==
ฯฯB D
$num
ฯฯE F
)
ฯฯF G
&&
ะะ 
discogsMetadata
ะะ &
.
ะะ& '
Genres
ะะ' -
!=
ะะ. 0
null
ะะ1 5
)
ัั 
result
าา 
.
าา 
Genres
าา !
=
าา" #
discogsMetadata
าา$ 3
.
าา3 4
Genres
าา4 :
;
าา: ;
if
ำำ 
(
ำำ 
(
ิิ 
result
ิิ 
.
ิิ 
Styles
ิิ "
==
ิิ# %
null
ิิ& *
||
ิิ+ -
result
ิิ. 4
.
ิิ4 5
Styles
ิิ5 ;
.
ิิ; <
Count
ิิ< A
==
ิิB D
$num
ิิE F
)
ิิF G
&&
ีี 
discogsMetadata
ีี &
.
ีี& '
Styles
ีี' -
!=
ีี. 0
null
ีี1 5
)
ึึ 
result
ืื 
.
ืื 
Styles
ืื !
=
ืื" #
discogsMetadata
ืื$ 3
.
ืื3 4
Styles
ืื4 :
;
ืื: ;
if
ูู 
(
ูู 
string
ูู 
.
ูู 
IsNullOrEmpty
ูู (
(
ูู( )
result
ูู) /
.
ูู/ 0
Comment
ูู0 7
)
ูู7 8
)
ูู8 9
result
ฺฺ 
.
ฺฺ 
Comment
ฺฺ "
=
ฺฺ# $
discogsMetadata
ฺฺ% 4
.
ฺฺ4 5
Comment
ฺฺ5 <
;
ฺฺ< =
if
 
(
 
result
 
.
 
Cover
  
==
! #
null
$ (
&&
) +
!
, -
string
- 3
.
3 4
IsNullOrEmpty
4 A
(
A B
discogsMetadata
B Q
.
Q R
CoverUrl
R Z
)
Z [
)
[ \
result
 
.
 
Cover
  
=
! "$
LoadBitmapImageFromUrl
# 9
(
9 :
discogsMetadata
: I
.
I J
CoverUrl
J R
)
R S
;
S T
if
แแ 
(
แแ 
string
แแ 
.
แแ 
IsNullOrEmpty
แแ (
(
แแ( )
result
แแ) /
.
แแ/ 0
Country
แแ0 7
)
แแ7 8
)
แแ8 9
result
โโ 
.
โโ 
Country
โโ "
=
โโ# $
discogsMetadata
โโ% 4
.
โโ4 5
Country
โโ5 <
;
โโ< =
if
ใใ 
(
ใใ 
string
ใใ 
.
ใใ 
IsNullOrEmpty
ใใ (
(
ใใ( )
result
ใใ) /
.
ใใ/ 0

DiscogsUrl
ใใ0 :
)
ใใ: ;
)
ใใ; <
result
ไไ 
.
ไไ 

DiscogsUrl
ไไ %
=
ไไ& '
discogsMetadata
ไไ( 7
.
ไไ7 8

DiscogsUrl
ไไ8 B
;
ไไB C
if
่่ 
(
่่ 
(
้้ 
result
้้ 
.
้้ 
	Tracklist
้้ %
==
้้& (
null
้้) -
||
้้. 0
result
้้1 7
.
้้7 8
	Tracklist
้้8 A
.
้้A B
Count
้้B G
==
้้H J
$num
้้K L
)
้้L M
&&
๊๊ 
discogsMetadata
๊๊ &
.
๊๊& '
	Tracklist
๊๊' 0
!=
๊๊1 3
null
๊๊4 8
&&
๋๋ 
discogsMetadata
๋๋ &
.
๋๋& '
	Tracklist
๋๋' 0
.
๋๋0 1
Count
๋๋1 6
>
๋๋7 8
$num
๋๋9 :
)
์์ 
{
ํํ 
result
๏๏ 
.
๏๏ 
	Tracklist
๏๏ $
=
๏๏% &
discogsMetadata
๏๏' 6
.
๏๏6 7
	Tracklist
๏๏7 @
.
๏๏@ A

ConvertAll
๏๏A K
(
๏๏K L
t
๏๏L M
=>
๏๏N P
t
๏๏Q R
.
๏๏R S
Title
๏๏S X
)
๏๏X Y
;
๏๏Y Z
}
๐๐ 
}
๑๑ 
return
๕๕ 
result
๕๕ 
;
๕๕ 
}
๖๖ 	
private
 
static
 
BitmapImage
 "'
LoadBitmapImageFromBase64
# <
(
< =
string
= C
base64
D J
)
J K
{
 	
if
 
(
 
string
 
.
 
IsNullOrEmpty
 $
(
$ %
base64
% +
)
+ ,
)
, -
return
 
null
 
;
 
try
 
{
 
byte
 
[
 
]
 
bytes
 
=
 
Convert
 &
.
& '
FromBase64String
' 7
(
7 8
base64
8 >
)
> ?
;
? @
using
 
(
 
var
 
ms
 
=
 
new
  #
MemoryStream
$ 0
(
0 1
bytes
1 6
)
6 7
)
7 8
{
 
var
 
img
 
=
 
new
 !
BitmapImage
" -
(
- .
)
. /
;
/ 0
img
 
.
 
	BeginInit
 !
(
! "
)
" #
;
# $
img
 
.
 
CacheOption
 #
=
$ %
BitmapCacheOption
& 7
.
7 8
OnLoad
8 >
;
> ?
img
 
.
 
StreamSource
 $
=
% &
ms
' )
;
) *
img
 
.
 
EndInit
 
(
  
)
  !
;
! "
img
 
.
 
Freeze
 
(
 
)
  
;
  !
return
 
img
 
;
 
}
 
}
 
catch
กก 
{
ขข 
return
ฆฆ 
null
ฆฆ 
;
ฆฆ 
}
งง 
}
จจ 	
private
ฒฒ 
static
ฒฒ 
BitmapImage
ฒฒ "$
LoadBitmapImageFromUrl
ฒฒ# 9
(
ฒฒ9 :
string
ฒฒ: @
url
ฒฒA D
)
ฒฒD E
{
ณณ 	
if
ตต 
(
ตต 
string
ตต 
.
ตต 
IsNullOrEmpty
ตต $
(
ตต$ %
url
ตต% (
)
ตต( )
)
ตต) *
return
ถถ 
null
ถถ 
;
ถถ 
try
ธธ 
{
นน 
var
ปป 
img
ปป 
=
ปป 
new
ปป 
BitmapImage
ปป )
(
ปป) *
)
ปป* +
;
ปป+ ,
img
ผผ 
.
ผผ 
	BeginInit
ผผ 
(
ผผ 
)
ผผ 
;
ผผ  
img
ฟฟ 
.
ฟฟ 
	UriSource
ฟฟ 
=
ฟฟ 
new
ฟฟ  #
Uri
ฟฟ$ '
(
ฟฟ' (
url
ฟฟ( +
,
ฟฟ+ ,
UriKind
ฟฟ- 4
.
ฟฟ4 5
Absolute
ฟฟ5 =
)
ฟฟ= >
;
ฟฟ> ?
img
รร 
.
รร 
CacheOption
รร 
=
รร  !
BitmapCacheOption
รร" 3
.
รร3 4
OnLoad
รร4 :
;
รร: ;
img
ฤฤ 
.
ฤฤ 
EndInit
ฤฤ 
(
ฤฤ 
)
ฤฤ 
;
ฤฤ 
img
วว 
.
วว 
Freeze
วว 
(
วว 
)
วว 
;
วว 
return
ศศ 
img
ศศ 
;
ศศ 
}
ษษ 
catch
สส 
{
หห 
return
ฯฯ 
null
ฯฯ 
;
ฯฯ 
}
ะะ 
}
ัั 	
}
 
} #
CC:\Playnite\_github\OstPlayer\source\Models\DiscogsMetadataModel.cs
	namespaceqq 	
	OstPlayerqq
 
.qq 
Modelsqq 
{qq 
publicss 

classss  
DiscogsMetadataModelss %
{ss& '
publicuu 
stringuu 
Titleuu 
{uu 
getuu !
;uu! "
setuu# &
;uu& '
}uu( )
publicww 
stringww 
Artistww 
{ww 
getww "
;ww" #
setww$ '
;ww' (
}ww) *
publicyy 
stringyy 
Countryyy 
{yy 
getyy  #
;yy# $
setyy% (
;yy( )
}yy* +
privatezz 
stringzz 
_albumzz 
;zz 
public|| 
string|| 
Album|| 
{|| 
get}} 
{}} 
if~~ 
(~~ 
string~~ 
.~~ 
IsNullOrWhiteSpace~~ -
(~~- .
_album~~. 4
)~~4 5
)~~5 6
return 
null 
;  
if
 
(
 
string
 
.
 
Equals
 !
(
! "
_album
" (
,
( )
Title
* /
)
/ 0
)
0 1
return
 
null
 
;
  
return
 
_album
 
;
 
}
 
set
 
{
 
_album
 
=
 
value
  
;
  !
}
" #
}
 	
public
 
string
 
Label
 
{
 
get
 !
;
! "
set
# &
;
& '
}
( )
public
 
string
 
Format
 
{
 
get
 "
;
" #
set
$ '
;
' (
}
) *
public
 
List
 
<
 
string
 
>
 
Genres
 "
{
# $
get
% (
;
( )
set
* -
;
- .
}
/ 0
public
 
List
 
<
 
string
 
>
 
Styles
 "
{
# $
get
% (
;
( )
set
* -
;
- .
}
/ 0
public
 
string
 
Notes
 
{
 
get
 !
;
! "
set
# &
;
& '
}
( )
public
 
string
 
Released
 
{
  
get
! $
;
$ %
set
& )
;
) *
}
+ ,
public
 
string
 
Comment
 
{
 
get
  #
;
# $
set
% (
;
( )
}
* +
public
 
string
 
CoverUrl
 
{
  
get
! $
;
$ %
set
& )
;
) *
}
+ ,
public
 
string
 

DiscogsUrl
  
{
! "
get
# &
;
& '
set
( +
;
+ ,
}
- .
public
 
List
 
<
 
DiscogsTrack
  
>
  !
	Tracklist
" +
{
, -
get
. 1
;
1 2
set
3 6
;
6 7
}
8 9
public
 
class
 
DiscogsTrack
 !
{
" #
public
 
string
 
Title
 
{
  !
get
" %
;
% &
set
' *
;
* +
}
, -
public
 
string
 
Duration
 "
{
# $
get
% (
;
( )
set
* -
;
- .
}
/ 0
}
 	
public
ขข 
List
ขข 
<
ขข 
string
ขข 
>
ขข 
TrackTitles
ขข '
=>
ขข( *
	Tracklist
ฃฃ 
?
ฃฃ 
.
ฃฃ 

ConvertAll
ฃฃ !
(
ฃฃ! "
t
ฃฃ" #
=>
ฃฃ$ &
t
ฃฃ' (
.
ฃฃ( )
Title
ฃฃ) .
)
ฃฃ. /
??
ฃฃ0 2
new
ฃฃ3 6
List
ฃฃ7 ;
<
ฃฃ; <
string
ฃฃ< B
>
ฃฃB C
(
ฃฃC D
)
ฃฃD E
;
ฃฃE F
}
คค 
}ฅฅ 2
UC:\Playnite\_github\OstPlayer\source\Views\Dialogs\DiscogsReleaseSelectDialog.xaml.cs
	namespaceoo 	
	OstPlayeroo
 
.oo 
Viewsoo 
.oo 
Dialogsoo !
{pp 
publicqq 

partialqq 
classqq &
DiscogsReleaseSelectDialogqq 3
:qq4 5
Windowqq6 <
{rr 
publictt  
DiscogsMetadataModeltt #
SelectedReleasett$ 3
{tt4 5
gettt6 9
;tt9 :
privatett; B
setttC F
;ttF G
}ttH I
privateww 
readonlyww 
stringww 
_discogsTokenww  -
;ww- .
privatezz 
Listzz 
<zz  
DiscogsMetadataModelzz )
>zz) *
_lastResultszz+ 7
;zz7 8
public
 (
DiscogsReleaseSelectDialog
 )
(
) *
List
* .
<
. /"
DiscogsMetadataModel
/ C
>
C D
releases
E M
,
M N
string
O U
discogsToken
V b
)
b c
{
 	!
InitializeComponent
 
(
  
)
  !
;
! "
ReleaseListBox
 
.
 
ItemsSource
 &
=
' (
releases
) 1
;
1 2
_lastResults
 
=
 
releases
 #
;
# $
_discogsToken
 
=
 
discogsToken
 (
;
( )
}
 	
private
 
void
 
OkButton_Click
 #
(
# $
object
$ *
sender
+ 1
,
1 2
RoutedEventArgs
3 B
e
C D
)
D E
{
 	
SelectedRelease
 
=
 
ReleaseListBox
 ,
.
, -
SelectedItem
- 9
as
: <"
DiscogsMetadataModel
= Q
;
Q R
DialogResult
 
=
 
SelectedRelease
 *
!=
+ -
null
. 2
;
2 3
Close
 
(
 
)
 
;
 
}
 	
private
 
void
 -
ReleaseListBox_MouseDoubleClick
 4
(
4 5
object
5 ;
sender
< B
,
B C"
MouseButtonEventArgs
D X
e
Y Z
)
Z [
{
 	
if
 
(
 
ReleaseListBox
 
.
 
SelectedItem
 +
!=
, .
null
/ 3
)
3 4
{
 
OkButton_Click
 
(
 
sender
 %
,
% &
e
' (
)
( )
;
) *
}
 
}
 	
private
 
async
 
void
  
SearchButton_Click
 -
(
- .
object
. 4
sender
5 ;
,
; <
RoutedEventArgs
= L
e
M N
)
N O
{
 	
await
 $
SearchAndUpdateResults
 (
(
( )
)
) *
;
* +
}
 	
private
กก 
async
กก 
void
กก #
SearchTextBox_KeyDown
กก 0
(
กก0 1
object
กก1 7
sender
กก8 >
,
กก> ?
KeyEventArgs
กก@ L
e
กกM N
)
กกN O
{
ขข 	
if
ฃฃ 
(
ฃฃ 
e
ฃฃ 
.
ฃฃ 
Key
ฃฃ 
==
ฃฃ 
Key
ฃฃ 
.
ฃฃ 
Enter
ฃฃ "
)
ฃฃ" #
{
คค 
e
ฅฅ 
.
ฅฅ 
Handled
ฅฅ 
=
ฅฅ 
true
ฅฅ  
;
ฅฅ  !
await
ฆฆ $
SearchAndUpdateResults
ฆฆ ,
(
ฆฆ, -
)
ฆฆ- .
;
ฆฆ. /
}
งง 
}
จจ 	
private
ซซ 
async
ซซ 
Task
ซซ $
SearchAndUpdateResults
ซซ 1
(
ซซ1 2
)
ซซ2 3
{
ฌฌ 	
var
ญญ 
query
ญญ 
=
ญญ 
SearchTextBox
ญญ %
.
ญญ% &
Text
ญญ& *
?
ญญ* +
.
ญญ+ ,
Trim
ญญ, 0
(
ญญ0 1
)
ญญ1 2
;
ญญ2 3
if
ฎฎ 
(
ฎฎ 
string
ฎฎ 
.
ฎฎ  
IsNullOrWhiteSpace
ฎฎ )
(
ฎฎ) *
query
ฎฎ* /
)
ฎฎ/ 0
)
ฎฎ0 1
return
ฏฏ 
;
ฏฏ 
if
ฑฑ 
(
ฑฑ 
string
ฑฑ 
.
ฑฑ  
IsNullOrWhiteSpace
ฑฑ )
(
ฑฑ) *
_discogsToken
ฑฑ* 7
)
ฑฑ7 8
)
ฑฑ8 9
{
ฒฒ 

MessageBox
ณณ 
.
ณณ 
Show
ณณ 
(
ณณ  
$str
ณณ  ?
)
ณณ? @
;
ณณ@ A
return
ดด 
;
ดด 
}
ตต 
ReleaseListBox
ทท 
.
ทท 
ItemsSource
ทท &
=
ทท' (
null
ทท) -
;
ทท- .
ReleaseListBox
ธธ 
.
ธธ 
Items
ธธ  
.
ธธ  !
Refresh
ธธ! (
(
ธธ( )
)
ธธ) *
;
ธธ* +
try
บบ 
{
ปป 
var
ผผ 
results
ผผ 
=
ผผ 
await
ผผ #
DiscogsClient
ผผ$ 1
.
ผผ1 2 
SearchReleaseAsync
ผผ2 D
(
ผผD E
query
ผผE J
,
ผผJ K
_discogsToken
ผผL Y
)
ผผY Z
;
ผผZ [
_lastResults
ฝฝ 
=
ฝฝ 
results
ฝฝ &
;
ฝฝ& '
ReleaseListBox
พพ 
.
พพ 
ItemsSource
พพ *
=
พพ+ ,
results
พพ- 4
;
พพ4 5
if
ภภ 
(
ภภ 
results
ภภ 
==
ภภ 
null
ภภ #
||
ภภ$ &
results
ภภ' .
.
ภภ. /
Count
ภภ/ 4
==
ภภ5 7
$num
ภภ8 9
)
ภภ9 :
{
มม 

MessageBox
ยย 
.
ยย 
Show
ยย #
(
ยย# $
$str
ยย$ B
)
ยยB C
;
ยยC D
}
รร 
}
ฤฤ 
catch
ลล 
(
ลล 
System
ลล 
.
ลล 
	Exception
ลล #
ex
ลล$ &
)
ลล& '
{
ฦฦ 

MessageBox
วว 
.
วว 
Show
วว 
(
วว  
$str
วว  A
+
ววB C
ex
ววD F
.
ววF G
Message
ววG N
)
ววN O
;
ววO P
}
ศศ 
}
ษษ 	
}
สส 
}หห ๑
=C:\Playnite\_github\OstPlayer\source\Clients\DiscogsClient.cs
	namespace`` 	
	OstPlayer``
 
.`` 
Clients`` 
{`` 
publicii 

staticii 
classii 
DiscogsClientii %
{ii& '
privaterr 
staticrr 
readonlyrr 
Lazyrr  $
<rr$ %

HttpClientrr% /
>rr/ 0
_httpClientLazyrr1 @
=rrA B
newrrC F
LazyrrG K
<rrK L

HttpClientrrL V
>rrV W
(rrW X
CreateHttpClientrrX h
)rrh i
;rri j
privatexx 
staticxx 

HttpClientxx !

HttpClientxx" ,
=>xx- /
_httpClientLazyxx0 ?
.xx? @
Valuexx@ E
;xxE F
private
 
const
 
string
 
ApiUrlSearch
 )
=
* +
$str
, U
;
U V
private
 
const
 
string
 "
ApiUrlReleaseDetails
 1
=
2 3
$str
4 W
;
W X
private
 
const
 
string
 
	UserAgent
 &
=
' (
$str
) M
;
M N
private
 
static
 

HttpClient
 !
CreateHttpClient
" 2
(
2 3
)
3 4
{
5 6
var
 
handler
 
=
 
new
 
HttpClientHandler
 /
(
/ 0
)
0 1
{
2 3$
AutomaticDecompression
 &
=
' (
System
) /
.
/ 0
Net
0 3
.
3 4"
DecompressionMethods
4 H
.
H I
GZip
I M
|
N O
System
P V
.
V W
Net
W Z
.
Z ["
DecompressionMethods
[ o
.
o p
Deflate
p w
}
 
;
 
var
ขข 
client
ขข 
=
ขข 
new
ขข 

HttpClient
ขข '
(
ขข' (
handler
ขข( /
)
ขข/ 0
;
ขข0 1
client
ฆฆ 
.
ฆฆ #
DefaultRequestHeaders
ฆฆ (
.
ฆฆ( )
	UserAgent
ฆฆ) 2
.
ฆฆ2 3
ParseAdd
ฆฆ3 ;
(
ฆฆ; <
	UserAgent
ฆฆ< E
)
ฆฆE F
;
ฆฆF G
client
ฉฉ 
.
ฉฉ 
Timeout
ฉฉ 
=
ฉฉ 
TimeSpan
ฉฉ %
.
ฉฉ% &
FromSeconds
ฉฉ& 1
(
ฉฉ1 2
$num
ฉฉ2 4
)
ฉฉ4 5
;
ฉฉ5 6
client
ญญ 
.
ญญ #
DefaultRequestHeaders
ญญ (
.
ญญ( )
Add
ญญ) ,
(
ญญ, -
$str
ญญ- 5
,
ญญ5 6
$str
ญญ7 I
)
ญญI J
;
ญญJ K
return
ฏฏ 
client
ฏฏ 
;
ฏฏ 
}
ฐฐ 	
public
ลล 
static
ลล 
async
ลล 
Task
ลล  
<
ลล  !
List
ลล! %
<
ลล% &"
DiscogsMetadataModel
ลล& :
>
ลล: ;
>
ลล; < 
SearchReleaseAsync
ลล= O
(
ลลO P
string
ฦฦ 
query
ฦฦ 
,
ฦฦ 
string
วว 
token
วว 
)
วว 
{
วว 
if
ษษ 
(
ษษ 
string
ษษ 
.
ษษ  
IsNullOrWhiteSpace
ษษ )
(
ษษ) *
token
ษษ* /
)
ษษ/ 0
)
ษษ0 1
throw
สส 
new
สส 
ArgumentException
สส +
(
สส+ ,
$str
สส, g
,
สสg h
nameof
สสi o
(
สสo p
token
สสp u
)
สสu v
)
สสv w
;
สสw x
if
ออ 
(
ออ 
string
ออ 
.
ออ  
IsNullOrWhiteSpace
ออ )
(
ออ) *
query
ออ* /
)
ออ/ 0
)
ออ0 1
return
ฮฮ 
new
ฮฮ 
List
ฮฮ 
<
ฮฮ  "
DiscogsMetadataModel
ฮฮ  4
>
ฮฮ4 5
(
ฮฮ5 6
)
ฮฮ6 7
;
ฮฮ7 8
var
าา 
url
าา 
=
าา 
$"
าา 
{
าา 
ApiUrlSearch
าา %
}
าา% &
$str
าา& )
{
าา) *
Uri
าา* -
.
าา- .
EscapeDataString
าา. >
(
าา> ?
query
าา? D
)
าาD E
}
าาE F
$str
าาF Z
{
าาZ [
Uri
าา[ ^
.
าา^ _
EscapeDataString
าา_ o
(
าาo p
token
าาp u
)
าาu v
}
าาv w
"
าาw x
;
าาx y
try
ิิ 
{
ิิ 
var
ืื 
json
ืื 
=
ืื 
await
ืื  

HttpClient
ืื! +
.
ืื+ ,
GetStringAsync
ืื, :
(
ืื: ;
url
ืื; >
)
ืื> ?
;
ืื? @
if
ฺฺ 
(
ฺฺ 
string
ฺฺ 
.
ฺฺ 
IsNullOrEmpty
ฺฺ (
(
ฺฺ( )
json
ฺฺ) -
)
ฺฺ- .
)
ฺฺ. /
{
ฺฺ0 1
throw
 
new
 '
InvalidOperationException
 7
(
7 8
$str
8 b
)
b c
;
c d
}
 
json
฿฿ 
=
฿฿ 
CleanJsonResponse
฿฿ (
(
฿฿( )
json
฿฿) -
)
฿฿- .
;
฿฿. /
var
โโ 
data
โโ 
=
โโ 
JsonConvert
โโ &
.
โโ& '
DeserializeObject
โโ' 8
<
โโ8 9!
DiscogsSearchResult
โโ9 L
>
โโL M
(
โโM N
json
โโN R
)
โโR S
;
โโS T
return
ๅๅ "
ProcessSearchResults
ๅๅ +
(
ๅๅ+ ,
data
ๅๅ, 0
)
ๅๅ0 1
;
ๅๅ1 2
}
ๆๆ 
catch
็็ 
(
็็ "
HttpRequestException
็็ '
ex
็็( *
)
็็* +
{
็็, -
throw
้้ 
new
้้ '
InvalidOperationException
้้ 3
(
้้3 4
$"
้้4 6
$str
้้6 ^
{
้้^ _
ex
้้_ a
.
้้a b
Message
้้b i
}
้้i j
"
้้j k
,
้้k l
ex
้้m o
)
้้o p
;
้้p q
}
๊๊ 
catch
๋๋ 
(
๋๋ 
JsonException
๋๋  
ex
๋๋! #
)
๋๋# $
{
๋๋% &
throw
ํํ 
new
ํํ '
InvalidOperationException
ํํ 3
(
ํํ3 4
$"
ํํ4 6
$str
ํํ6 \
{
ํํ\ ]
ex
ํํ] _
.
ํํ_ `
Message
ํํ` g
}
ํํg h
"
ํํh i
,
ํํi j
ex
ํํk m
)
ํํm n
;
ํํn o
}
๎๎ 
}
๏๏ 	
public
 
static
 
async
 
Task
  
<
  !"
DiscogsMetadataModel
! 5
>
5 6$
GetReleaseDetailsAsync
7 M
(
M N
string
 
	releaseId
 
,
 
string
 
token
 
)
 
{
 
if
 
(
 
string
 
.
  
IsNullOrWhiteSpace
 )
(
) *
token
* /
)
/ 0
)
0 1
throw
 
new
 
ArgumentException
 +
(
+ ,
$str
, g
,
g h
nameof
i o
(
o p
token
p u
)
u v
)
v w
;
w x
if
 
(
 
string
 
.
  
IsNullOrWhiteSpace
 )
(
) *
	releaseId
* 3
)
3 4
)
4 5
throw
 
new
 
ArgumentException
 +
(
+ ,
$str
, e
,
e f
nameof
g m
(
m n
	releaseId
n w
)
w x
)
x y
;
y z
var
 
url
 
=
 
$"
 
{
 "
ApiUrlReleaseDetails
 -
}
- .
{
. /
Uri
/ 2
.
2 3
EscapeDataString
3 C
(
C D
	releaseId
D M
)
M N
}
N O
$str
O V
{
V W
Uri
W Z
.
Z [
EscapeDataString
[ k
(
k l
token
l q
)
q r
}
r s
"
s t
;
t u
try
 
{
 
var
 
json
 
=
 
await
  

HttpClient
! +
.
+ ,
GetStringAsync
, :
(
: ;
url
; >
)
> ?
;
? @
json
 
=
 
CleanJsonResponse
 (
(
( )
json
) -
)
- .
;
. /
var
 
data
 
=
 
JsonConvert
 &
.
& '
DeserializeObject
' 8
<
8 9#
DiscogsReleaseDetails
9 N
>
N O
(
O P
json
P T
)
T U
;
U V
if
 
(
 
data
 
==
 
null
  
)
  !
return
 
null
 
;
  
return
 .
 MapReleaseDetailsToMetadataModel
 7
(
7 8
data
8 <
)
< =
;
= >
}
 
catch
 
(
 "
HttpRequestException
 '
ex
( *
)
* +
{
, -
throw
กก 
new
กก '
InvalidOperationException
กก 3
(
กก3 4
$"
กก4 6
$str
กก6 k
{
กกk l
ex
กกl n
.
กกn o
Message
กกo v
}
กกv w
"
กกw x
,
กกx y
ex
กกz |
)
กก| }
;
กก} ~
}
ขข 
catch
ฃฃ 
(
ฃฃ 
JsonException
ฃฃ  
ex
ฃฃ! #
)
ฃฃ# $
{
ฃฃ% &
throw
ฅฅ 
new
ฅฅ '
InvalidOperationException
ฅฅ 3
(
ฅฅ3 4
$"
ฅฅ4 6
$str
ฅฅ6 h
{
ฅฅh i
ex
ฅฅi k
.
ฅฅk l
Message
ฅฅl s
}
ฅฅs t
"
ฅฅt u
,
ฅฅu v
ex
ฅฅw y
)
ฅฅy z
;
ฅฅz {
}
ฆฆ 
}
งง 	
[
ตต 	
Obsolete
ตต	 
(
ตต 
$str
ตต e
)
ตตe f
]
ตตf g
private
ถถ 
static
ถถ 
void
ถถ !
ConfigureHttpClient
ถถ /
(
ถถ/ 0

HttpClient
ถถ0 :
client
ถถ; A
)
ถถA B
{
ถถC D
client
นน 
.
นน #
DefaultRequestHeaders
นน (
.
นน( )
	UserAgent
นน) 2
.
นน2 3
ParseAdd
นน3 ;
(
นน; <
	UserAgent
นน< E
)
นนE F
;
นนF G
client
ผผ 
.
ผผ 
Timeout
ผผ 
=
ผผ 
TimeSpan
ผผ %
.
ผผ% &
FromSeconds
ผผ& 1
(
ผผ1 2
$num
ผผ2 4
)
ผผ4 5
;
ผผ5 6
}
ฝฝ 	
private
ฦฦ 
static
ฦฦ 
List
ฦฦ 
<
ฦฦ "
DiscogsMetadataModel
ฦฦ 0
>
ฦฦ0 1"
ProcessSearchResults
ฦฦ2 F
(
ฦฦF G!
DiscogsSearchResult
ฦฦG Z
data
ฦฦ[ _
)
ฦฦ_ `
{
ฦฦa b
var
วว 
releases
วว 
=
วว 
new
วว 
List
วว #
<
วว# $"
DiscogsMetadataModel
วว$ 8
>
วว8 9
(
วว9 :
)
วว: ;
;
วว; <
if
สส 
(
สส 
data
สส 
?
สส 
.
สส 
Results
สส 
==
สส  
null
สส! %
)
สส% &
return
หห 
releases
หห 
;
หห  
var
ฯฯ 
releaseResults
ฯฯ 
=
ฯฯ  
data
ฯฯ! %
.
ฯฯ% &
Results
ฯฯ& -
.
ะะ 
Where
ะะ 
(
ะะ 
r
ะะ 
=>
ะะ 
string
ะะ "
.
ะะ" #
Equals
ะะ# )
(
ะะ) *
r
ะะ* +
.
ะะ+ ,
Type
ะะ, 0
,
ะะ0 1
$str
ะะ2 ;
,
ะะ; <
StringComparison
ะะ= M
.
ะะM N
OrdinalIgnoreCase
ะะN _
)
ะะ_ `
)
ะะ` a
.
ัั 
ToList
ัั 
(
ัั 
)
ัั 
;
ัั 
foreach
ิิ 
(
ิิ 
var
ิิ 
result
ิิ 
in
ิิ  "
releaseResults
ิิ# 1
)
ิิ1 2
{
ิิ3 4
if
ึึ 
(
ึึ 
string
ึึ 
.
ึึ  
IsNullOrWhiteSpace
ึึ -
(
ึึ- .
result
ึึ. 4
.
ึึ4 5
Title
ึึ5 :
)
ึึ: ;
||
ึึ< >
result
ึึ? E
.
ึึE F
Id
ึึF H
<=
ึึI K
$num
ึึL M
)
ึึM N
continue
ืื 
;
ืื 
string
ฺฺ 
artist
ฺฺ 
=
ฺฺ 
result
ฺฺ  &
.
ฺฺ& '
Artist
ฺฺ' -
;
ฺฺ- .
string
 
title
 
=
 
result
 %
.
% &
Title
& +
;
+ ,
if
฿฿ 
(
฿฿ 
string
฿฿ 
.
฿฿  
IsNullOrWhiteSpace
฿฿ -
(
฿฿- .
artist
฿฿. 4
)
฿฿4 5
&&
฿฿6 8
!
฿฿9 :
string
฿฿: @
.
฿฿@ A 
IsNullOrWhiteSpace
฿฿A S
(
฿฿S T
title
฿฿T Y
)
฿฿Y Z
)
฿฿Z [
{
฿฿\ ]
var
เเ 
parts
เเ 
=
เเ 
title
เเ  %
.
เเ% &
Split
เเ& +
(
เเ+ ,
new
เเ, /
[
เเ/ 0
]
เเ0 1
{
เเ2 3
$str
เเ4 9
}
เเ: ;
,
เเ; <
$num
เเ= >
,
เเ> ? 
StringSplitOptions
เเ@ R
.
เเR S
None
เเS W
)
เเW X
;
เเX Y
if
แแ 
(
แแ 
parts
แแ 
.
แแ 
Length
แแ $
==
แแ% '
$num
แแ( )
)
แแ) *
{
แแ+ ,
artist
โโ 
=
โโ  
parts
โโ! &
[
โโ& '
$num
โโ' (
]
โโ( )
.
โโ) *
Trim
โโ* .
(
โโ. /
)
โโ/ 0
;
โโ0 1
title
ใใ 
=
ใใ 
parts
ใใ  %
[
ใใ% &
$num
ใใ& '
]
ใใ' (
.
ใใ( )
Trim
ใใ) -
(
ใใ- .
)
ใใ. /
;
ใใ/ 0
}
ไไ 
}
ๅๅ 
releases
่่ 
.
่่ 
Add
่่ 
(
่่ 
new
่่  "
DiscogsMetadataModel
่่! 5
{
่่6 7
Title
้้ 
=
้้ 
title
้้ !
??
้้" $
string
้้% +
.
้้+ ,
Empty
้้, 1
,
้้1 2
Artist
๊๊ 
=
๊๊ 
artist
๊๊ #
??
๊๊$ &
string
๊๊' -
.
๊๊- .
Empty
๊๊. 3
,
๊๊3 4
Released
๋๋ 
=
๋๋ 
result
๋๋ %
.
๋๋% &
Year
๋๋& *
,
๋๋* +
CoverUrl
์์ 
=
์์ 
result
์์ %
.
์์% &
Thumb
์์& +
,
์์+ ,

DiscogsUrl
ํํ 
=
ํํ  
$"
ํํ! #
$str
ํํ# C
{
ํํC D
result
ํํD J
.
ํํJ K
Id
ํํK M
}
ํํM N
"
ํํN O
,
ํํO P
}
๎๎ 
)
๎๎ 
;
๎๎ 
}
๏๏ 
return
๑๑ 
releases
๑๑ 
;
๑๑ 
}
๒๒ 	
private
๛๛ 
static
๛๛ "
DiscogsMetadataModel
๛๛ +.
 MapReleaseDetailsToMetadataModel
๛๛, L
(
๛๛L M#
DiscogsReleaseDetails
๛๛M b
data
๛๛c g
)
๛๛g h
{
๛๛i j
string
 
coverUrl
 
=
 
null
 "
;
" #
if
 
(
 
data
 
.
 
Images
 
!=
 
null
 #
&&
$ &
data
' +
.
+ ,
Images
, 2
.
2 3
Count
3 8
>
9 :
$num
; <
)
< =
{
> ?
var
 
primaryImage
  
=
! "
data
# '
.
' (
Images
( .
[
. /
$num
/ 0
]
0 1
;
1 2
coverUrl
 
=
 
!
 
string
 "
.
" #
IsNullOrEmpty
# 0
(
0 1
primaryImage
1 =
.
= >
Uri
> A
)
A B
?
 
primaryImage
 "
.
" #
Uri
# &
:
 
primaryImage
 "
.
" #
Uri150
# )
;
) *
}
 
string
 
primaryArtist
  
=
! "
null
# '
;
' (
if
 
(
 
data
 
.
 
Artists
 
!=
 
null
  $
&&
% '
data
( ,
.
, -
Artists
- 4
.
4 5
Count
5 :
>
; <
$num
= >
)
> ?
{
@ A
primaryArtist
 
=
 
data
  $
.
$ %
Artists
% ,
[
, -
$num
- .
]
. /
.
/ 0
Name
0 4
;
4 5
}
 
string
 
labelString
 
=
  
null
! %
;
% &
if
 
(
 
data
 
.
 
Labels
 
!=
 
null
 #
&&
$ &
data
' +
.
+ ,
Labels
, 2
.
2 3
Count
3 8
>
9 :
$num
; <
)
< =
{
> ?
labelString
 
=
 
string
 $
.
$ %
Join
% )
(
) *
$str
* .
,
. /
data
0 4
.
4 5
Labels
5 ;
.
; <
Select
< B
(
B C
l
C D
=>
E G
l
H I
.
I J
Name
J N
)
N O
)
O P
;
P Q
}
 
string
 
formatString
 
=
  !
null
" &
;
& '
if
 
(
 
data
 
.
 
Formats
 
!=
 
null
  $
&&
% '
data
( ,
.
, -
Formats
- 4
.
4 5
Count
5 :
>
; <
$num
= >
)
> ?
{
@ A
var
  
formatDescriptions
 &
=
' (
data
) -
.
- .
Formats
. 5
.
5 6
Select
6 <
(
< =
f
= >
=>
? A
f
 
.
 
Name
 
+
 
(
 
string
 $
.
$ %
IsNullOrEmpty
% 2
(
2 3
f
3 4
.
4 5
Description
5 @
)
@ A
?
B C
$str
D F
:
G H
$"
I K
$str
K M
{
M N
f
N O
.
O P
Description
P [
}
[ \
$str
\ ]
"
] ^
)
^ _
)
_ `
;
` a
formatString
 
=
 
string
 %
.
% &
Join
& *
(
* +
$str
+ /
,
/ 0 
formatDescriptions
1 C
)
C D
;
D E
}
 
var
 
tracklistModels
 
=
  !
new
" %
List
& *
<
* +"
DiscogsMetadataModel
+ ?
.
? @
DiscogsTrack
@ L
>
L M
(
M N
)
N O
;
O P
if
 
(
 
data
 
.
 
	Tracklist
 
!=
 !
null
" &
)
& '
{
( )
tracklistModels
 
=
  !
data
" &
.
& '
	Tracklist
' 0
.
 
Select
 
(
 
t
 
=>
  
new
! $"
DiscogsMetadataModel
% 9
.
9 :
DiscogsTrack
: F
{
G H
Title
 
=
 
t
  !
.
! "
Title
" '
??
( *
string
+ 1
.
1 2
Empty
2 7
,
7 8
Duration
  
=
! "
t
# $
.
$ %
Duration
% -
??
. 0
string
1 7
.
7 8
Empty
8 =
,
= >
}
กก 
)
กก 
.
ขข 
ToList
ขข 
(
ขข 
)
ขข 
;
ขข 
}
ฃฃ 
return
ฆฆ 
new
ฆฆ "
DiscogsMetadataModel
ฆฆ +
{
ฆฆ, -
Title
งง 
=
งง 
data
งง 
.
งง 
Title
งง "
??
งง# %
string
งง& ,
.
งง, -
Empty
งง- 2
,
งง2 3
Album
จจ 
=
จจ 
data
จจ 
.
จจ 
Title
จจ "
??
จจ# %
string
จจ& ,
.
จจ, -
Empty
จจ- 2
,
จจ2 3
Artist
ฉฉ 
=
ฉฉ 
primaryArtist
ฉฉ &
??
ฉฉ' )
string
ฉฉ* 0
.
ฉฉ0 1
Empty
ฉฉ1 6
,
ฉฉ6 7
Country
ชช 
=
ชช 
data
ชช 
.
ชช 
Country
ชช &
??
ชช' )
string
ชช* 0
.
ชช0 1
Empty
ชช1 6
,
ชช6 7
Label
ซซ 
=
ซซ 
labelString
ซซ #
??
ซซ$ &
string
ซซ' -
.
ซซ- .
Empty
ซซ. 3
,
ซซ3 4
Format
ฌฌ 
=
ฌฌ 
formatString
ฌฌ %
??
ฌฌ& (
string
ฌฌ) /
.
ฌฌ/ 0
Empty
ฌฌ0 5
,
ฌฌ5 6
Genres
ญญ 
=
ญญ 
data
ญญ 
.
ญญ 
Genres
ญญ $
??
ญญ% '
new
ญญ( +
List
ญญ, 0
<
ญญ0 1
string
ญญ1 7
>
ญญ7 8
(
ญญ8 9
)
ญญ9 :
,
ญญ: ;
Styles
ฎฎ 
=
ฎฎ 
data
ฎฎ 
.
ฎฎ 
Styles
ฎฎ $
??
ฎฎ% '
new
ฎฎ( +
List
ฎฎ, 0
<
ฎฎ0 1
string
ฎฎ1 7
>
ฎฎ7 8
(
ฎฎ8 9
)
ฎฎ9 :
,
ฎฎ: ;
Notes
ฏฏ 
=
ฏฏ 
data
ฏฏ 
.
ฏฏ 
Notes
ฏฏ "
??
ฏฏ# %
string
ฏฏ& ,
.
ฏฏ, -
Empty
ฏฏ- 2
,
ฏฏ2 3
Released
ฐฐ 
=
ฐฐ 
data
ฐฐ 
.
ฐฐ  
Released
ฐฐ  (
??
ฐฐ) +
data
ฐฐ, 0
.
ฐฐ0 1
Year
ฐฐ1 5
??
ฐฐ6 8
string
ฐฐ9 ?
.
ฐฐ? @
Empty
ฐฐ@ E
,
ฐฐE F
Comment
ฑฑ 
=
ฑฑ 
null
ฑฑ 
,
ฑฑ 
CoverUrl
ฒฒ 
=
ฒฒ 
coverUrl
ฒฒ #
,
ฒฒ# $

DiscogsUrl
ณณ 
=
ณณ 
$"
ณณ 
$str
ณณ ?
{
ณณ? @
data
ณณ@ D
.
ณณD E
Id
ณณE G
}
ณณG H
"
ณณH I
,
ณณI J
	Tracklist
ดด 
=
ดด 
tracklistModels
ดด +
,
ดด+ ,
}
ตต 
;
ตต 
}
ถถ 	
private
พพ 
static
พพ 
string
พพ 
CleanJsonResponse
พพ /
(
พพ/ 0
string
พพ0 6
json
พพ7 ;
)
พพ; <
{
พพ= >
if
ฟฟ 
(
ฟฟ 
string
ฟฟ 
.
ฟฟ 
IsNullOrEmpty
ฟฟ $
(
ฟฟ$ %
json
ฟฟ% )
)
ฟฟ) *
)
ฟฟ* +
return
ภภ 
json
ภภ 
;
ภภ 
if
ฤฤ 
(
ฤฤ 
json
ฤฤ 
.
ฤฤ 
Length
ฤฤ 
>
ฤฤ 
$num
ฤฤ 
&&
ฤฤ  "
json
ฤฤ# '
[
ฤฤ' (
$num
ฤฤ( )
]
ฤฤ) *
==
ฤฤ+ -
$char
ฤฤ. 6
)
ฤฤ6 7
{
ฤฤ8 9
json
ลล 
=
ลล 
json
ลล 
.
ลล 
	Substring
ลล %
(
ลล% &
$num
ลล& '
)
ลล' (
;
ลล( )
}
ฦฦ 
json
สส 
=
สส 
json
สส 
.
สส 
Trim
สส 
(
สส 
$char
สส !
,
สส! "
$char
สส# +
,
สส+ ,
$char
สส- 5
,
สส5 6
$char
สส7 ?
,
สส? @
$char
สสA D
,
สสD E
$char
สสF J
,
สสJ K
$char
สสL P
,
สสP Q
$char
สสR V
)
สสV W
;
สสW X
var
ฮฮ 
cleaned
ฮฮ 
=
ฮฮ 
new
ฮฮ 
System
ฮฮ $
.
ฮฮ$ %
Text
ฮฮ% )
.
ฮฮ) *
StringBuilder
ฮฮ* 7
(
ฮฮ7 8
json
ฮฮ8 <
.
ฮฮ< =
Length
ฮฮ= C
)
ฮฮC D
;
ฮฮD E
foreach
ฯฯ 
(
ฯฯ 
char
ฯฯ 
c
ฯฯ 
in
ฯฯ 
json
ฯฯ #
)
ฯฯ# $
{
ฯฯ% &
if
ะะ 
(
ะะ 
char
ะะ 
.
ะะ 
	IsControl
ะะ "
(
ะะ" #
c
ะะ# $
)
ะะ$ %
&&
ะะ& (
c
ะะ) *
!=
ะะ+ -
$char
ะะ. 2
&&
ะะ3 5
c
ะะ6 7
!=
ะะ8 :
$char
ะะ; ?
&&
ะะ@ B
c
ะะC D
!=
ะะE G
$char
ะะH L
)
ะะL M
{
ะะN O
continue
าา 
;
าา 
}
ำำ 
cleaned
ีี 
.
ีี 
Append
ีี 
(
ีี 
c
ีี  
)
ีี  !
;
ีี! "
}
ึึ 
return
ุุ 
cleaned
ุุ 
.
ุุ 
ToString
ุุ #
(
ุุ# $
)
ุุ$ %
;
ุุ% &
}
ูู 	
private
ไไ 
sealed
ไไ 
class
ไไ !
DiscogsSearchResult
ไไ 0
{
ไไ1 2
[
ๆๆ 
JsonProperty
ๆๆ 
(
ๆๆ 
$str
ๆๆ #
)
ๆๆ# $
]
ๆๆ$ %
public
็็ 
List
็็ 
<
็็ 
Result
็็ 
>
็็ 
Results
็็  '
{
็็( )
get
็็* -
;
็็- .
set
็็/ 2
;
็็2 3
}
็็4 5
public
ํํ 
sealed
ํํ 
class
ํํ 
Result
ํํ  &
{
ํํ' (
[
๏๏ 
JsonProperty
๏๏ 
(
๏๏ 
$str
๏๏ %
)
๏๏% &
]
๏๏& '
public
๐๐ 
string
๐๐ 
Title
๐๐ #
{
๐๐$ %
get
๐๐& )
;
๐๐) *
set
๐๐+ .
;
๐๐. /
}
๐๐0 1
[
๓๓ 
JsonProperty
๓๓ 
(
๓๓ 
$str
๓๓ $
)
๓๓$ %
]
๓๓% &
public
๔๔ 
string
๔๔ 
Year
๔๔ "
{
๔๔# $
get
๔๔% (
;
๔๔( )
set
๔๔* -
;
๔๔- .
}
๔๔/ 0
[
๗๗ 
JsonProperty
๗๗ 
(
๗๗ 
$str
๗๗ "
)
๗๗" #
]
๗๗# $
public
๘๘ 
int
๘๘ 
Id
๘๘ 
{
๘๘ 
get
๘๘  #
;
๘๘# $
set
๘๘% (
;
๘๘( )
}
๘๘* +
[
๛๛ 
JsonProperty
๛๛ 
(
๛๛ 
$str
๛๛ %
)
๛๛% &
]
๛๛& '
public
 
string
 
Thumb
 #
{
$ %
get
& )
;
) *
set
+ .
;
. /
}
0 1
[
 
JsonProperty
 
(
 
$str
 $
)
$ %
]
% &
public
 
string
 
Type
 "
{
# $
get
% (
;
( )
set
* -
;
- .
}
/ 0
[
 
JsonProperty
 
(
 
$str
 &
)
& '
]
' (
public
 
string
 
Artist
 $
{
% &
get
' *
;
* +
set
, /
;
/ 0
}
1 2
}
 
}
 	
private
 
sealed
 
class
 #
DiscogsReleaseDetails
 2
{
3 4
[
 
JsonProperty
 
(
 
$str
 !
)
! "
]
" #
public
 
string
 
Title
 
{
  !
get
" %
;
% &
set
' *
;
* +
}
, -
[
 
JsonProperty
 
(
 
$str
  
)
  !
]
! "
public
 
string
 
Year
 
{
  
get
! $
;
$ %
set
& )
;
) *
}
+ ,
[
 
JsonProperty
 
(
 
$str
 
)
 
]
  
public
 
int
 
Id
 
{
 
get
 
;
  
set
! $
;
$ %
}
& '
[
 
JsonProperty
 
(
 
$str
 #
)
# $
]
$ %
public
 
string
 
Country
 !
{
" #
get
$ '
;
' (
set
) ,
;
, -
}
. /
[
 
JsonProperty
 
(
 
$str
 "
)
" #
]
# $
public
 
List
 
<
 
string
 
>
 
Genres
  &
{
' (
get
) ,
;
, -
set
. 1
;
1 2
}
3 4
[
ฃฃ 
JsonProperty
ฃฃ 
(
ฃฃ 
$str
ฃฃ "
)
ฃฃ" #
]
ฃฃ# $
public
คค 
List
คค 
<
คค 
string
คค 
>
คค 
Styles
คค  &
{
คค' (
get
คค) ,
;
คค, -
set
คค. 1
;
คค1 2
}
คค3 4
[
งง 
JsonProperty
งง 
(
งง 
$str
งง "
)
งง" #
]
งง# $
public
จจ 
List
จจ 
<
จจ 
Label
จจ 
>
จจ 
Labels
จจ %
{
จจ& '
get
จจ( +
;
จจ+ ,
set
จจ- 0
;
จจ0 1
}
จจ2 3
[
ซซ 
JsonProperty
ซซ 
(
ซซ 
$str
ซซ #
)
ซซ# $
]
ซซ$ %
public
ฌฌ 
List
ฌฌ 
<
ฌฌ 
Format
ฌฌ 
>
ฌฌ 
Formats
ฌฌ  '
{
ฌฌ( )
get
ฌฌ* -
;
ฌฌ- .
set
ฌฌ/ 2
;
ฌฌ2 3
}
ฌฌ4 5
[
ฏฏ 
JsonProperty
ฏฏ 
(
ฏฏ 
$str
ฏฏ !
)
ฏฏ! "
]
ฏฏ" #
public
ฐฐ 
string
ฐฐ 
Notes
ฐฐ 
{
ฐฐ  !
get
ฐฐ" %
;
ฐฐ% &
set
ฐฐ' *
;
ฐฐ* +
}
ฐฐ, -
[
ณณ 
JsonProperty
ณณ 
(
ณณ 
$str
ณณ $
)
ณณ$ %
]
ณณ% &
public
ดด 
string
ดด 
Released
ดด "
{
ดด# $
get
ดด% (
;
ดด( )
set
ดด* -
;
ดด- .
}
ดด/ 0
[
ทท 
JsonProperty
ทท 
(
ทท 
$str
ทท "
)
ทท" #
]
ทท# $
public
ธธ 
List
ธธ 
<
ธธ 
Image
ธธ 
>
ธธ 
Images
ธธ %
{
ธธ& '
get
ธธ( +
;
ธธ+ ,
set
ธธ- 0
;
ธธ0 1
}
ธธ2 3
[
ปป 
JsonProperty
ปป 
(
ปป 
$str
ปป %
)
ปป% &
]
ปป& '
public
ผผ 
List
ผผ 
<
ผผ 
Track
ผผ 
>
ผผ 
	Tracklist
ผผ (
{
ผผ) *
get
ผผ+ .
;
ผผ. /
set
ผผ0 3
;
ผผ3 4
}
ผผ5 6
[
ฟฟ 
JsonProperty
ฟฟ 
(
ฟฟ 
$str
ฟฟ #
)
ฟฟ# $
]
ฟฟ$ %
public
ภภ 
List
ภภ 
<
ภภ 
Artist
ภภ 
>
ภภ 
Artists
ภภ  '
{
ภภ( )
get
ภภ* -
;
ภภ- .
set
ภภ/ 2
;
ภภ2 3
}
ภภ4 5
public
รร 
sealed
รร 
class
รร 
Label
รร  %
{
รร& '
[
ลล 
JsonProperty
ลล 
(
ลล 
$str
ลล $
)
ลล$ %
]
ลล% &
public
ฦฦ 
string
ฦฦ 
Name
ฦฦ "
{
ฦฦ# $
get
ฦฦ% (
;
ฦฦ( )
set
ฦฦ* -
;
ฦฦ- .
}
ฦฦ/ 0
}
วว 
public
สส 
sealed
สส 
class
สส 
Format
สส  &
{
สส' (
[
ฬฬ 
JsonProperty
ฬฬ 
(
ฬฬ 
$str
ฬฬ $
)
ฬฬ$ %
]
ฬฬ% &
public
ออ 
string
ออ 
Name
ออ "
{
ออ# $
get
ออ% (
;
ออ( )
set
ออ* -
;
ออ- .
}
ออ/ 0
[
ะะ 
JsonProperty
ะะ 
(
ะะ 
$str
ะะ +
)
ะะ+ ,
]
ะะ, -
public
ัั 
string
ัั 
Description
ัั )
{
ัั* +
get
ัั, /
;
ัั/ 0
set
ัั1 4
;
ัั4 5
}
ัั6 7
}
าา 
public
ีี 
sealed
ีี 
class
ีี 
Image
ีี  %
{
ีี& '
[
ืื 
JsonProperty
ืื 
(
ืื 
$str
ืื #
)
ืื# $
]
ืื$ %
public
ุุ 
string
ุุ 
Uri
ุุ !
{
ุุ" #
get
ุุ$ '
;
ุุ' (
set
ุุ) ,
;
ุุ, -
}
ุุ. /
[
 
JsonProperty
 
(
 
$str
 &
)
& '
]
' (
public
 
string
 
Uri150
 $
{
% &
get
' *
;
* +
set
, /
;
/ 0
}
1 2
}
 
public
เเ 
sealed
เเ 
class
เเ 
Track
เเ  %
{
เเ& '
[
โโ 
JsonProperty
โโ 
(
โโ 
$str
โโ %
)
โโ% &
]
โโ& '
public
ใใ 
string
ใใ 
Title
ใใ #
{
ใใ$ %
get
ใใ& )
;
ใใ) *
set
ใใ+ .
;
ใใ. /
}
ใใ0 1
[
ๆๆ 
JsonProperty
ๆๆ 
(
ๆๆ 
$str
ๆๆ (
)
ๆๆ( )
]
ๆๆ) *
public
็็ 
string
็็ 
Duration
็็ &
{
็็' (
get
็็) ,
;
็็, -
set
็็. 1
;
็็1 2
}
็็3 4
}
่่ 
public
๋๋ 
sealed
๋๋ 
class
๋๋ 
Artist
๋๋  &
{
๋๋' (
[
ํํ 
JsonProperty
ํํ 
(
ํํ 
$str
ํํ $
)
ํํ$ %
]
ํํ% &
public
๎๎ 
string
๎๎ 
Name
๎๎ "
{
๎๎# $
get
๎๎% (
;
๎๎( )
set
๎๎* -
;
๎๎- .
}
๎๎/ 0
}
๏๏ 
}
๐๐ 	
}
๓๓ 
}๔๔ 
MC:\Playnite\_github\OstPlayer\source\Views\Windows\CoverPreviewWindow.xaml.cs
	namespacekk 	
	OstPlayerkk
 
.kk 
Viewskk 
.kk 
Windowskk !
{ll 
publicmm 

partialmm 
classmm 
CoverPreviewWindowmm +
:mm, -
Windowmm. 4
{nn 
publictt 
CoverPreviewWindowtt !
(tt! "
stringtt" (
imageUrltt) 1
=tt2 3
nulltt4 8
,tt8 9
ImageSourcett: E
embeddedImagettF S
=ttT U
nullttV Z
)ttZ [
{uu 	
InitializeComponentvv 
(vv  
)vv  !
;vv! "
ifxx 
(xx 
embeddedImagexx 
!=xx  
nullxx! %
)xx% &
{yy 

CoverImage{{ 
.{{ 
Source{{ !
={{" #
embeddedImage{{$ 1
;{{1 2
}|| 
else}} 
if}} 
(}} 
!}} 
string}} 
.}} 
IsNullOrEmpty}} *
(}}* +
imageUrl}}+ 3
)}}3 4
)}}4 5
{~~ 
try 
{
 
var
 
bitmap
 
=
  
new
! $
BitmapImage
% 0
(
0 1
)
1 2
;
2 3
bitmap
 
.
 
	BeginInit
 $
(
$ %
)
% &
;
& '
bitmap
 
.
 
	UriSource
 $
=
% &
new
' *
Uri
+ .
(
. /
imageUrl
/ 7
)
7 8
;
8 9
bitmap
 
.
 
CacheOption
 &
=
' (
BitmapCacheOption
) :
.
: ;
OnLoad
; A
;
A B
bitmap
 
.
 
EndInit
 "
(
" #
)
# $
;
$ %

CoverImage
 
.
 
Source
 %
=
& '
bitmap
( .
;
. /
}
 
catch
 
(
 
	Exception
  
ex
! #
)
# $
{
 

MessageBox
 
.
 
Show
 #
(
# $
$str
 9
+
: ;
ex
< >
.
> ?
Message
? F
,
F G
$str
 
,
  
MessageBoxButton
 (
.
( )
OK
) +
,
+ ,
MessageBoxImage
 '
.
' (
Error
( -
)
 
;
 
}
 
}
 
else
 
{
 

MessageBox
 
.
 
Show
 
(
  
$str
 8
,
8 9
$str
 
,
 
MessageBoxButton
 $
.
$ %
OK
% '
,
' (
MessageBoxImage
 #
.
# $
Warning
$ +
)
 
;
 
}
 
}
 	
}
 
} ำ๛
LC:\Playnite\_github\OstPlayer\source\ViewModels\OstPlayerSidebarViewModel.cs
	namespaceฤฤ 	
	OstPlayer
ฤฤ
 
.
ฤฤ 

ViewModels
ฤฤ 
{
ฤฤ  
public
หห 

class
หห '
OstPlayerSidebarViewModel
หห *
:
หห+ ,
ObservableObject
หห- =
{
หห> ?
private
าา 
readonly
าา 
	OstPlayer
าา "
plugin
าา# )
;
าา) *
private
ูู "
MusicPlaybackService
ูู $
playbackService
ูู% 4
;
ูู4 5
private
เเ 
DispatcherTimer
เเ 
progressTimer
เเ  -
;
เเ- .
private
ๆๆ 
bool
ๆๆ 
isAutoPlayingNext
ๆๆ &
=
ๆๆ' (
false
ๆๆ) .
;
ๆๆ. /
private
์์ 
bool
์์ 
isUserDragging
์์ #
=
์์$ %
false
์์& +
;
์์+ ,
private
๒๒ 
int
๒๒ 
playRetryCount
๒๒ "
=
๒๒# $
$num
๒๒% &
;
๒๒& '
private
๘๘ 
const
๘๘ 
int
๘๘ 
MaxPlayRetries
๘๘ (
=
๘๘) *
$num
๘๘+ ,
;
๘๘, -
private
 "
ObservableCollection
 $
<
$ %
Game
% )
>
) *
games
+ 0
;
0 1
private
 
List
 
<
 
Game
 
>
 
allGamesWithMusic
 ,
;
, -
private
 "
ObservableCollection
 $
<
$ %
TrackListItem
% 2
>
2 3

musicFiles
4 >
;
> ?
private
 
Game
 
selectedGame
 !
;
! "
private
กก 
string
กก 
selectedMusicFile
กก (
;
กก( )
private
ซซ 
bool
ซซ 
	isPlaying
ซซ 
=
ซซ  
false
ซซ! &
;
ซซ& '
private
ฑฑ 
bool
ฑฑ 
isPaused
ฑฑ 
=
ฑฑ 
false
ฑฑ  %
;
ฑฑ% &
private
ทท 
double
ทท 
position
ทท 
=
ทท  !
$num
ทท" #
;
ทท# $
private
ฝฝ 
double
ฝฝ 
duration
ฝฝ 
=
ฝฝ  !
$num
ฝฝ" #
;
ฝฝ# $
private
รร 
double
รร 
volume
รร 
=
รร 
$num
รร  "
;
รร" #
private
ออ 
string
ออ 

statusText
ออ !
=
ออ" #
$str
ออ$ P
;
ออP Q
private
ำำ 
string
ำำ 
currentTrack
ำำ #
=
ำำ$ %
$str
ำำ& (
;
ำำ( )
private
ูู 
bool
ูู "
isMp3MetadataVisible
ูู )
=
ูู* +
true
ูู, 0
;
ูู0 1
private
฿฿ 
bool
฿฿ &
isDiscogsMetadataVisible
฿฿ -
=
฿฿. /
true
฿฿0 4
;
฿฿4 5
private
๊๊ 
BitmapImage
๊๊ 

trackCover
๊๊ &
;
๊๊& '
private
ํํ 
string
ํํ 

trackTitle
ํํ !
;
ํํ! "
private
๐๐ 
string
๐๐ 
trackArtist
๐๐ "
;
๐๐" #
private
๓๓ 
string
๓๓ 

trackAlbum
๓๓ !
;
๓๓! "
private
๖๖ 
string
๖๖ 
	trackYear
๖๖  
;
๖๖  !
private
๙๙ 
string
๙๙ 

trackGenre
๙๙ !
;
๙๙! "
private
 
string
 
trackComment
 #
;
# $
private
 
string
 
trackDuration
 $
;
$ %
private
 
uint
 
trackNumber
  
;
  !
private
 
uint
 
totalTracks
  
;
  !
private
 "
DiscogsMetadataModel
 $
discogsMetadata
% 4
;
4 5
private
 "
DiscogsMetadataModel
 $!
gameDiscogsMetadata
% 8
;
8 9
private
 
Game
 %
preselectGameForLoading
 ,
;
, -
public
ชช '
OstPlayerSidebarViewModel
ชช (
(
ชช( )
	OstPlayer
ชช) 2
plugin
ชช3 9
,
ชช9 :
Game
ชช; ?
preselectGame
ชช@ M
=
ชชN O
null
ชชP T
)
ชชT U
{
ชชV W
this
ฌฌ 
.
ฌฌ 
plugin
ฌฌ 
=
ฌฌ 
plugin
ฌฌ  
??
ฌฌ! #
throw
ฌฌ$ )
new
ฌฌ* -#
ArgumentNullException
ฌฌ. C
(
ฌฌC D
nameof
ฌฌD J
(
ฌฌJ K
plugin
ฌฌK Q
)
ฌฌQ R
)
ฌฌR S
;
ฌฌS T'
InitializePlaybackService
ฏฏ %
(
ฏฏ% &
)
ฏฏ& '
;
ฏฏ' (
InitializeTimer
ฐฐ 
(
ฐฐ 
)
ฐฐ 
;
ฐฐ  
InitializeCommands
ฑฑ 
(
ฑฑ 
)
ฑฑ  
;
ฑฑ  !
Games
ดด 
=
ดด 
new
ดด "
ObservableCollection
ดด ,
<
ดด, -
Game
ดด- 1
>
ดด1 2
(
ดด2 3
)
ดด3 4
;
ดด4 5

MusicFiles
ตต 
=
ตต 
new
ตต "
ObservableCollection
ตต 1
<
ตต1 2
TrackListItem
ตต2 ?
>
ตต? @
(
ตต@ A
)
ตตA B
;
ตตB C
allGamesWithMusic
ถถ 
=
ถถ 
new
ถถ  #
List
ถถ$ (
<
ถถ( )
Game
ถถ) -
>
ถถ- .
(
ถถ. /
)
ถถ/ 0
;
ถถ0 1

StatusText
นน 
=
นน 
$str
นน 1
;
นน1 2
SettingsViewModel
ผผ 
=
ผผ "
GetSettingsViewModel
ผผ  4
(
ผผ4 5
)
ผผ5 6
;
ผผ6 7%
preselectGameForLoading
ฟฟ #
=
ฟฟ$ %
preselectGame
ฟฟ& 3
;
ฟฟ3 4
}
รร 	
public
ออ "
ObservableCollection
ออ #
<
ออ# $
Game
ออ$ (
>
ออ( )
Games
ออ* /
{
ออ0 1
get
ฮฮ 
=>
ฮฮ 
games
ฮฮ 
;
ฮฮ 
set
ฯฯ 
{
ฯฯ 
games
ฯฯ 
=
ฯฯ 
value
ฯฯ 
;
ฯฯ  
OnPropertyChanged
ฯฯ! 2
(
ฯฯ2 3
)
ฯฯ3 4
;
ฯฯ4 5
}
ฯฯ6 7
}
ะะ 	
public
ึึ "
ObservableCollection
ึึ #
<
ึึ# $
TrackListItem
ึึ$ 1
>
ึึ1 2

MusicFiles
ึึ3 =
{
ึึ> ?
get
ืื 
=>
ืื 

musicFiles
ืื 
;
ืื 
set
ุุ 
{
ุุ 

musicFiles
ุุ 
=
ุุ 
value
ุุ $
;
ุุ$ %
OnPropertyChanged
ุุ& 7
(
ุุ7 8
)
ุุ8 9
;
ุุ9 :
}
ุุ; <
}
ูู 	
public
฿฿ 
Game
฿฿ 
SelectedGame
฿฿  
{
฿฿! "
get
เเ 
=>
เเ 
selectedGame
เเ 
;
เเ  
set
แแ 
{
แแ 
selectedGame
โโ 
=
โโ 
value
โโ $
;
โโ$ %
OnPropertyChanged
ใใ !
(
ใใ! "
)
ใใ" #
;
ใใ# $$
OnGameSelectionChanged
ไไ &
(
ไไ& '
)
ไไ' (
;
ไไ( )
}
ๅๅ 
}
ๆๆ 	
public
์์ 
string
์์ 
SelectedMusicFile
์์ '
{
์์( )
get
ํํ 
=>
ํํ 
selectedMusicFile
ํํ $
;
ํํ$ %
set
๎๎ 
{
๎๎ 
selectedMusicFile
๏๏ !
=
๏๏" #
value
๏๏$ )
;
๏๏) *
OnPropertyChanged
๐๐ !
(
๐๐! "
)
๐๐" #
;
๐๐# $
OnPropertyChanged
๑๑ !
(
๑๑! "
nameof
๑๑" (
(
๑๑( )
CanPlayPause
๑๑) 5
)
๑๑5 6
)
๑๑6 7
;
๑๑7 8)
OnMusicFileSelectionChanged
๒๒ +
(
๒๒+ ,
)
๒๒, -
;
๒๒- .
}
๓๓ 
}
๔๔ 	
public
๚๚ 
bool
๚๚ 
	IsPlaying
๚๚ 
{
๚๚ 
get
๛๛ 
=>
๛๛ 
	isPlaying
๛๛ 
;
๛๛ 
set
 
{
 
	isPlaying
 
=
 
value
 !
;
! "
OnPropertyChanged
 !
(
! "
)
" #
;
# $
OnPropertyChanged
 !
(
! "
nameof
" (
(
( )
CanStop
) 0
)
0 1
)
1 2
;
2 3
OnPropertyChanged
 !
(
! "
nameof
" (
(
( )$
PlayPauseButtonContent
) ?
)
? @
)
@ A
;
A B
OnPropertyChanged
 !
(
! "
nameof
" (
(
( )$
PlayPauseButtonToolTip
) ?
)
? @
)
@ A
;
A B
}
 
}
 	
public
 
bool
 
IsPaused
 
{
 
get
 
=>
 
isPaused
 
;
 
set
 
{
 
isPaused
 
=
 
value
  
;
  !
OnPropertyChanged
 !
(
! "
)
" #
;
# $
OnPropertyChanged
 !
(
! "
nameof
" (
(
( )$
PlayPauseButtonContent
) ?
)
? @
)
@ A
;
A B
OnPropertyChanged
 !
(
! "
nameof
" (
(
( )$
PlayPauseButtonToolTip
) ?
)
? @
)
@ A
;
A B
}
 
}
 	
public
 
double
 
Position
 
{
  
get
 
=>
 
position
 
;
 
set
 
{
 
position
 
=
 
value
  
;
  !
OnPropertyChanged
 !
(
! "
)
" #
;
# $
OnPropertyChanged
 !
(
! "
nameof
" (
(
( )
CurrentTime
) 4
)
4 5
)
5 6
;
6 7
}
 
}
กก 	
public
จจ 
double
จจ 
Duration
จจ 
{
จจ  
get
ฉฉ 
=>
ฉฉ 
duration
ฉฉ 
;
ฉฉ 
set
ชช 
{
ชช 
duration
ซซ 
=
ซซ 
value
ซซ  
;
ซซ  !
OnPropertyChanged
ฌฌ !
(
ฌฌ! "
)
ฌฌ" #
;
ฌฌ# $
OnPropertyChanged
ญญ !
(
ญญ! "
nameof
ญญ" (
(
ญญ( )
DurationTime
ญญ) 5
)
ญญ5 6
)
ญญ6 7
;
ญญ7 8
}
ฎฎ 
}
ฏฏ 	
public
ถถ 
double
ถถ 
Volume
ถถ 
{
ถถ 
get
ทท 
=>
ทท 
volume
ทท 
;
ทท 
set
ธธ 
{
ธธ 
volume
นน 
=
นน 
value
นน 
;
นน 
OnPropertyChanged
บบ !
(
บบ! "
)
บบ" #
;
บบ# $
OnPropertyChanged
ปป !
(
ปป! "
nameof
ปป" (
(
ปป( )
VolumeDisplay
ปป) 6
)
ปป6 7
)
ปป7 8
;
ปป8 9
playbackService
ผผ 
?
ผผ  
.
ผผ  !
	SetVolume
ผผ! *
(
ผผ* +
value
ผผ+ 0
/
ผผ1 2
$num
ผผ3 8
)
ผผ8 9
;
ผผ9 :"
SaveVolumeToSettings
ฟฟ $
(
ฟฟ$ %
value
ฟฟ% *
)
ฟฟ* +
;
ฟฟ+ ,
}
ภภ 
}
มม 	
public
วว 
string
วว 

StatusText
วว  
{
วว! "
get
ศศ 
=>
ศศ 

statusText
ศศ 
;
ศศ 
set
ษษ 
{
ษษ 

statusText
ษษ 
=
ษษ 
value
ษษ $
;
ษษ$ %
OnPropertyChanged
ษษ& 7
(
ษษ7 8
)
ษษ8 9
;
ษษ9 :
}
ษษ; <
}
สส 	
public
ะะ 
string
ะะ 
CurrentTrack
ะะ "
{
ะะ# $
get
ัั 
=>
ัั 
currentTrack
ัั 
;
ัั  
set
าา 
{
าา 
currentTrack
าา 
=
าา  
value
าา! &
;
าา& '
OnPropertyChanged
าา( 9
(
าา9 :
)
าา: ;
;
าา; <
}
าา= >
}
ำำ 	
public
ูู 
bool
ูู "
IsMp3MetadataVisible
ูู (
{
ูู) *
get
ฺฺ 
=>
ฺฺ "
isMp3MetadataVisible
ฺฺ '
;
ฺฺ' (
set
 
{
 "
isMp3MetadataVisible
 $
=
% &
value
' ,
;
, -
OnPropertyChanged
 !
(
! "
)
" #
;
# $
OnPropertyChanged
 !
(
! "
nameof
" (
(
( )#
Mp3MetadataToggleText
) >
)
> ?
)
? @
;
@ A
}
฿฿ 
}
เเ 	
public
ๆๆ 
bool
ๆๆ &
IsDiscogsMetadataVisible
ๆๆ ,
{
ๆๆ- .
get
็็ 
=>
็็ &
isDiscogsMetadataVisible
็็ +
;
็็+ ,
set
่่ 
{
่่ &
isDiscogsMetadataVisible
้้ (
=
้้) *
value
้้+ 0
;
้้0 1
OnPropertyChanged
๊๊ !
(
๊๊! "
)
๊๊" #
;
๊๊# $
OnPropertyChanged
๋๋ !
(
๋๋! "
nameof
๋๋" (
(
๋๋( )'
DiscogsMetadataToggleText
๋๋) B
)
๋๋B C
)
๋๋C D
;
๋๋D E
}
์์ 
}
ํํ 	
public
๐๐ 
BitmapImage
๐๐ 

TrackCover
๐๐ %
{
๐๐& '
get
๐๐( +
=>
๐๐, .

trackCover
๐๐/ 9
;
๐๐9 :
set
๐๐; >
{
๐๐? @

trackCover
๐๐A K
=
๐๐L M
value
๐๐N S
;
๐๐S T
OnPropertyChanged
๐๐U f
(
๐๐f g
)
๐๐g h
;
๐๐h i
}
๐๐j k
}
๐๐l m
public
๑๑ 
string
๑๑ 

TrackTitle
๑๑  
{
๑๑! "
get
๑๑# &
=>
๑๑' )

trackTitle
๑๑* 4
;
๑๑4 5
set
๑๑6 9
{
๑๑: ;

trackTitle
๑๑< F
=
๑๑G H
value
๑๑I N
;
๑๑N O
OnPropertyChanged
๑๑P a
(
๑๑a b
)
๑๑b c
;
๑๑c d
}
๑๑e f
}
๑๑g h
public
๒๒ 
string
๒๒ 
TrackArtist
๒๒ !
{
๒๒" #
get
๒๒$ '
=>
๒๒( *
trackArtist
๒๒+ 6
;
๒๒6 7
set
๒๒8 ;
{
๒๒< =
trackArtist
๒๒> I
=
๒๒J K
value
๒๒L Q
;
๒๒Q R
OnPropertyChanged
๒๒S d
(
๒๒d e
)
๒๒e f
;
๒๒f g
}
๒๒h i
}
๒๒j k
public
๓๓ 
string
๓๓ 

TrackAlbum
๓๓  
{
๓๓! "
get
๓๓# &
=>
๓๓' )

trackAlbum
๓๓* 4
;
๓๓4 5
set
๓๓6 9
{
๓๓: ;

trackAlbum
๓๓< F
=
๓๓G H
value
๓๓I N
;
๓๓N O
OnPropertyChanged
๓๓P a
(
๓๓a b
)
๓๓b c
;
๓๓c d
}
๓๓e f
}
๓๓g h
public
๔๔ 
string
๔๔ 
	TrackYear
๔๔ 
{
๔๔  !
get
๔๔" %
=>
๔๔& (
	trackYear
๔๔) 2
;
๔๔2 3
set
๔๔4 7
{
๔๔8 9
	trackYear
๔๔: C
=
๔๔D E
value
๔๔F K
;
๔๔K L
OnPropertyChanged
๔๔M ^
(
๔๔^ _
)
๔๔_ `
;
๔๔` a
}
๔๔b c
}
๔๔d e
public
๕๕ 
string
๕๕ 

TrackGenre
๕๕  
{
๕๕! "
get
๕๕# &
=>
๕๕' )

trackGenre
๕๕* 4
;
๕๕4 5
set
๕๕6 9
{
๕๕: ;

trackGenre
๕๕< F
=
๕๕G H
value
๕๕I N
;
๕๕N O
OnPropertyChanged
๕๕P a
(
๕๕a b
)
๕๕b c
;
๕๕c d
}
๕๕e f
}
๕๕g h
public
๖๖ 
string
๖๖ 
TrackComment
๖๖ "
{
๖๖# $
get
๖๖% (
=>
๖๖) +
trackComment
๖๖, 8
;
๖๖8 9
set
๖๖: =
{
๖๖> ?
trackComment
๖๖@ L
=
๖๖M N
value
๖๖O T
;
๖๖T U
OnPropertyChanged
๖๖V g
(
๖๖g h
)
๖๖h i
;
๖๖i j
}
๖๖k l
}
๖๖m n
public
๗๗ 
string
๗๗ 
TrackDuration
๗๗ #
{
๗๗$ %
get
๗๗& )
=>
๗๗* ,
trackDuration
๗๗- :
;
๗๗: ;
set
๗๗< ?
{
๗๗@ A
trackDuration
๗๗B O
=
๗๗P Q
value
๗๗R W
;
๗๗W X
OnPropertyChanged
๗๗Y j
(
๗๗j k
)
๗๗k l
;
๗๗l m
}
๗๗n o
}
๗๗p q
public
๘๘ 
uint
๘๘ 
TrackNumber
๘๘ 
{
๘๘  !
get
๘๘" %
=>
๘๘& (
trackNumber
๘๘) 4
;
๘๘4 5
set
๘๘6 9
{
๘๘: ;
trackNumber
๘๘< G
=
๘๘H I
value
๘๘J O
;
๘๘O P
OnPropertyChanged
๘๘Q b
(
๘๘b c
)
๘๘c d
;
๘๘d e
}
๘๘f g
}
๘๘h i
public
๙๙ 
uint
๙๙ 
TotalTracks
๙๙ 
{
๙๙  !
get
๙๙" %
=>
๙๙& (
totalTracks
๙๙) 4
;
๙๙4 5
set
๙๙6 9
{
๙๙: ;
totalTracks
๙๙< G
=
๙๙H I
value
๙๙J O
;
๙๙O P
OnPropertyChanged
๙๙Q b
(
๙๙b c
)
๙๙c d
;
๙๙d e
}
๙๙f g
}
๙๙h i
public
๚๚ "
DiscogsMetadataModel
๚๚ #
DiscogsMetadata
๚๚$ 3
{
๚๚4 5
get
๚๚6 9
=>
๚๚: <
discogsMetadata
๚๚= L
;
๚๚L M
set
๚๚N Q
{
๚๚R S
discogsMetadata
๚๚T c
=
๚๚d e
value
๚๚f k
;
๚๚k l
OnPropertyChanged
๚๚m ~
(
๚๚~ 
)๚๚ 
;๚๚ 
}๚๚ 
}๚๚ 
public
 
string
 
VolumeDisplay
 #
=>
$ &
VolumeHelper
' 3
.
3 4
FormatPercentage
4 D
(
D E
Volume
E K
)
K L
;
L M
public
 
string
 
CurrentTime
 !
=>
" $

TimeHelper
% /
.
/ 0

FormatTime
0 :
(
: ;
Position
; C
)
C D
;
D E
public
 
string
 
DurationTime
 "
=>
# %

TimeHelper
& 0
.
0 1$
FormatTimeWithFallback
1 G
(
G H
Duration
H P
,
P Q
false
R W
)
W X
;
X Y
public
 
bool
 
CanPlayPause
  
=>
! #
!
$ %
string
% +
.
+ ,
IsNullOrEmpty
, 9
(
9 :
SelectedMusicFile
: K
)
K L
;
L M
public
 
bool
 
CanStop
 
=>
 
	IsPlaying
 (
;
( )
public
 
string
 $
PlayPauseButtonContent
 ,
=>
- /
(
0 1
	IsPlaying
1 :
&&
; =
!
> ?
IsPaused
? G
)
G H
?
I J
$str
K S
:
T U
$str
V ^
;
^ _
public
 
string
 $
PlayPauseButtonToolTip
 ,
=>
- /
(
0 1
	IsPlaying
1 :
&&
; =
!
> ?
IsPaused
? G
)
G H
?
I J
$str
K [
:
\ ]
$str
^ s
;
s t
public
 
string
 #
Mp3MetadataToggleText
 +
=>
, ."
IsMp3MetadataVisible
/ C
?
D E
$str
F Y
:
Z [
$str
\ o
;
o p
public
 
string
 '
DiscogsMetadataToggleText
 /
=>
0 2&
IsDiscogsMetadataVisible
3 K
?
L M
$str
N e
:
f g
$str
h 
; 
public
 (
OstPlayerSettingsViewModel
 )
SettingsViewModel
* ;
{
< =
get
> A
;
A B
private
C J
set
K N
;
N O
}
P Q
public
ฅฅ 
ICommand
ฅฅ 
PlayPauseCommand
ฅฅ (
{
ฅฅ) *
get
ฅฅ+ .
;
ฅฅ. /
private
ฅฅ0 7
set
ฅฅ8 ;
;
ฅฅ; <
}
ฅฅ= >
public
ชช 
ICommand
ชช 
StopCommand
ชช #
{
ชช$ %
get
ชช& )
;
ชช) *
private
ชช+ 2
set
ชช3 6
;
ชช6 7
}
ชช8 9
public
ฏฏ 
ICommand
ฏฏ &
Mp3MetadataToggleCommand
ฏฏ 0
{
ฏฏ1 2
get
ฏฏ3 6
;
ฏฏ6 7
private
ฏฏ8 ?
set
ฏฏ@ C
;
ฏฏC D
}
ฏฏE F
public
ดด 
ICommand
ดด *
DiscogsMetadataToggleCommand
ดด 4
{
ดด5 6
get
ดด7 :
;
ดด: ;
private
ดด< C
set
ดดD G
;
ดดG H
}
ดดI J
public
นน 
ICommand
นน (
HideMetadataSectionCommand
นน 2
{
นน3 4
get
นน5 8
;
นน8 9
private
นน: A
set
นนB E
;
นนE F
}
นนG H
public
พพ 
ICommand
พพ (
LoadDiscogsMetadataCommand
พพ 2
{
พพ3 4
get
พพ5 8
;
พพ8 9
private
พพ: A
set
พพB E
;
พพE F
}
พพG H
public
รร 
ICommand
รร #
ShowTrackCoverCommand
รร -
{
รร. /
get
รร0 3
;
รร3 4
private
รร5 <
set
รร= @
;
รร@ A
}
รรB C
public
ศศ 
ICommand
ศศ %
ShowDiscogsCoverCommand
ศศ /
{
ศศ0 1
get
ศศ2 5
;
ศศ5 6
private
ศศ7 >
set
ศศ? B
;
ศศB C
}
ศศD E
public
ออ 
ICommand
ออ +
RefreshDiscogsMetadataCommand
ออ 5
{
ออ6 7
get
ออ8 ;
;
ออ; <
private
ออ= D
set
ออE H
;
ออH I
}
ออJ K
public
าา 
ICommand
าา &
PlaySelectedTrackCommand
าา 0
{
าา1 2
get
าา3 6
;
าา6 7
private
าา8 ?
set
าา@ C
;
าาC D
}
าาE F
private
 
void
 '
InitializePlaybackService
 .
(
. /
)
/ 0
{
1 2
playbackService
 
=
 
new
 !"
MusicPlaybackService
" 6
(
6 7
)
7 8
;
8 9$
LoadVolumeFromSettings
แแ "
(
แแ" #
)
แแ# $
;
แแ$ %
playbackService
ไไ 
.
ไไ 
PlaybackStarted
ไไ +
+=
ไไ, .
(
ไไ/ 0
s
ไไ0 1
,
ไไ1 2
e
ไไ3 4
)
ไไ4 5
=>
ไไ6 8
{
ไไ9 :
	IsPlaying
ไไ; D
=
ไไE F
true
ไไG K
;
ไไK L
IsPaused
ไไM U
=
ไไV W
false
ไไX ]
;
ไไ] ^
}
ไไ_ `
;
ไไ` a
playbackService
ๅๅ 
.
ๅๅ 
PlaybackPaused
ๅๅ *
+=
ๅๅ+ -
(
ๅๅ. /
s
ๅๅ/ 0
,
ๅๅ0 1
e
ๅๅ2 3
)
ๅๅ3 4
=>
ๅๅ5 7
{
ๅๅ8 9
IsPaused
ๅๅ: B
=
ๅๅC D
true
ๅๅE I
;
ๅๅI J
}
ๅๅK L
;
ๅๅL M
playbackService
ๆๆ 
.
ๆๆ 
PlaybackStopped
ๆๆ +
+=
ๆๆ, .
(
ๆๆ/ 0
s
ๆๆ0 1
,
ๆๆ1 2
e
ๆๆ3 4
)
ๆๆ4 5
=>
ๆๆ6 8
{
ๆๆ9 :
	IsPlaying
ๆๆ; D
=
ๆๆE F
false
ๆๆG L
;
ๆๆL M
IsPaused
ๆๆN V
=
ๆๆW X
false
ๆๆY ^
;
ๆๆ^ _
}
ๆๆ` a
;
ๆๆa b
playbackService
็็ 
.
็็ 
PositionChanged
็็ +
+=
็็, .
(
็็/ 0
s
็็0 1
,
็็1 2
pos
็็3 6
)
็็6 7
=>
็็8 :
{
็็; <
Position
็็= E
=
็็F G
pos
็็H K
;
็็K L
}
็็M N
;
็็N O
playbackService
่่ 
.
่่ 
DurationChanged
่่ +
+=
่่, .
(
่่/ 0
s
่่0 1
,
่่1 2
dur
่่3 6
)
่่6 7
=>
่่8 :
{
่่; <
Duration
่่= E
=
่่F G
dur
่่H K
;
่่K L
}
่่M N
;
่่N O
playbackService
้้ 
.
้้ 
PlaybackEnded
้้ )
+=
้้* ,
(
้้- .
s
้้. /
,
้้/ 0
e
้้1 2
)
้้2 3
=>
้้4 6
OnPlaybackEnded
้้7 F
(
้้F G
)
้้G H
;
้้H I
}
๊๊ 	
private
๑๑ 
void
๑๑ 
InitializeTimer
๑๑ $
(
๑๑$ %
)
๑๑% &
{
๑๑' (
progressTimer
๒๒ 
=
๒๒ 
new
๒๒ 
DispatcherTimer
๒๒  /
(
๒๒/ 0
)
๒๒0 1
;
๒๒1 2
progressTimer
๓๓ 
.
๓๓ 
Interval
๓๓ "
=
๓๓# $
TimeSpan
๓๓% -
.
๓๓- .
FromMilliseconds
๓๓. >
(
๓๓> ?
$num
๓๓? B
)
๓๓B C
;
๓๓C D
progressTimer
๔๔ 
.
๔๔ 
Tick
๔๔ 
+=
๔๔ !
(
๔๔" #
s
๔๔# $
,
๔๔$ %
e
๔๔& '
)
๔๔' (
=>
๔๔) +
UpdatePosition
๔๔, :
(
๔๔: ;
)
๔๔; <
;
๔๔< =
}
๕๕ 	
private
 
void
  
InitializeCommands
 '
(
' (
)
( )
{
* +
PlayPauseCommand
 
=
 
new
 "
Utils
# (
.
( )
RelayCommand
) 5
(
5 6
async
6 ;
_
< =
=>
> @
await
A F
PlayPauseAsync
G U
(
U V
)
V W
)
W X
;
X Y
StopCommand
 
=
 
new
 
Utils
 #
.
# $
RelayCommand
$ 0
(
0 1
_
1 2
=>
3 5
Stop
6 :
(
: ;
)
; <
)
< =
;
= >&
Mp3MetadataToggleCommand
 $
=
% &
new
' *
Utils
+ 0
.
0 1
RelayCommand
1 =
(
= >
_
> ?
=>
@ B"
IsMp3MetadataVisible
C W
=
X Y
!
Z ["
IsMp3MetadataVisible
[ o
)
o p
;
p q*
DiscogsMetadataToggleCommand
 (
=
) *
new
+ .
Utils
/ 4
.
4 5
RelayCommand
5 A
(
A B
_
B C
=>
D F&
IsDiscogsMetadataVisible
G _
=
` a
!
b c&
IsDiscogsMetadataVisible
c {
)
{ |
;
| }(
HideMetadataSectionCommand
 &
=
' (
new
) ,
Utils
- 2
.
2 3
RelayCommand
3 ?
(
? @!
HideMetadataSection
@ S
)
S T
;
T U(
LoadDiscogsMetadataCommand
 &
=
' (
new
) ,
Utils
- 2
.
2 3
RelayCommand
3 ?
(
? @
async
@ E
_
F G
=>
H J
await
K P&
LoadDiscogsMetadataAsync
Q i
(
i j
)
j k
)
k l
;
l m#
ShowTrackCoverCommand
 !
=
" #
new
$ '
Utils
( -
.
- .
RelayCommand
. :
(
: ;
_
; <
=>
= ?
ShowTrackCover
@ N
(
N O
)
O P
)
P Q
;
Q R%
ShowDiscogsCoverCommand
 #
=
$ %
new
& )
Utils
* /
.
/ 0
RelayCommand
0 <
(
< =
_
= >
=>
? A
ShowDiscogsCover
B R
(
R S
)
S T
)
T U
;
U V+
RefreshDiscogsMetadataCommand
 )
=
* +
new
, /
Utils
0 5
.
5 6
RelayCommand
6 B
(
B C
async
C H
_
I J
=>
K M
{
N O
if
 
(
 
SelectedGame
  
==
! #
null
$ (
)
( )
{
* +
	ShowError
 
(
 
$str
 ;
)
; <
;
< =
return
 
;
 
}
 
DiscogsMetadata
 
=
  !
null
" &
;
& '
await
 &
LoadDiscogsMetadataAsync
 .
(
. /
)
/ 0
;
0 1
}
 
)
 
;
 &
PlaySelectedTrackCommand
 $
=
% &
new
' *
Utils
+ 0
.
0 1
RelayCommand
1 =
(
= >
async
> C
	parameter
D M
=>
N P
{
Q R
if
 
(
 
	parameter
 
is
  
TrackListItem
! .
selectedItem
/ ;
)
; <
{
= >
await
 /
!PlaySelectedMusicFromListBoxAsync
 ;
(
; <
selectedItem
< H
)
H I
;
I J
}
 
}
 
)
 
;
 
}
 	
public
คค 
void
คค *
PlaySelectedMusicFromListBox
คค 0
(
คค0 1
TrackListItem
คค1 >
selectedItem
คค? K
)
คคK L
{
คคM N
_
ฆฆ 
=
ฆฆ /
!PlaySelectedMusicFromListBoxAsync
ฆฆ 1
(
ฆฆ1 2
selectedItem
ฆฆ2 >
)
ฆฆ> ?
;
ฆฆ? @
}
งง 	
public
ฐฐ 
async
ฐฐ 
Task
ฐฐ /
!PlaySelectedMusicFromListBoxAsync
ฐฐ ;
(
ฐฐ; <
TrackListItem
ฐฐ< I
selectedItem
ฐฐJ V
)
ฐฐV W
{
ฐฐX Y
if
ฑฑ 
(
ฑฑ 
selectedItem
ฑฑ 
!=
ฑฑ 
null
ฑฑ  $
)
ฑฑ$ %
{
ฑฑ& '
Stop
ฒฒ 
(
ฒฒ 
)
ฒฒ 
;
ฒฒ 
SelectedMusicFile
ณณ !
=
ณณ" #
selectedItem
ณณ$ 0
.
ณณ0 1
FilePath
ณณ1 9
;
ณณ9 :
try
ดด 
{
ดด 
await
ตต 
playbackService
ตต )
.
ตต) *
	PlayAsync
ตต* 3
(
ตต3 4
selectedItem
ตต4 @
.
ตต@ A
FilePath
ตตA I
,
ตตI J
$num
ตตK L
)
ตตL M
;
ตตM N
CurrentTrack
ถถ  
=
ถถ! "
$"
ถถ# %
$str
ถถ% .
{
ถถ. /
Path
ถถ/ 3
.
ถถ3 4)
GetFileNameWithoutExtension
ถถ4 O
(
ถถO P
selectedItem
ถถP \
.
ถถ\ ]
FilePath
ถถ] e
)
ถถe f
}
ถถf g
"
ถถg h
;
ถถh i
}
ทท 
catch
ธธ 
(
ธธ 
	Exception
ธธ  
ex
ธธ! #
)
ธธ# $
{
ธธ% &

StatusText
นน 
=
นน  
$"
นน! #
$str
นน# 8
{
นน8 9
ex
นน9 ;
.
นน; <
Message
นน< C
}
นนC D
"
นนD E
;
นนE F
}
บบ 
}
ปป 
}
ผผ 	
public
ฤฤ 
void
ฤฤ 
SetUserDragging
ฤฤ #
(
ฤฤ# $
bool
ฤฤ$ (
dragging
ฤฤ) 1
)
ฤฤ1 2
{
ฤฤ3 4
isUserDragging
ลล 
=
ลล 
dragging
ลล %
;
ลล% &
playbackService
ฦฦ 
?
ฦฦ 
.
ฦฦ 
SetUserDragging
ฦฦ ,
(
ฦฦ, -
dragging
ฦฦ- 5
)
ฦฦ5 6
;
ฦฦ6 7
if
วว 
(
วว 
!
วว 
dragging
วว 
)
วว 
{
วว 
playbackService
ศศ 
?
ศศ  
.
ศศ  !
SetPosition
ศศ! ,
(
ศศ, -
Position
ศศ- 5
)
ศศ5 6
;
ศศ6 7
}
ษษ 
}
สส 	
public
าา 
void
าา 
FilterGames
าา 
(
าา  
string
าา  &

searchText
าา' 1
)
าา1 2
{
าา3 4
if
ำำ 
(
ำำ 
allGamesWithMusic
ำำ !
==
ำำ" $
null
ำำ% )
)
ำำ) *
return
ิิ 
;
ิิ 
if
ึึ 
(
ึึ 
string
ึึ 
.
ึึ  
IsNullOrWhiteSpace
ึึ )
(
ึึ) *

searchText
ึึ* 4
)
ึึ4 5
)
ึึ5 6
{
ึึ7 8
Games
ุุ 
=
ุุ 
new
ุุ "
ObservableCollection
ุุ 0
<
ุุ0 1
Game
ุุ1 5
>
ุุ5 6
(
ุุ6 7
allGamesWithMusic
ุุ7 H
)
ุุH I
;
ุุI J
}
ูู 
else
ฺฺ 
{
ฺฺ 
var
 
filteredGames
 !
=
" #
allGamesWithMusic
$ 5
.
 
Where
 
(
 
g
 
=>
 
g
  !
.
! "
Name
" &
.
& '
ToLower
' .
(
. /
)
/ 0
.
0 1
Contains
1 9
(
9 :

searchText
: D
.
D E
ToLower
E L
(
L M
)
M N
)
N O
)
O P
.
 
ToList
 
(
 
)
 
;
 
Games
฿฿ 
=
฿฿ 
new
฿฿ "
ObservableCollection
฿฿ 0
<
฿฿0 1
Game
฿฿1 5
>
฿฿5 6
(
฿฿6 7
filteredGames
฿฿7 D
)
฿฿D E
;
฿฿E F
}
เเ 
}
แแ 	
public
้้ 
Game
้้ 
FindGameByName
้้ "
(
้้" #
string
้้# )
gameName
้้* 2
)
้้2 3
{
้้4 5
return
๊๊ 
allGamesWithMusic
๊๊ $
?
๊๊$ %
.
๊๊% &
FirstOrDefault
๊๊& 4
(
๊๊4 5
g
๊๊5 6
=>
๊๊7 9
string
๋๋ 
.
๋๋ 
Equals
๋๋ 
(
๋๋ 
g
๋๋ 
.
๋๋  
Name
๋๋  $
,
๋๋$ %
gameName
๋๋& .
,
๋๋. /
StringComparison
๋๋0 @
.
๋๋@ A
OrdinalIgnoreCase
๋๋A R
)
๋๋R S
)
๋๋S T
;
๋๋T U
}
์์ 	
public
๒๒ 
async
๒๒ 
Task
๒๒ 
InitializeAsync
๒๒ )
(
๒๒) *
)
๒๒* +
{
๒๒, -
await
๓๓ 
LoadGamesAsync
๓๓  
(
๓๓  !%
preselectGameForLoading
๓๓! 8
)
๓๓8 9
;
๓๓9 :
}
๔๔ 	
private
 
void
 $
OnGameSelectionChanged
 +
(
+ ,
)
, -
{
. /
SelectedMusicFile
 
=
 
null
  $
;
$ %
ResetMetadata
 
(
 
)
 
;
 
Position
 
=
 
$num
 
;
 
Duration
 
=
 
$num
 
;
 '
LoadCachedDiscogsMetadata
 %
(
% &
)
& '
;
' (
LoadMusicFiles
 
(
 
)
 
;
 
}
 	
private
 
void
 )
OnMusicFileSelectionChanged
 0
(
0 1
)
1 2
{
3 4
if
 
(
 
!
 
string
 
.
 
IsNullOrEmpty
 %
(
% &
SelectedMusicFile
& 7
)
7 8
&&
9 ;
!
< =
isAutoPlayingNext
= N
)
N O
{
P Q
Position
 
=
 
$num
 
;
 '
LoadSelectedTrackMetadata
 )
(
) *
)
* +
;
+ ,
}
 
}
 	
private
 
void
 
ResetMetadata
 "
(
" #
)
# $
{
% &

TrackCover
กก 
=
กก 
null
กก 
;
กก 

TrackTitle
ขข 
=
ขข 
null
ขข 
;
ขข 
TrackArtist
ฃฃ 
=
ฃฃ 
null
ฃฃ 
;
ฃฃ 

TrackAlbum
คค 
=
คค 
null
คค 
;
คค 
	TrackYear
ฅฅ 
=
ฅฅ 
null
ฅฅ 
;
ฅฅ 

TrackGenre
ฆฆ 
=
ฆฆ 
null
ฆฆ 
;
ฆฆ 
TrackDuration
งง 
=
งง 
null
งง  
;
งง  !
TrackComment
จจ 
=
จจ 
null
จจ 
;
จจ  
DiscogsMetadata
ฉฉ 
=
ฉฉ 
null
ฉฉ "
;
ฉฉ" #
TrackNumber
ชช 
=
ชช 
$num
ชช 
;
ชช 
TotalTracks
ซซ 
=
ซซ 
$num
ซซ 
;
ซซ !
gameDiscogsMetadata
ฎฎ 
=
ฎฎ  !
null
ฎฎ" &
;
ฎฎ& '
}
ฏฏ 	
private
ถถ 
async
ถถ 
Task
ถถ 
LoadGamesAsync
ถถ )
(
ถถ) *
Game
ถถ* .
preselectGame
ถถ/ <
=
ถถ= >
null
ถถ? C
)
ถถC D
{
ถถE F
try
ทท 
{
ทท 
await
ธธ 
Task
ธธ 
.
ธธ 
Run
ธธ 
(
ธธ 
(
ธธ  
)
ธธ  !
=>
ธธ" $
{
ธธ% &
try
นน 
{
นน 
if
ปป 
(
ปป 
plugin
ปป "
?
ปป" #
.
ปป# $
PlayniteApi
ปป$ /
?
ปป/ 0
.
ปป0 1
Database
ปป1 9
?
ปป9 :
.
ปป: ;
Games
ปป; @
==
ปปA C
null
ปปD H
)
ปปH I
{
ปปJ K
System
ผผ "
.
ผผ" #
Windows
ผผ# *
.
ผผ* +
Application
ผผ+ 6
.
ผผ6 7
Current
ผผ7 >
.
ผผ> ?

Dispatcher
ผผ? I
.
ผผI J
Invoke
ผผJ P
(
ผผP Q
(
ผผQ R
)
ผผR S
=>
ผผT V
{
ผผW X

StatusText
ฝฝ  *
=
ฝฝ+ ,
$str
ฝฝ- U
;
ฝฝU V
}
พพ 
)
พพ 
;
พพ 
return
ฟฟ "
;
ฟฟ" #
}
ภภ 
var
รร 
gamesWithMusic
รร *
=
รร+ ,
plugin
รร- 3
.
รร3 4
PlayniteApi
รร4 ?
.
รร? @
Database
รร@ H
.
รรH I
Games
รรI N
.
รรN O
Where
รรO T
(
รรT U
g
รรU V
=>
รรW Y
{
รรZ [
try
ฤฤ 
{
ฤฤ  !
var
ลล  #
gameMusicFiles
ลล$ 2
=
ลล3 4
MusicFileHelper
ลล5 D
.
ลลD E
GetGameMusicFiles
ลลE V
(
ลลV W
plugin
ลลW ]
.
ลล] ^
PlayniteApi
ลล^ i
,
ลลi j
g
ลลk l
)
ลลl m
;
ลลm n
return
ฦฦ  &
gameMusicFiles
ฦฦ' 5
!=
ฦฦ6 8
null
ฦฦ9 =
&&
ฦฦ> @
gameMusicFiles
ฦฦA O
.
ฦฦO P
Count
ฦฦP U
>
ฦฦV W
$num
ฦฦX Y
;
ฦฦY Z
}
วว 
catch
ศศ !
{
ศศ" #
return
ษษ  &
false
ษษ' ,
;
ษษ, -
}
สส 
}
หห 
)
หห 
.
ฬฬ 
OrderBy
ฬฬ  
(
ฬฬ  !
g
ฬฬ! "
=>
ฬฬ# %
g
ฬฬ& '
.
ฬฬ' (
Name
ฬฬ( ,
)
ฬฬ, -
.
ออ 
ToList
ออ 
(
ออ  
)
ออ  !
;
ออ! "
System
ะะ 
.
ะะ 
Windows
ะะ &
.
ะะ& '
Application
ะะ' 2
.
ะะ2 3
Current
ะะ3 :
.
ะะ: ;

Dispatcher
ะะ; E
.
ะะE F
Invoke
ะะF L
(
ะะL M
(
ะะM N
)
ะะN O
=>
ะะP R
{
ะะS T
allGamesWithMusic
าา -
=
าา. /
gamesWithMusic
าา0 >
;
าา> ?
Games
ำำ !
=
ำำ" #
new
ำำ$ '"
ObservableCollection
ำำ( <
<
ำำ< =
Game
ำำ= A
>
ำำA B
(
ำำB C
gamesWithMusic
ำำC Q
)
ำำQ R
;
ำำR S
if
ึึ 
(
ึึ  
Games
ึึ  %
.
ึึ% &
Count
ึึ& +
==
ึึ, .
$num
ึึ/ 0
)
ึึ0 1
{
ึึ2 3

StatusText
ืื  *
=
ืื+ ,
$str
ืื- q
+
ืืr s
$str
ุุ+ ]
;
ุุ] ^
}
ูู 
else
ฺฺ  
{
ฺฺ! "

StatusText
  *
=
+ ,
$"
- /
$str
/ 5
{
5 6
Games
6 ;
.
; <
Count
< A
}
A B
$str
B ]
"
] ^
;
^ _
}
 
if
฿฿ 
(
฿฿  
preselectGame
฿฿  -
!=
฿฿. 0
null
฿฿1 5
)
฿฿5 6
{
฿฿7 8
SelectedGame
เเ  ,
=
เเ- .
Games
เเ/ 4
?
เเ4 5
.
เเ5 6
FirstOrDefault
เเ6 D
(
เเD E
g
เเE F
=>
เเG I
g
เเJ K
.
เเK L
Id
เเL N
==
เเO Q
preselectGame
เเR _
.
เเ_ `
Id
เเ` b
)
เเb c
;
เเc d
}
แแ 
}
โโ 
)
โโ 
;
โโ 
}
ใใ 
catch
ไไ 
(
ไไ 
	Exception
ไไ $
ex
ไไ% '
)
ไไ' (
{
ไไ) *
System
ๅๅ 
.
ๅๅ 
Windows
ๅๅ &
.
ๅๅ& '
Application
ๅๅ' 2
.
ๅๅ2 3
Current
ๅๅ3 :
.
ๅๅ: ;

Dispatcher
ๅๅ; E
.
ๅๅE F
Invoke
ๅๅF L
(
ๅๅL M
(
ๅๅM N
)
ๅๅN O
=>
ๅๅP R
{
ๅๅS T

StatusText
ๆๆ &
=
ๆๆ' (
$"
ๆๆ) +
$str
ๆๆ+ @
{
ๆๆ@ A
ex
ๆๆA C
.
ๆๆC D
Message
ๆๆD K
}
ๆๆK L
"
ๆๆL M
;
ๆๆM N
}
็็ 
)
็็ 
;
็็ 
}
่่ 
}
้้ 
)
้้ 
;
้้ 
}
๊๊ 
catch
๋๋ 
(
๋๋ 
	Exception
๋๋ 
ex
๋๋ 
)
๋๋  
{
๋๋! "

StatusText
์์ 
=
์์ 
$"
์์ 
$str
์์ C
{
์์C D
ex
์์D F
.
์์F G
Message
์์G N
}
์์N O
"
์์O P
;
์์P Q
}
ํํ 
}
๎๎ 	
private
๖๖ 
void
๖๖ 
	LoadGames
๖๖ 
(
๖๖ 
)
๖๖  
{
๖๖! "
_
๘๘ 
=
๘๘ 
LoadGamesAsync
๘๘ 
(
๘๘ 
)
๘๘  
;
๘๘  !
}
๙๙ 	
private
 
void
 
LoadMusicFiles
 #
(
# $
)
$ %
{
& '
if
 
(
 
SelectedGame
 
==
 
null
  $
)
$ %
{
& '

MusicFiles
 
=
 
new
  "
ObservableCollection
! 5
<
5 6
TrackListItem
6 C
>
C D
(
D E
)
E F
;
F G

StatusText
 
=
 
$str
 I
;
I J
return
 
;
 
}
 
try
 
{
 
var
 
files
 
=
 
MusicFileHelper
 +
.
+ ,
GetGameMusicFiles
, =
(
= >
plugin
> D
.
D E
PlayniteApi
E P
,
P Q
SelectedGame
R ^
)
^ _
;
_ `
var
 
items
 
=
 
new
 
List
  $
<
$ %
TrackListItem
% 2
>
2 3
(
3 4
)
4 5
;
5 6
foreach
 
(
 
var
 
file
 !
in
" $
files
% *
)
* +
{
, -
var
 
fileName
  
=
! "
Path
# '
.
' ()
GetFileNameWithoutExtension
( C
(
C D
file
D H
)
H I
;
I J
var
 
metadata
  
=
! "
Mp3MetadataReader
# 4
.
4 5
ReadMetadata
5 A
(
A B
file
B F
)
F G
;
G H
items
 
.
 
Add
 
(
 
new
 !
TrackListItem
" /
{
0 1

TrackTitle
 "
=
# $
metadata
% -
?
- .
.
. /
Title
/ 4
??
5 7
fileName
8 @
,
@ A
TrackDuration
 %
=
& '
metadata
( 0
?
0 1
.
1 2
Duration
2 :
,
: ;
FilePath
  
=
! "
file
# '
,
' (
TrackNumber
 #
=
$ %
metadata
& .
?
. /
.
/ 0
TrackNumber
0 ;
??
< >
$num
? @
,
@ A
TotalTracks
 #
=
$ %
metadata
& .
?
. /
.
/ 0
TotalTracks
0 ;
??
< >
$num
? @
,
@ A
}
 
)
 
;
 
}
 

MusicFiles
 
=
 
new
  "
ObservableCollection
! 5
<
5 6
TrackListItem
6 C
>
C D
(
D E
items
E J
)
J K
;
K L
if
 
(
 

MusicFiles
 
.
 
Count
 $
==
% '
$num
( )
)
) *
{
+ ,

StatusText
 
=
  
$"
! #
$str
# <
{
< =
SelectedGame
= I
.
I J
Name
J N
}
N O
"
O P
;
P Q
}
กก 
else
ขข 
{
ขข 

StatusText
ฃฃ 
=
ฃฃ  
$"
ฃฃ! #
$str
ฃฃ# )
{
ฃฃ) *

MusicFiles
ฃฃ* 4
.
ฃฃ4 5
Count
ฃฃ5 :
}
ฃฃ: ;
$str
ฃฃ; L
{
ฃฃL M
SelectedGame
ฃฃM Y
.
ฃฃY Z
Name
ฃฃZ ^
}
ฃฃ^ _
"
ฃฃ_ `
;
ฃฃ` a
}
คค 
}
ฅฅ 
catch
ฆฆ 
(
ฆฆ 
	Exception
ฆฆ 
ex
ฆฆ 
)
ฆฆ  
{
ฆฆ! "

StatusText
งง 
=
งง 
$"
งง 
$str
งง :
{
งง: ;
ex
งง; =
.
งง= >
Message
งง> E
}
งงE F
"
งงF G
;
งงG H

MusicFiles
จจ 
=
จจ 
new
จจ  "
ObservableCollection
จจ! 5
<
จจ5 6
TrackListItem
จจ6 C
>
จจC D
(
จจD E
)
จจE F
;
จจF G
}
ฉฉ 
}
ชช 	
private
ฑฑ 
void
ฑฑ '
LoadSelectedTrackMetadata
ฑฑ .
(
ฑฑ. /
)
ฑฑ/ 0
{
ฑฑ1 2 
ResetTrackMetadata
ฒฒ 
(
ฒฒ 
)
ฒฒ  
;
ฒฒ  !
if
ดด 
(
ดด 
SelectedGame
ดด 
==
ดด 
null
ดด  $
||
ดด% '
string
ดด( .
.
ดด. /
IsNullOrEmpty
ดด/ <
(
ดด< =
SelectedMusicFile
ดด= N
)
ดดN O
)
ดดO P
return
ตต 
;
ตต 
var
ธธ 
metadata
ธธ 
=
ธธ 
Mp3MetadataReader
ธธ ,
.
ธธ, -
ReadMetadata
ธธ- 9
(
ธธ9 :
SelectedMusicFile
ธธ: K
)
ธธK L
;
ธธL M
if
นน 
(
นน 
metadata
นน 
==
นน 
null
นน  
)
นน  !
return
บบ 
;
บบ 

TrackCover
ฝฝ 
=
ฝฝ 
metadata
ฝฝ !
.
ฝฝ! "
Cover
ฝฝ" '
;
ฝฝ' (

TrackTitle
พพ 
=
พพ 
metadata
พพ !
.
พพ! "
Title
พพ" '
;
พพ' (
TrackArtist
ฟฟ 
=
ฟฟ 
metadata
ฟฟ "
.
ฟฟ" #
Artist
ฟฟ# )
;
ฟฟ) *

TrackAlbum
ภภ 
=
ภภ 
metadata
ภภ !
.
ภภ! "
Album
ภภ" '
;
ภภ' (
	TrackYear
มม 
=
มม 
metadata
มม  
.
มม  !
Year
มม! %
;
มม% &

TrackGenre
ยย 
=
ยย 
metadata
ยย !
.
ยย! "
Genre
ยย" '
;
ยย' (
TrackComment
รร 
=
รร 
metadata
รร #
.
รร# $
Comment
รร$ +
;
รร+ ,
TrackDuration
ฤฤ 
=
ฤฤ 
metadata
ฤฤ $
.
ฤฤ$ %
Duration
ฤฤ% -
;
ฤฤ- .
TrackNumber
ลล 
=
ลล 
metadata
ลล "
.
ลล" #
TrackNumber
ลล# .
;
ลล. /
TotalTracks
ฦฦ 
=
ฦฦ 
metadata
ฦฦ "
.
ฦฦ" #
TotalTracks
ฦฦ# .
;
ฦฦ. /
if
สส 
(
สส !
gameDiscogsMetadata
สส #
!=
สส$ &
null
สส' +
)
สส+ ,
{
สส- .
DiscogsMetadata
หห 
=
หห  !!
gameDiscogsMetadata
หห" 5
;
หห5 6
}
ฬฬ 
if
ฯฯ 
(
ฯฯ 
!
ฯฯ 
	IsPlaying
ฯฯ 
)
ฯฯ 
{
ฯฯ &
LoadDurationFromMetadata
ะะ (
(
ะะ( )
metadata
ะะ) 1
)
ะะ1 2
;
ะะ2 3
}
ัั 
}
าา 	
private
ูู 
void
ูู  
ResetTrackMetadata
ูู '
(
ูู' (
)
ูู( )
{
ูู* +

TrackCover
 
=
 
null
 
;
 

TrackTitle
 
=
 
null
 
;
 
TrackArtist
 
=
 
null
 
;
 

TrackAlbum
 
=
 
null
 
;
 
	TrackYear
฿฿ 
=
฿฿ 
null
฿฿ 
;
฿฿ 

TrackGenre
เเ 
=
เเ 
null
เเ 
;
เเ 
TrackDuration
แแ 
=
แแ 
null
แแ  
;
แแ  !
TrackComment
โโ 
=
โโ 
null
โโ 
;
โโ  
TrackNumber
ใใ 
=
ใใ 
$num
ใใ 
;
ใใ 
TotalTracks
ไไ 
=
ไไ 
$num
ไไ 
;
ไไ 
DiscogsMetadata
็็ 
=
็็ !
gameDiscogsMetadata
็็ 1
;
็็1 2
}
่่ 	
private
๐๐ 
void
๐๐ &
LoadDurationFromMetadata
๐๐ -
(
๐๐- . 
TrackMetadataModel
๐๐. @
metadata
๐๐A I
)
๐๐I J
{
๐๐K L
if
๑๑ 
(
๑๑ 
!
๑๑ 
string
๑๑ 
.
๑๑ 
IsNullOrEmpty
๑๑ %
(
๑๑% &
metadata
๑๑& .
.
๑๑. /
Duration
๑๑/ 7
)
๑๑7 8
)
๑๑8 9
{
๑๑: ;
if
๓๓ 
(
๓๓ 
TimeSpan
๓๓ 
.
๓๓ 
TryParse
๓๓ %
(
๓๓% &
$str
๓๓& +
+
๓๓, -
metadata
๓๓. 6
.
๓๓6 7
Duration
๓๓7 ?
,
๓๓? @
out
๓๓A D
TimeSpan
๓๓E M
duration
๓๓N V
)
๓๓V W
||
๓๓X Z
TimeSpan
๔๔ 
.
๔๔ 
TryParse
๔๔ %
(
๔๔% &
metadata
๔๔& .
.
๔๔. /
Duration
๔๔/ 7
,
๔๔7 8
out
๔๔9 <
duration
๔๔= E
)
๔๔E F
)
๔๔F G
{
๔๔H I
Duration
๕๕ 
=
๕๕ 
duration
๕๕ '
.
๕๕' (
TotalSeconds
๕๕( 4
;
๕๕4 5
return
๖๖ 
;
๖๖ 
}
๗๗ 
}
๘๘ 
try
๛๛ 
{
๛๛ 
using
 
(
 
var
 
audioFileReader
 *
=
+ ,
new
- 0
AudioFileReader
1 @
(
@ A
SelectedMusicFile
A R
)
R S
)
S T
{
U V
Duration
 
=
 
audioFileReader
 .
.
. /
	TotalTime
/ 8
.
8 9
TotalSeconds
9 E
;
E F
}
 
}
 
catch
		 
{
		 
Duration
		 
=
		 
$num
		 
;
		 
}
		 
}
		 	
private
		 
async
		 
Task
		 
PlayPauseAsync
		 )
(
		) *
)
		* +
{
		, -
if
		 
(
		 
	IsPlaying
		 
&&
		 
!
		 
IsPaused
		 &
)
		& '
{
		( )
Pause
		 
(
		 
)
		 
;
		 
}
		 
else
		 
{
		 
await
		 
	PlayAsync
		 
(
		  
)
		  !
;
		! "
}
		 
}
		 	
private
		 
async
		 
Task
		 
	PlayAsync
		 $
(
		$ %
)
		% &
{
		' (
if
		 
(
		 
string
		 
.
		 
IsNullOrEmpty
		 $
(
		$ %
SelectedMusicFile
		% 6
)
		6 7
||
		8 :
SelectedGame
		; G
==
		H J
null
		K O
)
		O P
return
		 
;
		 
try
		 
{
		 
double
ข	ข	 
?
ข	ข	 
startPosition
ข	ข	 %
=
ข	ข	& '
null
ข	ข	( ,
;
ข	ข	, -
if
ฃ	ฃ	 
(
ฃ	ฃ	 
!
ฃ	ฃ	 
	IsPlaying
ฃ	ฃ	 
&&
ฃ	ฃ	 !
Position
ฃ	ฃ	" *
>
ฃ	ฃ	+ ,
$num
ฃ	ฃ	- .
)
ฃ	ฃ	. /
{
ฃ	ฃ	0 1
startPosition
ค	ค	 !
=
ค	ค	" #
Position
ค	ค	$ ,
;
ค	ค	, -
}
ฅ	ฅ	 
await
ง	ง	 
playbackService
ง	ง	 %
.
ง	ง	% &
	PlayAsync
ง	ง	& /
(
ง	ง	/ 0
SelectedMusicFile
ง	ง	0 A
,
ง	ง	A B
startPosition
ง	ง	C P
)
ง	ง	P Q
;
ง	ง	Q R
CurrentTrack
จ	จ	 
=
จ	จ	 
$"
จ	จ	 !
$str
จ	จ	! *
{
จ	จ	* +
Path
จ	จ	+ /
.
จ	จ	/ 0)
GetFileNameWithoutExtension
จ	จ	0 K
(
จ	จ	K L
SelectedMusicFile
จ	จ	L ]
)
จ	จ	] ^
}
จ	จ	^ _
"
จ	จ	_ `
;
จ	จ	` a
}
ฉ	ฉ	 
catch
ช	ช	 
(
ช	ช	 
	Exception
ช	ช	 
ex
ช	ช	 
)
ช	ช	  
{
ช	ช	! "

StatusText
ซ	ซ	 
=
ซ	ซ	 
$"
ซ	ซ	 
$str
ซ	ซ	 4
{
ซ	ซ	4 5
ex
ซ	ซ	5 7
.
ซ	ซ	7 8
Message
ซ	ซ	8 ?
}
ซ	ซ	? @
"
ซ	ซ	@ A
;
ซ	ซ	A B
}
ฌ	ฌ	 
}
ญ	ญ	 	
private
ณ	ณ	 
void
ณ	ณ	 
Pause
ณ	ณ	 
(
ณ	ณ	 
)
ณ	ณ	 
{
ณ	ณ	 
playbackService
ด	ด	 
.
ด	ด	 
Pause
ด	ด	 !
(
ด	ด	! "
)
ด	ด	" #
;
ด	ด	# $
if
ต	ต	 
(
ต	ต	 
	IsPlaying
ต	ต	 
)
ต	ต	 
CurrentTrack
ถ	ถ	 
=
ถ	ถ	 
CurrentTrack
ถ	ถ	 +
.
ถ	ถ	+ ,
Replace
ถ	ถ	, 3
(
ถ	ถ	3 4
$str
ถ	ถ	4 >
,
ถ	ถ	> ?
$str
ถ	ถ	@ I
)
ถ	ถ	I J
;
ถ	ถ	J K
}
ท	ท	 	
private
ฝ	ฝ	 
void
ฝ	ฝ	 
Stop
ฝ	ฝ	 
(
ฝ	ฝ	 
)
ฝ	ฝ	 
{
ฝ	ฝ	 
playbackService
พ	พ	 
.
พ	พ	 
Stop
พ	พ	  
(
พ	พ	  !
)
พ	พ	! "
;
พ	พ	" #
CurrentTrack
ฟ	ฟ	 
=
ฟ	ฟ	 
$str
ฟ	ฟ	 
;
ฟ	ฟ	 
}
ภ	ภ	 	
private
ฦ	ฦ	 
void
ฦ	ฦ	 
UpdatePosition
ฦ	ฦ	 #
(
ฦ	ฦ	# $
)
ฦ	ฦ	$ %
{
ฦ	ฦ	& '
if
ว	ว	 
(
ว	ว	 
!
ว	ว	 
isUserDragging
ว	ว	 
)
ว	ว	  
{
ว	ว	! "
Position
ศ	ศ	 
=
ศ	ศ	 
playbackService
ศ	ศ	 *
.
ศ	ศ	* +
GetPosition
ศ	ศ	+ 6
(
ศ	ศ	6 7
)
ศ	ศ	7 8
;
ศ	ศ	8 9
}
ษ	ษ	 
}
ส	ส	 	
private
ึ	ึ	 
async
ึ	ึ	 
void
ึ	ึ	 
OnPlaybackEnded
ึ	ึ	 *
(
ึ	ึ	* +
)
ึ	ึ	+ ,
{
ึ	ึ	- .
if
ื	ื	 
(
ื	ื	 

MusicFiles
ื	ื	 
!=
ื	ื	 
null
ื	ื	 "
&&
ื	ื	# %
SelectedMusicFile
ื	ื	& 7
!=
ื	ื	8 :
null
ื	ื	; ?
)
ื	ื	? @
{
ื	ื	A B
var
ู	ู	 
currentIndex
ู	ู	  
=
ู	ู	! "

MusicFiles
ู	ู	# -
.
ู	ู	- .
ToList
ู	ู	. 4
(
ู	ู	4 5
)
ู	ู	5 6
.
ู	ู	6 7
	FindIndex
ู	ู	7 @
(
ู	ู	@ A
item
ู	ู	A E
=>
ู	ู	F H
item
ู	ู	I M
.
ู	ู	M N
FilePath
ู	ู	N V
==
ู	ู	W Y
SelectedMusicFile
ู	ู	Z k
)
ู	ู	k l
;
ู	ู	l m
if
		 
(
		 
currentIndex
		  
>=
		! #
$num
		$ %
&&
		& (
currentIndex
		) 5
<
		6 7

MusicFiles
		8 B
.
		B C
Count
		C H
-
		I J
$num
		K L
)
		L M
{
		N O
var
		 
nextFile
		  
=
		! "

MusicFiles
		# -
[
		- .
currentIndex
		. :
+
		; <
$num
		= >
]
		> ?
.
		? @
FilePath
		@ H
;
		H I
playRetryCount
		 "
=
		# $
$num
		% &
;
		& '
await
฿	฿	 ,
TryPlayNextTrackWithRetryAsync
฿	฿	 8
(
฿	฿	8 9
nextFile
฿	฿	9 A
)
฿	฿	A B
;
฿	฿	B C
}
เ	เ	 
else
แ	แ	 
{
แ	แ	 
	IsPlaying
ใ	ใ	 
=
ใ	ใ	 
false
ใ	ใ	  %
;
ใ	ใ	% &
IsPaused
ไ	ไ	 
=
ไ	ไ	 
false
ไ	ไ	 $
;
ไ	ไ	$ %
CurrentTrack
ๅ	ๅ	  
=
ๅ	ๅ	! "
$str
ๅ	ๅ	# %
;
ๅ	ๅ	% &
}
ๆ	ๆ	 
}
็	็	 
else
่	่	 
{
่	่	 
	IsPlaying
๊	๊	 
=
๊	๊	 
false
๊	๊	 !
;
๊	๊	! "
IsPaused
๋	๋	 
=
๋	๋	 
false
๋	๋	  
;
๋	๋	  !
CurrentTrack
์	์	 
=
์	์	 
$str
์	์	 !
;
์	์	! "
}
ํ	ํ	 
}
๎	๎	 	
private
๗	๗	 
async
๗	๗	 
Task
๗	๗	 ,
TryPlayNextTrackWithRetryAsync
๗	๗	 9
(
๗	๗	9 :
string
๗	๗	: @
nextFile
๗	๗	A I
)
๗	๗	I J
{
๗	๗	K L
isAutoPlayingNext
๘	๘	 
=
๘	๘	 
true
๘	๘	  $
;
๘	๘	$ %
SelectedMusicFile
๙	๙	 
=
๙	๙	 
nextFile
๙	๙	  (
;
๙	๙	( )
try
๛	๛	 
{
๛	๛	 
await
		 
Task
		 
.
		 
Delay
		  
(
		  !
$num
		! $
)
		$ %
;
		% &
await
		 
playbackService
		 %
.
		% &
	PlayAsync
		& /
(
		/ 0
nextFile
		0 8
,
		8 9
$num
		: ;
)
		; <
;
		< =
CurrentTrack


 
=


 
$"


 !
$str


! *
{


* +
Path


+ /
.


/ 0)
GetFileNameWithoutExtension


0 K
(


K L
nextFile


L T
)


T U
}


U V
"


V W
;


W X
playRetryCount


 
=


  
$num


! "
;


" #
	IsPlaying


 
=


 
true


  
;


  !
IsPaused


 
=


 
false


  
;


  !'
LoadSelectedTrackMetadata


 )
(


) *
)


* +
;


+ ,
isAutoPlayingNext


 !
=


" #
false


$ )
;


) *
}


 
catch


 
(


 
	Exception


 
ex


 
)


  
{


! "
if


 
(


 
playRetryCount


 "
<


# $
MaxPlayRetries


% 3
)


3 4
{


5 6
playRetryCount


 "
++


" $
;


$ %
await


 ,
TryPlayNextTrackWithRetryAsync


 8
(


8 9
nextFile


9 A
)


A B
;


B C
}


 
else


 
{


 

StatusText


 
=


  
$"


! #
$str


# =
{


= >
ex


> @
.


@ A
Message


A H
}


H I
"


I J
;


J K
playRetryCount


 "
=


# $
$num


% &
;


& '
isAutoPlayingNext


 %
=


& '
false


( -
;


- .
	IsPlaying


 
=


 
false


  %
;


% &
IsPaused


 
=


 
false


 $
;


$ %
CurrentTrack


  
=


! "
$str


# %
;


% &
}


 
}


 
}


 	
private
ค
ค
 
void
ค
ค
 !
HideMetadataSection
ค
ค
 (
(
ค
ค
( )
object
ค
ค
) /
	parameter
ค
ค
0 9
)
ค
ค
9 :
{
ค
ค
; <
var
ฅ
ฅ
 
section
ฅ
ฅ
 
=
ฅ
ฅ
 
	parameter
ฅ
ฅ
 #
as
ฅ
ฅ
$ &
string
ฅ
ฅ
' -
;
ฅ
ฅ
- .
if
ฆ
ฆ
 
(
ฆ
ฆ
 
string
ฆ
ฆ
 
.
ฆ
ฆ
 
Equals
ฆ
ฆ
 
(
ฆ
ฆ
 
section
ฆ
ฆ
 %
,
ฆ
ฆ
% &
$str
ฆ
ฆ
' ,
,
ฆ
ฆ
, -
StringComparison
ฆ
ฆ
. >
.
ฆ
ฆ
> ?
OrdinalIgnoreCase
ฆ
ฆ
? P
)
ฆ
ฆ
P Q
)
ฆ
ฆ
Q R
{
ฆ
ฆ
S T"
IsMp3MetadataVisible
ง
ง
 $
=
ง
ง
% &
false
ง
ง
' ,
;
ง
ง
, -
}
จ
จ
 
else
ฉ
ฉ
 
if
ฉ
ฉ
 
(
ฉ
ฉ
 
string
ฉ
ฉ
 
.
ฉ
ฉ
 
Equals
ฉ
ฉ
 "
(
ฉ
ฉ
" #
section
ฉ
ฉ
# *
,
ฉ
ฉ
* +
$str
ฉ
ฉ
, 5
,
ฉ
ฉ
5 6
StringComparison
ฉ
ฉ
7 G
.
ฉ
ฉ
G H
OrdinalIgnoreCase
ฉ
ฉ
H Y
)
ฉ
ฉ
Y Z
)
ฉ
ฉ
Z [
{
ฉ
ฉ
\ ]&
IsDiscogsMetadataVisible
ช
ช
 (
=
ช
ช
) *
false
ช
ช
+ 0
;
ช
ช
0 1
}
ซ
ซ
 
}
ฌ
ฌ
 	
private
ท
ท
 
async
ท
ท
 
Task
ท
ท
 &
LoadDiscogsMetadataAsync
ท
ท
 3
(
ท
ท
3 4
)
ท
ท
4 5
{
ท
ท
6 7
if
ธ
ธ
 
(
ธ
ธ
 
SelectedGame
ธ
ธ
 
==
ธ
ธ
 
null
ธ
ธ
  $
)
ธ
ธ
$ %
{
ธ
ธ
& '
	ShowError
น
น
 
(
น
น
 
$str
น
น
 7
)
น
น
7 8
;
น
น
8 9
return
บ
บ
 
;
บ
บ
 
}
ป
ป
 
string
ฝ
ฝ
 
query
ฝ
ฝ
 
=
ฝ
ฝ
 
SelectedGame
ฝ
ฝ
 '
.
ฝ
ฝ
' (
Name
ฝ
ฝ
( ,
;
ฝ
ฝ
, -
string
พ
พ
 
token
พ
พ
 
=
พ
พ
 
SettingsViewModel
พ
พ
 ,
?
พ
พ
, -
.
พ
พ
- .
Settings
พ
พ
. 6
?
พ
พ
6 7
.
พ
พ
7 8
DiscogsToken
พ
พ
8 D
;
พ
พ
D E
if
ม
ม
 
(
ม
ม
 
string
ม
ม
 
.
ม
ม
  
IsNullOrWhiteSpace
ม
ม
 )
(
ม
ม
) *
token
ม
ม
* /
)
ม
ม
/ 0
)
ม
ม
0 1
{
ม
ม
2 3
	ShowError
ย
ย
 
(
ย
ย
 
$str
ย
ย
 U
)
ย
ย
U V
;
ย
ย
V W
return
ร
ร
 
;
ร
ร
 
}
ฤ
ฤ
 
try
ฦ
ฦ
 
{
ฦ
ฦ
 
var
ศ
ศ
 
results
ศ
ศ
 
=
ศ
ศ
 
await
ศ
ศ
 #
DiscogsClient
ศ
ศ
$ 1
.
ศ
ศ
1 2 
SearchReleaseAsync
ศ
ศ
2 D
(
ศ
ศ
D E
query
ศ
ศ
E J
,
ศ
ศ
J K
token
ศ
ศ
L Q
)
ศ
ศ
Q R
;
ศ
ศ
R S
if
ษ
ษ
 
(
ษ
ษ
 
results
ษ
ษ
 
!=
ษ
ษ
 
null
ษ
ษ
 #
&&
ษ
ษ
$ &
results
ษ
ษ
' .
.
ษ
ษ
. /
Count
ษ
ษ
/ 4
>
ษ
ษ
5 6
$num
ษ
ษ
7 8
)
ษ
ษ
8 9
{
ษ
ษ
: ;"
DiscogsMetadataModel
ส
ส
 (
selected
ส
ส
) 1
=
ส
ส
2 3
null
ส
ส
4 8
;
ส
ส
8 9
if
ห
ห
 
(
ห
ห
 
results
ห
ห
 
.
ห
ห
  
Count
ห
ห
  %
==
ห
ห
& (
$num
ห
ห
) *
)
ห
ห
* +
{
ห
ห
, -
selected
อ
อ
  
=
อ
อ
! "
results
อ
อ
# *
[
อ
อ
* +
$num
อ
อ
+ ,
]
อ
อ
, -
;
อ
อ
- .
}
ฮ
ฮ
 
else
ฯ
ฯ
 
{
ฯ
ฯ
 
selected
า
า
  
=
า
า
! "-
OnSelectDiscogsReleaseRequested
า
า
# B
?
า
า
B C
.
า
า
C D
Invoke
า
า
D J
(
า
า
J K
results
า
า
K R
,
า
า
R S
token
า
า
T Y
)
า
า
Y Z
;
า
า
Z [
}
ำ
ำ
 
if
ี
ี
 
(
ี
ี
 
selected
ี
ี
  
!=
ี
ี
! #
null
ี
ี
$ (
)
ี
ี
( )
{
ี
ี
* +
await
ึ
ึ
  
LoadDiscogsDetails
ึ
ึ
 0
(
ึ
ึ
0 1
selected
ึ
ึ
1 9
,
ึ
ึ
9 :
token
ึ
ึ
; @
)
ึ
ึ
@ A
;
ึ
ึ
A B
}
ื
ื
 
}
ุ
ุ
 
else
ู
ู
 
{
ู
ู
 
ShowInfo
ฺ
ฺ
 
(
ฺ
ฺ
 
$str
ฺ
ฺ
 ;
)
ฺ
ฺ
; <
;
ฺ
ฺ
< =
}


 
}


 
catch


 
(


 
	Exception


 
ex


 
)


  
{


! "
	ShowError


 
(


 
$str


 8
+


9 :
ex


; =
.


= >
Message


> E
)


E F
;


F G
}
฿
฿
 
}
เ
เ
 	
private
้
้
 
async
้
้
 
Task
้
้
  
LoadDiscogsDetails
้
้
 -
(
้
้
- ."
DiscogsMetadataModel
้
้
. B
selected
้
้
C K
,
้
้
K L
string
้
้
M S
token
้
้
T Y
)
้
้
Y Z
{
้
้
[ \
string
๊
๊
 
	releaseId
๊
๊
 
=
๊
๊
 
null
๊
๊
 #
;
๊
๊
# $
if
ํ
ํ
 
(
ํ
ํ
 
!
ํ
ํ
 
string
ํ
ํ
 
.
ํ
ํ
 
IsNullOrEmpty
ํ
ํ
 %
(
ํ
ํ
% &
selected
ํ
ํ
& .
.
ํ
ํ
. /

DiscogsUrl
ํ
ํ
/ 9
)
ํ
ํ
9 :
)
ํ
ํ
: ;
{
ํ
ํ
< =
var
๎
๎
 
urlParts
๎
๎
 
=
๎
๎
 
selected
๎
๎
 '
.
๎
๎
' (

DiscogsUrl
๎
๎
( 2
.
๎
๎
2 3
Split
๎
๎
3 8
(
๎
๎
8 9
$char
๎
๎
9 <
)
๎
๎
< =
;
๎
๎
= >
	releaseId
๏
๏
 
=
๏
๏
 
urlParts
๏
๏
 $
.
๏
๏
$ %
LastOrDefault
๏
๏
% 2
(
๏
๏
2 3
)
๏
๏
3 4
;
๏
๏
4 5
}
๐
๐
 
if
๒
๒
 
(
๒
๒
 
!
๒
๒
 
string
๒
๒
 
.
๒
๒
 
IsNullOrEmpty
๒
๒
 %
(
๒
๒
% &
	releaseId
๒
๒
& /
)
๒
๒
/ 0
)
๒
๒
0 1
{
๒
๒
2 3
var
๔
๔
 
details
๔
๔
 
=
๔
๔
 
await
๔
๔
 #
DiscogsClient
๔
๔
$ 1
.
๔
๔
1 2$
GetReleaseDetailsAsync
๔
๔
2 H
(
๔
๔
H I
	releaseId
๔
๔
I R
,
๔
๔
R S
token
๔
๔
T Y
)
๔
๔
Y Z
;
๔
๔
Z [
if
๕
๕
 
(
๕
๕
 
details
๕
๕
 
!=
๕
๕
 
null
๕
๕
 #
)
๕
๕
# $
{
๕
๕
% &
details
๗
๗
 
.
๗
๗
 
Released
๗
๗
 $
=
๗
๗
% &
details
๗
๗
' .
.
๗
๗
. /
Released
๗
๗
/ 7
??
๗
๗
8 :
selected
๗
๗
; C
.
๗
๗
C D
Released
๗
๗
D L
;
๗
๗
L M
details
๘
๘
 
.
๘
๘
 
Genres
๘
๘
 "
=
๘
๘
# $
details
๘
๘
% ,
.
๘
๘
, -
Genres
๘
๘
- 3
??
๘
๘
4 6
selected
๘
๘
7 ?
.
๘
๘
? @
Genres
๘
๘
@ F
;
๘
๘
F G
details
๙
๙
 
.
๙
๙
 
Styles
๙
๙
 "
=
๙
๙
# $
details
๙
๙
% ,
.
๙
๙
, -
Styles
๙
๙
- 3
??
๙
๙
4 6
selected
๙
๙
7 ?
.
๙
๙
? @
Styles
๙
๙
@ F
;
๙
๙
F G
DiscogsMetadata
๚
๚
 #
=
๚
๚
$ %
details
๚
๚
& -
;
๚
๚
- .!
gameDiscogsMetadata


 '
=


( )
details


* 1
;


1 2(
SaveDiscogsMetadataToCache
 .
(
. /
details
/ 6
)
6 7
;
7 8
}
 
else
 
{
 
DiscogsMetadata
 #
=
$ %
selected
& .
;
. /!
gameDiscogsMetadata
 '
=
( )
selected
* 2
;
2 3(
SaveDiscogsMetadataToCache
 .
(
. /
selected
/ 7
)
7 8
;
8 9
}
 
}
 
else
 
{
 
DiscogsMetadata
 
=
  !
selected
" *
;
* +!
gameDiscogsMetadata
 #
=
$ %
selected
& .
;
. /(
SaveDiscogsMetadataToCache
 *
(
* +
selected
+ 3
)
3 4
;
4 5
}
 
}
 	
private
 
void
 '
LoadCachedDiscogsMetadata
 .
(
. /
)
/ 0
{
1 2
if
 
(
 
SelectedGame
 
==
 
null
  $
)
$ %
return
 
;
 
try
 
{
 
var
 
musicDir
 
=
 
Path
 #
.
# $
Combine
$ +
(
+ ,
plugin
 
.
 
PlayniteApi
 &
.
& '
Paths
' ,
.
, -
ConfigurationPath
- >
,
> ?
$str
 #
,
# $
$str
 
,
 
SelectedGame
  
.
  !
Id
! #
.
# $
ToString
$ ,
(
, -
)
- .
,
. /
$str
กก !
)
ขข 
;
ขข 
var
คค 
discogsJsonPath
คค #
=
คค$ %
Path
คค& *
.
คค* +
Combine
คค+ 2
(
คค2 3
musicDir
คค3 ;
,
คค; <
$"
คค= ?
{
คค? @
SelectedGame
คค@ L
.
คคL M
Id
คคM O
}
คคO P
$str
คคP ]
"
คค] ^
)
คค^ _
;
คค_ `
if
งง 
(
งง 
File
งง 
.
งง 
Exists
งง 
(
งง  
discogsJsonPath
งง  /
)
งง/ 0
)
งง0 1
{
งง2 3
var
จจ 
json
จจ 
=
จจ 
File
จจ #
.
จจ# $
ReadAllText
จจ$ /
(
จจ/ 0
discogsJsonPath
จจ0 ?
)
จจ? @
;
จจ@ A
var
ฉฉ 
cachedMetadata
ฉฉ &
=
ฉฉ' (

Newtonsoft
ฉฉ) 3
.
ฉฉ3 4
Json
ฉฉ4 8
.
ฉฉ8 9
JsonConvert
ฉฉ9 D
.
ฉฉD E
DeserializeObject
ฉฉE V
<
ฉฉV W"
DiscogsMetadataModel
ฉฉW k
>
ฉฉk l
(
ฉฉl m
json
ฉฉm q
)
ฉฉq r
;
ฉฉr s
if
ซซ 
(
ซซ 
cachedMetadata
ซซ &
!=
ซซ' )
null
ซซ* .
)
ซซ. /
{
ซซ0 1!
gameDiscogsMetadata
ฌฌ +
=
ฌฌ, -
cachedMetadata
ฌฌ. <
;
ฌฌ< =
DiscogsMetadata
ญญ '
=
ญญ( )
cachedMetadata
ญญ* 8
;
ญญ8 9
}
ฎฎ 
}
ฏฏ 
}
ฐฐ 
catch
ฑฑ 
{
ฑฑ 
}
ดด 
}
ตต 	
private
ฝฝ 
void
ฝฝ (
SaveDiscogsMetadataToCache
ฝฝ /
(
ฝฝ/ 0"
DiscogsMetadataModel
ฝฝ0 D
metadata
ฝฝE M
)
ฝฝM N
{
ฝฝO P
if
พพ 
(
พพ 
SelectedGame
พพ 
==
พพ 
null
พพ  $
||
พพ% '
metadata
พพ( 0
==
พพ1 3
null
พพ4 8
)
พพ8 9
return
ฟฟ 
;
ฟฟ 
try
มม 
{
มม 
metadata
รร 
.
รร 
Comment
รร  
=
รร! "
$"
รร# %
$str
รร% /
{
รร/ 0
DateTime
รร0 8
.
รร8 9
Now
รร9 <
:
รร< =
$str
รร= P
}
รรP Q
"
รรQ R
;
รรR S
MetadataJsonSaver
ลล !
.
ลล! "'
SaveDiscogsMetadataToJson
ลล" ;
(
ลล; <
SelectedGame
ลล< H
.
ลลH I
Id
ลลI K
,
ลลK L
metadata
ลลM U
,
ลลU V
plugin
ลลW ]
.
ลล] ^
PlayniteApi
ลล^ i
)
ลลi j
;
ลลj k
}
ฦฦ 
catch
วว 
{
วว 
}
สส 
}
หห 	
private
ีี 
void
ีี 
ShowTrackCover
ีี #
(
ีี# $
)
ีี$ %
{
ีี& '
if
ึึ 
(
ึึ 

TrackCover
ึึ 
!=
ึึ 
null
ึึ "
)
ึึ" #
{
ึึ$ %'
OnShowTrackCoverRequested
ุุ )
?
ุุ) *
.
ุุ* +
Invoke
ุุ+ 1
(
ุุ1 2

TrackCover
ุุ2 <
)
ุุ< =
;
ุุ= >
}
ูู 
else
ฺฺ 
{
ฺฺ 
ShowInfo
 
(
 
$str
 8
)
8 9
;
9 :
}
 
}
 	
private
ใใ 
void
ใใ 
ShowDiscogsCover
ใใ %
(
ใใ% &
)
ใใ& '
{
ใใ( )
var
ไไ 
coverUrl
ไไ 
=
ไไ 
DiscogsMetadata
ไไ *
?
ไไ* +
.
ไไ+ ,
CoverUrl
ไไ, 4
;
ไไ4 5
if
ๅๅ 
(
ๅๅ 
!
ๅๅ 
string
ๅๅ 
.
ๅๅ 
IsNullOrEmpty
ๅๅ %
(
ๅๅ% &
coverUrl
ๅๅ& .
)
ๅๅ. /
)
ๅๅ/ 0
{
ๅๅ1 2)
OnShowDiscogsCoverRequested
็็ +
?
็็+ ,
.
็็, -
Invoke
็็- 3
(
็็3 4
coverUrl
็็4 <
)
็็< =
;
็็= >
}
่่ 
else
้้ 
{
้้ 
ShowInfo
๊๊ 
(
๊๊ 
$str
๊๊ :
)
๊๊: ;
;
๊๊; <
}
๋๋ 
}
์์ 	
private
๗๗ (
OstPlayerSettingsViewModel
๗๗ *"
GetSettingsViewModel
๗๗+ ?
(
๗๗? @
)
๗๗@ A
{
๗๗B C
var
๘๘ 
settingsProp
๘๘ 
=
๘๘ 
plugin
๘๘ %
.
๘๘% &
GetType
๘๘& -
(
๘๘- .
)
๘๘. /
.
๘๘/ 0
GetProperty
๘๘0 ;
(
๘๘; <
$str
๘๘< F
,
๘๘F G
System
๙๙ 
.
๙๙ 

Reflection
๙๙ !
.
๙๙! "
BindingFlags
๙๙" .
.
๙๙. /
	NonPublic
๙๙/ 8
|
๙๙9 :
System
๙๙; A
.
๙๙A B

Reflection
๙๙B L
.
๙๙L M
BindingFlags
๙๙M Y
.
๙๙Y Z
Instance
๙๙Z b
)
๙๙b c
;
๙๙c d
return
๚๚ 
settingsProp
๚๚ 
?
๚๚  
.
๚๚  !
GetValue
๚๚! )
(
๚๚) *
plugin
๚๚* 0
)
๚๚0 1
as
๚๚2 4(
OstPlayerSettingsViewModel
๚๚5 O
;
๚๚O P
}
๛๛ 	
private
 
void
 
	ShowError
 
(
 
string
 %
message
& -
)
- .
{
/ 0"
OnShowErrorRequested
  
?
  !
.
! "
Invoke
" (
(
( )
message
) 0
)
0 1
;
1 2
}
 	
private
 
void
 
ShowInfo
 
(
 
string
 $
message
% ,
)
, -
{
. /!
OnShowInfoRequested
 
?
  
.
  !
Invoke
! '
(
' (
message
( /
)
/ 0
;
0 1
}
 	
public
 
event
 
Action
 
<
 
BitmapImage
 '
>
' ('
OnShowTrackCoverRequested
) B
;
B C
public
 
event
 
Action
 
<
 
string
 "
>
" #)
OnShowDiscogsCoverRequested
$ ?
;
? @
public
 
event
 
Action
 
<
 
string
 "
>
" #"
OnShowErrorRequested
$ 8
;
8 9
public
 
event
 
Action
 
<
 
string
 "
>
" #!
OnShowInfoRequested
$ 7
;
7 8
public
 
event
 
Func
 
<
 
List
 
<
 "
DiscogsMetadataModel
 3
>
3 4
,
4 5
string
6 <
,
< ="
DiscogsMetadataModel
> R
>
R S-
OnSelectDiscogsReleaseRequested
T s
;
s t
private
ชช 
void
ชช $
LoadVolumeFromSettings
ชช +
(
ชช+ ,
)
ชช, -
{
ชช. /
try
ซซ 
{
ซซ 
var
ฌฌ 
settings
ฌฌ 
=
ฌฌ 
plugin
ฌฌ %
.
ฌฌ% & 
LoadPluginSettings
ฌฌ& 8
<
ฌฌ8 9
OstPlayerSettings
ฌฌ9 J
>
ฌฌJ K
(
ฌฌK L
)
ฌฌL M
;
ฌฌM N
if
ญญ 
(
ญญ 
settings
ญญ 
!=
ญญ 
null
ญญ  $
)
ญญ$ %
{
ญญ& '
volume
ฏฏ 
=
ฏฏ 
settings
ฏฏ %
.
ฏฏ% &
DefaultVolume
ฏฏ& 3
;
ฏฏ3 4
OnPropertyChanged
ฐฐ %
(
ฐฐ% &
nameof
ฐฐ& ,
(
ฐฐ, -
Volume
ฐฐ- 3
)
ฐฐ3 4
)
ฐฐ4 5
;
ฐฐ5 6
OnPropertyChanged
ฑฑ %
(
ฑฑ% &
nameof
ฑฑ& ,
(
ฑฑ, -
VolumeDisplay
ฑฑ- :
)
ฑฑ: ;
)
ฑฑ; <
;
ฑฑ< =
playbackService
ดด #
?
ดด# $
.
ดด$ %
	SetVolume
ดด% .
(
ดด. /
volume
ดด/ 5
/
ดด6 7
$num
ดด8 =
)
ดด= >
;
ดด> ?
}
ตต 
}
ถถ 
catch
ทท 
(
ทท 
	Exception
ทท 
ex
ทท 
)
ทท  
{
ทท! "
volume
นน 
=
นน 
$num
นน 
;
นน 

StatusText
บบ 
=
บบ 
$"
บบ 
$str
บบ >
{
บบ> ?
ex
บบ? A
.
บบA B
Message
บบB I
}
บบI J
"
บบJ K
;
บบK L
}
ปป 
}
ผผ 	
private
รร 
void
รร "
SaveVolumeToSettings
รร )
(
รร) *
double
รร* 0
volumeLevel
รร1 <
)
รร< =
{
รร> ?
try
ฤฤ 
{
ฤฤ 
var
ลล 
settings
ลล 
=
ลล 
plugin
ลล %
.
ลล% & 
LoadPluginSettings
ลล& 8
<
ลล8 9
OstPlayerSettings
ลล9 J
>
ลลJ K
(
ลลK L
)
ลลL M
??
ลลN P
new
ลลQ T
OstPlayerSettings
ลลU f
(
ลลf g
)
ลลg h
;
ลลh i
settings
ฦฦ 
.
ฦฦ 
DefaultVolume
ฦฦ &
=
ฦฦ' (
volumeLevel
ฦฦ) 4
;
ฦฦ4 5
plugin
วว 
.
วว  
SavePluginSettings
วว )
(
วว) *
settings
วว* 2
)
วว2 3
;
วว3 4
}
ศศ 
catch
ษษ 
(
ษษ 
	Exception
ษษ 
ex
ษษ 
)
ษษ  
{
ษษ! "
System
หห 
.
หห 
Diagnostics
หห "
.
หห" #
Debug
หห# (
.
หห( )
	WriteLine
หห) 2
(
หห2 3
$"
หห3 5
$str
หห5 X
{
หหX Y
ex
หหY [
.
หห[ \
Message
หห\ c
}
หหc d
"
หหd e
)
หหe f
;
หหf g
}
ฬฬ 
}
ออ 	
public
ุุ 
void
ุุ 
Dispose
ุุ 
(
ุุ 
)
ุุ 
{
ุุ 
playbackService
ูู 
?
ูู 
.
ูู 
Dispose
ูู $
(
ูู$ %
)
ูู% &
;
ูู& '
progressTimer
ฺฺ 
?
ฺฺ 
.
ฺฺ 
Stop
ฺฺ 
(
ฺฺ  
)
ฺฺ  !
;
ฺฺ! "
}
 	
}
 
}฿฿ 
MC:\Playnite\_github\OstPlayer\source\ViewModels\OstPlayerSettingsViewModel.cs
	namespaceWW 	
	OstPlayerWW
 
.WW 

ViewModelsWW 
{WW  
public\\ 

class\\ &
OstPlayerSettingsViewModel\\ +
:\\, -
ObservableObject\\. >
,\\> ?
	ISettings\\@ I
{\\J K
public]] 
readonly]] 
	OstPlayer]] !
plugin]]" (
;]]( )
private^^ 
OstPlayerSettings^^ !
editingClone^^" .
{^^/ 0
get^^1 4
;^^4 5
set^^6 9
;^^9 :
}^^; <
private`` 
OstPlayerSettings`` !
settings``" *
;``* +
publicdd 
OstPlayerSettingsdd  
Settingsdd! )
{dd* +
getee 
=>ee 
settingsee 
;ee 
setff 
{ff 
settingsgg 
=gg 
valuegg  
;gg  !
OnPropertyChangedhh !
(hh! "
)hh" #
;hh# $
}ii 
}jj 	
publicoo &
OstPlayerSettingsViewModeloo )
(oo) *
	OstPlayeroo* 3
pluginoo4 :
)oo: ;
{oo< =
thispp 
.pp 
pluginpp 
=pp 
pluginpp  
;pp  !
varqq 
savedSettingsqq 
=qq 
pluginqq  &
.qq& '
LoadPluginSettingsqq' 9
<qq9 :
OstPlayerSettingsqq: K
>qqK L
(qqL M
)qqM N
;qqN O
Settingsrr 
=rr 
savedSettingsrr $
??rr% '
newrr( +
OstPlayerSettingsrr, =
(rr= >
)rr> ?
;rr? @
}ss 	
publicxx 
voidxx 
	BeginEditxx 
(xx 
)xx 
{xx  !
editingCloneyy 
=yy 
Serializationyy (
.yy( )
GetCloneyy) 1
(yy1 2
Settingsyy2 :
)yy: ;
;yy; <
}zz 	
public 
void 

CancelEdit 
( 
)  
{! "
Settings
 
=
 
editingClone
 #
;
# $
}
 	
public
 
void
 
EndEdit
 
(
 
)
 
{
 
plugin
 
.
  
SavePluginSettings
 %
(
% &
Settings
& .
)
. /
;
/ 0
}
 	
public
 
bool
 
VerifySettings
 "
(
" #
out
# &
List
' +
<
+ ,
string
, 2
>
2 3
errors
4 :
)
: ;
{
< =
errors
 
=
 
new
 
List
 
<
 
string
 $
>
$ %
(
% &
)
& '
;
' (
return
 
true
 
;
 
}
 	
}
 
} เ-
EC:\Playnite\_github\OstPlayer\source\ViewModels\Core\ViewModelBase.cs
	namespace__ 	
	OstPlayer__
 
.__ 

ViewModels__ 
.__ 
Core__ #
{__$ %
publicii 

abstractii 
classii 
ViewModelBaseii '
:ii( )"
INotifyPropertyChangedii* @
,ii@ A
IDisposableiiB M
{iiN O
privatepp 
boolpp 
	_disposedpp 
=pp  
falsepp! &
;pp& '
privatevv 
readonlyvv 
objectvv 
_disposeLockvv  ,
=vv- .
newvv/ 2
objectvv3 9
(vv9 :
)vv: ;
;vv; <
public
 
event
 )
PropertyChangedEventHandler
 0
PropertyChanged
1 @
;
@ A
	protected
 
virtual
 
void
 
OnPropertyChanged
 0
(
0 1
[
1 2
CallerMemberName
2 B
]
B C
string
D J
propertyName
K W
=
X Y
null
Z ^
)
^ _
{
` a
if
 
(
 
!
 
	_disposed
 
)
 
{
 
PropertyChanged
กก 
?
กก  
.
กก  !
Invoke
กก! '
(
กก' (
this
กก( ,
,
กก, -
new
กก. 1&
PropertyChangedEventArgs
กก2 J
(
กกJ K
propertyName
กกK W
)
กกW X
)
กกX Y
;
กกY Z
}
ขข 
}
ฃฃ 	
	protected
ผผ 
virtual
ผผ 
bool
ผผ 
SetProperty
ผผ *
<
ผผ* +
T
ผผ+ ,
>
ผผ, -
(
ผผ- .
ref
ผผ. 1
T
ผผ2 3
field
ผผ4 9
,
ผผ9 :
T
ผผ; <
value
ผผ= B
,
ผผB C
[
ผผD E
CallerMemberName
ผผE U
]
ผผU V
string
ผผW ]
propertyName
ผผ^ j
=
ผผk l
null
ผผm q
)
ผผq r
{
ผผs t
if
พพ 
(
พพ 
	_disposed
พพ 
)
พพ 
return
ฟฟ 
false
ฟฟ 
;
ฟฟ 
if
ยย 
(
ยย 
System
ยย 
.
ยย 
Collections
ยย "
.
ยย" #
Generic
ยย# *
.
ยย* +
EqualityComparer
ยย+ ;
<
ยย; <
T
ยย< =
>
ยย= >
.
ยย> ?
Default
ยย? F
.
ยยF G
Equals
ยยG M
(
ยยM N
field
ยยN S
,
ยยS T
value
ยยU Z
)
ยยZ [
)
ยย[ \
return
รร 
false
รร 
;
รร 
field
ฦฦ 
=
ฦฦ 
value
ฦฦ 
;
ฦฦ 
OnPropertyChanged
วว 
(
วว 
propertyName
วว *
)
วว* +
;
วว+ ,
return
ศศ 
true
ศศ 
;
ศศ 
}
ษษ 	
	protected
ิิ 
ViewModelBase
ิิ 
(
ิิ  
)
ิิ  !
{
ิิ" #

Initialize
ึึ 
(
ึึ 
)
ึึ 
;
ึึ 
}
ืื 	
	protected
แแ 
virtual
แแ 
void
แแ 

Initialize
แแ )
(
แแ) *
)
แแ* +
{
แแ, -
}
ใใ 	
	protected
ํํ 
virtual
ํํ 
void
ํํ 
Cleanup
ํํ &
(
ํํ& '
)
ํํ' (
{
ํํ) *
}
๏๏ 	
	protected
 
void
 
ThrowIfDisposed
 &
(
& '
)
' (
{
) *
if
 
(
 
	_disposed
 
)
 
{
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
GetType
2 9
(
9 :
)
: ;
.
; <
Name
< @
)
@ A
;
A B
}
 
}
 	
	protected
 
bool
 

IsDisposed
 !
=>
" $
	_disposed
% .
;
. /
public
 
void
 
Dispose
 
(
 
)
 
{
 
Dispose
 
(
 
true
 
)
 
;
 
GC
 
.
 
SuppressFinalize
 
(
  
this
  $
)
$ %
;
% &
}
 	
	protected
คค 
virtual
คค 
void
คค 
Dispose
คค &
(
คค& '
bool
คค' +
	disposing
คค, 5
)
คค5 6
{
คค7 8
if
ฅฅ 
(
ฅฅ 
!
ฅฅ 
	_disposed
ฅฅ 
)
ฅฅ 
{
ฅฅ 
lock
ฆฆ 
(
ฆฆ 
_disposeLock
ฆฆ "
)
ฆฆ" #
{
ฆฆ$ %
if
งง 
(
งง 
!
งง 
	_disposed
งง "
)
งง" #
{
งง$ %
if
จจ 
(
จจ 
	disposing
จจ %
)
จจ% &
{
จจ' (
Cleanup
ชช #
(
ชช# $
)
ชช$ %
;
ชช% &
PropertyChanged
ญญ +
=
ญญ, -
null
ญญ. 2
;
ญญ2 3
}
ฎฎ 
	_disposed
ฑฑ !
=
ฑฑ" #
true
ฑฑ$ (
;
ฑฑ( )
}
ฒฒ 
}
ณณ 
}
ดด 
}
ตต 	
public
ภภ 
override
ภภ 
string
ภภ 
ToString
ภภ '
(
ภภ' (
)
ภภ( )
{
ภภ* +
return
มม 
$"
มม 
{
มม 
GetType
มม 
(
มม 
)
มม 
.
มม  
Name
มม  $
}
มม$ %
$str
มม% 1
{
มม1 2
	_disposed
มม2 ;
}
มม; <
$str
มม< =
"
มม= >
;
มม> ?
}
ยย 	
}
ลล 
}ฦฦ ๏จ
AC:\Playnite\_github\OstPlayer\source\Utils\TrackDataGridSorter.cs
	namespace^^ 	
	OstPlayer^^
 
.^^ 
Utils^^ 
{__ 
publicdd 

staticdd 
classdd 
TrackDataGridSorterdd +
{ee 
publicoo 
staticoo  
ObservableCollectionoo *
<oo* +
TrackListItemoo+ 8
>oo8 9
SortByTrackNumberoo: K
(ooK L
IEnumerablepp 
<pp 
TrackListItempp %
>pp% &
trackspp' -
,pp- .
boolqq 
	ascendingqq 
=qq 
trueqq !
)rr 	
{ss 	
iftt 
(tt 
trackstt 
==tt 
nulltt 
)tt 
returnuu 
newuu  
ObservableCollectionuu /
<uu/ 0
TrackListItemuu0 =
>uu= >
(uu> ?
)uu? @
;uu@ A
varww 
sortedww 
=ww 
	ascendingww "
?xx 
tracksxx 
.yy 
OrderByyy 
(yy 
tyy 
=>yy !
tyy" #
.yy# $
TrackNumberyy$ /
==yy0 2
$numyy3 4
?yy5 6
uintyy7 ;
.yy; <
MaxValueyy< D
:yyE F
tyyG H
.yyH I
TrackNumberyyI T
)yyT U
.zz 
ThenByzz 
(zz 
tzz 
=>zz  
tzz! "
.zz" #

TrackTitlezz# -
??zz. 0
$strzz1 3
,zz3 4
StringComparerzz5 C
.zzC D
OrdinalIgnoreCasezzD U
)zzU V
:{{ 
tracks{{ 
.|| 
OrderByDescending|| &
(||& '
t||' (
=>||) +
t||, -
.||- .
TrackNumber||. 9
==||: <
$num||= >
?||? @
$num||A B
:||C D
t||E F
.||F G
TrackNumber||G R
)||R S
.}} 
ThenBy}} 
(}} 
t}} 
=>}}  
t}}! "
.}}" #

TrackTitle}}# -
??}}. 0
$str}}1 3
,}}3 4
StringComparer}}5 C
.}}C D
OrdinalIgnoreCase}}D U
)}}U V
;}}V W
return 
new  
ObservableCollection +
<+ ,
TrackListItem, 9
>9 :
(: ;
sorted; A
)A B
;B C
}
 	
public
 
static
 "
ObservableCollection
 *
<
* +
TrackListItem
+ 8
>
8 9
SortByTitle
: E
(
E F
IEnumerable
 
<
 
TrackListItem
 %
>
% &
tracks
' -
,
- .
bool
 
	ascending
 
=
 
true
 !
)
 	
{
 	
if
 
(
 
tracks
 
==
 
null
 
)
 
return
 
new
 "
ObservableCollection
 /
<
/ 0
TrackListItem
0 =
>
= >
(
> ?
)
? @
;
@ A
var
 
sorted
 
=
 
	ascending
 "
?
 
tracks
 
.
 
OrderBy
  
(
  !
t
! "
=>
# %
t
& '
.
' (

TrackTitle
( 2
??
3 5
$str
6 8
,
8 9
StringComparer
: H
.
H I&
CurrentCultureIgnoreCase
I a
)
a b
:
 
tracks
 
.
 
OrderByDescending
 *
(
* +
t
 
=>
 
t
 
.
 

TrackTitle
 %
??
& (
$str
) +
,
+ ,
StringComparer
 "
.
" #&
CurrentCultureIgnoreCase
# ;
)
 
;
 
return
 
new
 "
ObservableCollection
 +
<
+ ,
TrackListItem
, 9
>
9 :
(
: ;
sorted
; A
)
A B
;
B C
}
 	
public
ขข 
static
ขข "
ObservableCollection
ขข *
<
ขข* +
TrackListItem
ขข+ 8
>
ขข8 9
SortByDuration
ขข: H
(
ขขH I
IEnumerable
ฃฃ 
<
ฃฃ 
TrackListItem
ฃฃ %
>
ฃฃ% &
tracks
ฃฃ' -
,
ฃฃ- .
bool
คค 
	ascending
คค 
=
คค 
true
คค !
)
ฅฅ 	
{
ฆฆ 	
if
งง 
(
งง 
tracks
งง 
==
งง 
null
งง 
)
งง 
return
จจ 
new
จจ "
ObservableCollection
จจ /
<
จจ/ 0
TrackListItem
จจ0 =
>
จจ= >
(
จจ> ?
)
จจ? @
;
จจ@ A
var
ชช 
sorted
ชช 
=
ชช 
	ascending
ชช "
?
ซซ 
tracks
ซซ 
.
ฌฌ 
OrderBy
ฌฌ 
(
ฌฌ 
t
ฌฌ 
=>
ฌฌ !
t
ฌฌ" #
.
ฌฌ# $
DurationSeconds
ฌฌ$ 3
)
ฌฌ3 4
.
ญญ 
ThenBy
ญญ 
(
ญญ 
t
ญญ 
=>
ญญ  
t
ญญ! "
.
ญญ" #

TrackTitle
ญญ# -
??
ญญ. 0
$str
ญญ1 3
,
ญญ3 4
StringComparer
ญญ5 C
.
ญญC D
OrdinalIgnoreCase
ญญD U
)
ญญU V
:
ฎฎ 
tracks
ฎฎ 
.
ฏฏ 
OrderByDescending
ฏฏ &
(
ฏฏ& '
t
ฏฏ' (
=>
ฏฏ) +
t
ฏฏ, -
.
ฏฏ- .
DurationSeconds
ฏฏ. =
)
ฏฏ= >
.
ฐฐ 
ThenBy
ฐฐ 
(
ฐฐ 
t
ฐฐ 
=>
ฐฐ  
t
ฐฐ! "
.
ฐฐ" #

TrackTitle
ฐฐ# -
??
ฐฐ. 0
$str
ฐฐ1 3
,
ฐฐ3 4
StringComparer
ฐฐ5 C
.
ฐฐC D
OrdinalIgnoreCase
ฐฐD U
)
ฐฐU V
;
ฐฐV W
return
ฒฒ 
new
ฒฒ "
ObservableCollection
ฒฒ +
<
ฒฒ+ ,
TrackListItem
ฒฒ, 9
>
ฒฒ9 :
(
ฒฒ: ;
sorted
ฒฒ; A
)
ฒฒA B
;
ฒฒB C
}
ณณ 	
public
รร 
static
รร "
ObservableCollection
รร *
<
รร* +
TrackListItem
รร+ 8
>
รร8 9
SortMultiColumn
รร: I
(
รรI J
IEnumerable
ฤฤ 
<
ฤฤ 
TrackListItem
ฤฤ %
>
ฤฤ% &
tracks
ฤฤ' -
,
ฤฤ- .

SortColumn
ลล 
primarySort
ลล "
,
ลล" #
bool
ฦฦ 
primaryAscending
ฦฦ !
,
ฦฦ! "

SortColumn
วว 
?
วว 
secondarySort
วว %
=
วว& '
null
วว( ,
,
วว, -
bool
ศศ  
secondaryAscending
ศศ #
=
ศศ$ %
true
ศศ& *
)
ษษ 	
{
สส 	
if
หห 
(
หห 
tracks
หห 
==
หห 
null
หห 
)
หห 
return
ฬฬ 
new
ฬฬ "
ObservableCollection
ฬฬ /
<
ฬฬ/ 0
TrackListItem
ฬฬ0 =
>
ฬฬ= >
(
ฬฬ> ?
)
ฬฬ? @
;
ฬฬ@ A
var
ฮฮ 
query
ฮฮ 
=
ฮฮ 
tracks
ฮฮ 
.
ฮฮ 
AsQueryable
ฮฮ *
(
ฮฮ* +
)
ฮฮ+ ,
;
ฮฮ, -
query
ัั 
=
ัั 
ApplySortColumn
ัั #
(
ัั# $
query
ัั$ )
,
ัั) *
primarySort
ัั+ 6
,
ัั6 7
primaryAscending
ัั8 H
,
ััH I
true
ััJ N
)
ััN O
;
ััO P
if
ิิ 
(
ิิ 
secondarySort
ิิ 
.
ิิ 
HasValue
ิิ &
)
ิิ& '
{
ีี 
query
ึึ 
=
ึึ 
ApplySortColumn
ึึ '
(
ึึ' (
query
ึึ( -
,
ึึ- .
secondarySort
ึึ/ <
.
ึึ< =
Value
ึึ= B
,
ึึB C 
secondaryAscending
ึึD V
,
ึึV W
false
ึึX ]
)
ึึ] ^
;
ึึ^ _
}
ืื 
return
ูู 
new
ูู "
ObservableCollection
ูู +
<
ูู+ ,
TrackListItem
ูู, 9
>
ูู9 :
(
ูู: ;
query
ูู; @
)
ูู@ A
;
ููA B
}
ฺฺ 	
private
฿฿ 
static
฿฿ 
IOrderedQueryable
฿฿ (
<
฿฿( )
TrackListItem
฿฿) 6
>
฿฿6 7
ApplySortColumn
฿฿8 G
(
฿฿G H

IQueryable
เเ 
<
เเ 
TrackListItem
เเ $
>
เเ$ %
query
เเ& +
,
เเ+ ,

SortColumn
แแ 
column
แแ 
,
แแ 
bool
โโ 
	ascending
โโ 
,
โโ 
bool
ใใ 
	isPrimary
ใใ 
)
ไไ 	
{
ๅๅ 	
switch
ๆๆ 
(
ๆๆ 
column
ๆๆ 
)
ๆๆ 
{
็็ 
case
่่ 

SortColumn
่่ 
.
่่  
TrackNumber
่่  +
:
่่+ ,
if
้้ 
(
้้ 
	isPrimary
้้ !
)
้้! "
{
๊๊ 
return
๋๋ 
	ascending
๋๋ (
?
์์ 
query
์์ #
.
์์# $
OrderBy
์์$ +
(
์์+ ,
t
์์, -
=>
์์. 0
t
์์1 2
.
์์2 3
TrackNumber
์์3 >
==
์์? A
$num
์์B C
?
์์D E
uint
์์F J
.
์์J K
MaxValue
์์K S
:
์์T U
t
์์V W
.
์์W X
TrackNumber
์์X c
)
์์c d
:
ํํ 
query
ํํ #
.
ํํ# $
OrderByDescending
ํํ$ 5
(
ํํ5 6
t
ํํ6 7
=>
ํํ8 :
t
ํํ; <
.
ํํ< =
TrackNumber
ํํ= H
==
ํํI K
$num
ํํL M
?
ํํN O
$num
ํํP Q
:
ํํR S
t
ํํT U
.
ํํU V
TrackNumber
ํํV a
)
ํํa b
;
ํํb c
}
๎๎ 
else
๏๏ 
{
๐๐ 
var
๑๑ 
orderedQuery
๑๑ (
=
๑๑) *
(
๑๑+ ,
IOrderedQueryable
๑๑, =
<
๑๑= >
TrackListItem
๑๑> K
>
๑๑K L
)
๑๑L M
query
๑๑M R
;
๑๑R S
return
๒๒ 
	ascending
๒๒ (
?
๓๓ 
orderedQuery
๓๓ *
.
๓๓* +
ThenBy
๓๓+ 1
(
๓๓1 2
t
๓๓2 3
=>
๓๓4 6
t
๔๔  !
.
๔๔! "
TrackNumber
๔๔" -
==
๔๔. 0
$num
๔๔1 2
?
๔๔3 4
uint
๔๔5 9
.
๔๔9 :
MaxValue
๔๔: B
:
๔๔C D
t
๔๔E F
.
๔๔F G
TrackNumber
๔๔G R
)
๕๕ 
:
๖๖ 
orderedQuery
๖๖ *
.
๖๖* +
ThenByDescending
๖๖+ ;
(
๖๖; <
t
๖๖< =
=>
๖๖> @
t
๗๗  !
.
๗๗! "
TrackNumber
๗๗" -
==
๗๗. 0
$num
๗๗1 2
?
๗๗3 4
$num
๗๗5 6
:
๗๗7 8
t
๗๗9 :
.
๗๗: ;
TrackNumber
๗๗; F
)
๘๘ 
;
๘๘ 
}
๙๙ 
case
๛๛ 

SortColumn
๛๛ 
.
๛๛  
Title
๛๛  %
:
๛๛% &
if
 
(
 
	isPrimary
 !
)
! "
{
 
return
 
	ascending
 (
?
 
query
 #
.
# $
OrderBy
$ +
(
+ ,
t
  !
=>
" $
t
% &
.
& '

TrackTitle
' 1
??
2 4
$str
5 7
,
7 8
StringComparer
  .
.
. /&
CurrentCultureIgnoreCase
/ G
)
 
:
 
query
 #
.
# $
OrderByDescending
$ 5
(
5 6
t
  !
=>
" $
t
% &
.
& '

TrackTitle
' 1
??
2 4
$str
5 7
,
7 8
StringComparer
  .
.
. /&
CurrentCultureIgnoreCase
/ G
)
 
;
 
}
 
else
 
{
 
var
 
orderedQuery
 (
=
) *
(
+ ,
IOrderedQueryable
, =
<
= >
TrackListItem
> K
>
K L
)
L M
query
M R
;
R S
return
 
	ascending
 (
?
 
orderedQuery
 *
.
* +
ThenBy
+ 1
(
1 2
t
  !
=>
" $
t
% &
.
& '

TrackTitle
' 1
??
2 4
$str
5 7
,
7 8
StringComparer
  .
.
. /&
CurrentCultureIgnoreCase
/ G
)
 
:
 
orderedQuery
 *
.
* +
ThenByDescending
+ ;
(
; <
t
  !
=>
" $
t
% &
.
& '

TrackTitle
' 1
??
2 4
$str
5 7
,
7 8
StringComparer
  .
.
. /&
CurrentCultureIgnoreCase
/ G
)
 
;
 
}
 
case
 

SortColumn
 
.
  
Duration
  (
:
( )
if
 
(
 
	isPrimary
 !
)
! "
{
 
return
 
	ascending
 (
?
 
query
 #
.
# $
OrderBy
$ +
(
+ ,
t
, -
=>
. 0
t
1 2
.
2 3
DurationSeconds
3 B
)
B C
:
 
query
 #
.
# $
OrderByDescending
$ 5
(
5 6
t
6 7
=>
8 :
t
; <
.
< =
DurationSeconds
= L
)
L M
;
M N
}
 
else
 
{
 
var
 
orderedQuery
 (
=
) *
(
+ ,
IOrderedQueryable
, =
<
= >
TrackListItem
> K
>
K L
)
L M
query
M R
;
R S
return
 
	ascending
 (
?
กก 
orderedQuery
กก *
.
กก* +
ThenBy
กก+ 1
(
กก1 2
t
กก2 3
=>
กก4 6
t
กก7 8
.
กก8 9
DurationSeconds
กก9 H
)
กกH I
:
ขข 
orderedQuery
ขข *
.
ขข* +
ThenByDescending
ขข+ ;
(
ขข; <
t
ขข< =
=>
ขข> @
t
ขขA B
.
ขขB C
DurationSeconds
ขขC R
)
ขขR S
;
ขขS T
}
ฃฃ 
default
ฅฅ 
:
ฅฅ 
throw
ฆฆ 
new
ฆฆ 
ArgumentException
ฆฆ /
(
ฆฆ/ 0
$"
ฆฆ0 2
$str
ฆฆ2 K
{
ฆฆK L
column
ฆฆL R
}
ฆฆR S
"
ฆฆS T
)
ฆฆT U
;
ฆฆU V
}
งง 
}
จจ 	
public
ตต 
static
ตต 
void
ตต %
ApplyCollectionViewSort
ตต 2
(
ตต2 3
ICollectionView
ถถ 
collectionView
ถถ *
,
ถถ* +

SortColumn
ทท 
column
ทท 
,
ทท 
bool
ธธ 
	ascending
ธธ 
)
นน 	
{
บบ 	
if
ปป 
(
ปป 
collectionView
ปป 
==
ปป !
null
ปป" &
)
ปป& '
return
ผผ 
;
ผผ 
collectionView
พพ 
.
พพ 
SortDescriptions
พพ +
.
พพ+ ,
Clear
พพ, 1
(
พพ1 2
)
พพ2 3
;
พพ3 4
string
ภภ 
propertyName
ภภ 
;
ภภ  
	IComparer
มม 
<
มม 
object
มม 
>
มม 
customComparer
มม ,
=
มม- .
null
มม/ 3
;
มม3 4
switch
รร 
(
รร 
column
รร 
)
รร 
{
ฤฤ 
case
ลล 

SortColumn
ลล 
.
ลล  
TrackNumber
ลล  +
:
ลล+ ,
propertyName
ฦฦ  
=
ฦฦ! "
nameof
ฦฦ# )
(
ฦฦ) *
TrackListItem
ฦฦ* 7
.
ฦฦ7 8
TrackNumber
ฦฦ8 C
)
ฦฦC D
;
ฦฦD E
customComparer
วว "
=
วว# $
new
วว% (!
TrackNumberComparer
วว) <
(
วว< =
	ascending
วว= F
)
ววF G
;
ววG H
break
ศศ 
;
ศศ 
case
สส 

SortColumn
สส 
.
สส  
Title
สส  %
:
สส% &
propertyName
หห  
=
หห! "
nameof
หห# )
(
หห) *
TrackListItem
หห* 7
.
หห7 8

TrackTitle
หห8 B
)
หหB C
;
หหC D
break
ฬฬ 
;
ฬฬ 
case
ฮฮ 

SortColumn
ฮฮ 
.
ฮฮ  
Duration
ฮฮ  (
:
ฮฮ( )
propertyName
ฯฯ  
=
ฯฯ! "
nameof
ฯฯ# )
(
ฯฯ) *
TrackListItem
ฯฯ* 7
.
ฯฯ7 8
DurationSeconds
ฯฯ8 G
)
ฯฯG H
;
ฯฯH I
break
ะะ 
;
ะะ 
default
าา 
:
าา 
throw
ำำ 
new
ำำ 
ArgumentException
ำำ /
(
ำำ/ 0
$"
ำำ0 2
$str
ำำ2 K
{
ำำK L
column
ำำL R
}
ำำR S
"
ำำS T
)
ำำT U
;
ำำU V
}
ิิ 
var
ึึ 
	direction
ึึ 
=
ึึ 
	ascending
ึึ %
?
ึึ& '
ListSortDirection
ึึ( 9
.
ึึ9 :
	Ascending
ึึ: C
:
ึึD E
ListSortDirection
ึึF W
.
ึึW X

Descending
ึึX b
;
ึึb c
collectionView
ืื 
.
ืื 
SortDescriptions
ืื +
.
ืื+ ,
Add
ืื, /
(
ืื/ 0
new
ืื0 3
SortDescription
ืื4 C
(
ืืC D
propertyName
ืืD P
,
ืืP Q
	direction
ืืR [
)
ืื[ \
)
ืื\ ]
;
ืื] ^
if
ูู 
(
ูู 
customComparer
ูู 
!=
ูู !
null
ูู" &
)
ูู& '
{
ฺฺ 
System
 
.
 
Diagnostics
 "
.
" #
Debug
# (
.
( )
	WriteLine
) 2
(
2 3
$"
 
$str
 *
{
* +
column
+ 1
}
1 2
$str
2 Z
"
Z [
)
฿฿ 
;
฿฿ 
}
เเ 
}
แแ 	
private
๊๊ 
class
๊๊ !
TrackNumberComparer
๊๊ )
:
๊๊* +
	IComparer
๊๊, 5
<
๊๊5 6
object
๊๊6 <
>
๊๊< =
{
๋๋ 	
private
์์ 
readonly
์์ 
bool
์์ !

_ascending
์์" ,
;
์์, -
public
๎๎ !
TrackNumberComparer
๎๎ &
(
๎๎& '
bool
๎๎' +
	ascending
๎๎, 5
)
๎๎5 6
{
๏๏ 

_ascending
๐๐ 
=
๐๐ 
	ascending
๐๐ &
;
๐๐& '
}
๑๑ 
public
๓๓ 
int
๓๓ 
Compare
๓๓ 
(
๓๓ 
object
๓๓ %
x
๓๓& '
,
๓๓' (
object
๓๓) /
y
๓๓0 1
)
๓๓1 2
{
๔๔ 
if
๕๕ 
(
๕๕ 
x
๕๕ 
is
๕๕ 
TrackListItem
๕๕ &
trackX
๕๕' -
&&
๕๕. 0
y
๕๕1 2
is
๕๕3 5
TrackListItem
๕๕6 C
trackY
๕๕D J
)
๕๕J K
{
๖๖ 
var
๗๗ 
result
๗๗ 
=
๗๗  
TrackListItem
๗๗! .
.
๗๗. /"
CompareByTrackNumber
๗๗/ C
(
๗๗C D
trackX
๗๗D J
,
๗๗J K
trackY
๗๗L R
)
๗๗R S
;
๗๗S T
return
๘๘ 

_ascending
๘๘ %
?
๘๘& '
result
๘๘( .
:
๘๘/ 0
-
๘๘1 2
result
๘๘2 8
;
๘๘8 9
}
๙๙ 
return
๛๛ 
$num
๛๛ 
;
๛๛ 
}
 
}
 	
public
 
enum
 

SortColumn
 
{
 	
TrackNumber
 
,
 
Title
 
,
 
Duration
 
,
 
}
 	
public
 
static
 
class
 
PerformanceStats
 ,
{
 	
public
 
static
 
long
  
LastSortDurationMs
 1
{
2 3
get
4 7
;
7 8
private
9 @
set
A D
;
D E
}
F G
public
 
static
 
int
 
LastSortItemCount
 /
{
0 1
get
2 5
;
5 6
private
7 >
set
? B
;
B C
}
D E
internal
ฃฃ 
static
ฃฃ 
void
ฃฃ  

RecordSort
ฃฃ! +
(
ฃฃ+ ,
int
ฃฃ, /
	itemCount
ฃฃ0 9
,
ฃฃ9 :
long
ฃฃ; ?

durationMs
ฃฃ@ J
)
ฃฃJ K
{
คค 
LastSortItemCount
ฅฅ !
=
ฅฅ" #
	itemCount
ฅฅ$ -
;
ฅฅ- . 
LastSortDurationMs
ฆฆ "
=
ฆฆ# $

durationMs
ฆฆ% /
;
ฆฆ/ 0
}
งง 
}
จจ 	
}
ซซ 
}ฌฌ 
:C:\Playnite\_github\OstPlayer\source\Utils\RelayCommand.cs
	namespaceZZ 	
	OstPlayerZZ
 
.ZZ 
UtilsZZ 
{ZZ 
publicaa 

classaa 
RelayCommandaa 
:aa 
ICommandaa  (
{aa) *
privategg 
readonlygg 
Actiongg 
<gg  
objectgg  &
>gg& '
executegg( /
;gg/ 0
privatell 
readonlyll 
	Predicatell "
<ll" #
objectll# )
>ll) *

canExecutell+ 5
;ll5 6
publiczz 
RelayCommandzz 
(zz 
Actionzz "
<zz" #
objectzz# )
>zz) *
executezz+ 2
,zz2 3
	Predicatezz4 =
<zz= >
objectzz> D
>zzD E

canExecutezzF P
=zzQ R
nullzzS W
)zzW X
{zzY Z
this{{ 
.{{ 
execute{{ 
={{ 
execute{{ "
;{{" #
this|| 
.|| 

canExecute|| 
=|| 

canExecute|| (
;||( )
}}} 	
public
 
bool
 

CanExecute
 
(
 
object
 %
	parameter
& /
)
/ 0
{
1 2
return
 

canExecute
 
==
  
null
! %
||
& (

canExecute
) 3
(
3 4
	parameter
4 =
)
= >
;
> ?
}
 	
public
 
void
 
Execute
 
(
 
object
 "
	parameter
# ,
)
, -
{
. /
execute
 
(
 
	parameter
 
)
 
;
 
}
 	
public
ลล 
event
ลล 
EventHandler
ลล !
CanExecuteChanged
ลล" 3
{
ลล4 5
add
ษษ 
{
ษษ 
}
ษษ 
remove
สส 
{
สส 
}
สส 
}
หห 	
}
 
} ุ
BC:\Playnite\_github\OstPlayer\source\Utils\Performance\TTLCache.cs
	namespacebb 	
	OstPlayerbb
 
.bb 
Utilsbb 
.bb 
Performancebb %
{bb& '
publichh 

classhh 
TTLCacheItemhh 
<hh 
TValuehh $
>hh$ %
{hh& '
publicii 
TValueii 
Valueii 
{ii 
getii !
;ii! "
setii# &
;ii& '
}ii( )
publicjj 
DateTimejj 
ExpirationTimejj &
{jj' (
getjj) ,
;jj, -
setjj. 1
;jj1 2
}jj3 4
publickk 
DateTimekk 
LastAccessTimekk &
{kk' (
getkk) ,
;kk, -
setkk. 1
;kk1 2
}kk3 4
publicll 
longll 
AccessCountll 
{ll  !
getll" %
;ll% &
setll' *
;ll* +
}ll, -
publicnn 
boolnn 
	IsExpirednn 
=>nn  
DateTimenn! )
.nn) *
UtcNownn* 0
>nn1 2
ExpirationTimenn3 A
;nnA B
}oo 
publicuu 

classuu 
CacheStatisticsuu  
{uu! "
publicvv 
longvv 
TotalRequestsvv !
{vv" #
getvv$ '
;vv' (
setvv) ,
;vv, -
}vv. /
publicww 
longww 
	CacheHitsww 
{ww 
getww  #
;ww# $
setww% (
;ww( )
}ww* +
publicxx 
longxx 
CacheMissesxx 
{xx  !
getxx" %
;xx% &
setxx' *
;xx* +
}xx, -
publicyy 
longyy 
	Evictionsyy 
{yy 
getyy  #
;yy# $
setyy% (
;yy( )
}yy* +
publiczz 
longzz 
Expirationszz 
{zz  !
getzz" %
;zz% &
setzz' *
;zz* +
}zz, -
public{{ 
int{{ 
CurrentSize{{ 
{{{  
get{{! $
;{{$ %
set{{& )
;{{) *
}{{+ ,
public|| 
int|| 
MaxSize|| 
{|| 
get||  
;||  !
set||" %
;||% &
}||' (
public}} 
double}} 
HitRatio}} 
=>}} !
TotalRequests}}" /
>}}0 1
$num}}2 3
?}}4 5
(}}6 7
double}}7 =
)}}= >
	CacheHits}}> G
/}}H I
TotalRequests}}J W
:}}X Y
$num}}Z ]
;}}] ^
public~~ 
TimeSpan~~ 

DefaultTTL~~ "
{~~# $
get~~% (
;~~( )
set~~* -
;~~- .
}~~/ 0
} 
public
 

class
 
TTLCache
 
<
 
TKey
 
,
 
TValue
  &
>
& '
:
( )
IDisposable
* 5
{
6 7
private
 
readonly
 
int
 
_initialMaxSize
 ,
;
, -
private
 
int
 
_maxSize
 
;
 
private
 
readonly
 
TimeSpan
 !
_defaultTTL
" -
;
- .
private
 
readonly
 
TimeSpan
 !
_cleanupInterval
" 2
;
2 3
private
 
readonly
 
bool
 -
_enableMemoryPressureAdjustment
 =
;
= >
private
 
readonly
 "
ConcurrentDictionary
 -
<
- .
TKey
. 2
,
2 3
LinkedListNode
4 B
<
B C

CacheEntry
C M
>
M N
>
N O
_cache
P V
;
V W
private
 
readonly
 

LinkedList
 #
<
# $

CacheEntry
$ .
>
. /
_lruList
0 8
;
8 9
private
 
readonly
 "
ReaderWriterLockSlim
 -
_lruLock
. 6
;
6 7
private
 
readonly
 
Timer
 
_cleanupTimer
 ,
;
, -
private
 
volatile
 
bool
 
	_disposed
 '
=
( )
false
* /
;
/ 0
private
 
long
 
_totalRequests
 #
=
$ %
$num
& '
;
' (
private
 
long
 

_cacheHits
 
=
  !
$num
" #
;
# $
private
 
long
 
_cacheMisses
 !
=
" #
$num
$ %
;
% &
private
 
long
 

_evictions
 
=
  !
$num
" #
;
# $
private
กก 
long
กก 
_expirations
กก !
=
กก" #
$num
กก$ %
;
กก% &
public
ฎฎ 
TTLCache
ฎฎ 
(
ฎฎ 
int
ฎฎ 
maxSize
ฎฎ #
,
ฎฎ# $
TimeSpan
ฎฎ% -

defaultTTL
ฎฎ. 8
,
ฎฎ8 9
TimeSpan
ฎฎ: B
?
ฎฎB C
cleanupInterval
ฎฎD S
=
ฎฎT U
null
ฎฎV Z
,
ฎฎZ [
bool
ฎฎ\ `,
enableMemoryPressureAdjustment
ฎฎa 
=ฎฎ 
trueฎฎ 
)ฎฎ 
{ฎฎ 
_initialMaxSize
ฏฏ 
=
ฏฏ 
maxSize
ฏฏ %
;
ฏฏ% &
_maxSize
ฐฐ 
=
ฐฐ 
maxSize
ฐฐ 
;
ฐฐ 
_defaultTTL
ฑฑ 
=
ฑฑ 

defaultTTL
ฑฑ $
;
ฑฑ$ %
_cleanupInterval
ฒฒ 
=
ฒฒ 
cleanupInterval
ฒฒ .
??
ฒฒ/ 1
TimeSpan
ฒฒ2 :
.
ฒฒ: ;
FromMinutes
ฒฒ; F
(
ฒฒF G
$num
ฒฒG H
)
ฒฒH I
;
ฒฒI J-
_enableMemoryPressureAdjustment
ณณ +
=
ณณ, -,
enableMemoryPressureAdjustment
ณณ. L
;
ณณL M
_cache
ตต 
=
ตต 
new
ตต "
ConcurrentDictionary
ตต -
<
ตต- .
TKey
ตต. 2
,
ตต2 3
LinkedListNode
ตต4 B
<
ตตB C

CacheEntry
ตตC M
>
ตตM N
>
ตตN O
(
ตตO P
)
ตตP Q
;
ตตQ R
_lruList
ถถ 
=
ถถ 
new
ถถ 

LinkedList
ถถ %
<
ถถ% &

CacheEntry
ถถ& 0
>
ถถ0 1
(
ถถ1 2
)
ถถ2 3
;
ถถ3 4
_lruLock
ทท 
=
ทท 
new
ทท "
ReaderWriterLockSlim
ทท /
(
ทท/ 0!
LockRecursionPolicy
ทท0 C
.
ททC D
NoRecursion
ททD O
)
ททO P
;
ททP Q
_cleanupTimer
บบ 
=
บบ 
new
บบ 
Timer
บบ  %
(
บบ% &
BackgroundCleanup
บบ& 7
,
บบ7 8
null
บบ9 =
,
บบ= >
_cleanupInterval
บบ? O
,
บบO P
_cleanupInterval
บบQ a
)
บบa b
;
บบb c
}
ปป 	
public
ษษ 
bool
ษษ 
TryGet
ษษ 
(
ษษ 
TKey
ษษ 
key
ษษ  #
,
ษษ# $
out
ษษ% (
TValue
ษษ) /
value
ษษ0 5
)
ษษ5 6
{
ษษ7 8
Interlocked
สส 
.
สส 
	Increment
สส !
(
สส! "
ref
สส" %
_totalRequests
สส& 4
)
สส4 5
;
สส5 6
value
หห 
=
หห 
default
หห 
(
หห 
TValue
หห "
)
หห" #
;
หห# $
if
ออ 
(
ออ 
_cache
ออ 
.
ออ 
TryGetValue
ออ "
(
ออ" #
key
ออ# &
,
ออ& '
out
ออ( +
var
ออ, /
node
ออ0 4
)
ออ4 5
)
ออ5 6
{
ออ7 8
_lruLock
ฮฮ 
.
ฮฮ 
EnterWriteLock
ฮฮ '
(
ฮฮ' (
)
ฮฮ( )
;
ฮฮ) *
try
ฯฯ 
{
ฯฯ 
var
ะะ 
entry
ะะ 
=
ะะ 
node
ะะ  $
.
ะะ$ %
Value
ะะ% *
;
ะะ* +
if
ำำ 
(
ำำ 
entry
ำำ 
.
ำำ 
Item
ำำ "
.
ำำ" #
	IsExpired
ำำ# ,
)
ำำ, -
{
ำำ. /
_lruList
ีี  
.
ีี  !
Remove
ีี! '
(
ีี' (
node
ีี( ,
)
ีี, -
;
ีี- .
_cache
ึึ 
.
ึึ 
	TryRemove
ึึ (
(
ึึ( )
key
ึึ) ,
,
ึึ, -
out
ึึ. 1
_
ึึ2 3
)
ึึ3 4
;
ึึ4 5
Interlocked
ืื #
.
ืื# $
	Increment
ืื$ -
(
ืื- .
ref
ืื. 1
_expirations
ืื2 >
)
ืื> ?
;
ืื? @
Interlocked
ุุ #
.
ุุ# $
	Increment
ุุ$ -
(
ุุ- .
ref
ุุ. 1
_cacheMisses
ุุ2 >
)
ุุ> ?
;
ุุ? @
return
ูู 
false
ูู $
;
ูู$ %
}
ฺฺ 
entry
 
.
 
Item
 
.
 
LastAccessTime
 -
=
. /
DateTime
0 8
.
8 9
UtcNow
9 ?
;
? @
entry
 
.
 
Item
 
.
 
AccessCount
 *
++
* ,
;
, -
_lruList
แแ 
.
แแ 
Remove
แแ #
(
แแ# $
node
แแ$ (
)
แแ( )
;
แแ) *
_lruList
โโ 
.
โโ 
AddFirst
โโ %
(
โโ% &
node
โโ& *
)
โโ* +
;
โโ+ ,
value
ไไ 
=
ไไ 
entry
ไไ !
.
ไไ! "
Item
ไไ" &
.
ไไ& '
Value
ไไ' ,
;
ไไ, -
Interlocked
ๅๅ 
.
ๅๅ  
	Increment
ๅๅ  )
(
ๅๅ) *
ref
ๅๅ* -

_cacheHits
ๅๅ. 8
)
ๅๅ8 9
;
ๅๅ9 :
return
ๆๆ 
true
ๆๆ 
;
ๆๆ  
}
็็ 
finally
่่ 
{
่่ 
_lruLock
้้ 
.
้้ 
ExitWriteLock
้้ *
(
้้* +
)
้้+ ,
;
้้, -
}
๊๊ 
}
๋๋ 
Interlocked
ํํ 
.
ํํ 
	Increment
ํํ !
(
ํํ! "
ref
ํํ" %
_cacheMisses
ํํ& 2
)
ํํ2 3
;
ํํ3 4
return
๎๎ 
false
๎๎ 
;
๎๎ 
}
๏๏ 	
public
๙๙ 
void
๙๙ 
Add
๙๙ 
(
๙๙ 
TKey
๙๙ 
key
๙๙  
,
๙๙  !
TValue
๙๙" (
value
๙๙) .
,
๙๙. /
TimeSpan
๙๙0 8
?
๙๙8 9
	customTTL
๙๙: C
=
๙๙D E
null
๙๙F J
)
๙๙J K
{
๙๙L M
var
๚๚ 
ttl
๚๚ 
=
๚๚ 
	customTTL
๚๚ 
??
๚๚  "
_defaultTTL
๚๚# .
;
๚๚. /
var
๛๛ 
expirationTime
๛๛ 
=
๛๛  
DateTime
๛๛! )
.
๛๛) *
UtcNow
๛๛* 0
.
๛๛0 1
Add
๛๛1 4
(
๛๛4 5
ttl
๛๛5 8
)
๛๛8 9
;
๛๛9 :
var
 
now
 
=
 
DateTime
 
.
 
UtcNow
 %
;
% &
var
 
newItem
 
=
 
new
 
TTLCacheItem
 *
<
* +
TValue
+ 1
>
1 2
{
3 4
Value
 
=
 
value
 
,
 
ExpirationTime
 
=
  
expirationTime
! /
,
/ 0
LastAccessTime
 
=
  
now
! $
,
$ %
AccessCount
 
=
 
$num
 
}
 
;
 
_lruLock
 
.
 
EnterWriteLock
 #
(
# $
)
$ %
;
% &
try
 
{
 
if
 
(
 
_cache
 
.
 
TryGetValue
 &
(
& '
key
' *
,
* +
out
, /
var
0 3
existingNode
4 @
)
@ A
)
A B
{
C D
existingNode
  
.
  !
Value
! &
.
& '
Item
' +
=
, -
newItem
. 5
;
5 6
_lruList
 
.
 
Remove
 #
(
# $
existingNode
$ 0
)
0 1
;
1 2
_lruList
 
.
 
AddFirst
 %
(
% &
existingNode
& 2
)
2 3
;
3 4
}
 
else
 
{
 
var
 
entry
 
=
 
new
  #

CacheEntry
$ .
{
/ 0
Key
1 4
=
5 6
key
7 :
,
: ;
Item
< @
=
A B
newItem
C J
}
K L
;
L M
var
 
newNode
 
=
  !
new
" %
LinkedListNode
& 4
<
4 5

CacheEntry
5 ?
>
? @
(
@ A
entry
A F
)
F G
;
G H
while
 
(
 
_cache
 !
.
! "
Count
" '
>=
( *
_maxSize
+ 3
&&
4 6
_lruList
7 ?
.
? @
Count
@ E
>
F G
$num
H I
)
I J
{
K L$
EvictLeastRecentlyUsed
 .
(
. /
)
/ 0
;
0 1
}
 
_lruList
 
.
 
AddFirst
 %
(
% &
newNode
& -
)
- .
;
. /
_cache
 
[
 
key
 
]
 
=
  !
newNode
" )
;
) *
}
 
}
 
finally
 
{
 
_lruLock
 
.
 
ExitWriteLock
 &
(
& '
)
' (
;
( )
}
 
}
 	
public
ฅฅ 
bool
ฅฅ 
Remove
ฅฅ 
(
ฅฅ 
TKey
ฅฅ 
key
ฅฅ  #
)
ฅฅ# $
{
ฅฅ% &
if
ฆฆ 
(
ฆฆ 
_cache
ฆฆ 
.
ฆฆ 
	TryRemove
ฆฆ  
(
ฆฆ  !
key
ฆฆ! $
,
ฆฆ$ %
out
ฆฆ& )
var
ฆฆ* -
node
ฆฆ. 2
)
ฆฆ2 3
)
ฆฆ3 4
{
ฆฆ5 6
_lruLock
งง 
.
งง 
EnterWriteLock
งง '
(
งง' (
)
งง( )
;
งง) *
try
จจ 
{
จจ 
_lruList
ฉฉ 
.
ฉฉ 
Remove
ฉฉ #
(
ฉฉ# $
node
ฉฉ$ (
)
ฉฉ( )
;
ฉฉ) *
return
ชช 
true
ชช 
;
ชช  
}
ซซ 
finally
ฌฌ 
{
ฌฌ 
_lruLock
ญญ 
.
ญญ 
ExitWriteLock
ญญ *
(
ญญ* +
)
ญญ+ ,
;
ญญ, -
}
ฎฎ 
}
ฏฏ 
return
ฐฐ 
false
ฐฐ 
;
ฐฐ 
}
ฑฑ 	
public
ถถ 
void
ถถ 
Clear
ถถ 
(
ถถ 
)
ถถ 
{
ถถ 
_lruLock
ทท 
.
ทท 
EnterWriteLock
ทท #
(
ทท# $
)
ทท$ %
;
ทท% &
try
ธธ 
{
ธธ 
_cache
นน 
.
นน 
Clear
นน 
(
นน 
)
นน 
;
นน 
_lruList
บบ 
.
บบ 
Clear
บบ 
(
บบ 
)
บบ  
;
บบ  !
Interlocked
ฝฝ 
.
ฝฝ 
Exchange
ฝฝ $
(
ฝฝ$ %
ref
ฝฝ% (
_totalRequests
ฝฝ) 7
,
ฝฝ7 8
$num
ฝฝ9 :
)
ฝฝ: ;
;
ฝฝ; <
Interlocked
พพ 
.
พพ 
Exchange
พพ $
(
พพ$ %
ref
พพ% (

_cacheHits
พพ) 3
,
พพ3 4
$num
พพ5 6
)
พพ6 7
;
พพ7 8
Interlocked
ฟฟ 
.
ฟฟ 
Exchange
ฟฟ $
(
ฟฟ$ %
ref
ฟฟ% (
_cacheMisses
ฟฟ) 5
,
ฟฟ5 6
$num
ฟฟ7 8
)
ฟฟ8 9
;
ฟฟ9 :
Interlocked
ภภ 
.
ภภ 
Exchange
ภภ $
(
ภภ$ %
ref
ภภ% (

_evictions
ภภ) 3
,
ภภ3 4
$num
ภภ5 6
)
ภภ6 7
;
ภภ7 8
Interlocked
มม 
.
มม 
Exchange
มม $
(
มม$ %
ref
มม% (
_expirations
มม) 5
,
มม5 6
$num
มม7 8
)
มม8 9
;
มม9 :
}
ยย 
finally
รร 
{
รร 
_lruLock
ฤฤ 
.
ฤฤ 
ExitWriteLock
ฤฤ &
(
ฤฤ& '
)
ฤฤ' (
;
ฤฤ( )
}
ลล 
}
ฦฦ 	
public
ะะ 
void
ะะ %
AdjustForMemoryPressure
ะะ +
(
ะะ+ ,
)
ะะ, -
{
ะะ. /
if
ัั 
(
ัั 
!
ัั -
_enableMemoryPressureAdjustment
ัั 0
)
ัั0 1
return
ัั2 8
;
ัั8 9
try
ำำ 
{
ำำ 
var
ีี 

workingSet
ีี 
=
ีี  
Environment
ีี! ,
.
ีี, -

WorkingSet
ีี- 7
;
ีี7 8
var
ึึ %
memoryPressureThreshold
ึึ +
=
ึึ, -
$num
ึึ. 1
*
ึึ2 3
$num
ึึ4 8
*
ึึ9 :
$num
ึึ; ?
;
ึึ? @
int
ุุ 

newMaxSize
ุุ 
;
ุุ 
if
ูู 
(
ูู 

workingSet
ูู 
>
ูู  %
memoryPressureThreshold
ูู! 8
)
ูู8 9
{
ูู: ;

newMaxSize
 
=
  
Math
! %
.
% &
Max
& )
(
) *
_initialMaxSize
* 9
/
: ;
$num
< =
,
= >
$num
? A
)
A B
;
B C
}
 
else
 
{
 

newMaxSize
฿฿ 
=
฿฿  
_initialMaxSize
฿฿! 0
;
฿฿0 1
}
เเ 
if
โโ 
(
โโ 

newMaxSize
โโ 
!=
โโ !
_maxSize
โโ" *
)
โโ* +
{
โโ, -
_maxSize
ใใ 
=
ใใ 

newMaxSize
ใใ )
;
ใใ) *
_lruLock
ๆๆ 
.
ๆๆ 
EnterWriteLock
ๆๆ +
(
ๆๆ+ ,
)
ๆๆ, -
;
ๆๆ- .
try
็็ 
{
็็ 
while
่่ 
(
่่ 
_cache
่่ %
.
่่% &
Count
่่& +
>
่่, -
_maxSize
่่. 6
&&
่่7 9
_lruList
่่: B
.
่่B C
Count
่่C H
>
่่I J
$num
่่K L
)
่่L M
{
่่N O$
EvictLeastRecentlyUsed
้้ 2
(
้้2 3
)
้้3 4
;
้้4 5
}
๊๊ 
}
๋๋ 
finally
์์ 
{
์์ 
_lruLock
ํํ  
.
ํํ  !
ExitWriteLock
ํํ! .
(
ํํ. /
)
ํํ/ 0
;
ํํ0 1
}
๎๎ 
}
๏๏ 
}
๐๐ 
catch
๑๑ 
{
๑๑ 
}
๓๓ 
}
๔๔ 	
public
 
CacheStatistics
 
GetStatistics
 ,
(
, -
)
- .
{
/ 0
return
 
new
 
CacheStatistics
 &
{
' (
TotalRequests
 
=
 
Interlocked
  +
.
+ ,
Read
, 0
(
0 1
ref
1 4
_totalRequests
5 C
)
C D
,
D E
	CacheHits
 
=
 
Interlocked
 '
.
' (
Read
( ,
(
, -
ref
- 0

_cacheHits
1 ;
)
; <
,
< =
CacheMisses
 
=
 
Interlocked
 )
.
) *
Read
* .
(
. /
ref
/ 2
_cacheMisses
3 ?
)
? @
,
@ A
	Evictions
 
=
 
Interlocked
 '
.
' (
Read
( ,
(
, -
ref
- 0

_evictions
1 ;
)
; <
,
< =
Expirations
 
=
 
Interlocked
 )
.
) *
Read
* .
(
. /
ref
/ 2
_expirations
3 ?
)
? @
,
@ A
CurrentSize
 
=
 
_cache
 $
.
$ %
Count
% *
,
* +
MaxSize
 
=
 
_maxSize
 "
,
" #

DefaultTTL
 
=
 
_defaultTTL
 (
}
 
;
 
}
 	
public
 
int
 
Count
 
=>
 
_cache
 "
.
" #
Count
# (
;
( )
public
 
int
 
MaxSize
 
=>
 
_maxSize
 &
;
& '
private
 
void
 $
EvictLeastRecentlyUsed
 +
(
+ ,
)
, -
{
. /
var
 
lastNode
 
=
 
_lruList
 #
.
# $
Last
$ (
;
( )
if
 
(
 
lastNode
 
!=
 
null
  
)
  !
{
" #
_lruList
 
.
 

RemoveLast
 #
(
# $
)
$ %
;
% &
_cache
กก 
.
กก 
	TryRemove
กก  
(
กก  !
lastNode
กก! )
.
กก) *
Value
กก* /
.
กก/ 0
Key
กก0 3
,
กก3 4
out
กก5 8
_
กก9 :
)
กก: ;
;
กก; <
Interlocked
ขข 
.
ขข 
	Increment
ขข %
(
ขข% &
ref
ขข& )

_evictions
ขข* 4
)
ขข4 5
;
ขข5 6
}
ฃฃ 
}
คค 	
private
ชช 
void
ชช 
BackgroundCleanup
ชช &
(
ชช& '
object
ชช' -
state
ชช. 3
)
ชช3 4
{
ชช5 6
if
ซซ 
(
ซซ 
	_disposed
ซซ 
)
ซซ 
return
ซซ !
;
ซซ! "
try
ญญ 
{
ญญ !
CleanupExpiredItems
ฎฎ #
(
ฎฎ# $
)
ฎฎ$ %
;
ฎฎ% &%
AdjustForMemoryPressure
ฏฏ '
(
ฏฏ' (
)
ฏฏ( )
;
ฏฏ) *
}
ฐฐ 
catch
ฑฑ 
{
ฑฑ 
}
ณณ 
}
ดด 	
private
นน 
void
นน !
CleanupExpiredItems
นน (
(
นน( )
)
นน) *
{
นน+ ,
var
บบ 
expiredKeys
บบ 
=
บบ 
new
บบ !
List
บบ" &
<
บบ& '
TKey
บบ' +
>
บบ+ ,
(
บบ, -
)
บบ- .
;
บบ. /
var
ปป 
now
ปป 
=
ปป 
DateTime
ปป 
.
ปป 
UtcNow
ปป %
;
ปป% &
_lruLock
พพ 
.
พพ 
EnterReadLock
พพ "
(
พพ" #
)
พพ# $
;
พพ$ %
try
ฟฟ 
{
ฟฟ 
var
ภภ 
current
ภภ 
=
ภภ 
_lruList
ภภ &
.
ภภ& '
First
ภภ' ,
;
ภภ, -
while
มม 
(
มม 
current
มม 
!=
มม !
null
มม" &
)
มม& '
{
มม( )
if
ยย 
(
ยย 
current
ยย 
.
ยย  
Value
ยย  %
.
ยย% &
Item
ยย& *
.
ยย* +
ExpirationTime
ยย+ 9
<=
ยย: <
now
ยย= @
)
ยย@ A
{
ยยB C
expiredKeys
รร #
.
รร# $
Add
รร$ '
(
รร' (
current
รร( /
.
รร/ 0
Value
รร0 5
.
รร5 6
Key
รร6 9
)
รร9 :
;
รร: ;
}
ฤฤ 
current
ลล 
=
ลล 
current
ลล %
.
ลล% &
Next
ลล& *
;
ลล* +
}
ฦฦ 
}
วว 
finally
ศศ 
{
ศศ 
_lruLock
ษษ 
.
ษษ 
ExitReadLock
ษษ %
(
ษษ% &
)
ษษ& '
;
ษษ' (
}
สส 
if
ออ 
(
ออ 
expiredKeys
ออ 
.
ออ 
Count
ออ !
>
ออ" #
$num
ออ$ %
)
ออ% &
{
ออ' (
_lruLock
ฮฮ 
.
ฮฮ 
EnterWriteLock
ฮฮ '
(
ฮฮ' (
)
ฮฮ( )
;
ฮฮ) *
try
ฯฯ 
{
ฯฯ 
foreach
ะะ 
(
ะะ 
var
ะะ  
key
ะะ! $
in
ะะ% '
expiredKeys
ะะ( 3
)
ะะ3 4
{
ะะ5 6
if
ัั 
(
ัั 
_cache
ัั "
.
ัั" #
	TryRemove
ัั# ,
(
ัั, -
key
ัั- 0
,
ัั0 1
out
ัั2 5
var
ัั6 9
node
ัั: >
)
ัั> ?
)
ัั? @
{
ััA B
_lruList
าา $
.
าา$ %
Remove
าา% +
(
าา+ ,
node
าา, 0
)
าา0 1
;
าา1 2
Interlocked
ำำ '
.
ำำ' (
	Increment
ำำ( 1
(
ำำ1 2
ref
ำำ2 5
_expirations
ำำ6 B
)
ำำB C
;
ำำC D
}
ิิ 
}
ีี 
}
ึึ 
finally
ืื 
{
ืื 
_lruLock
ุุ 
.
ุุ 
ExitWriteLock
ุุ *
(
ุุ* +
)
ุุ+ ,
;
ุุ, -
}
ูู 
}
ฺฺ 
}
 	
private
ๅๅ 
class
ๅๅ 

CacheEntry
ๅๅ  
{
ๅๅ! "
public
ๆๆ 
TKey
ๆๆ 
Key
ๆๆ 
{
ๆๆ 
get
ๆๆ !
;
ๆๆ! "
set
ๆๆ# &
;
ๆๆ& '
}
ๆๆ( )
public
็็ 
TTLCacheItem
็็ 
<
็็  
TValue
็็  &
>
็็& '
Item
็็( ,
{
็็- .
get
็็/ 2
;
็็2 3
set
็็4 7
;
็็7 8
}
็็9 :
}
่่ 	
public
๑๑ 
void
๑๑ 
Dispose
๑๑ 
(
๑๑ 
)
๑๑ 
{
๑๑ 
Dispose
๒๒ 
(
๒๒ 
true
๒๒ 
)
๒๒ 
;
๒๒ 
GC
๓๓ 
.
๓๓ 
SuppressFinalize
๓๓ 
(
๓๓  
this
๓๓  $
)
๓๓$ %
;
๓๓% &
}
๔๔ 	
	protected
๚๚ 
virtual
๚๚ 
void
๚๚ 
Dispose
๚๚ &
(
๚๚& '
bool
๚๚' +
	disposing
๚๚, 5
)
๚๚5 6
{
๚๚7 8
if
๛๛ 
(
๛๛ 
!
๛๛ 
	_disposed
๛๛ 
&&
๛๛ 
	disposing
๛๛ '
)
๛๛' (
{
๛๛) *
	_disposed
 
=
 
true
  
;
  !
_cleanupTimer
 
?
 
.
 
Dispose
 &
(
& '
)
' (
;
( )
_lruLock
 
?
 
.
 
Dispose
 !
(
! "
)
" #
;
# $
Clear
 
(
 
)
 
;
 
}
 
}
 	
}
 
} ำ6
BC:\Playnite\_github\OstPlayer\source\Utils\Performance\LRUCache.cs
	namespaceUU 	
	OstPlayerUU
 
.UU 
UtilsUU 
.UU 
PerformanceUU %
{VV 
public__ 

class__ 
LRUCache__ 
<__ 
TKey__ 
,__ 
TValue__  &
>__& '
{`` 
privateff 
readonlyff 
intff 
_maxSizeff %
;ff% &
privatekk 
readonlykk  
ConcurrentDictionarykk -
<kk- .
TKeykk. 2
,kk2 3
LinkedListNodekk4 B
<kkB C
	CacheItemkkC L
>kkL M
>kkM N
_cachekkO U
;kkU V
privatepp 
readonlypp 

LinkedListpp #
<pp# $
	CacheItempp$ -
>pp- .
_lruListpp/ 7
;pp7 8
privateuu 
readonlyuu 
objectuu 
_lockuu  %
=uu& '
newuu( +
objectuu, 2
(uu2 3
)uu3 4
;uu4 5
public
 
LRUCache
 
(
 
int
 
maxSize
 #
)
# $
{
 	
_maxSize
 
=
 
maxSize
 
;
 
_cache
 
=
 
new
 "
ConcurrentDictionary
 -
<
- .
TKey
. 2
,
2 3
LinkedListNode
4 B
<
B C
	CacheItem
C L
>
L M
>
M N
(
N O
)
O P
;
P Q
_lruList
 
=
 
new
 

LinkedList
 %
<
% &
	CacheItem
& /
>
/ 0
(
0 1
)
1 2
;
2 3
}
 	
public
 
bool
 
TryGet
 
(
 
TKey
 
key
  #
,
# $
out
% (
TValue
) /
value
0 5
)
5 6
{
 	
value
 
=
 
default
 
(
 
TValue
 "
)
" #
;
# $
if
 
(
 
_cache
 
.
 
TryGetValue
 "
(
" #
key
# &
,
& '
out
( +
var
, /
node
0 4
)
4 5
)
5 6
{
 
lock
 
(
 
_lock
 
)
 
{
 
_lruList
กก 
.
กก 
Remove
กก #
(
กก# $
node
กก$ (
)
กก( )
;
กก) *
_lruList
ขข 
.
ขข 
AddFirst
ขข %
(
ขข% &
node
ขข& *
)
ขข* +
;
ขข+ ,
}
ฃฃ 
value
ฆฆ 
=
ฆฆ 
node
ฆฆ 
.
ฆฆ 
Value
ฆฆ "
.
ฆฆ" #
Value
ฆฆ# (
;
ฆฆ( )
return
งง 
true
งง 
;
งง 
}
จจ 
return
ซซ 
false
ซซ 
;
ซซ 
}
ฌฌ 	
public
ถถ 
void
ถถ 
Add
ถถ 
(
ถถ 
TKey
ถถ 
key
ถถ  
,
ถถ  !
TValue
ถถ" (
value
ถถ) .
)
ถถ. /
{
ทท 	
lock
ธธ 
(
ธธ 
_lock
ธธ 
)
ธธ 
{
นน 
if
ปป 
(
ปป 
_cache
ปป 
.
ปป 
TryGetValue
ปป &
(
ปป& '
key
ปป' *
,
ปป* +
out
ปป, /
var
ปป0 3
existingNode
ปป4 @
)
ปป@ A
)
ปปA B
{
ผผ 
existingNode
พพ  
.
พพ  !
Value
พพ! &
.
พพ& '
Value
พพ' ,
=
พพ- .
value
พพ/ 4
;
พพ4 5
_lruList
มม 
.
มม 
Remove
มม #
(
มม# $
existingNode
มม$ 0
)
มม0 1
;
มม1 2
_lruList
ยย 
.
ยย 
AddFirst
ยย %
(
ยย% &
existingNode
ยย& 2
)
ยย2 3
;
ยย3 4
}
รร 
else
ฤฤ 
{
ลล 
var
วว 
newNode
วว 
=
วว  !
new
วว" %
LinkedListNode
วว& 4
<
วว4 5
	CacheItem
วว5 >
>
วว> ?
(
วว? @
new
ศศ 
	CacheItem
ศศ %
{
ศศ& '
Key
ศศ( +
=
ศศ, -
key
ศศ. 1
,
ศศ1 2
Value
ศศ3 8
=
ศศ9 :
value
ศศ; @
}
ศศA B
)
ษษ 
;
ษษ 
if
ฬฬ 
(
ฬฬ 
_cache
ฬฬ 
.
ฬฬ 
Count
ฬฬ $
>=
ฬฬ% '
_maxSize
ฬฬ( 0
)
ฬฬ0 1
{
ออ 
var
ฯฯ 
lastNode
ฯฯ $
=
ฯฯ% &
_lruList
ฯฯ' /
.
ฯฯ/ 0
Last
ฯฯ0 4
;
ฯฯ4 5
if
ะะ 
(
ะะ 
lastNode
ะะ $
!=
ะะ% '
null
ะะ( ,
)
ะะ, -
{
ัั 
_lruList
ำำ $
.
ำำ$ %

RemoveLast
ำำ% /
(
ำำ/ 0
)
ำำ0 1
;
ำำ1 2
_cache
ิิ "
.
ิิ" #
	TryRemove
ิิ# ,
(
ิิ, -
lastNode
ิิ- 5
.
ิิ5 6
Value
ิิ6 ;
.
ิิ; <
Key
ิิ< ?
,
ิิ? @
out
ิิA D
_
ิิE F
)
ิิF G
;
ิิG H
}
ีี 
}
ึึ 
_lruList
ูู 
.
ูู 
AddFirst
ูู %
(
ูู% &
newNode
ูู& -
)
ูู- .
;
ูู. /
_cache
ฺฺ 
[
ฺฺ 
key
ฺฺ 
]
ฺฺ 
=
ฺฺ  !
newNode
ฺฺ" )
;
ฺฺ) *
}
 
}
 
}
 	
public
ไไ 
void
ไไ 
Clear
ไไ 
(
ไไ 
)
ไไ 
{
ๅๅ 	
lock
ๆๆ 
(
ๆๆ 
_lock
ๆๆ 
)
ๆๆ 
{
็็ 
_cache
่่ 
.
่่ 
Clear
่่ 
(
่่ 
)
่่ 
;
่่ 
_lruList
้้ 
.
้้ 
Clear
้้ 
(
้้ 
)
้้  
;
้้  !
}
๊๊ 
}
๋๋ 	
public
๖๖ 
int
๖๖ 
Count
๖๖ 
=>
๖๖ 
_cache
๖๖ "
.
๖๖" #
Count
๖๖# (
;
๖๖( )
public
 
int
 
MaxSize
 
=>
 
_maxSize
 &
;
& '
private
 
class
 
	CacheItem
 
{
 	
public
 
TKey
 
Key
 
{
 
get
 !
;
! "
set
# &
;
& '
}
( )
public
 
TValue
 
Value
 
{
  !
get
" %
;
% &
set
' *
;
* +
}
, -
}
 	
}
าา 
}ำำ ถ
CC:\Playnite\_github\OstPlayer\source\Utils\Performance\LazyAsync.cs
	namespaceII 	
	OstPlayerII
 
.II 
UtilsII 
.II 
PerformanceII %
{II& '
publicQQ 

classQQ 
	LazyAsyncQQ 
<QQ 
TQQ 
>QQ 
{QQ 
privateWW 
readonlyWW 
FuncWW 
<WW 
TaskWW "
<WW" #
TWW# $
>WW$ %
>WW% &
_factoryWW' /
;WW/ 0
private\\ 
readonly\\ 
object\\ 
_lock\\  %
=\\& '
new\\( +
object\\, 2
(\\2 3
)\\3 4
;\\4 5
privateaa 
Taskaa 
<aa 
Taa 
>aa 
_taskaa 
;aa 
publicmm 
	LazyAsyncmm 
(mm 
Funcmm 
<mm 
Taskmm "
<mm" #
Tmm# $
>mm$ %
>mm% &
factorymm' .
)mm. /
{mm0 1
_factorynn 
=nn 
factorynn 
??nn !
thrownn" '
newnn( +!
ArgumentNullExceptionnn, A
(nnA B
nameofnnB H
(nnH I
factorynnI P
)nnP Q
)nnQ R
;nnR S
}oo 	
public{{ 
Task{{ 
<{{ 
T{{ 
>{{ 
Value{{ 
{{{ 
get|| 
{|| 
if 
( 
_task 
!= 
null !
)! "
return
 
_task
  
;
  !
lock
 
(
 
_lock
 
)
 
{
 
if
 
(
 
_task
 
==
  
null
! %
)
% &
{
' (
_task
 
=
 
_factory
  (
(
( )
)
) *
;
* +
}
 
return
 
_task
  
;
  !
}
 
}
 
}
 	
public
 
bool
 
IsValueCreated
 "
=>
# %
_task
& +
!=
, .
null
/ 3
&&
4 6
_task
7 <
.
< =
IsCompleted
= H
;
H I
}
ฤฤ 
}ลล $
CC:\Playnite\_github\OstPlayer\source\Utils\Performance\Debouncer.cs
	namespaceVV 	
	OstPlayerVV
 
.VV 
UtilsVV 
.VV 
PerformanceVV %
{VV& '
public]] 

class]] 
	Debouncer]] 
:]] 
IDisposable]] (
{]]) *
privatecc 
readonlycc 
intcc 
_delayMscc %
;cc% &
privatehh 
Timerhh 
_timerhh 
;hh 
privatell 
readonlyll 
objectll 
_lockll  %
=ll& '
newll( +
objectll, 2
(ll2 3
)ll3 4
;ll4 5
privateoo 
booloo 
	_disposedoo 
=oo  
falseoo! &
;oo& '
public|| 
	Debouncer|| 
(|| 
int|| 
delayMs|| $
)||$ %
{||& '
if}} 
(}} 
delayMs}} 
<}} 
$num}} 
)}} 
throw~~ 
new~~ '
ArgumentOutOfRangeException~~ 5
(~~5 6
nameof~~6 <
(~~< =
delayMs~~= D
)~~D E
,~~E F
$str~~G c
)~~c d
;~~d e
_delayMs
 
=
 
delayMs
 
;
 
}
 	
public
 
void
 
Debounce
 
(
 
Action
 #
action
$ *
)
* +
{
, -
if
 
(
 
action
 
==
 
null
 
)
 
throw
 
new
 #
ArgumentNullException
 /
(
/ 0
nameof
0 6
(
6 7
action
7 =
)
= >
)
> ?
;
? @
if
 
(
 
	_disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
	Debouncer
9 B
)
B C
)
C D
;
D E
lock
 
(
 
_lock
 
)
 
{
 
_timer
 
?
 
.
 
Dispose
 
(
  
)
  !
;
! "
_timer
 
=
 
new
 
Timer
 "
(
" #
_
 
=>
 
{
 
try
 
{
 
action
กก "
(
กก" #
)
กก# $
;
กก$ %
}
ขข 
catch
ฃฃ 
{
ฃฃ 
}
ฆฆ 
}
งง 
,
งง 
null
จจ 
,
จจ 
_delayMs
ฉฉ 
,
ฉฉ 
Timeout
ชช 
.
ชช 
Infinite
ชช $
)
ซซ 
;
ซซ 
}
ฌฌ 
}
ญญ 	
public
ดด 
void
ดด 
Cancel
ดด 
(
ดด 
)
ดด 
{
ดด 
if
ตต 
(
ตต 
	_disposed
ตต 
)
ตต 
return
ถถ 
;
ถถ 
lock
ธธ 
(
ธธ 
_lock
ธธ 
)
ธธ 
{
ธธ 
_timer
นน 
?
นน 
.
นน 
Dispose
นน 
(
นน  
)
นน  !
;
นน! "
_timer
บบ 
=
บบ 
null
บบ 
;
บบ 
}
ปป 
}
ผผ 	
public
วว 
void
วว 
Dispose
วว 
(
วว 
)
วว 
{
วว 
Dispose
ศศ 
(
ศศ 
true
ศศ 
)
ศศ 
;
ศศ 
GC
ษษ 
.
ษษ 
SuppressFinalize
ษษ 
(
ษษ  
this
ษษ  $
)
ษษ$ %
;
ษษ% &
}
สส 	
	protected
ะะ 
virtual
ะะ 
void
ะะ 
Dispose
ะะ &
(
ะะ& '
bool
ะะ' +
	disposing
ะะ, 5
)
ะะ5 6
{
ะะ7 8
if
ัั 
(
ัั 
!
ัั 
	_disposed
ัั 
&&
ัั 
	disposing
ัั '
)
ัั' (
{
ัั) *
lock
าา 
(
าา 
_lock
าา 
)
าา 
{
าา 
_timer
ำำ 
?
ำำ 
.
ำำ 
Dispose
ำำ #
(
ำำ# $
)
ำำ$ %
;
ำำ% &
_timer
ิิ 
=
ิิ 
null
ิิ !
;
ิิ! "
}
ีี 
	_disposed
ึึ 
=
ึึ 
true
ึึ  
;
ึึ  !
}
ืื 
}
ุุ 	
}
 
} ฐ
FC:\Playnite\_github\OstPlayer\source\Utils\PerformanceOptimizations.cs
	namespace>> 	
	OstPlayer>>
 
.>> 
Utils>> 
{?? 
}cc ๛ั
BC:\Playnite\_github\OstPlayer\source\Utils\MusicPlaybackService.cs
	namespacett 	
	OstPlayertt
 
.tt 
Utilstt 
{uu 
public|| 

class||  
MusicPlaybackService|| %
:||& '
IDisposable||( 3
{}} 
private 
IWavePlayer 
waveOut #
;# $
private
 
AudioFileReader
 
audioFileReader
  /
;
/ 0
private
 
readonly
 
DispatcherTimer
 (
progressTimer
) 6
;
6 7
private
 
readonly
 "
ErrorHandlingService
 -
errorHandler
. :
;
: ;
private
 
bool
 
isPaused
 
=
 
false
  %
;
% &
private
 
bool
 
	isPlaying
 
=
  
false
! &
;
& '
private
 
bool
 
isManualStop
 !
=
" #
false
$ )
;
) *
private
กก 
bool
กก &
isStoppingForTrackChange
กก -
=
กก. /
false
กก0 5
;
กก5 6
private
ฆฆ 
bool
ฆฆ 
isUserDragging
ฆฆ #
=
ฆฆ$ %
false
ฆฆ& +
;
ฆฆ+ ,
private
ฌฌ 
double
ฌฌ 
volume
ฌฌ 
=
ฌฌ 
$num
ฌฌ  #
;
ฌฌ# $
private
ฑฑ 
string
ฑฑ 
currentFilePath
ฑฑ &
=
ฑฑ' (
null
ฑฑ) -
;
ฑฑ- .
public
ดด 
event
ดด 
EventHandler
ดด !
PlaybackStopped
ดด" 1
;
ดด1 2
public
ถถ 
event
ถถ 
EventHandler
ถถ !
PlaybackStarted
ถถ" 1
;
ถถ1 2
public
ธธ 
event
ธธ 
EventHandler
ธธ !
PlaybackPaused
ธธ" 0
;
ธธ0 1
public
บบ 
event
บบ 
EventHandler
บบ !
<
บบ! "
double
บบ" (
>
บบ( )
PositionChanged
บบ* 9
;
บบ9 :
public
ผผ 
event
ผผ 
EventHandler
ผผ !
<
ผผ! "
double
ผผ" (
>
ผผ( )
DurationChanged
ผผ* 9
;
ผผ9 :
public
พพ 
event
พพ 
EventHandler
พพ !
PlaybackEnded
พพ" /
;
พพ/ 0
public
ฤฤ "
MusicPlaybackService
ฤฤ #
(
ฤฤ# $
)
ฤฤ$ %
{
ลล 	
errorHandler
ฦฦ 
=
ฦฦ 
new
ฦฦ "
ErrorHandlingService
ฦฦ 3
(
ฦฦ3 4
)
ฦฦ4 5
;
ฦฦ5 6
progressTimer
ศศ 
=
ศศ 
new
ศศ 
DispatcherTimer
ศศ  /
(
ศศ/ 0
)
ศศ0 1
;
ศศ1 2
progressTimer
ษษ 
.
ษษ 
Interval
ษษ "
=
ษษ# $
TimeSpan
ษษ% -
.
ษษ- .
FromMilliseconds
ษษ. >
(
ษษ> ?
$num
ษษ? B
)
ษษB C
;
ษษC D
progressTimer
สส 
.
สส 
Tick
สส 
+=
สส ! 
ProgressTimer_Tick
สส" 4
;
สส4 5
}
หห 	
public
ำำ 
void
ำำ 
Play
ำำ 
(
ำำ 
string
ำำ 
filePath
ำำ  (
,
ำำ( )
double
ำำ* 0
?
ำำ0 1
startPosition
ำำ2 ?
=
ำำ@ A
null
ำำB F
)
ำำF G
{
ิิ 	
_
ึึ 
=
ึึ 
	PlayAsync
ึึ 
(
ึึ 
filePath
ึึ "
,
ึึ" #
startPosition
ึึ$ 1
)
ึึ1 2
;
ึึ2 3
}
ืื 	
public
โโ 
async
โโ 
Task
โโ 
	PlayAsync
โโ #
(
โโ# $
string
โโ$ *
filePath
โโ+ 3
,
โโ3 4
double
โโ5 ;
?
โโ; <
startPosition
โโ= J
=
โโK L
null
โโM Q
)
โโQ R
{
ใใ 	
if
ไไ 
(
ไไ 
string
ไไ 
.
ไไ 
IsNullOrEmpty
ไไ $
(
ไไ$ %
filePath
ไไ% -
)
ไไ- .
)
ไไ. /
return
ๅๅ 
;
ๅๅ 
try
็็ 
{
่่ 
if
์์ 
(
์์ 
isPaused
์์ 
&&
์์ 
waveOut
์์  '
!=
์์( *
null
์์+ /
&&
์์0 2
filePath
์์3 ;
==
์์< >
currentFilePath
์์? N
)
์์N O
{
ํํ 
try
๏๏ 
{
๐๐ 
if
๑๑ 
(
๑๑ 
startPosition
๑๑ )
.
๑๑) *
HasValue
๑๑* 2
&&
๑๑3 5
audioFileReader
๑๑6 E
!=
๑๑F H
null
๑๑I M
)
๑๑M N
{
๒๒ 
var
๕๕ 
validatedPosition
๕๕  1
=
๕๕2 3"
ValidateSeekPosition
๕๕4 H
(
๕๕H I
startPosition
๕๕I V
.
๕๕V W
Value
๕๕W \
)
๕๕\ ]
;
๕๕] ^
audioFileReader
๖๖ +
.
๖๖+ ,
CurrentTime
๖๖, 7
=
๖๖8 9
TimeSpan
๖๖: B
.
๖๖B C
FromSeconds
๖๖C N
(
๖๖N O
validatedPosition
๖๖O `
)
๖๖` a
;
๖๖a b
}
๗๗ 
waveOut
๚๚ 
.
๚๚  
Play
๚๚  $
(
๚๚$ %
)
๚๚% &
;
๚๚& '
isPaused
๛๛  
=
๛๛! "
false
๛๛# (
;
๛๛( )
	isPlaying
 !
=
" #
true
$ (
;
( )
isManualStop
 $
=
% &
false
' ,
;
, -
progressTimer
 %
.
% &
Start
& +
(
+ ,
)
, -
;
- .
PlaybackStarted
 '
?
' (
.
( )
Invoke
) /
(
/ 0
this
0 4
,
4 5
	EventArgs
6 ?
.
? @
Empty
@ E
)
E F
;
F G
return
 
;
 
}
 
catch
 
(
 
	Exception
 $
ex
% '
)
' (
{
 
errorHandler
 $
.
$ %!
HandlePlaybackError
% 8
(
8 9
ex
9 ;
,
; <
filePath
= E
)
E F
;
F G
return
 
;
 
}
 
}
 
if
 
(
 
waveOut
 
!=
 
null
 #
||
$ &
audioFileReader
' 6
!=
7 9
null
: >
)
> ?
{
 &
isStoppingForTrackChange
 ,
=
- .
true
/ 3
;
3 4
Stop
 
(
 
true
 
)
 
;
 &
isStoppingForTrackChange
 ,
=
- .
false
/ 4
;
4 5
}
 
if
 
(
 
!
 
System
 
.
 
IO
 
.
 
File
 #
.
# $
Exists
$ *
(
* +
filePath
+ 3
)
3 4
)
4 5
{
 
errorHandler
  
.
  !!
HandlePlaybackError
! 4
(
4 5
new
 
System
 "
.
" #
IO
# %
.
% &#
FileNotFoundException
& ;
(
; <
$str
< S
)
S T
,
T U
filePath
  
)
 
;
 
return
 
;
 
}
 
await
 
Task
 
.
 
Delay
  
(
  !
$num
! #
)
# $
;
$ %
try
ขข 
{
ฃฃ 
audioFileReader
ฆฆ #
=
ฆฆ$ %
new
ฆฆ& )
AudioFileReader
ฆฆ* 9
(
ฆฆ9 :
filePath
ฆฆ: B
)
ฆฆB C
;
ฆฆC D
audioFileReader
งง #
.
งง# $
Volume
งง$ *
=
งง+ ,
(
งง- .
float
งง. 3
)
งง3 4
volume
งง4 :
;
งง: ;
if
ซซ 
(
ซซ 
startPosition
ซซ %
.
ซซ% &
HasValue
ซซ& .
)
ซซ. /
{
ฌฌ 
var
ญญ 
validatedPosition
ญญ -
=
ญญ. /"
ValidateSeekPosition
ญญ0 D
(
ญญD E
startPosition
ญญE R
.
ญญR S
Value
ญญS X
)
ญญX Y
;
ญญY Z
audioFileReader
ฎฎ '
.
ฎฎ' (
CurrentTime
ฎฎ( 3
=
ฎฎ4 5
TimeSpan
ฎฎ6 >
.
ฎฎ> ?
FromSeconds
ฎฎ? J
(
ฎฎJ K
validatedPosition
ฎฎK \
)
ฎฎ\ ]
;
ฎฎ] ^
}
ฏฏ 
waveOut
ณณ 
=
ณณ 
new
ณณ !
WaveOutEvent
ณณ" .
(
ณณ. /
)
ณณ/ 0
;
ณณ0 1
waveOut
ดด 
.
ดด 
Init
ดด  
(
ดด  !
audioFileReader
ดด! 0
)
ดด0 1
;
ดด1 2
waveOut
ตต 
.
ตต 
PlaybackStopped
ตต +
+=
ตต, .%
WaveOut_PlaybackStopped
ตต/ F
;
ตตF G
waveOut
ถถ 
.
ถถ 
Play
ถถ  
(
ถถ  !
)
ถถ! "
;
ถถ" #
currentFilePath
นน #
=
นน$ %
filePath
นน& .
;
นน. /
	isPlaying
บบ 
=
บบ 
true
บบ  $
;
บบ$ %
isPaused
ปป 
=
ปป 
false
ปป $
;
ปป$ %
isManualStop
ผผ  
=
ผผ! "
false
ผผ# (
;
ผผ( )
progressTimer
ฝฝ !
.
ฝฝ! "
Start
ฝฝ" '
(
ฝฝ' (
)
ฝฝ( )
;
ฝฝ) *
DurationChanged
ภภ #
?
ภภ# $
.
ภภ$ %
Invoke
ภภ% +
(
ภภ+ ,
this
ภภ, 0
,
ภภ0 1
audioFileReader
ภภ2 A
.
ภภA B
	TotalTime
ภภB K
.
ภภK L
TotalSeconds
ภภL X
)
ภภX Y
;
ภภY Z
PlaybackStarted
มม #
?
มม# $
.
มม$ %
Invoke
มม% +
(
มม+ ,
this
มม, 0
,
มม0 1
	EventArgs
มม2 ;
.
มม; <
Empty
มม< A
)
มมA B
;
มมB C
}
ยย 
catch
รร 
(
รร 
	Exception
รร  
ex
รร! #
)
รร# $
{
ฤฤ 
CleanupResources
วว $
(
วว$ %
)
วว% &
;
วว& '
errorHandler
ศศ  
.
ศศ  !!
HandlePlaybackError
ศศ! 4
(
ศศ4 5
ex
ศศ5 7
,
ศศ7 8
filePath
ศศ9 A
)
ศศA B
;
ศศB C
}
ษษ 
}
สส 
catch
หห 
(
หห 
	Exception
หห 
ex
หห 
)
หห  
{
ฬฬ 
errorHandler
ฮฮ 
.
ฮฮ !
HandlePlaybackError
ฮฮ 0
(
ฮฮ0 1
ex
ฮฮ1 3
,
ฮฮ3 4
filePath
ฮฮ5 =
)
ฮฮ= >
;
ฮฮ> ?
}
ฯฯ 
}
ะะ 	
public
ุุ 
void
ุุ 
Pause
ุุ 
(
ุุ 
)
ุุ 
{
ูู 	
try
ฺฺ 
{
 
if
 
(
 
	isPlaying
 
&&
  
!
! "
isPaused
" *
&&
+ -
waveOut
. 5
!=
6 8
null
9 =
)
= >
{
 
waveOut
 
.
 
Pause
 !
(
! "
)
" #
;
# $
isPaused
฿฿ 
=
฿฿ 
true
฿฿ #
;
฿฿# $
progressTimer
เเ !
.
เเ! "
Stop
เเ" &
(
เเ& '
)
เเ' (
;
เเ( )
PlaybackPaused
แแ "
?
แแ" #
.
แแ# $
Invoke
แแ$ *
(
แแ* +
this
แแ+ /
,
แแ/ 0
	EventArgs
แแ1 :
.
แแ: ;
Empty
แแ; @
)
แแ@ A
;
แแA B
}
โโ 
}
ใใ 
catch
ไไ 
(
ไไ 
	Exception
ไไ 
ex
ไไ 
)
ไไ  
{
ๅๅ 
errorHandler
ๆๆ 
.
ๆๆ !
HandlePlaybackError
ๆๆ 0
(
ๆๆ0 1
ex
ๆๆ1 3
,
ๆๆ3 4
currentFilePath
ๆๆ5 D
??
ๆๆE G
$str
ๆๆH Q
)
ๆๆQ R
;
ๆๆR S
}
็็ 
}
่่ 	
public
๑๑ 
void
๑๑ 
Stop
๑๑ 
(
๑๑ 
bool
๑๑ *
suppressPlaybackStoppedEvent
๑๑ :
=
๑๑; <
false
๑๑= B
)
๑๑B C
{
๒๒ 	
try
๓๓ 
{
๔๔ 
isManualStop
๕๕ 
=
๕๕ 
true
๕๕ #
;
๕๕# $
bool
๖๖ 

wasPlaying
๖๖ 
=
๖๖  !
	isPlaying
๖๖" +
;
๖๖+ ,
CleanupResources
๘๘  
(
๘๘  !
)
๘๘! "
;
๘๘" #
	isPlaying
๛๛ 
=
๛๛ 
false
๛๛ !
;
๛๛! "
isPaused
 
=
 
false
  
;
  !
currentFilePath
 
=
  !
null
" &
;
& '
PositionChanged
 
?
  
.
  !
Invoke
! '
(
' (
this
( ,
,
, -
$num
. /
)
/ 0
;
0 1
if
 
(
 

wasPlaying
 
&&
 !
!
" #*
suppressPlaybackStoppedEvent
# ?
)
? @
{
 
PlaybackStopped
 #
?
# $
.
$ %
Invoke
% +
(
+ ,
this
, 0
,
0 1
	EventArgs
2 ;
.
; <
Empty
< A
)
A B
;
B C
}
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
errorHandler
 
.
 !
HandlePlaybackError
 0
(
0 1
ex
1 3
,
3 4
currentFilePath
5 D
??
E G
$str
H Q
)
Q R
;
R S
}
 
}
 	
private
 
void
 
CleanupResources
 %
(
% &
)
& '
{
 	
try
 
{
 
if
 
(
 
waveOut
 
!=
 
null
 #
)
# $
{
 
try
 
{
 
waveOut
 
.
  
PlaybackStopped
  /
-=
0 2%
WaveOut_PlaybackStopped
3 J
;
J K
waveOut
 
.
  
Stop
  $
(
$ %
)
% &
;
& '
waveOut
 
.
  
Dispose
  '
(
' (
)
( )
;
) *
}
กก 
catch
ขข 
(
ขข 
	Exception
ขข $
ex
ขข% '
)
ขข' (
{
ฃฃ 
System
ฅฅ 
.
ฅฅ 
Diagnostics
ฅฅ *
.
ฅฅ* +
Debug
ฅฅ+ 0
.
ฅฅ0 1
	WriteLine
ฅฅ1 :
(
ฅฅ: ;
$"
ฅฅ; =
$str
ฅฅ= T
{
ฅฅT U
ex
ฅฅU W
.
ฅฅW X
Message
ฅฅX _
}
ฅฅ_ `
"
ฅฅ` a
)
ฅฅa b
;
ฅฅb c
}
ฆฆ 
finally
งง 
{
จจ 
waveOut
ฉฉ 
=
ฉฉ  !
null
ฉฉ" &
;
ฉฉ& '
}
ชช 
}
ซซ 
if
ฎฎ 
(
ฎฎ 
audioFileReader
ฎฎ #
!=
ฎฎ$ &
null
ฎฎ' +
)
ฎฎ+ ,
{
ฏฏ 
try
ฐฐ 
{
ฑฑ 
audioFileReader
ฒฒ '
.
ฒฒ' (
Dispose
ฒฒ( /
(
ฒฒ/ 0
)
ฒฒ0 1
;
ฒฒ1 2
}
ณณ 
catch
ดด 
(
ดด 
	Exception
ดด $
ex
ดด% '
)
ดด' (
{
ตต 
System
ทท 
.
ทท 
Diagnostics
ทท *
.
ทท* +
Debug
ทท+ 0
.
ทท0 1
	WriteLine
ทท1 :
(
ทท: ;
$"
ธธ 
$str
ธธ =
{
ธธ= >
ex
ธธ> @
.
ธธ@ A
Message
ธธA H
}
ธธH I
"
ธธI J
)
นน 
;
นน 
}
บบ 
finally
ปป 
{
ผผ 
audioFileReader
ฝฝ '
=
ฝฝ( )
null
ฝฝ* .
;
ฝฝ. /
}
พพ 
}
ฟฟ 
progressTimer
มม 
?
มม 
.
มม 
Stop
มม #
(
มม# $
)
มม$ %
;
มม% &
}
ยย 
catch
รร 
(
รร 
	Exception
รร 
ex
รร 
)
รร  
{
ฤฤ 
System
ฦฦ 
.
ฦฦ 
Diagnostics
ฦฦ "
.
ฦฦ" #
Debug
ฦฦ# (
.
ฦฦ( )
	WriteLine
ฦฦ) 2
(
ฦฦ2 3
$"
ฦฦ3 5
$str
ฦฦ5 D
{
ฦฦD E
ex
ฦฦE G
.
ฦฦG H
Message
ฦฦH O
}
ฦฦO P
"
ฦฦP Q
)
ฦฦQ R
;
ฦฦR S
}
วว 
}
ศศ 	
public
ัั 
void
ัั 
	SetVolume
ัั 
(
ัั 
double
ัั $
value
ัั% *
)
ัั* +
{
าา 	
try
ำำ 
{
ิิ 
volume
ีี 
=
ีี 
value
ีี 
;
ีี 
if
ุุ 
(
ุุ 
audioFileReader
ุุ #
!=
ุุ$ &
null
ุุ' +
)
ุุ+ ,
{
ูู 
audioFileReader
ฺฺ #
.
ฺฺ# $
Volume
ฺฺ$ *
=
ฺฺ+ ,
(
ฺฺ- .
float
ฺฺ. 3
)
ฺฺ3 4
volume
ฺฺ4 :
;
ฺฺ: ;
}
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
errorHandler
฿฿ 
.
฿฿ !
HandlePlaybackError
฿฿ 0
(
฿฿0 1
ex
฿฿1 3
,
฿฿3 4
currentFilePath
฿฿5 D
??
฿฿E G
$str
฿฿H Q
)
฿฿Q R
;
฿฿R S
}
เเ 
}
แแ 	
public
่่ 
double
่่ 
	GetVolume
่่ 
(
่่  
)
่่  !
=>
่่" $
volume
่่% +
;
่่+ ,
public
๐๐ 
double
๐๐ 
GetPosition
๐๐ !
(
๐๐! "
)
๐๐" #
{
๑๑ 	
try
๒๒ 
{
๓๓ 
return
๔๔ 
audioFileReader
๔๔ &
?
๔๔& '
.
๔๔' (
CurrentTime
๔๔( 3
.
๔๔3 4
TotalSeconds
๔๔4 @
??
๔๔A C
$num
๔๔D E
;
๔๔E F
}
๕๕ 
catch
๖๖ 
(
๖๖ 
	Exception
๖๖ 
)
๖๖ 
{
๗๗ 
return
๙๙ 
$num
๙๙ 
;
๙๙ 
}
๚๚ 
}
๛๛ 	
public
 
double
 
GetDuration
 !
(
! "
)
" #
{
 	
try
 
{
 
return
 
audioFileReader
 &
?
& '
.
' (
	TotalTime
( 1
.
1 2
TotalSeconds
2 >
??
? A
$num
B C
;
C D
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
$num
 
;
 
}
 
}
 	
public
 
void
 
SetPosition
 
(
  
double
  &
seconds
' .
)
. /
{
 	
try
 
{
 
if
 
(
 
audioFileReader
 #
!=
$ &
null
' +
)
+ ,
{
 
var
 
validatedPosition
 )
=
* +"
ValidateSeekPosition
, @
(
@ A
seconds
A H
)
H I
;
I J
audioFileReader
 #
.
# $
CurrentTime
$ /
=
0 1
TimeSpan
2 :
.
: ;
FromSeconds
; F
(
F G
validatedPosition
G X
)
X Y
;
Y Z
PositionChanged
ขข #
?
ขข# $
.
ขข$ %
Invoke
ขข% +
(
ขข+ ,
this
ขข, 0
,
ขข0 1
validatedPosition
ขข2 C
)
ขขC D
;
ขขD E
}
ฃฃ 
}
คค 
catch
ฅฅ 
(
ฅฅ 
	Exception
ฅฅ 
ex
ฅฅ 
)
ฅฅ  
{
ฆฆ 
errorHandler
งง 
.
งง !
HandlePlaybackError
งง 0
(
งง0 1
ex
งง1 3
,
งง3 4
currentFilePath
งง5 D
??
งงE G
$str
งงH Q
)
งงQ R
;
งงR S
}
จจ 
}
ฉฉ 	
private
ณณ 
double
ณณ "
ValidateSeekPosition
ณณ +
(
ณณ+ ,
double
ณณ, 2
requestedPosition
ณณ3 D
)
ณณD E
{
ดด 	
if
ตต 
(
ตต 
audioFileReader
ตต 
==
ตต  "
null
ตต# '
)
ตต' (
return
ถถ 
$num
ถถ 
;
ถถ 
var
ธธ 
duration
ธธ 
=
ธธ 
audioFileReader
ธธ *
.
ธธ* +
	TotalTime
ธธ+ 4
.
ธธ4 5
TotalSeconds
ธธ5 A
;
ธธA B
if
ปป 
(
ปป 
requestedPosition
ปป !
<
ปป" #
$num
ปป$ %
)
ปป% &
return
ผผ 
$num
ผผ 
;
ผผ 
const
ภภ 
double
ภภ 
	endBuffer
ภภ "
=
ภภ# $
$num
ภภ% (
;
ภภ( )
var
มม 
maxValidPosition
มม  
=
มม! "
Math
มม# '
.
มม' (
Max
มม( +
(
มม+ ,
$num
มม, -
,
มม- .
duration
มม/ 7
-
มม8 9
	endBuffer
มม: C
)
มมC D
;
มมD E
if
ฤฤ 
(
ฤฤ 
requestedPosition
ฤฤ !
>=
ฤฤ" $
maxValidPosition
ฤฤ% 5
&&
ฤฤ6 8
duration
ฤฤ9 A
>
ฤฤB C
	endBuffer
ฤฤD M
)
ฤฤM N
{
ลล 
return
ฦฦ 
maxValidPosition
ฦฦ '
;
ฦฦ' (
}
วว 
return
ษษ 
requestedPosition
ษษ $
;
ษษ$ %
}
สส 	
public
ำำ 
void
ำำ 
SetUserDragging
ำำ #
(
ำำ# $
bool
ำำ$ (
dragging
ำำ) 1
)
ำำ1 2
{
ิิ 	
isUserDragging
ีี 
=
ีี 
dragging
ีี %
;
ีี% &
}
ึึ 	
private
 
void
  
ProgressTimer_Tick
 '
(
' (
object
( .
sender
/ 5
,
5 6
	EventArgs
7 @
e
A B
)
B C
{
฿฿ 	
try
เเ 
{
แแ 
if
โโ 
(
โโ 
audioFileReader
โโ #
!=
โโ$ &
null
โโ' +
&&
โโ, .
waveOut
โโ/ 6
!=
โโ7 9
null
โโ: >
&&
โโ? A
!
โโB C
isUserDragging
โโC Q
)
โโQ R
{
ใใ 
PositionChanged
ไไ #
?
ไไ# $
.
ไไ$ %
Invoke
ไไ% +
(
ไไ+ ,
this
ไไ, 0
,
ไไ0 1
audioFileReader
ไไ2 A
.
ไไA B
CurrentTime
ไไB M
.
ไไM N
TotalSeconds
ไไN Z
)
ไไZ [
;
ไไ[ \
}
ๅๅ 
}
ๆๆ 
catch
็็ 
(
็็ 
	Exception
็็ 
)
็็ 
{
่่ 
}
๋๋ 
}
์์ 	
private
๔๔ 
void
๔๔ %
WaveOut_PlaybackStopped
๔๔ ,
(
๔๔, -
object
๔๔- 3
sender
๔๔4 :
,
๔๔: ;
StoppedEventArgs
๔๔< L
e
๔๔M N
)
๔๔N O
{
๕๕ 	
try
๖๖ 
{
๗๗ 
if
๙๙ 
(
๙๙ 
e
๙๙ 
.
๙๙ 
	Exception
๙๙ 
!=
๙๙  "
null
๙๙# '
)
๙๙' (
{
๚๚ 
errorHandler
๛๛  
.
๛๛  !!
HandlePlaybackError
๛๛! 4
(
๛๛4 5
e
๛๛5 6
.
๛๛6 7
	Exception
๛๛7 @
,
๛๛@ A
currentFilePath
๛๛B Q
??
๛๛R T
$str
๛๛U ^
)
๛๛^ _
;
๛๛_ `
return
 
;
 
}
 
bool
 
wasManualStop
 "
=
# $
isManualStop
% 1
;
1 2
bool
 '
wasStoppingForTrackChange
 .
=
/ 0&
isStoppingForTrackChange
1 I
;
I J
bool
 

wasPlaying
 
=
  !
	isPlaying
" +
;
+ ,
isManualStop
 
=
 
false
 $
;
$ %
if
 
(
 
wasManualStop
 !
||
" $'
wasStoppingForTrackChange
% >
||
? A
!
B C

wasPlaying
C M
)
M N
{
 
return
 
;
 
}
 
CleanupResources
  
(
  !
)
! "
;
" #
	isPlaying
 
=
 
false
 !
;
! "
isPaused
 
=
 
false
  
;
  !
currentFilePath
 
=
  !
null
" &
;
& '
PositionChanged
 
?
  
.
  !
Invoke
! '
(
' (
this
( ,
,
, -
$num
. /
)
/ 0
;
0 1
PlaybackEnded
 
?
 
.
 
Invoke
 %
(
% &
this
& *
,
* +
	EventArgs
, 5
.
5 6
Empty
6 ;
)
; <
;
< =
}
กก 
catch
ขข 
(
ขข 
	Exception
ขข 
ex
ขข 
)
ขข  
{
ฃฃ 
errorHandler
คค 
.
คค !
HandlePlaybackError
คค 0
(
คค0 1
ex
คค1 3
,
คค3 4
currentFilePath
คค5 D
??
คคE G
$str
คคH Q
)
คคQ R
;
คคR S
}
ฅฅ 
}
ฆฆ 	
public
ฎฎ 
void
ฎฎ 
Dispose
ฎฎ 
(
ฎฎ 
)
ฎฎ 
{
ฏฏ 	
try
ฐฐ 
{
ฑฑ 
Stop
ฒฒ 
(
ฒฒ 
)
ฒฒ 
;
ฒฒ 
progressTimer
ณณ 
.
ณณ 
Tick
ณณ "
-=
ณณ# % 
ProgressTimer_Tick
ณณ& 8
;
ณณ8 9
}
ดด 
catch
ตต 
(
ตต 
	Exception
ตต 
)
ตต 
{
ถถ 
}
ธธ 
}
นน 	
}
บบ 
}ปป ห
=C:\Playnite\_github\OstPlayer\source\Utils\MusicFileHelper.cs
	namespace`` 	
	OstPlayer``
 
.`` 
Utils`` 
{`` 
publicgg 

staticgg 
classgg 
MusicFileHelpergg '
{gg( )
publicss 
staticss 
stringss 
GetGameMusicPathss -
(ss- .
IPlayniteAPIss. :
apiss; >
,ss> ?
Gamess@ D
gamessE I
)ssI J
{ssK L
ifuu 
(uu 
gameuu 
==uu 
nulluu 
)uu 
returnvv 
nullvv 
;vv 
var{{ 
extraMetadataPath{{ !
={{" #
Path{{$ (
.{{( )
Combine{{) 0
({{0 1
api{{1 4
.{{4 5
Paths{{5 :
.{{: ;
ConfigurationPath{{; L
,{{L M
$str{{N ]
){{] ^
;{{^ _
var|| 
gameMusicPath|| 
=|| 
Path||  $
.||$ %
Combine||% ,
(||, -
extraMetadataPath}} !
,}}! "
$str~~ 
,~~ 
game 
. 
Id 
. 
ToString  
(  !
)! "
," #
$str
 
)
 
;
 
return
 
	Directory
 
.
 
Exists
 #
(
# $
gameMusicPath
$ 1
)
1 2
?
3 4
gameMusicPath
5 B
:
C D
null
E I
;
I J
}
 	
public
 
static
 
List
 
<
 
string
 !
>
! "
GetGameMusicFiles
# 4
(
4 5
IPlayniteAPI
5 A
api
B E
,
E F
Game
G K
game
L P
)
P Q
{
R S
var
 
	musicPath
 
=
 
GetGameMusicPath
 ,
(
, -
api
- 0
,
0 1
game
2 6
)
6 7
;
7 8
if
 
(
 
string
 
.
 
IsNullOrEmpty
 $
(
$ %
	musicPath
% .
)
. /
)
/ 0
return
 
new
 
List
 
<
  
string
  &
>
& '
(
' (
)
( )
;
) *
try
 
{
 
var
 
files
 
=
 
	Directory
 %
.
% &
GetFiles
& .
(
. /
	musicPath
/ 8
,
8 9
$str
: A
,
A B
SearchOption
C O
.
O P
TopDirectoryOnly
P `
)
` a
;
a b
return
ฆฆ 
files
ฆฆ 
.
งง 
OrderBy
งง 
(
งง 
f
งง 
=>
งง !
Path
งง" &
.
งง& ')
GetFileNameWithoutExtension
งง' B
(
งงB C
f
งงC D
)
งงD E
)
งงE F
.
จจ 
ToList
จจ 
(
จจ 
)
จจ 
;
จจ 
}
ฉฉ 
catch
ชช 
(
ชช 
	Exception
ชช 
)
ชช 
{
ชช 
return
ถถ 
new
ถถ 
List
ถถ 
<
ถถ  
string
ถถ  &
>
ถถ& '
(
ถถ' (
)
ถถ( )
;
ถถ) *
}
ทท 
}
ธธ 	
}
 
}กก ีn
BC:\Playnite\_github\OstPlayer\source\Utils\Helpers\VolumeHelper.cs
	namespace== 	
	OstPlayer==
 
.== 
Utils== 
.== 
Helpers== !
{==" #
publicEE 

staticEE 
classEE 
VolumeHelperEE $
{EE% &
publicKK 
constKK 
doubleKK 
	MinVolumeKK %
=KK& '
$numKK( +
;KK+ ,
publicPP 
constPP 
doublePP 
	MaxVolumePP %
=PP& '
$numPP( -
;PP- .
publicUU 
constUU 
doubleUU 
DefaultVolumeUU )
=UU* +
$numUU, 0
;UU0 1
publicZZ 
constZZ 
doubleZZ 

VolumeStepZZ &
=ZZ' (
$numZZ) ,
;ZZ, -
publickk 
statickk 
stringkk 
FormatPercentagekk -
(kk- .
doublekk. 4
volumekk5 ;
)kk; <
{kk= >
varll 
clampedVolumell 
=ll 
ClampVolumell  +
(ll+ ,
volumell, 2
)ll2 3
;ll3 4
returnmm 
$"mm 
{mm 
(mm 
intmm 
)mm 
Mathmm 
.mm  
Roundmm  %
(mm% &
clampedVolumemm& 3
)mm3 4
}mm4 5
$strmm5 6
"mm6 7
;mm7 8
}nn 	
publicvv 
staticvv 
stringvv !
FormatPercentageValuevv 2
(vv2 3
doublevv3 9
volumevv: @
)vv@ A
{vvB C
varww 
clampedVolumeww 
=ww 
ClampVolumeww  +
(ww+ ,
volumeww, 2
)ww2 3
;ww3 4
returnxx 
$"xx 
{xx 
(xx 
intxx 
)xx 
Mathxx 
.xx  
Roundxx  %
(xx% &
clampedVolumexx& 3
)xx3 4
}xx4 5
"xx5 6
;xx6 7
}yy 	
public
 
static
 
string
 
FormatPrecise
 *
(
* +
double
+ 1
volume
2 8
,
8 9
int
: =
decimalPlaces
> K
=
L M
$num
N O
)
O P
{
Q R
var
 
clampedVolume
 
=
 
ClampVolume
  +
(
+ ,
volume
, 2
)
2 3
;
3 4
var
 
format
 
=
 
$"
 
$str
 
{
 
Math
 !
.
! "
Max
" %
(
% &
$num
& '
,
' (
Math
) -
.
- .
Min
. 1
(
1 2
$num
2 4
,
4 5
decimalPlaces
6 C
)
C D
)
D E
}
E F
"
F G
;
G H
return
 
$"
 
{
 
clampedVolume
 #
.
# $
ToString
$ ,
(
, -
format
- 3
)
3 4
}
4 5
$str
5 6
"
6 7
;
7 8
}
 	
public
 
static
 
double
 
ClampVolume
 (
(
( )
double
) /
volume
0 6
)
6 7
{
8 9
if
 
(
 
double
 
.
 
IsNaN
 
(
 
volume
 #
)
# $
||
% '
double
( .
.
. /

IsInfinity
/ 9
(
9 :
volume
: @
)
@ A
)
A B
return
 
DefaultVolume
 $
;
$ %
return
 
Math
 
.
 
Max
 
(
 
	MinVolume
 %
,
% &
Math
' +
.
+ ,
Min
, /
(
/ 0
	MaxVolume
0 9
,
9 :
volume
; A
)
A B
)
B C
;
C D
}
 	
public
ฆฆ 
static
ฆฆ 
bool
ฆฆ 
IsValidVolume
ฆฆ (
(
ฆฆ( )
double
ฆฆ) /
volume
ฆฆ0 6
)
ฆฆ6 7
{
ฆฆ8 9
return
งง 
!
งง 
double
งง 
.
งง 
IsNaN
งง  
(
งง  !
volume
งง! '
)
งง' (
&&
งง) +
!
จจ 
double
จจ 
.
จจ 

IsInfinity
จจ %
(
จจ% &
volume
จจ& ,
)
จจ, -
&&
จจ. 0
volume
ฉฉ 
>=
ฉฉ 
	MinVolume
ฉฉ &
&&
ฉฉ' )
volume
ชช 
<=
ชช 
	MaxVolume
ชช &
;
ชช& '
}
ซซ 	
public
ดด 
static
ดด 
double
ดด 
RoundToStep
ดด (
(
ดด( )
double
ดด) /
volume
ดด0 6
,
ดด6 7
double
ดด8 >
stepSize
ดด? G
=
ดดH I

VolumeStep
ดดJ T
)
ดดT U
{
ดดV W
var
ตต 
clampedVolume
ตต 
=
ตต 
ClampVolume
ตต  +
(
ตต+ ,
volume
ตต, 2
)
ตต2 3
;
ตต3 4
var
ถถ 
validStepSize
ถถ 
=
ถถ 
Math
ถถ  $
.
ถถ$ %
Max
ถถ% (
(
ถถ( )
$num
ถถ) ,
,
ถถ, -
Math
ถถ. 2
.
ถถ2 3
Min
ถถ3 6
(
ถถ6 7
$num
ถถ7 ;
,
ถถ; <
stepSize
ถถ= E
)
ถถE F
)
ถถF G
;
ถถG H
return
ธธ 
Math
ธธ 
.
ธธ 
Round
ธธ 
(
ธธ 
clampedVolume
ธธ +
/
ธธ, -
validStepSize
ธธ. ;
)
ธธ; <
*
ธธ= >
validStepSize
ธธ? L
;
ธธL M
}
นน 	
public
หห 
static
หห 
double
หห $
PercentageToNormalized
หห 3
(
หห3 4
double
หห4 :

percentage
หห; E
)
หหE F
{
หหG H
var
ฬฬ 
clampedPercentage
ฬฬ !
=
ฬฬ" #
ClampVolume
ฬฬ$ /
(
ฬฬ/ 0

percentage
ฬฬ0 :
)
ฬฬ: ;
;
ฬฬ; <
return
ออ 
clampedPercentage
ออ $
/
ออ% &
$num
ออ' ,
;
ออ, -
}
ฮฮ 	
public
 
static
 
double
 $
NormalizedToPercentage
 3
(
3 4
double
4 :

normalized
; E
)
E F
{
G H
if
 
(
 
double
 
.
 
IsNaN
 
(
 

normalized
 '
)
' (
||
) +
double
, 2
.
2 3

IsInfinity
3 =
(
= >

normalized
> H
)
H I
)
I J
return
 
DefaultVolume
 $
;
$ %
var
เเ 
clampedNormalized
เเ !
=
เเ" #
Math
เเ$ (
.
เเ( )
Max
เเ) ,
(
เเ, -
$num
เเ- 0
,
เเ0 1
Math
เเ2 6
.
เเ6 7
Min
เเ7 :
(
เเ: ;
$num
เเ; >
,
เเ> ?

normalized
เเ@ J
)
เเJ K
)
เเK L
;
เเL M
return
แแ 
clampedNormalized
แแ $
*
แแ% &
$num
แแ' ,
;
แแ, -
}
โโ 	
public
๎๎ 
static
๎๎ 
double
๎๎ 
IncreaseVolume
๎๎ +
(
๎๎+ ,
double
๎๎, 2
currentVolume
๎๎3 @
,
๎๎@ A
double
๎๎B H
	increment
๎๎I R
=
๎๎S T

VolumeStep
๎๎U _
)
๎๎_ `
{
๎๎a b
var
๏๏ 
validIncrement
๏๏ 
=
๏๏  
Math
๏๏! %
.
๏๏% &
Max
๏๏& )
(
๏๏) *
$num
๏๏* -
,
๏๏- .
	increment
๏๏/ 8
)
๏๏8 9
;
๏๏9 :
return
๐๐ 
ClampVolume
๐๐ 
(
๐๐ 
currentVolume
๐๐ ,
+
๐๐- .
validIncrement
๐๐/ =
)
๐๐= >
;
๐๐> ?
}
๑๑ 	
public
๙๙ 
static
๙๙ 
double
๙๙ 
DecreaseVolume
๙๙ +
(
๙๙+ ,
double
๙๙, 2
currentVolume
๙๙3 @
,
๙๙@ A
double
๙๙B H
	decrement
๙๙I R
=
๙๙S T

VolumeStep
๙๙U _
)
๙๙_ `
{
๙๙a b
var
๚๚ 
validDecrement
๚๚ 
=
๚๚  
Math
๚๚! %
.
๚๚% &
Max
๚๚& )
(
๚๚) *
$num
๚๚* -
,
๚๚- .
	decrement
๚๚/ 8
)
๚๚8 9
;
๚๚9 :
return
๛๛ 
ClampVolume
๛๛ 
(
๛๛ 
currentVolume
๛๛ ,
-
๛๛- .
validDecrement
๛๛/ =
)
๛๛= >
;
๛๛> ?
}
 	
public
 
static
 
double
 

ToggleMute
 '
(
' (
double
( .
currentVolume
/ <
,
< =
double
> D
previousVolume
E S
=
T U
DefaultVolume
V c
)
c d
{
e f
var
 !
validPreviousVolume
 #
=
$ %
Math
& *
.
* +
Max
+ .
(
. /
$num
/ 2
,
2 3
ClampVolume
4 ?
(
? @
previousVolume
@ N
)
N O
)
O P
;
P Q
if
 
(
 
currentVolume
 
<=
  
$num
! $
)
$ %
{
& '
return
 !
validPreviousVolume
 *
;
* +
}
 
return
 
	MinVolume
 
;
 
}
 	
public
 
static
 
double
 

MuteVolume
 '
=>
( *
	MinVolume
+ 4
;
4 5
public
 
static
 
double
 
	LowVolume
 &
=>
' )
$num
* .
;
. /
public
กก 
static
กก 
double
กก 
MediumVolume
กก )
=>
กก* ,
DefaultVolume
กก- :
;
กก: ;
public
ฆฆ 
static
ฆฆ 
double
ฆฆ 

HighVolume
ฆฆ '
=>
ฆฆ( *
$num
ฆฆ+ /
;
ฆฆ/ 0
public
ซซ 
static
ซซ 
double
ซซ 
MaximumVolume
ซซ *
=>
ซซ+ -
	MaxVolume
ซซ. 7
;
ซซ7 8
public
ฒฒ 
static
ฒฒ 
double
ฒฒ 
[
ฒฒ 
]
ฒฒ 
GetVolumePresets
ฒฒ /
(
ฒฒ/ 0
)
ฒฒ0 1
{
ฒฒ2 3
return
ณณ 
new
ณณ 
double
ณณ 
[
ณณ 
]
ณณ 
{
ดด 

MuteVolume
ตต 
,
ตต 
	LowVolume
ถถ 
,
ถถ 
MediumVolume
ทท 
,
ทท 

HighVolume
ธธ 
,
ธธ 
MaximumVolume
นน 
}
บบ 
;
บบ 
}
ปป 	
public
ยย 
static
ยย 
string
ยย 
GetPresetName
ยย *
(
ยย* +
double
ยย+ 1
volume
ยย2 8
)
ยย8 9
{
ยย: ;
var
รร 
rounded
รร 
=
รร 
Math
รร 
.
รร 
Round
รร $
(
รร$ %
volume
รร% +
)
รร+ ,
;
รร, -
switch
ลล 
(
ลล 
rounded
ลล 
)
ลล 
{
ลล 
case
ฦฦ 
$num
ฦฦ 
:
ฦฦ 
return
ฦฦ 
$str
ฦฦ %
;
ฦฦ% &
case
วว 
$num
วว 
:
วว 
return
วว 
$str
วว  %
;
วว% &
case
ศศ 
$num
ศศ 
:
ศศ 
return
ศศ 
$str
ศศ  (
;
ศศ( )
case
ษษ 
$num
ษษ 
:
ษษ 
return
ษษ 
$str
ษษ  &
;
ษษ& '
case
สส 
$num
สส 
:
สส 
return
สส  
$str
สส! *
;
สส* +
default
หห 
:
หห 
return
หห 
null
หห  $
;
หห$ %
}
ฬฬ 
}
ออ 	
public
ูู 
static
ูู 
double
ูู '
CalculateVolumeDifference
ูู 6
(
ูู6 7
double
ูู7 =

fromVolume
ูู> H
,
ููH I
double
ููJ P
toVolume
ููQ Y
)
ููY Z
{
ูู[ \
return
ฺฺ 
ClampVolume
ฺฺ 
(
ฺฺ 
toVolume
ฺฺ '
)
ฺฺ' (
-
ฺฺ) *
ClampVolume
ฺฺ+ 6
(
ฺฺ6 7

fromVolume
ฺฺ7 A
)
ฺฺA B
;
ฺฺB C
}
 	
public
ๅๅ 
static
ๅๅ 
double
ๅๅ 
InterpolateVolume
ๅๅ .
(
ๅๅ. /
double
ๅๅ/ 5

fromVolume
ๅๅ6 @
,
ๅๅ@ A
double
ๅๅB H
toVolume
ๅๅI Q
,
ๅๅQ R
double
ๅๅS Y
factor
ๅๅZ `
)
ๅๅ` a
{
ๅๅb c
var
ๆๆ 
clampedFrom
ๆๆ 
=
ๆๆ 
ClampVolume
ๆๆ )
(
ๆๆ) *

fromVolume
ๆๆ* 4
)
ๆๆ4 5
;
ๆๆ5 6
var
็็ 
	clampedTo
็็ 
=
็็ 
ClampVolume
็็ '
(
็็' (
toVolume
็็( 0
)
็็0 1
;
็็1 2
var
่่ 
clampedFactor
่่ 
=
่่ 
Math
่่  $
.
่่$ %
Max
่่% (
(
่่( )
$num
่่) ,
,
่่, -
Math
่่. 2
.
่่2 3
Min
่่3 6
(
่่6 7
$num
่่7 :
,
่่: ;
factor
่่< B
)
่่B C
)
่่C D
;
่่D E
return
๊๊ 
clampedFrom
๊๊ 
+
๊๊  
(
๊๊! "
	clampedTo
๊๊" +
-
๊๊, -
clampedFrom
๊๊. 9
)
๊๊9 :
*
๊๊; <
clampedFactor
๊๊= J
;
๊๊J K
}
๋๋ 	
}
๎๎ 
}๏๏ d
?C:\Playnite\_github\OstPlayer\source\Utils\Mp3MetadataReader.cs
	namespacecc 	
	OstPlayercc
 
.cc 
Utilscc 
{cc 
publicjj 

staticjj 
classjj 
Mp3MetadataReaderjj )
{jj* +
publicss 
staticss 
TrackMetadataModelss (
ReadMetadatass) 5
(ss5 6
stringss6 <
fullPathss= E
)ssE F
{ssG H
ifvv 
(vv 
!vv 
Systemvv 
.vv 
IOvv 
.vv 
Filevv 
.vv  
Existsvv  &
(vv& '
fullPathvv' /
)vv/ 0
)vv0 1
returnww 
nullww 
;ww 
tryyy 
{yy 
var}} 
file}} 
=}} 
TagLib}} !
.}}! "
File}}" &
.}}& '
Create}}' -
(}}- .
fullPath}}. 6
)}}6 7
;}}7 8
var~~ 
metadata~~ 
=~~ 
new~~ "
TrackMetadataModel~~# 5
(~~5 6
)~~6 7
;~~7 8
SetCoverImage
 
(
 
file
 "
,
" #
metadata
$ ,
)
, -
;
- .
SetBasicTags
 
(
 
file
 !
,
! "
metadata
# +
,
+ ,
fullPath
- 5
)
5 6
;
6 7
SetTrackNumbers
 
(
  
file
  $
,
$ %
metadata
& .
)
. /
;
/ 0
return
 
metadata
 
;
  
}
 
catch
 
{
 
return
 
null
 
;
 
}
 
}
 	
private
 
static
 
void
 
SetCoverImage
 )
(
) *
TagLib
* 0
.
0 1
File
1 5
file
6 :
,
: ; 
TrackMetadataModel
< N
metadata
O W
)
W X
{
Y Z
if
 
(
 
file
 
.
 
Tag
 
.
 
Pictures
 !
!=
" $
null
% )
&&
* ,
file
- 1
.
1 2
Tag
2 5
.
5 6
Pictures
6 >
.
> ?
Length
? E
>
F G
$num
H I
)
I J
{
K L
var
คค 
pic
คค 
=
คค 
file
คค 
.
คค 
Tag
คค "
.
คค" #
Pictures
คค# +
[
คค+ ,
$num
คค, -
]
คค- .
;
คค. /
using
จจ 
(
จจ 
var
จจ 
ms
จจ 
=
จจ 
new
จจ  #
MemoryStream
จจ$ 0
(
จจ0 1
pic
จจ1 4
.
จจ4 5
Data
จจ5 9
.
จจ9 :
Data
จจ: >
)
จจ> ?
)
จจ? @
{
จจA B
var
ชช 
img
ชช 
=
ชช 
new
ชช !
BitmapImage
ชช" -
(
ชช- .
)
ชช. /
;
ชช/ 0
img
ซซ 
.
ซซ 
	BeginInit
ซซ !
(
ซซ! "
)
ซซ" #
;
ซซ# $
img
ฐฐ 
.
ฐฐ 
CacheOption
ฐฐ #
=
ฐฐ$ %
BitmapCacheOption
ฐฐ& 7
.
ฐฐ7 8
OnLoad
ฐฐ8 >
;
ฐฐ> ?
img
ฑฑ 
.
ฑฑ 
StreamSource
ฑฑ $
=
ฑฑ% &
ms
ฑฑ' )
;
ฑฑ) *
img
ฒฒ 
.
ฒฒ 
EndInit
ฒฒ 
(
ฒฒ  
)
ฒฒ  !
;
ฒฒ! "
img
ถถ 
.
ถถ 
Freeze
ถถ 
(
ถถ 
)
ถถ  
;
ถถ  !
metadata
ทท 
.
ทท 
Cover
ทท "
=
ทท# $
img
ทท% (
;
ทท( )
}
ธธ 
}
นน 
}
ปป 	
private
ฦฦ 
static
ฦฦ 
void
ฦฦ 
SetBasicTags
ฦฦ (
(
ฦฦ( )
TagLib
ฦฦ) /
.
ฦฦ/ 0
File
ฦฦ0 4
file
ฦฦ5 9
,
ฦฦ9 : 
TrackMetadataModel
ฦฦ; M
metadata
ฦฦN V
,
ฦฦV W
string
ฦฦX ^
fullPath
ฦฦ_ g
)
ฦฦg h
{
ฦฦi j
metadata
สส 
.
สส 
Title
สส 
=
สส 
file
สส !
.
สส! "
Tag
สส" %
.
สส% &
Title
สส& +
??
สส, .
Path
สส/ 3
.
สส3 4)
GetFileNameWithoutExtension
สส4 O
(
สสO P
fullPath
สสP X
)
สสX Y
;
สสY Z
metadata
ฯฯ 
.
ฯฯ 
Artist
ฯฯ 
=
ฯฯ 
string
ฯฯ $
.
ฯฯ$ %
Join
ฯฯ% )
(
ฯฯ) *
$str
ฯฯ* .
,
ฯฯ. /
file
ฯฯ0 4
.
ฯฯ4 5
Tag
ฯฯ5 8
.
ฯฯ8 9

Performers
ฯฯ9 C
??
ฯฯD F
new
ฯฯG J
string
ฯฯK Q
[
ฯฯQ R
$num
ฯฯR S
]
ฯฯS T
)
ฯฯT U
;
ฯฯU V
metadata
ำำ 
.
ำำ 
Album
ำำ 
=
ำำ 
file
ำำ !
.
ำำ! "
Tag
ำำ" %
.
ำำ% &
Album
ำำ& +
??
ำำ, .
string
ำำ/ 5
.
ำำ5 6
Empty
ำำ6 ;
;
ำำ; <
metadata
ุุ 
.
ุุ 
Year
ุุ 
=
ุุ 
file
ุุ  
.
ุุ  !
Tag
ุุ! $
.
ุุ$ %
Year
ุุ% )
>
ุุ* +
$num
ุุ, -
?
ุุ. /
file
ุุ0 4
.
ุุ4 5
Tag
ุุ5 8
.
ุุ8 9
Year
ุุ9 =
.
ุุ= >
ToString
ุุ> F
(
ุุF G
)
ุุG H
:
ุุI J
string
ุุK Q
.
ุุQ R
Empty
ุุR W
;
ุุW X
metadata
 
.
 
Genre
 
=
 
string
 #
.
# $
Join
$ (
(
( )
$str
) -
,
- .
file
/ 3
.
3 4
Tag
4 7
.
7 8
Genres
8 >
??
? A
new
B E
string
F L
[
L M
$num
M N
]
N O
)
O P
;
P Q
metadata
เเ 
.
เเ 
Comment
เเ 
=
เเ 
file
เเ #
.
เเ# $
Tag
เเ$ '
.
เเ' (
Comment
เเ( /
??
เเ0 2
string
เเ3 9
.
เเ9 :
Empty
เเ: ?
;
เเ? @
metadata
ๅๅ 
.
ๅๅ 
Duration
ๅๅ 
=
ๅๅ 
file
ๅๅ  $
.
ๅๅ$ %

Properties
ๅๅ% /
.
ๅๅ/ 0
Duration
ๅๅ0 8
.
ๅๅ8 9
ToString
ๅๅ9 A
(
ๅๅA B
$str
ๅๅB K
)
ๅๅK L
;
ๅๅL M
}
ๆๆ 	
private
๐๐ 
static
๐๐ 
void
๐๐ 
SetTrackNumbers
๐๐ +
(
๐๐+ ,
TagLib
๐๐, 2
.
๐๐2 3
File
๐๐3 7
file
๐๐8 <
,
๐๐< = 
TrackMetadataModel
๐๐> P
metadata
๐๐Q Y
)
๐๐Y Z
{
๐๐[ \
metadata
๓๓ 
.
๓๓ 
TrackNumber
๓๓  
=
๓๓! "
file
๓๓# '
.
๓๓' (
Tag
๓๓( +
.
๓๓+ ,
Track
๓๓, 1
;
๓๓1 2
metadata
๔๔ 
.
๔๔ 
TotalTracks
๔๔  
=
๔๔! "
file
๔๔# '
.
๔๔' (
Tag
๔๔( +
.
๔๔+ ,

TrackCount
๔๔, 6
;
๔๔6 7
if
๘๘ 
(
๘๘ 
metadata
๘๘ 
.
๘๘ 
TrackNumber
๘๘ $
!=
๘๘% '
$num
๘๘( )
&&
๘๘* ,
metadata
๘๘- 5
.
๘๘5 6
TotalTracks
๘๘6 A
!=
๘๘B D
$num
๘๘E F
)
๘๘F G
return
๙๙ 
;
๙๙ 
string
 
trck
 
=
 
GetTrckFrame
 &
(
& '
file
' +
)
+ ,
;
, -
if
 
(
 
!
 
string
 
.
 
IsNullOrEmpty
 %
(
% &
trck
& *
)
* +
)
+ ,
ParseTrckFrame
 
(
 
trck
 #
,
# $
metadata
% -
)
- .
;
. /
}
 	
private
 
static
 
string
 
GetTrckFrame
 *
(
* +
TagLib
+ 1
.
1 2
File
2 6
file
7 ;
)
; <
{
= >
var
 
id3v2
 
=
 
file
 
.
 
GetTag
 #
(
# $
TagLib
$ *
.
* +
TagTypes
+ 3
.
3 4
Id3v2
4 9
)
9 :
as
; =
TagLib
> D
.
D E
Id3v2
E J
.
J K
Tag
K N
;
N O
if
 
(
 
id3v2
 
==
 
null
 
)
 
return
 
null
 
;
 
foreach
 
(
 
var
 
frame
 
in
 !
id3v2
" '
.
' (
	GetFrames
( 1
(
1 2
$str
2 8
)
8 9
)
9 :
{
; <
var
 
	trckFrame
 
=
 
frame
  %
as
& (
TagLib
) /
.
/ 0
Id3v2
0 5
.
5 6"
TextInformationFrame
6 J
;
J K
if
 
(
 
	trckFrame
 
!=
  
null
! %
)
% &
return
 
	trckFrame
 $
.
$ %
ToString
% -
(
- .
)
. /
;
/ 0
}
 
return
 
null
 
;
 
}
 	
private
ฆฆ 
static
ฆฆ 
void
ฆฆ 
ParseTrckFrame
ฆฆ *
(
ฆฆ* +
string
ฆฆ+ 1
trck
ฆฆ2 6
,
ฆฆ6 7 
TrackMetadataModel
ฆฆ8 J
metadata
ฆฆK S
)
ฆฆS T
{
ฆฆU V
var
ฉฉ 
cleaned
ฉฉ 
=
ฉฉ 
trck
ฉฉ 
.
ฉฉ 
Replace
ฉฉ &
(
ฉฉ& '
$str
ฉฉ' *
,
ฉฉ* +
string
ฉฉ, 2
.
ฉฉ2 3
Empty
ฉฉ3 8
)
ฉฉ8 9
.
ฉฉ9 :
Trim
ฉฉ: >
(
ฉฉ> ?
)
ฉฉ? @
;
ฉฉ@ A
var
ญญ 
parts
ญญ 
=
ญญ 
cleaned
ญญ 
.
ญญ  
Split
ญญ  %
(
ญญ% &
$char
ญญ& )
)
ญญ) *
;
ญญ* +
uint
ฐฐ 
num
ฐฐ 
=
ฐฐ 
$num
ฐฐ 
,
ฐฐ 
total
ฐฐ 
=
ฐฐ  !
$num
ฐฐ" #
;
ฐฐ# $
string
ณณ 
part0
ณณ 
=
ณณ 
parts
ณณ  
.
ณณ  !
Length
ณณ! '
>
ณณ( )
$num
ณณ* +
?
ณณ, -
parts
ณณ. 3
[
ณณ3 4
$num
ณณ4 5
]
ณณ5 6
.
ณณ6 7
	TrimStart
ณณ7 @
(
ณณ@ A
$char
ณณA D
)
ณณD E
:
ณณF G
null
ณณH L
;
ณณL M
string
ดด 
part1
ดด 
=
ดด 
parts
ดด  
.
ดด  !
Length
ดด! '
>
ดด( )
$num
ดด* +
?
ดด, -
parts
ดด. 3
[
ดด3 4
$num
ดด4 5
]
ดด5 6
.
ดด6 7
	TrimStart
ดด7 @
(
ดด@ A
$char
ดดA D
)
ดดD E
:
ดดF G
null
ดดH L
;
ดดL M
if
ฝฝ 
(
ฝฝ 
!
ฝฝ 
string
ฝฝ 
.
ฝฝ 
IsNullOrEmpty
ฝฝ %
(
ฝฝ% &
part0
ฝฝ& +
)
ฝฝ+ ,
&&
ฝฝ- /
uint
ฝฝ0 4
.
ฝฝ4 5
TryParse
ฝฝ5 =
(
ฝฝ= >
part0
ฝฝ> C
,
ฝฝC D
out
ฝฝE H
num
ฝฝI L
)
ฝฝL M
)
ฝฝM N
metadata
พพ 
.
พพ 
TrackNumber
พพ $
=
พพ% &
num
พพ' *
;
พพ* +
if
ยย 
(
ยย 
!
ยย 
string
ยย 
.
ยย 
IsNullOrEmpty
ยย %
(
ยย% &
part1
ยย& +
)
ยย+ ,
&&
ยย- /
uint
ยย0 4
.
ยย4 5
TryParse
ยย5 =
(
ยย= >
part1
ยย> C
,
ยยC D
out
ยยE H
total
ยยI N
)
ยยN O
)
ยยO P
metadata
รร 
.
รร 
TotalTracks
รร $
=
รร% &
total
รร' ,
;
รร, -
}
ศศ 	
}
ษษ 
}สส 
@C:\Playnite\_github\OstPlayer\source\Utils\Helpers\TimeHelper.cs
	namespace>> 	
	OstPlayer>>
 
.>> 
Utils>> 
.>> 
Helpers>> !
{>>" #
publicFF 

staticFF 
classFF 

TimeHelperFF "
{FF# $
publicLL 
constLL 
stringLL 
UnknownTimeDisplayLL .
=LL/ 0
$strLL1 8
;LL8 9
publicQQ 
constQQ 
stringQQ 
ZeroTimeDisplayQQ +
=QQ, -
$strQQ. 5
;QQ5 6
publicVV 
constVV 
doubleVV 
MinTimeSecondsVV *
=VV+ ,
$numVV- 0
;VV0 1
public\\ 
const\\ 
double\\ 
MaxTimeSeconds\\ *
=\\+ ,
$num\\- /
*\\0 1
$num\\2 4
*\\5 6
$num\\7 9
;\\9 :
publicnn 
staticnn 
stringnn 

FormatTimenn '
(nn' (
doublenn( .
timeInSecondsnn/ <
)nn< =
{nn> ?
ifoo 
(oo 
!oo 
IsValidTimeoo 
(oo 
timeInSecondsoo *
)oo* +
)oo+ ,
returnpp 
ZeroTimeDisplaypp &
;pp& '
tryrr 
{rr 
varss 
timeSpanss 
=ss 
TimeSpanss '
.ss' (
FromSecondsss( 3
(ss3 4
timeInSecondsss4 A
)ssA B
;ssB C
ifvv 
(vv 
timeSpanvv 
.vv 

TotalHoursvv '
<vv( )
$numvv* +
)vv+ ,
{vv- .
returnww 
$"ww 
{ww 
(ww 
intww "
)ww" #
timeSpanww# +
.ww+ ,
TotalMinutesww, 8
:ww8 9
$strww9 ;
}ww; <
$strww< =
{ww= >
timeSpanww> F
.wwF G
SecondswwG N
:wwN O
$strwwO Q
}wwQ R
"wwR S
;wwS T
}xx 
return{{ 
$"{{ 
{{{ 
({{ 
int{{ 
){{ 
timeSpan{{ '
.{{' (

TotalHours{{( 2
}{{2 3
$str{{3 4
{{{4 5
timeSpan{{5 =
.{{= >
Minutes{{> E
:{{E F
$str{{F H
}{{H I
$str{{I J
{{{J K
timeSpan{{K S
.{{S T
Seconds{{T [
:{{[ \
$str{{\ ^
}{{^ _
"{{_ `
;{{` a
}|| 
catch}} 
{}} 
return~~ 
ZeroTimeDisplay~~ &
;~~& '
} 
}
 	
public
 
static
 
string
 $
FormatTimeWithFallback
 3
(
3 4
double
4 :
timeInSeconds
; H
,
H I
bool
J N
showUnknownAsZero
O `
=
a b
false
c h
)
h i
{
j k
if
 
(
 
!
 
IsValidTime
 
(
 
timeInSeconds
 *
)
* +
)
+ ,
return
 
showUnknownAsZero
 (
?
) *
ZeroTimeDisplay
+ :
:
; < 
UnknownTimeDisplay
= O
;
O P
return
 

FormatTime
 
(
 
timeInSeconds
 +
)
+ ,
;
, -
}
 	
public
 
static
 
string
 
FormatTimePrecise
 .
(
. /
double
/ 5
timeInSeconds
6 C
)
C D
{
E F
if
 
(
 
!
 
IsValidTime
 
(
 
timeInSeconds
 *
)
* +
)
+ ,
return
 
ZeroTimeDisplay
 &
;
& '
try
 
{
 
var
 
timeSpan
 
=
 
TimeSpan
 '
.
' (
FromSeconds
( 3
(
3 4
timeInSeconds
4 A
)
A B
;
B C
if
 
(
 
timeSpan
 
.
 

TotalHours
 '
<
( )
$num
* +
)
+ ,
{
- .
return
 
$"
 
{
 
(
 
int
 "
)
" #
timeSpan
# +
.
+ ,
TotalMinutes
, 8
:
8 9
$str
9 ;
}
; <
$str
< =
{
= >
timeSpan
> F
.
F G
Seconds
G N
:
N O
$str
O Q
}
Q R
$str
R S
{
S T
timeSpan
T \
.
\ ]
Milliseconds
] i
:
i j
$str
j m
}
m n
"
n o
;
o p
}
 
return
 
$"
 
{
 
(
 
int
 
)
 
timeSpan
 '
.
' (

TotalHours
( 2
}
2 3
$str
3 4
{
4 5
timeSpan
5 =
.
= >
Minutes
> E
:
E F
$str
F H
}
H I
$str
I J
{
J K
timeSpan
K S
.
S T
Seconds
T [
:
[ \
$str
\ ^
}
^ _
$str
_ `
{
` a
timeSpan
a i
.
i j
Milliseconds
j v
:
v w
$str
w z
}
z {
"
{ |
;
| }
}
กก 
catch
ขข 
{
ขข 
return
ฃฃ 
ZeroTimeDisplay
ฃฃ &
;
ฃฃ& '
}
คค 
}
ฅฅ 	
public
บบ 
static
บบ 
double
บบ  
ParseTimeToSeconds
บบ /
(
บบ/ 0
string
บบ0 6

timeString
บบ7 A
)
บบA B
{
บบC D
if
ปป 
(
ปป 
string
ปป 
.
ปป  
IsNullOrWhiteSpace
ปป )
(
ปป) *

timeString
ปป* 4
)
ปป4 5
)
ปป5 6
return
ผผ 
$num
ผผ 
;
ผผ 
try
พพ 
{
พพ 
if
ภภ 
(
ภภ 
TimeSpan
ภภ 
.
ภภ 
TryParse
ภภ %
(
ภภ% &
$str
ภภ& +
+
ภภ, -

timeString
ภภ. 8
,
ภภ8 9
out
ภภ: =
TimeSpan
ภภ> F
result
ภภG M
)
ภภM N
||
ภภO Q
TimeSpan
มม 
.
มม 
TryParse
มม %
(
มม% &

timeString
มม& 0
,
มม0 1
out
มม2 5
result
มม6 <
)
มม< =
)
มม= >
{
มม? @
return
ยย 
	ClampTime
ยย $
(
ยย$ %
result
ยย% +
.
ยย+ ,
TotalSeconds
ยย, 8
)
ยย8 9
;
ยย9 :
}
รร 
if
ฦฦ 
(
ฦฦ 
double
ฦฦ 
.
ฦฦ 
TryParse
ฦฦ #
(
ฦฦ# $

timeString
ฦฦ$ .
,
ฦฦ. /
out
ฦฦ0 3
double
ฦฦ4 :
seconds
ฦฦ; B
)
ฦฦB C
)
ฦฦC D
{
ฦฦE F
return
วว 
	ClampTime
วว $
(
วว$ %
seconds
วว% ,
)
วว, -
;
วว- .
}
ศศ 
return
สส 
$num
สส 
;
สส 
}
หห 
catch
ฬฬ 
{
ฬฬ 
return
ออ 
$num
ออ 
;
ออ 
}
ฮฮ 
}
ฯฯ 	
public
ืื 
static
ืื 
bool
ืื #
TryParseTimeToSeconds
ืื 0
(
ืื0 1
string
ืื1 7

timeString
ืื8 B
,
ืืB C
out
ืืD G
double
ืืH N
timeInSeconds
ืืO \
)
ืื\ ]
{
ืื^ _
timeInSeconds
ุุ 
=
ุุ  
ParseTimeToSeconds
ุุ .
(
ุุ. /

timeString
ุุ/ 9
)
ุุ9 :
;
ุุ: ;
return
ูู 
timeInSeconds
ูู  
>
ูู! "
$num
ูู# $
||
ูู% '
string
ูู( .
.
ูู. /
Equals
ูู/ 5
(
ูู5 6

timeString
ูู6 @
,
ูู@ A
ZeroTimeDisplay
ููB Q
,
ููQ R
StringComparison
ููS c
.
ููc d
OrdinalIgnoreCase
ููd u
)
ููu v
;
ููv w
}
ฺฺ 	
public
ๅๅ 
static
ๅๅ 
bool
ๅๅ 
IsValidTime
ๅๅ &
(
ๅๅ& '
double
ๅๅ' -
timeInSeconds
ๅๅ. ;
)
ๅๅ; <
{
ๅๅ= >
return
ๆๆ 
!
ๆๆ 
double
ๆๆ 
.
ๆๆ 
IsNaN
ๆๆ  
(
ๆๆ  !
timeInSeconds
ๆๆ! .
)
ๆๆ. /
&&
ๆๆ0 2
!
็็ 
double
็็ 
.
็็ 

IsInfinity
็็ %
(
็็% &
timeInSeconds
็็& 3
)
็็3 4
&&
็็5 7
timeInSeconds
่่  
>=
่่! #
MinTimeSeconds
่่$ 2
&&
่่3 5
timeInSeconds
้้  
<=
้้! #
MaxTimeSeconds
้้$ 2
;
้้2 3
}
๊๊ 	
public
๒๒ 
static
๒๒ 
double
๒๒ 
	ClampTime
๒๒ &
(
๒๒& '
double
๒๒' -
timeInSeconds
๒๒. ;
)
๒๒; <
{
๒๒= >
if
๓๓ 
(
๓๓ 
double
๓๓ 
.
๓๓ 
IsNaN
๓๓ 
(
๓๓ 
timeInSeconds
๓๓ *
)
๓๓* +
||
๓๓, .
double
๓๓/ 5
.
๓๓5 6

IsInfinity
๓๓6 @
(
๓๓@ A
timeInSeconds
๓๓A N
)
๓๓N O
)
๓๓O P
return
๔๔ 
$num
๔๔ 
;
๔๔ 
return
๖๖ 
Math
๖๖ 
.
๖๖ 
Max
๖๖ 
(
๖๖ 
MinTimeSeconds
๖๖ *
,
๖๖* +
Math
๖๖, 0
.
๖๖0 1
Min
๖๖1 4
(
๖๖4 5
MaxTimeSeconds
๖๖5 C
,
๖๖C D
timeInSeconds
๖๖E R
)
๖๖R S
)
๖๖S T
;
๖๖T U
}
๗๗ 	
public
 
static
 
double
 
ClampPosition
 *
(
* +
double
+ 1
position
2 :
,
: ;
double
< B
duration
C K
)
K L
{
M N
var
 
validDuration
 
=
 
Math
  $
.
$ %
Max
% (
(
( )
$num
) ,
,
, -
	ClampTime
. 7
(
7 8
duration
8 @
)
@ A
)
A B
;
B C
var
 
validPosition
 
=
 
	ClampTime
  )
(
) *
position
* 2
)
2 3
;
3 4
return
 
Math
 
.
 
Min
 
(
 
validPosition
 )
,
) *
validDuration
+ 8
)
8 9
;
9 :
}
 	
public
 
static
 
double
 
CalculateProgress
 .
(
. /
double
/ 5
position
6 >
,
> ?
double
@ F
duration
G O
)
O P
{
Q R
var
 
validDuration
 
=
 
	ClampTime
  )
(
) *
duration
* 2
)
2 3
;
3 4
var
 
validPosition
 
=
 
ClampPosition
  -
(
- .
position
. 6
,
6 7
validDuration
8 E
)
E F
;
F G
if
 
(
 
validDuration
 
<=
  
$num
! "
)
" #
return
 
$num
 
;
 
return
 
(
 
validPosition
 !
/
" #
validDuration
$ 1
)
1 2
*
3 4
$num
5 :
;
: ;
}
 	
public
งง 
static
งง 
double
งง +
CalculatePositionFromProgress
งง :
(
งง: ;
double
งง; A 
progressPercentage
งงB T
,
งงT U
double
งงV \
duration
งง] e
)
งงe f
{
งงg h
var
จจ 
validDuration
จจ 
=
จจ 
	ClampTime
จจ  )
(
จจ) *
duration
จจ* 2
)
จจ2 3
;
จจ3 4
var
ฉฉ 
clampedProgress
ฉฉ 
=
ฉฉ  !
Math
ฉฉ" &
.
ฉฉ& '
Max
ฉฉ' *
(
ฉฉ* +
$num
ฉฉ+ .
,
ฉฉ. /
Math
ฉฉ0 4
.
ฉฉ4 5
Min
ฉฉ5 8
(
ฉฉ8 9
$num
ฉฉ9 >
,
ฉฉ> ? 
progressPercentage
ฉฉ@ R
)
ฉฉR S
)
ฉฉS T
;
ฉฉT U
return
ซซ 
(
ซซ 
clampedProgress
ซซ #
/
ซซ$ %
$num
ซซ& +
)
ซซ+ ,
*
ซซ- .
validDuration
ซซ/ <
;
ซซ< =
}
ฌฌ 	
public
ดด 
static
ดด 
double
ดด $
CalculateRemainingTime
ดด 3
(
ดด3 4
double
ดด4 :
position
ดด; C
,
ดดC D
double
ดดE K
duration
ดดL T
)
ดดT U
{
ดดV W
var
ตต 
validDuration
ตต 
=
ตต 
	ClampTime
ตต  )
(
ตต) *
duration
ตต* 2
)
ตต2 3
;
ตต3 4
var
ถถ 
validPosition
ถถ 
=
ถถ 
ClampPosition
ถถ  -
(
ถถ- .
position
ถถ. 6
,
ถถ6 7
validDuration
ถถ8 E
)
ถถE F
;
ถถF G
return
ธธ 
Math
ธธ 
.
ธธ 
Max
ธธ 
(
ธธ 
$num
ธธ 
,
ธธ  
validDuration
ธธ! .
-
ธธ/ 0
validPosition
ธธ1 >
)
ธธ> ?
;
ธธ? @
}
นน 	
public
ลล 
static
ลล 
double
ลล 
AddTime
ลล $
(
ลล$ %
double
ลล% +
time1
ลล, 1
,
ลล1 2
double
ลล3 9
time2
ลล: ?
)
ลล? @
{
ลลA B
var
ฦฦ 
valid1
ฦฦ 
=
ฦฦ 
	ClampTime
ฦฦ "
(
ฦฦ" #
time1
ฦฦ# (
)
ฦฦ( )
;
ฦฦ) *
var
วว 
valid2
วว 
=
วว 
	ClampTime
วว "
(
วว" #
time2
วว# (
)
วว( )
;
วว) *
return
ษษ 
	ClampTime
ษษ 
(
ษษ 
valid1
ษษ #
+
ษษ$ %
valid2
ษษ& ,
)
ษษ, -
;
ษษ- .
}
สส 	
public
าา 
static
าา 
double
าา 
SubtractTime
าา )
(
าา) *
double
าา* 0
time1
าา1 6
,
าา6 7
double
าา8 >
time2
าา? D
)
าาD E
{
าาF G
var
ำำ 
valid1
ำำ 
=
ำำ 
	ClampTime
ำำ "
(
ำำ" #
time1
ำำ# (
)
ำำ( )
;
ำำ) *
var
ิิ 
valid2
ิิ 
=
ิิ 
	ClampTime
ิิ "
(
ิิ" #
time2
ิิ# (
)
ิิ( )
;
ิิ) *
return
ึึ 
	ClampTime
ึึ 
(
ึึ 
valid1
ึึ #
-
ึึ$ %
valid2
ึึ& ,
)
ึึ, -
;
ึึ- .
}
ืื 	
public
 
static
 
double
 #
MillisecondsToSeconds
 2
(
2 3
double
3 9
milliseconds
: F
)
F G
{
H I
return
฿฿ 
	ClampTime
฿฿ 
(
฿฿ 
milliseconds
฿฿ )
/
฿฿* +
$num
฿฿, 2
)
฿฿2 3
;
฿฿3 4
}
เเ 	
public
็็ 
static
็็ 
double
็็ #
SecondsToMilliseconds
็็ 2
(
็็2 3
double
็็3 9
seconds
็็: A
)
็็A B
{
็็C D
return
่่ 
	ClampTime
่่ 
(
่่ 
seconds
่่ $
)
่่$ %
*
่่& '
$num
่่( .
;
่่. /
}
้้ 	
public
๔๔ 
static
๔๔ 
TimeSpan
๔๔ 

ToTimeSpan
๔๔ )
(
๔๔) *
double
๔๔* 0
seconds
๔๔1 8
)
๔๔8 9
{
๔๔: ;
if
๕๕ 
(
๕๕ 
!
๕๕ 
IsValidTime
๕๕ 
(
๕๕ 
seconds
๕๕ $
)
๕๕$ %
)
๕๕% &
return
๖๖ 
TimeSpan
๖๖ 
.
๖๖  
Zero
๖๖  $
;
๖๖$ %
try
๘๘ 
{
๘๘ 
return
๙๙ 
TimeSpan
๙๙ 
.
๙๙  
FromSeconds
๙๙  +
(
๙๙+ ,
seconds
๙๙, 3
)
๙๙3 4
;
๙๙4 5
}
๚๚ 
catch
๛๛ 
{
๛๛ 
return
 
TimeSpan
 
.
  
Zero
  $
;
$ %
}
 
}
 	
public
 
static
 
double
 
FromTimeSpan
 )
(
) *
TimeSpan
* 2
timeSpan
3 ;
)
; <
{
= >
return
 
	ClampTime
 
(
 
timeSpan
 %
.
% &
TotalSeconds
& 2
)
2 3
;
3 4
}
 	
public
 
static
 
double
 
RoundToSecond
 *
(
* +
double
+ 1
timeInSeconds
2 ?
)
? @
{
A B
return
 
Math
 
.
 
Round
 
(
 
	ClampTime
 '
(
' (
timeInSeconds
( 5
)
5 6
)
6 7
;
7 8
}
 	
public
 
static
 
string
  
FormatProgressTime
 /
(
/ 0
double
0 6
position
7 ?
,
? @
double
A G
duration
H P
)
P Q
{
R S
var
 
currentTime
 
=
 $
FormatTimeWithFallback
 4
(
4 5
position
5 =
,
= >
true
? C
)
C D
;
D E
var
 
	totalTime
 
=
 $
FormatTimeWithFallback
 2
(
2 3
duration
3 ;
,
; <
false
= B
)
B C
;
C D
return
 
$"
 
{
 
currentTime
 !
}
! "
$str
" %
{
% &
	totalTime
& /
}
/ 0
"
0 1
;
1 2
}
 	
}
 
}กก 
GC:\Playnite\_github\OstPlayer\source\Utils\DataGridColumnPersistence.cs
	namespacekk 	
	OstPlayerkk
 
.kk 
Utilskk 
{kk 
publicrr 

classrr %
DataGridColumnPersistencerr *
:rr+ ,
IDisposablerr- 8
{rr9 :
privateuu 
readonlyuu 
DataGriduu !
	_dataGriduu" +
;uu+ ,
privatevv 
readonlyvv 
	OstPlayervv "
_pluginvv# *
;vv* +
privateww 
readonlyww 
DispatcherTimerww (

_saveTimerww) 3
;ww3 4
privatexx 
boolxx 

_isLoadingxx 
=xx  !
falsexx" '
;xx' (
privateyy 
boolyy 
	_disposedyy 
=yy  
falseyy! &
;yy& '
public
 '
DataGridColumnPersistence
 (
(
( )
DataGrid
) 1
dataGrid
2 :
,
: ;
	OstPlayer
< E
plugin
F L
)
L M
{
N O
	_dataGrid
 
=
 
dataGrid
  
??
! #
throw
$ )
new
* -#
ArgumentNullException
. C
(
C D
nameof
D J
(
J K
dataGrid
K S
)
S T
)
T U
;
U V
_plugin
 
=
 
plugin
 
??
 
throw
  %
new
& )#
ArgumentNullException
* ?
(
? @
nameof
@ F
(
F G
plugin
G M
)
M N
)
N O
;
O P

_saveTimer
 
=
 
new
 
DispatcherTimer
 ,
{
- .
Interval
 
=
 
TimeSpan
 #
.
# $
FromMilliseconds
$ 4
(
4 5
$num
5 8
)
8 9
}
 
;
 

_saveTimer
 
.
 
Tick
 
+=
 
OnSaveTimerTick
 .
;
. /
SubscribeToEvents
 
(
 
)
 
;
  
}
 	
private
 
void
 
SubscribeToEvents
 &
(
& '
)
' (
{
) *
if
 
(
 
	_dataGrid
 
!=
 
null
 !
)
! "
{
# $
	_dataGrid
 
.
 '
ColumnDisplayIndexChanged
 3
+=
4 6
OnColumnChanged
7 F
;
F G
	_dataGrid
 
.
 
LayoutUpdated
 '
+=
( *
OnLayoutUpdated
+ :
;
: ;
	_dataGrid
 
.
 
Loaded
  
+=
! #
OnDataGridLoaded
$ 4
;
4 5
	_dataGrid
 
.
 
ColumnReordered
 )
+=
* ,
OnColumnReordered
- >
;
> ?
}
 
}
 	
private
คค 
void
คค #
UnsubscribeFromEvents
คค *
(
คค* +
)
คค+ ,
{
คค- .
if
ฅฅ 
(
ฅฅ 
	_dataGrid
ฅฅ 
!=
ฅฅ 
null
ฅฅ !
)
ฅฅ! "
{
ฅฅ# $
	_dataGrid
ฆฆ 
.
ฆฆ '
ColumnDisplayIndexChanged
ฆฆ 3
-=
ฆฆ4 6
OnColumnChanged
ฆฆ7 F
;
ฆฆF G
	_dataGrid
งง 
.
งง 
LayoutUpdated
งง '
-=
งง( *
OnLayoutUpdated
งง+ :
;
งง: ;
	_dataGrid
จจ 
.
จจ 
Loaded
จจ  
-=
จจ! #
OnDataGridLoaded
จจ$ 4
;
จจ4 5
	_dataGrid
ฉฉ 
.
ฉฉ 
ColumnReordered
ฉฉ )
-=
ฉฉ* ,
OnColumnReordered
ฉฉ- >
;
ฉฉ> ?
}
ชช 
}
ซซ 	
public
นน 
void
นน 
LoadColumnWidths
นน $
(
นน$ %
)
นน% &
{
นน' (
try
บบ 
{
บบ 

_isLoading
ปป 
=
ปป 
true
ปป !
;
ปป! "
var
ฝฝ 
settings
ฝฝ 
=
ฝฝ 
GetSettings
ฝฝ *
(
ฝฝ* +
)
ฝฝ+ ,
;
ฝฝ, -
if
พพ 
(
พพ 
settings
พพ 
==
พพ 
null
พพ  $
||
พพ% '
	_dataGrid
พพ( 1
.
พพ1 2
Columns
พพ2 9
.
พพ9 :
Count
พพ: ?
<
พพ@ A
$num
พพB C
)
พพC D
return
ฟฟ 
;
ฟฟ 
if
ยย 
(
ยย 
	_dataGrid
ยย 
.
ยย 
Columns
ยย %
.
ยย% &
Count
ยย& +
>=
ยย, .
$num
ยย/ 0
)
ยย0 1
{
ยย2 3!
SetColumnPixelWidth
ฤฤ '
(
ฤฤ' (
$num
ฤฤ( )
,
ฤฤ) *
settings
ฤฤ+ 3
.
ฤฤ3 4$
TrackNumberColumnWidth
ฤฤ4 J
,
ฤฤJ K
$num
ฤฤL N
,
ฤฤN O
$num
ฤฤP S
)
ฤฤS T
;
ฤฤT U2
$RestoreStarSizedColumnsWithPositions
ษษ 8
(
ษษ8 9
settings
ษษ9 A
)
ษษA B
;
ษษB C
}
สส 
PerformanceStats
ฬฬ  
.
ฬฬ  !

RecordLoad
ฬฬ! +
(
ฬฬ+ ,
)
ฬฬ, -
;
ฬฬ- .
}
ออ 
catch
ฮฮ 
(
ฮฮ 
	Exception
ฮฮ 
ex
ฮฮ 
)
ฮฮ  
{
ฮฮ! "
System
ฯฯ 
.
ฯฯ 
Diagnostics
ฯฯ "
.
ฯฯ" #
Debug
ฯฯ# (
.
ฯฯ( )
	WriteLine
ฯฯ) 2
(
ฯฯ2 3
$"
ฯฯ3 5
$str
ฯฯ5 S
{
ฯฯS T
ex
ฯฯT V
.
ฯฯV W
Message
ฯฯW ^
}
ฯฯ^ _
"
ฯฯ_ `
)
ฯฯ` a
;
ฯฯa b
}
ะะ 
finally
ัั 
{
ัั 

_isLoading
าา 
=
าา 
false
าา "
;
าา" #
}
ำำ 
}
ิิ 	
public
 
void
 
SaveColumnWidths
 $
(
$ %
)
% &
{
' (
if
 
(
 

_isLoading
 
||
 
	_disposed
 '
)
' (
return
฿฿ 
;
฿฿ 
try
แแ 
{
แแ 
var
โโ 
settings
โโ 
=
โโ 
GetSettings
โโ *
(
โโ* +
)
โโ+ ,
;
โโ, -
if
ใใ 
(
ใใ 
settings
ใใ 
==
ใใ 
null
ใใ  $
||
ใใ% '
	_dataGrid
ใใ( 1
.
ใใ1 2
Columns
ใใ2 9
.
ใใ9 :
Count
ใใ: ?
<
ใใ@ A
$num
ใใB C
)
ใใC D
return
ไไ 
;
ไไ 
settings
็็ 
.
็็ $
TrackNumberColumnWidth
็็ /
=
็็0 1
GetClampedWidth
็็2 A
(
็็A B
$num
็็B C
,
็็C D
$num
็็E G
,
็็G H
$num
็็I L
)
็็L M
;
็็M N4
&SaveStarSizedColumnRatiosWithPositions
๋๋ 6
(
๋๋6 7
settings
๋๋7 ?
)
๋๋? @
;
๋๋@ A
_plugin
๎๎ 
.
๎๎  
SavePluginSettings
๎๎ *
(
๎๎* +
settings
๎๎+ 3
)
๎๎3 4
;
๎๎4 5
PerformanceStats
๑๑  
.
๑๑  !

RecordSave
๑๑! +
(
๑๑+ ,
)
๑๑, -
;
๑๑- .
}
๒๒ 
catch
๓๓ 
(
๓๓ 
	Exception
๓๓ 
ex
๓๓ 
)
๓๓  
{
๓๓! "
System
๔๔ 
.
๔๔ 
Diagnostics
๔๔ "
.
๔๔" #
Debug
๔๔# (
.
๔๔( )
	WriteLine
๔๔) 2
(
๔๔2 3
$"
๔๔3 5
$str
๔๔5 S
{
๔๔S T
ex
๔๔T V
.
๔๔V W
Message
๔๔W ^
}
๔๔^ _
"
๔๔_ `
)
๔๔` a
;
๔๔a b
}
๕๕ 
}
๖๖ 	
private
 
OstPlayerSettings
 !
GetSettings
" -
(
- .
)
. /
{
0 1
return
 
_plugin
 
?
 
.
  
LoadPluginSettings
 .
<
. /
OstPlayerSettings
/ @
>
@ A
(
A B
)
B C
;
C D
}
 	
private
 
void
 !
SetColumnPixelWidth
 (
(
( )
int
) ,
columnIndex
- 8
,
8 9
double
: @
width
A F
,
F G
double
H N
minWidth
O W
,
W X
double
Y _
maxWidth
` h
)
h i
{
j k
if
 
(
 
columnIndex
 
>=
 
$num
  
&&
! #
columnIndex
$ /
<
0 1
	_dataGrid
2 ;
.
; <
Columns
< C
.
C D
Count
D I
)
I J
{
K L
var
 
clampedWidth
  
=
! "
Math
# '
.
' (
Max
( +
(
+ ,
minWidth
, 4
,
4 5
Math
6 :
.
: ;
Min
; >
(
> ?
maxWidth
? G
,
G H
width
I N
)
N O
)
O P
;
P Q
	_dataGrid
 
.
 
Columns
 !
[
! "
columnIndex
" -
]
- .
.
. /
Width
/ 4
=
5 6
clampedWidth
7 C
;
C D
}
 
}
 	
private
 
double
 
GetClampedWidth
 &
(
& '
int
' *
columnIndex
+ 6
,
6 7
double
8 >
minWidth
? G
,
G H
double
I O
maxWidth
P X
)
X Y
{
Z [
if
 
(
 
columnIndex
 
>=
 
$num
  
&&
! #
columnIndex
$ /
<
0 1
	_dataGrid
2 ;
.
; <
Columns
< C
.
C D
Count
D I
)
I J
{
K L
var
 
actualWidth
 
=
  !
	_dataGrid
" +
.
+ ,
Columns
, 3
[
3 4
columnIndex
4 ?
]
? @
.
@ A
ActualWidth
A L
;
L M
return
 
Math
 
.
 
Max
 
(
  
minWidth
  (
,
( )
Math
* .
.
. /
Min
/ 2
(
2 3
maxWidth
3 ;
,
; <
actualWidth
= H
)
H I
)
I J
;
J K
}
 
return
 
minWidth
 
;
 
}
 	
private
ฅฅ 
void
ฅฅ 
ScheduleSave
ฅฅ !
(
ฅฅ! "
)
ฅฅ" #
{
ฅฅ$ %
if
ฆฆ 
(
ฆฆ 

_isLoading
ฆฆ 
||
ฆฆ 
	_disposed
ฆฆ '
)
ฆฆ' (
return
งง 
;
งง 

_saveTimer
ชช 
.
ชช 
Stop
ชช 
(
ชช 
)
ชช 
;
ชช 

_saveTimer
ซซ 
.
ซซ 
Start
ซซ 
(
ซซ 
)
ซซ 
;
ซซ 
}
ฌฌ 	
private
ธธ 
void
ธธ 2
$RestoreStarSizedColumnsWithPositions
ธธ 9
(
ธธ9 :
OstPlayerSettings
ธธ: K
settings
ธธL T
)
ธธT U
{
ธธV W
try
นน 
{
นน 
var
ปป 
savedTitleWidth
ปป #
=
ปป$ %
settings
ปป& .
.
ปป. /#
TrackTitleColumnWidth
ปป/ D
;
ปปD E
var
ผผ  
savedDurationWidth
ผผ &
=
ผผ' (
settings
ผผ) 1
.
ผผ1 2!
DurationColumnWidth
ผผ2 E
;
ผผE F
var
ฝฝ  
savedSplitterRatio
ฝฝ &
=
ฝฝ' (
settings
ฝฝ) 1
.
ฝฝ1 2(
TitleDurationSplitterRatio
ฝฝ2 L
;
ฝฝL M
var
ภภ 
minTitleWidth
ภภ !
=
ภภ" #
$num
ภภ$ )
;
ภภ) *
var
มม 
minDurationWidth
มม $
=
มม% &
$num
มม' +
;
มม+ ,
if
ฤฤ 
(
ฤฤ 
savedTitleWidth
ฤฤ #
>=
ฤฤ$ &
minTitleWidth
ฤฤ' 4
&&
ฤฤ5 7 
savedDurationWidth
ฤฤ8 J
>=
ฤฤK M
minDurationWidth
ฤฤN ^
&&
ฤฤ_ a 
savedSplitterRatio
ลล &
>
ลล' (
$num
ลล) ,
&&
ลล- / 
savedSplitterRatio
ลล0 B
<
ลลC D
$num
ลลE I
)
ลลI J
{
ลลK L
var
ศศ 
titleStarValue
ศศ &
=
ศศ' (
Math
ศศ) -
.
ศศ- .
Max
ศศ. 1
(
ศศ1 2
$num
ศศ2 5
,
ศศ5 6 
savedSplitterRatio
ศศ7 I
*
ศศJ K
$num
ศศL O
)
ศศO P
;
ศศP Q
var
ษษ 
durationStarValue
ษษ )
=
ษษ* +
Math
ษษ, 0
.
ษษ0 1
Max
ษษ1 4
(
ษษ4 5
$num
ษษ5 8
,
ษษ8 9
(
ษษ: ;
$num
ษษ; >
-
ษษ? @ 
savedSplitterRatio
ษษA S
)
ษษS T
*
ษษU V
$num
ษษW Z
)
ษษZ [
;
ษษ[ \
	_dataGrid
ฬฬ 
.
ฬฬ 
Columns
ฬฬ %
[
ฬฬ% &
$num
ฬฬ& '
]
ฬฬ' (
.
ฬฬ( )
Width
ฬฬ) .
=
ฬฬ/ 0
new
ฬฬ1 4
DataGridLength
ฬฬ5 C
(
ฬฬC D
titleStarValue
ฬฬD R
,
ฬฬR S$
DataGridLengthUnitType
ฬฬT j
.
ฬฬj k
Star
ฬฬk o
)
ฬฬo p
;
ฬฬp q
	_dataGrid
ออ 
.
ออ 
Columns
ออ %
[
ออ% &
$num
ออ& '
]
ออ' (
.
ออ( )
Width
ออ) .
=
ออ/ 0
new
ออ1 4
DataGridLength
ออ5 C
(
ออC D
durationStarValue
ออD U
,
ออU V$
DataGridLengthUnitType
ออW m
.
ออm n
Star
ออn r
)
ออr s
;
ออs t
	_dataGrid
ะะ 
.
ะะ 
Columns
ะะ %
[
ะะ% &
$num
ะะ& '
]
ะะ' (
.
ะะ( )
MinWidth
ะะ) 1
=
ะะ2 3
minTitleWidth
ะะ4 A
;
ะะA B
	_dataGrid
ัั 
.
ัั 
Columns
ัั %
[
ัั% &
$num
ัั& '
]
ัั' (
.
ัั( )
MinWidth
ัั) 1
=
ัั2 3
minDurationWidth
ัั4 D
;
ััD E
PerformanceStats
ำำ $
.
ำำ$ %)
RecordStarSizingCalculation
ำำ% @
(
ำำ@ A
)
ำำA B
;
ำำB C
System
ีี 
.
ีี 
Diagnostics
ีี &
.
ีี& '
Debug
ีี' ,
.
ีี, -
	WriteLine
ีี- 6
(
ีี6 7
$"
ีี7 9
$str
ีี9 o
{
ีีo p!
savedSplitterRatioีีp 
:ีี 
$strีี 
}ีี 
$strีี 
{ีี 
titleStarValueีี 
:ีี 
$strีี ข
}ีีข ฃ
$strีีฃ ฐ
{ีีฐ ฑ!
durationStarValueีีฑ ย
:ีีย ร
$strีีร ล
}ีีล ฦ
$strีีฦ ว
"ีีว ศ
)ีีศ ษ
;ีีษ ส
}
ึึ 
else
ืื 
{
ืื 
if
ูู 
(
ูู 
savedTitleWidth
ูู '
>=
ูู( *
minTitleWidth
ูู+ 8
&&
ูู9 ; 
savedDurationWidth
ูู< N
>=
ููO Q
minDurationWidth
ููR b
)
ููb c
{
ููd e
var
 

totalWidth
 &
=
' (
savedTitleWidth
) 8
+
9 : 
savedDurationWidth
; M
;
M N
var
 

titleRatio
 &
=
' (
savedTitleWidth
) 8
/
9 :

totalWidth
; E
;
E F
var
 
titleStarValue
 *
=
+ ,
Math
- 1
.
1 2
Max
2 5
(
5 6
$num
6 9
,
9 :

titleRatio
; E
*
F G
$num
H K
)
K L
;
L M
var
 
durationStarValue
 -
=
. /
Math
0 4
.
4 5
Max
5 8
(
8 9
$num
9 <
,
< =
(
> ?
$num
? B
-
C D

titleRatio
E O
)
O P
*
Q R
$num
S V
)
V W
;
W X
	_dataGrid
เเ !
.
เเ! "
Columns
เเ" )
[
เเ) *
$num
เเ* +
]
เเ+ ,
.
เเ, -
Width
เเ- 2
=
เเ3 4
new
เเ5 8
DataGridLength
เเ9 G
(
เเG H
titleStarValue
เเH V
,
เเV W$
DataGridLengthUnitType
เเX n
.
เเn o
Star
เเo s
)
เเs t
;
เเt u
	_dataGrid
แแ !
.
แแ! "
Columns
แแ" )
[
แแ) *
$num
แแ* +
]
แแ+ ,
.
แแ, -
Width
แแ- 2
=
แแ3 4
new
แแ5 8
DataGridLength
แแ9 G
(
แแG H
durationStarValue
แแH Y
,
แแY Z$
DataGridLengthUnitType
แแ[ q
.
แแq r
Star
แแr v
)
แแv w
;
แแw x
System
ใใ 
.
ใใ 
Diagnostics
ใใ *
.
ใใ* +
Debug
ใใ+ 0
.
ใใ0 1
	WriteLine
ใใ1 :
(
ใใ: ;
$"
ใใ; =
$str
ใใ= n
{
ใใn o
titleStarValue
ใใo }
:
ใใ} ~
$strใใ~ 
}ใใ 
$strใใ 
{ใใ !
durationStarValueใใ 
:ใใ ก
$strใใก ฃ
}ใใฃ ค
$strใใค ฅ
"ใใฅ ฆ
)ใใฆ ง
;ใใง จ
}
ไไ 
else
ๅๅ 
{
ๅๅ 
	_dataGrid
็็ !
.
็็! "
Columns
็็" )
[
็็) *
$num
็็* +
]
็็+ ,
.
็็, -
Width
็็- 2
=
็็3 4
new
็็5 8
DataGridLength
็็9 G
(
็็G H
$num
็็H K
,
็็K L$
DataGridLengthUnitType
็็M c
.
็็c d
Star
็็d h
)
็็h i
;
็็i j
	_dataGrid
่่ !
.
่่! "
Columns
่่" )
[
่่) *
$num
่่* +
]
่่+ ,
.
่่, -
Width
่่- 2
=
่่3 4
new
่่5 8
DataGridLength
่่9 G
(
่่G H
$num
่่H K
,
่่K L$
DataGridLengthUnitType
่่M c
.
่่c d
Star
่่d h
)
่่h i
;
่่i j
System
๊๊ 
.
๊๊ 
Diagnostics
๊๊ *
.
๊๊* +
Debug
๊๊+ 0
.
๊๊0 1
	WriteLine
๊๊1 :
(
๊๊: ;
$str๊๊; 
)๊๊ 
;๊๊ 
}
๋๋ 
	_dataGrid
ํํ 
.
ํํ 
Columns
ํํ %
[
ํํ% &
$num
ํํ& '
]
ํํ' (
.
ํํ( )
MinWidth
ํํ) 1
=
ํํ2 3
minTitleWidth
ํํ4 A
;
ํํA B
	_dataGrid
๎๎ 
.
๎๎ 
Columns
๎๎ %
[
๎๎% &
$num
๎๎& '
]
๎๎' (
.
๎๎( )
MinWidth
๎๎) 1
=
๎๎2 3
minDurationWidth
๎๎4 D
;
๎๎D E
}
๏๏ 
}
๐๐ 
catch
๑๑ 
(
๑๑ 
	Exception
๑๑ 
ex
๑๑ 
)
๑๑  
{
๑๑! "
System
๒๒ 
.
๒๒ 
Diagnostics
๒๒ "
.
๒๒" #
Debug
๒๒# (
.
๒๒( )
	WriteLine
๒๒) 2
(
๒๒2 3
$"
๒๒3 5
$str
๒๒5 [
{
๒๒[ \
ex
๒๒\ ^
.
๒๒^ _
Message
๒๒_ f
}
๒๒f g
"
๒๒g h
)
๒๒h i
;
๒๒i j
try
๕๕ 
{
๕๕ 
	_dataGrid
๖๖ 
.
๖๖ 
Columns
๖๖ %
[
๖๖% &
$num
๖๖& '
]
๖๖' (
.
๖๖( )
Width
๖๖) .
=
๖๖/ 0
new
๖๖1 4
DataGridLength
๖๖5 C
(
๖๖C D
$num
๖๖D G
,
๖๖G H$
DataGridLengthUnitType
๖๖I _
.
๖๖_ `
Star
๖๖` d
)
๖๖d e
;
๖๖e f
	_dataGrid
๗๗ 
.
๗๗ 
Columns
๗๗ %
[
๗๗% &
$num
๗๗& '
]
๗๗' (
.
๗๗( )
Width
๗๗) .
=
๗๗/ 0
new
๗๗1 4
DataGridLength
๗๗5 C
(
๗๗C D
$num
๗๗D G
,
๗๗G H$
DataGridLengthUnitType
๗๗I _
.
๗๗_ `
Star
๗๗` d
)
๗๗d e
;
๗๗e f
}
๘๘ 
catch
๙๙ 
{
๙๙ 
}
๛๛ 
}
 
}
 	
private
 
void
 4
&SaveStarSizedColumnRatiosWithPositions
 ;
(
; <
OstPlayerSettings
< M
settings
N V
)
V W
{
X Y
try
 
{
 
var
 
titleActualWidth
 $
=
% &
	_dataGrid
' 0
.
0 1
Columns
1 8
[
8 9
$num
9 :
]
: ;
.
; <
ActualWidth
< G
;
G H
var
 !
durationActualWidth
 '
=
( )
	_dataGrid
* 3
.
3 4
Columns
4 ;
[
; <
$num
< =
]
= >
.
> ?
ActualWidth
? J
;
J K
if
 
(
 
titleActualWidth
 $
>
% &
$num
' (
&&
) +!
durationActualWidth
, ?
>
@ A
$num
B C
)
C D
{
E F
var
 
totalStarWidth
 &
=
' (
titleActualWidth
) 9
+
: ;!
durationActualWidth
< O
;
O P
var
 
splitterRatio
 %
=
& '
titleActualWidth
( 8
/
9 :
totalStarWidth
; I
;
I J
var
 
clampedTitleWidth
 )
=
* +
Math
, 0
.
0 1
Max
1 4
(
4 5
$num
5 8
,
8 9
titleActualWidth
: J
)
J K
;
K L
var
 "
clampedDurationWidth
 ,
=
- .
Math
/ 3
.
3 4
Max
4 7
(
7 8
$num
8 :
,
: ;!
durationActualWidth
< O
)
O P
;
P Q
var
 "
clampedSplitterRatio
 ,
=
- .
Math
/ 3
.
3 4
Max
4 7
(
7 8
$num
8 ;
,
; <
Math
= A
.
A B
Min
B E
(
E F
$num
F I
,
I J
splitterRatio
K X
)
X Y
)
Y Z
;
Z [
var
 
titleChanged
 $
=
% &
Math
' +
.
+ ,
Abs
, /
(
/ 0
settings
0 8
.
8 9#
TrackTitleColumnWidth
9 N
-
O P
clampedTitleWidth
Q b
)
b c
>
d e
$num
f g
;
g h
var
 
durationChanged
 '
=
( )
Math
* .
.
. /
Abs
/ 2
(
2 3
settings
3 ;
.
; <!
DurationColumnWidth
< O
-
P Q"
clampedDurationWidth
R f
)
f g
>
h i
$num
j k
;
k l
var
 
ratioChanged
 $
=
% &
Math
' +
.
+ ,
Abs
, /
(
/ 0
settings
0 8
.
8 9(
TitleDurationSplitterRatio
9 S
-
T U"
clampedSplitterRatio
V j
)
j k
>
l m
$num
n r
;
r s
if
 
(
 
titleChanged
 $
||
% '
durationChanged
( 7
||
8 :
ratioChanged
; G
)
G H
{
I J
settings
  
.
  !#
TrackTitleColumnWidth
! 6
=
7 8
clampedTitleWidth
9 J
;
J K
settings
  
.
  !!
DurationColumnWidth
! 4
=
5 6"
clampedDurationWidth
7 K
;
K L
settings
  
.
  !(
TitleDurationSplitterRatio
! ;
=
< ="
clampedSplitterRatio
> R
;
R S
PerformanceStats
ขข (
.
ขข( ))
RecordStarSizingCalculation
ขข) D
(
ขขD E
)
ขขE F
;
ขขF G
System
คค 
.
คค 
Diagnostics
คค *
.
คค* +
Debug
คค+ 0
.
คค0 1
	WriteLine
คค1 :
(
คค: ;
$"
คค; =
$str
คค= x
{
คคx y 
clampedTitleWidthคคy 
:คค 
$strคค 
}คค 
$strคค 
{คค $
clampedDurationWidthคค ฑ
:คคฑ ฒ
$strคคฒ ด
}คคด ต
$strคคต ภ
{คคภ ม$
clampedSplitterRatioคคม ี
:คคี ึ
$strคคึ ุ
}คคุ ู
"คคู ฺ
)คคฺ 
;คค 
}
ฅฅ 
}
ฆฆ 
}
งง 
catch
จจ 
(
จจ 
	Exception
จจ 
ex
จจ 
)
จจ  
{
จจ! "
System
ฉฉ 
.
ฉฉ 
Diagnostics
ฉฉ "
.
ฉฉ" #
Debug
ฉฉ# (
.
ฉฉ( )
	WriteLine
ฉฉ) 2
(
ฉฉ2 3
$"
ฉฉ3 5
$str
ฉฉ5 ^
{
ฉฉ^ _
ex
ฉฉ_ a
.
ฉฉa b
Message
ฉฉb i
}
ฉฉi j
"
ฉฉj k
)
ฉฉk l
;
ฉฉl m
}
ชช 
}
ซซ 	
private
ดด 
void
ดด 
OnDataGridLoaded
ดด %
(
ดด% &
object
ดด& ,
sender
ดด- 3
,
ดด3 4
System
ดด5 ;
.
ดด; <
Windows
ดด< C
.
ดดC D
RoutedEventArgs
ดดD S
e
ดดT U
)
ดดU V
{
ดดW X
LoadColumnWidths
ตต 
(
ตต 
)
ตต 
;
ตต 
}
ถถ 	
private
ปป 
void
ปป 
OnColumnChanged
ปป $
(
ปป$ %
object
ปป% +
sender
ปป, 2
,
ปป2 3%
DataGridColumnEventArgs
ปป4 K
e
ปปL M
)
ปปM N
{
ปปO P
ScheduleSave
ผผ 
(
ผผ 
)
ผผ 
;
ผผ 
}
ฝฝ 	
private
รร 
void
รร 
OnColumnReordered
รร &
(
รร& '
object
รร' -
sender
รร. 4
,
รร4 5%
DataGridColumnEventArgs
รร6 M
e
รรN O
)
รรO P
{
รรQ R
ScheduleSave
ลล 
(
ลล 
)
ลล 
;
ลล 
System
ฦฦ 
.
ฦฦ 
Diagnostics
ฦฦ 
.
ฦฦ 
Debug
ฦฦ $
.
ฦฦ$ %
	WriteLine
ฦฦ% .
(
ฦฦ. /
$str
ฦฦ/ [
)
ฦฦ[ \
;
ฦฦ\ ]
}
วว 	
private
ออ 
void
ออ 
OnLayoutUpdated
ออ $
(
ออ$ %
object
ออ% +
sender
ออ, 2
,
ออ2 3
	EventArgs
ออ4 =
e
ออ> ?
)
ออ? @
{
ออA B
if
ฮฮ 
(
ฮฮ 
	_dataGrid
ฮฮ 
.
ฮฮ 
IsLoaded
ฮฮ "
&&
ฮฮ# %
	_dataGrid
ฮฮ& /
.
ฮฮ/ 0
Columns
ฮฮ0 7
.
ฮฮ7 8
Count
ฮฮ8 =
>=
ฮฮ> @
$num
ฮฮA B
)
ฮฮB C
{
ฮฮD E
var
าา 
hasValidWidths
าา "
=
าา# $
	_dataGrid
าา% .
.
าา. /
Columns
าา/ 6
[
าา6 7
$num
าา7 8
]
าา8 9
.
าา9 :
ActualWidth
าา: E
>
าาF G
$num
าาH I
&&
าาJ L
	_dataGrid
ำำ# ,
.
ำำ, -
Columns
ำำ- 4
[
ำำ4 5
$num
ำำ5 6
]
ำำ6 7
.
ำำ7 8
ActualWidth
ำำ8 C
>
ำำD E
$num
ำำF I
&&
ำำJ L
	_dataGrid
ิิ# ,
.
ิิ, -
Columns
ิิ- 4
[
ิิ4 5
$num
ิิ5 6
]
ิิ6 7
.
ิิ7 8
ActualWidth
ิิ8 C
>
ิิD E
$num
ิิF H
;
ิิH I
if
ึึ 
(
ึึ 
hasValidWidths
ึึ "
)
ึึ" #
{
ึึ$ %
ScheduleSave
ืื  
(
ืื  !
)
ืื! "
;
ืื" #
}
ุุ 
}
ูู 
}
ฺฺ 	
private
฿฿ 
void
฿฿ 
OnSaveTimerTick
฿฿ $
(
฿฿$ %
object
฿฿% +
sender
฿฿, 2
,
฿฿2 3
	EventArgs
฿฿4 =
e
฿฿> ?
)
฿฿? @
{
฿฿A B

_saveTimer
เเ 
.
เเ 
Stop
เเ 
(
เเ 
)
เเ 
;
เเ 
SaveColumnWidths
แแ 
(
แแ 
)
แแ 
;
แแ 
}
โโ 	
public
์์ 
class
์์ 
PerformanceStats
์์ %
{
์์& '
public
๎๎ 
static
๎๎ 
int
๎๎  
SaveOperationCount
๎๎ 0
{
๎๎1 2
get
๎๎3 6
;
๎๎6 7
private
๎๎8 ?
set
๎๎@ C
;
๎๎C D
}
๎๎E F
public
๑๑ 
static
๑๑ 
int
๑๑  
LoadOperationCount
๑๑ 0
{
๑๑1 2
get
๑๑3 6
;
๑๑6 7
private
๑๑8 ?
set
๑๑@ C
;
๑๑C D
}
๑๑E F
public
๔๔ 
static
๔๔ 
int
๔๔ $
StarSizingCalculations
๔๔ 4
{
๔๔5 6
get
๔๔7 :
;
๔๔: ;
private
๔๔< C
set
๔๔D G
;
๔๔G H
}
๔๔I J
internal
๗๗ 
static
๗๗ 
void
๗๗  

RecordSave
๗๗! +
(
๗๗+ ,
)
๗๗, -
{
๗๗. / 
SaveOperationCount
๘๘ "
++
๘๘" $
;
๘๘$ %
}
๙๙ 
internal
 
static
 
void
  

RecordLoad
! +
(
+ ,
)
, -
{
. / 
LoadOperationCount
 "
++
" $
;
$ %
}
 
internal
 
static
 
void
  )
RecordStarSizingCalculation
! <
(
< =
)
= >
{
? @$
StarSizingCalculations
 &
++
& (
;
( )
}
 
public
 
static
 
void
 
Reset
 $
(
$ %
)
% &
{
' ( 
SaveOperationCount
 "
=
# $
$num
% &
;
& ' 
LoadOperationCount
 "
=
# $
$num
% &
;
& '$
StarSizingCalculations
 &
=
' (
$num
) *
;
* +
}
 
public
 
static
 
string
  

GetSummary
! +
(
+ ,
)
, -
{
. /
return
 
$"
 
$str
  
{
  ! 
SaveOperationCount
! 3
}
3 4
$str
4 =
{
= > 
LoadOperationCount
> P
}
P Q
$str
Q ^
{
^ _$
StarSizingCalculations
_ u
}
u v
"
v w
;
w x
}
 
}
 	
public
 
void
 
Dispose
 
(
 
)
 
{
 
if
 
(
 
!
 
	_disposed
 
)
 
{
 

_saveTimer
 
?
 
.
 
Stop
  
(
  !
)
! "
;
" #
SaveColumnWidths
  
(
  !
)
! "
;
" ##
UnsubscribeFromEvents
 %
(
% &
)
& '
;
' (

_saveTimer
ฃฃ 
?
ฃฃ 
.
ฃฃ 
Stop
ฃฃ  
(
ฃฃ  !
)
ฃฃ! "
;
ฃฃ" #
	_disposed
ฅฅ 
=
ฅฅ 
true
ฅฅ  
;
ฅฅ  !
}
ฆฆ 
}
งง 	
}
ชช 
}ซซ ๅ`
BC:\Playnite\_github\OstPlayer\source\Utils\AsyncMusicFileHelper.cs
	namespacedd 	
	OstPlayerdd
 
.dd 
Utilsdd 
{dd 
publicll 

classll 
FileProgressInfoll !
{ll" #
publicnn 
intnn 
Currentnn 
{nn 
getnn  
;nn  !
setnn" %
;nn% &
}nn' (
publicqq 
intqq 
Totalqq 
{qq 
getqq 
;qq 
setqq  #
;qq# $
}qq% &
publictt 
doublett 
PercentCompletett %
=>tt& (
Totaltt) .
>tt/ 0
$numtt1 2
?tt3 4
(tt5 6
doublett6 <
)tt< =
Currenttt= D
/ttE F
TotalttG L
*ttM N
$numttO R
:ttS T
$numttU V
;ttV W
}uu 
public|| 

class||  
MetadataProgressInfo|| %
{||& '
public~~ 
int~~ 
Current~~ 
{~~ 
get~~  
;~~  !
set~~" %
;~~% &
}~~' (
public
 
int
 
Total
 
{
 
get
 
;
 
set
  #
;
# $
}
% &
public
 
string
 
CurrentFile
 !
{
" #
get
$ '
;
' (
set
) ,
;
, -
}
. /
public
 
double
 
PercentComplete
 %
=>
& (
Total
) .
>
/ 0
$num
1 2
?
3 4
(
5 6
double
6 <
)
< =
Current
= D
/
E F
Total
G L
*
M N
$num
O R
:
S T
$num
U V
;
V W
public
 
TimeSpan
 
?
 $
EstimatedTimeRemaining
 /
{
0 1
get
2 5
;
5 6
set
7 :
;
: ;
}
< =
}
 
public
 

static
 
class
 "
AsyncMusicFileHelper
 ,
{
- .
public
ฃฃ 
static
ฃฃ 
async
ฃฃ 
Task
ฃฃ  
<
ฃฃ  !
List
ฃฃ! %
<
ฃฃ% &
string
ฃฃ& ,
>
ฃฃ, -
>
ฃฃ- .$
GetGameMusicFilesAsync
ฃฃ/ E
(
ฃฃE F
IPlayniteAPI
คค 
api
คค 
,
คค 
Game
ฅฅ 
game
ฅฅ 
,
ฅฅ 
	IProgress
ฆฆ 
<
ฆฆ 
FileProgressInfo
ฆฆ &
>
ฆฆ& '
progress
ฆฆ( 0
=
ฆฆ1 2
null
ฆฆ3 7
,
ฆฆ7 8
CancellationToken
งง 
cancellationToken
งง /
=
งง0 1
default
งง2 9
)
งง9 :
{
งง; <
if
ฉฉ 
(
ฉฉ 
game
ฉฉ 
==
ฉฉ 
null
ฉฉ 
)
ฉฉ 
return
ชช 
new
ชช 
List
ชช 
<
ชช  
string
ชช  &
>
ชช& '
(
ชช' (
)
ชช( )
;
ชช) *
var
ญญ 
	musicPath
ญญ 
=
ญญ 
MusicFileHelper
ญญ +
.
ญญ+ ,
GetGameMusicPath
ญญ, <
(
ญญ< =
api
ญญ= @
,
ญญ@ A
game
ญญB F
)
ญญF G
;
ญญG H
if
ฎฎ 
(
ฎฎ 
string
ฎฎ 
.
ฎฎ 
IsNullOrEmpty
ฎฎ $
(
ฎฎ$ %
	musicPath
ฎฎ% .
)
ฎฎ. /
)
ฎฎ/ 0
return
ฏฏ 
new
ฏฏ 
List
ฏฏ 
<
ฏฏ  
string
ฏฏ  &
>
ฏฏ& '
(
ฏฏ' (
)
ฏฏ( )
;
ฏฏ) *
return
ฒฒ 
await
ฒฒ 
Task
ฒฒ 
.
ฒฒ 
Run
ฒฒ !
(
ฒฒ! "
async
ฒฒ" '
(
ฒฒ( )
)
ฒฒ) *
=>
ฒฒ+ -
{
ฒฒ. /
try
ณณ 
{
ณณ 
var
ถถ 
files
ถถ 
=
ถถ 
	Directory
ถถ  )
.
ถถ) *
GetFiles
ถถ* 2
(
ถถ2 3
	musicPath
ถถ3 <
,
ถถ< =
$str
ถถ> E
,
ถถE F
SearchOption
ถถG S
.
ถถS T
TopDirectoryOnly
ถถT d
)
ถถd e
;
ถถe f
var
ทท 
sortedFiles
ทท #
=
ทท$ %
new
ทท& )
List
ทท* .
<
ทท. /
string
ทท/ 5
>
ทท5 6
(
ทท6 7
)
ทท7 8
;
ทท8 9
for
บบ 
(
บบ 
int
บบ 
i
บบ 
=
บบ  
$num
บบ! "
;
บบ" #
i
บบ$ %
<
บบ& '
files
บบ( -
.
บบ- .
Length
บบ. 4
;
บบ4 5
i
บบ6 7
++
บบ7 9
)
บบ9 :
{
บบ; <
cancellationToken
ฝฝ )
.
ฝฝ) **
ThrowIfCancellationRequested
ฝฝ* F
(
ฝฝF G
)
ฝฝG H
;
ฝฝH I
sortedFiles
ภภ #
.
ภภ# $
Add
ภภ$ '
(
ภภ' (
files
ภภ( -
[
ภภ- .
i
ภภ. /
]
ภภ/ 0
)
ภภ0 1
;
ภภ1 2
progress
รร  
?
รร  !
.
รร! "
Report
รร" (
(
รร( )
new
รร) ,
FileProgressInfo
รร- =
{
รร> ?
Current
ฤฤ #
=
ฤฤ$ %
i
ฤฤ& '
+
ฤฤ( )
$num
ฤฤ* +
,
ฤฤ+ ,
Total
ลล !
=
ลล" #
files
ลล$ )
.
ลล) *
Length
ลล* 0
}
ฦฦ 
)
ฦฦ 
;
ฦฦ 
if
หห 
(
หห 
i
หห 
%
หห 
$num
หห  "
==
หห# %
$num
หห& '
)
หห' (
await
ฬฬ !
Task
ฬฬ" &
.
ฬฬ& '
Delay
ฬฬ' ,
(
ฬฬ, -
$num
ฬฬ- .
,
ฬฬ. /
cancellationToken
ฬฬ0 A
)
ฬฬA B
;
ฬฬB C
}
ออ 
return
ัั 
sortedFiles
ัั &
.
ัั& '
OrderBy
ัั' .
(
ัั. /
f
ัั/ 0
=>
ัั1 3
Path
ัั4 8
.
ัั8 9)
GetFileNameWithoutExtension
ัั9 T
(
ััT U
f
ััU V
)
ััV W
)
ััW X
.
ััX Y
ToList
ััY _
(
ัั_ `
)
ัั` a
;
ััa b
}
าา 
catch
ำำ 
(
ำำ (
OperationCanceledException
ำำ 1
)
ำำ1 2
{
ำำ3 4
throw
ีี 
;
ีี 
}
ึึ 
catch
ืื 
(
ืื 
	Exception
ืื  
)
ืื  !
{
ืื" #
return
 
new
 
List
 #
<
# $
string
$ *
>
* +
(
+ ,
)
, -
;
- .
}
 
}
 
,
 
cancellationToken
  
)
  !
;
! "
}
 	
public
๎๎ 
static
๎๎ 
async
๎๎ 
Task
๎๎  
<
๎๎  !

Dictionary
๎๎! +
<
๎๎+ ,
string
๎๎, 2
,
๎๎2 3
Models
๎๎4 :
.
๎๎: ; 
TrackMetadataModel
๎๎; M
>
๎๎M N
>
๎๎N O'
LoadMetadataForFilesAsync
๎๎P i
(
๎๎i j
IEnumerable
๏๏ 
<
๏๏ 
string
๏๏ 
>
๏๏ 
	filePaths
๏๏  )
,
๏๏) *
	IProgress
๐๐ 
<
๐๐ "
MetadataProgressInfo
๐๐ *
>
๐๐* +
progress
๐๐, 4
=
๐๐5 6
null
๐๐7 ;
,
๐๐; <
CancellationToken
๑๑ 
cancellationToken
๑๑ /
=
๑๑0 1
default
๑๑2 9
)
๑๑9 :
{
๑๑; <
var
๔๔ 
files
๔๔ 
=
๔๔ 
	filePaths
๔๔ !
.
๔๔! "
ToList
๔๔" (
(
๔๔( )
)
๔๔) *
;
๔๔* +
var
๕๕ 
results
๕๕ 
=
๕๕ 
new
๕๕ 

Dictionary
๕๕ (
<
๕๕( )
string
๕๕) /
,
๕๕/ 0
Models
๕๕1 7
.
๕๕7 8 
TrackMetadataModel
๕๕8 J
>
๕๕J K
(
๕๕K L
)
๕๕L M
;
๕๕M N
for
๙๙ 
(
๙๙ 
int
๙๙ 
i
๙๙ 
=
๙๙ 
$num
๙๙ 
;
๙๙ 
i
๙๙ 
<
๙๙ 
files
๙๙  %
.
๙๙% &
Count
๙๙& +
;
๙๙+ ,
i
๙๙- .
++
๙๙. 0
)
๙๙0 1
{
๙๙2 3
cancellationToken
๛๛ !
.
๛๛! "*
ThrowIfCancellationRequested
๛๛" >
(
๛๛> ?
)
๛๛? @
;
๛๛@ A
var
 
filePath
 
=
 
files
 $
[
$ %
i
% &
]
& '
;
' (
progress
 
?
 
.
 
Report
  
(
  !
new
! $"
MetadataProgressInfo
% 9
{
: ;
Current
 
=
 
i
 
+
  !
$num
" #
,
# $
Total
 
=
 
files
 !
.
! "
Count
" '
,
' (
CurrentFile
 
=
  !
Path
" &
.
& ')
GetFileNameWithoutExtension
' B
(
B C
filePath
C K
)
K L
}
 
)
 
;
 
var
 
metadata
 
=
 
await
 $
Task
% )
.
) *
Run
* -
(
- .
(
. /
)
/ 0
=>
1 3
Mp3MetadataReader
4 E
.
E F
ReadMetadata
F R
(
R S
filePath
S [
)
[ \
,
\ ]
cancellationToken
^ o
)
o p
;
p q
if
 
(
 
metadata
 
!=
 
null
  $
)
$ %
{
& '
results
 
[
 
filePath
 $
]
$ %
=
& '
metadata
( 0
;
0 1
}
 
await
 
Task
 
.
 
Delay
  
(
  !
$num
! "
,
" #
cancellationToken
$ 5
)
5 6
;
6 7
}
 
return
 
results
 
;
 
}
 	
public
คค 
static
คค 
async
คค 
Task
คค  
<
คค  !
bool
คค! %
>
คค% &$
ValidateMusicFileAsync
คค' =
(
คค= >
string
คค> D
filePath
คคE M
,
คคM N
CancellationToken
คคO `
cancellationToken
คคa r
=
คคs t
default
คคu |
)
คค| }
{
คค~ 
if
ฆฆ 
(
ฆฆ 
string
ฆฆ 
.
ฆฆ 
IsNullOrEmpty
ฆฆ $
(
ฆฆ$ %
filePath
ฆฆ% -
)
ฆฆ- .
||
ฆฆ/ 1
!
ฆฆ2 3
File
ฆฆ3 7
.
ฆฆ7 8
Exists
ฆฆ8 >
(
ฆฆ> ?
filePath
ฆฆ? G
)
ฆฆG H
)
ฆฆH I
return
งง 
false
งง 
;
งง 
return
ชช 
await
ชช 
Task
ชช 
.
ชช 
Run
ชช !
(
ชช! "
(
ชช" #
)
ชช# $
=>
ชช% '
{
ชช( )
try
ซซ 
{
ซซ 
cancellationToken
ญญ %
.
ญญ% &*
ThrowIfCancellationRequested
ญญ& B
(
ญญB C
)
ญญC D
;
ญญD E
using
ฒฒ 
(
ฒฒ 
var
ฒฒ 
audioFileReader
ฒฒ .
=
ฒฒ/ 0
new
ฒฒ1 4
NAudio
ฒฒ5 ;
.
ฒฒ; <
Wave
ฒฒ< @
.
ฒฒ@ A
AudioFileReader
ฒฒA P
(
ฒฒP Q
filePath
ฒฒQ Y
)
ฒฒY Z
)
ฒฒZ [
{
ฒฒ\ ]
return
ตต 
audioFileReader
ตต .
.
ตต. /
	TotalTime
ตต/ 8
.
ตต8 9
TotalSeconds
ตต9 E
>
ตตF G
$num
ตตH I
;
ตตI J
}
ถถ 
}
ทท 
catch
ธธ 
{
ธธ 
return
ผผ 
false
ผผ  
;
ผผ  !
}
ฝฝ 
}
พพ 
,
พพ 
cancellationToken
พพ  
)
พพ  !
;
พพ! "
}
ฟฟ 	
}
ฎฎ 
}ฏฏ 
AC:\Playnite\_github\OstPlayer\source\Services\ServiceContainer.cs
	namespace 	
	OstPlayer
 
. 
Services 
{ 
public
 

enum
 
ServiceLifetime
 
{
 
	Singleton
 
,
 
	Transient
 
,
 
Scoped
 
,
 
}
 
public
 

class
 
ServiceDescriptor
 "
{
 
public
 
Type
 
ServiceType
 
{
  !
get
" %
;
% &
set
' *
;
* +
}
, -
public
 
Type
  
ImplementationType
 &
{
' (
get
) ,
;
, -
set
. 1
;
1 2
}
3 4
public
 
ServiceLifetime
 
Lifetime
 '
{
( )
get
* -
;
- .
set
/ 2
;
2 3
}
4 5
public
 
Func
 
<
 
IServiceProvider
 $
,
$ %
object
& ,
>
, -
Factory
. 5
{
6 7
get
8 ;
;
; <
set
= @
;
@ A
}
B C
public
 
object
 
SingletonInstance
 '
{
( )
get
* -
;
- .
set
/ 2
;
2 3
}
4 5
public
 
ServiceDescriptor
  
(
  !
Type
 
serviceType
 
,
 
Type
  
implementationType
 #
,
# $
ServiceLifetime
 
lifetime
 $
)
 	
{
 	
ServiceType
 
=
 
serviceType
 %
;
% & 
ImplementationType
 
=
   
implementationType
! 3
;
3 4
Lifetime
 
=
 
lifetime
 
;
  
}
 	
public
 
ServiceDescriptor
  
(
  !
Type
 
serviceType
 
,
 
Func
 
<
 
IServiceProvider
 !
,
! "
object
# )
>
) *
factory
+ 2
,
2 3
ServiceLifetime
 
lifetime
 $
)
กก 	
{
ขข 	
ServiceType
ฃฃ 
=
ฃฃ 
serviceType
ฃฃ %
;
ฃฃ% &
Factory
คค 
=
คค 
factory
คค 
;
คค 
Lifetime
ฅฅ 
=
ฅฅ 
lifetime
ฅฅ 
;
ฅฅ  
}
ฆฆ 	
}
งง 
public
ชช 

class
ชช 
ServiceScope
ชช 
:
ชช 
IDisposable
ชช  +
{
ซซ 
private
ฌฌ 
readonly
ฌฌ "
ConcurrentDictionary
ฌฌ -
<
ฌฌ- .
Type
ฌฌ. 2
,
ฌฌ2 3
object
ฌฌ4 :
>
ฌฌ: ;
_scopedServices
ฌฌ< K
;
ฌฌK L
private
ญญ 
readonly
ญญ 
List
ญญ 
<
ญญ 
IDisposable
ญญ )
>
ญญ) *
_disposables
ญญ+ 7
;
ญญ7 8
private
ฎฎ 
bool
ฎฎ 
	_disposed
ฎฎ 
=
ฎฎ  
false
ฎฎ! &
;
ฎฎ& '
public
ฐฐ 
ServiceScope
ฐฐ 
(
ฐฐ 
)
ฐฐ 
{
ฑฑ 	
_scopedServices
ฒฒ 
=
ฒฒ 
new
ฒฒ !"
ConcurrentDictionary
ฒฒ" 6
<
ฒฒ6 7
Type
ฒฒ7 ;
,
ฒฒ; <
object
ฒฒ= C
>
ฒฒC D
(
ฒฒD E
)
ฒฒE F
;
ฒฒF G
_disposables
ณณ 
=
ณณ 
new
ณณ 
List
ณณ #
<
ณณ# $
IDisposable
ณณ$ /
>
ณณ/ 0
(
ณณ0 1
)
ณณ1 2
;
ณณ2 3
}
ดด 	
public
ถถ 
T
ถถ 
GetScopedService
ถถ !
<
ถถ! "
T
ถถ" #
>
ถถ# $
(
ถถ$ %
Func
ถถ% )
<
ถถ) *
T
ถถ* +
>
ถถ+ ,
factory
ถถ- 4
)
ถถ4 5
{
ทท 	
if
ธธ 
(
ธธ 
	_disposed
ธธ 
)
ธธ 
throw
นน 
new
นน %
ObjectDisposedException
นน 1
(
นน1 2
nameof
นน2 8
(
นน8 9
ServiceScope
นน9 E
)
นนE F
)
นนF G
;
นนG H
return
ปป 
(
ปป 
T
ปป 
)
ปป 
_scopedServices
ผผ 
.
ผผ  
GetOrAdd
ผผ  (
(
ผผ( )
typeof
ฝฝ 
(
ฝฝ 
T
ฝฝ 
)
ฝฝ 
,
ฝฝ 
_
พพ 
=>
พพ 
{
ฟฟ 
var
ภภ 
instance
ภภ $
=
ภภ% &
factory
ภภ' .
(
ภภ. /
)
ภภ/ 0
;
ภภ0 1
if
มม 
(
มม 
instance
มม $
is
มม% '
IDisposable
มม( 3

disposable
มม4 >
)
มม> ?
{
ยย 
lock
รร  
(
รร! "
_disposables
รร" .
)
รร. /
{
ฤฤ 
_disposables
ลล  ,
.
ลล, -
Add
ลล- 0
(
ลล0 1

disposable
ลล1 ;
)
ลล; <
;
ลล< =
}
ฦฦ 
}
วว 
return
ศศ 
instance
ศศ '
;
ศศ' (
}
ษษ 
)
สส 
;
สส 
}
หห 	
public
ออ 
void
ออ 
Dispose
ออ 
(
ออ 
)
ออ 
{
ฮฮ 	
if
ฯฯ 
(
ฯฯ 
!
ฯฯ 
	_disposed
ฯฯ 
)
ฯฯ 
{
ะะ 
lock
ัั 
(
ัั 
_disposables
ัั "
)
ัั" #
{
าา 
foreach
ำำ 
(
ำำ 
var
ำำ  

disposable
ำำ! +
in
ำำ, .
_disposables
ำำ/ ;
)
ำำ; <
{
ิิ 
try
ีี 
{
ึึ 

disposable
ืื &
.
ืื& '
Dispose
ืื' .
(
ืื. /
)
ืื/ 0
;
ืื0 1
}
ุุ 
catch
ูู 
{
ฺฺ 
}
 
}
 
_disposables
  
.
  !
Clear
! &
(
& '
)
' (
;
( )
}
฿฿ 
_scopedServices
แแ 
.
แแ  
Clear
แแ  %
(
แแ% &
)
แแ& '
;
แแ' (
	_disposed
โโ 
=
โโ 
true
โโ  
;
โโ  !
}
ใใ 
}
ไไ 	
}
ๅๅ 
public
่่ 

	interface
่่ 
IServiceProvider
่่ %
{
้้ 
T
๊๊ 	

GetService
๊๊
 
<
๊๊ 
T
๊๊ 
>
๊๊ 
(
๊๊ 
)
๊๊ 
;
๊๊ 
object
๋๋ 

GetService
๋๋ 
(
๋๋ 
Type
๋๋ 
serviceType
๋๋ *
)
๋๋* +
;
๋๋+ ,
T
์์ 	 
GetRequiredService
์์
 
<
์์ 
T
์์ 
>
์์ 
(
์์  
)
์์  !
;
์์! "
object
ํํ  
GetRequiredService
ํํ !
(
ํํ! "
Type
ํํ" &
serviceType
ํํ' 2
)
ํํ2 3
;
ํํ3 4
IServiceScope
๎๎ 
CreateScope
๎๎ !
(
๎๎! "
)
๎๎" #
;
๎๎# $
}
๏๏ 
public
๑๑ 

	interface
๑๑ 
IServiceScope
๑๑ "
:
๑๑# $
IDisposable
๑๑% 0
{
๒๒ 
IServiceProvider
๓๓ 
ServiceProvider
๓๓ (
{
๓๓) *
get
๓๓+ .
;
๓๓. /
}
๓๓0 1
}
๔๔ 
public
๗๗ 

class
๗๗ 
ServiceContainer
๗๗ !
:
๗๗" #
IServiceProvider
๗๗$ 4
{
๘๘ 
private
๛๛ 
static
๛๛ 
readonly
๛๛ 
Lazy
๛๛  $
<
๛๛$ %
ServiceContainer
๛๛% 5
>
๛๛5 6
	_instance
๛๛7 @
=
๛๛A B
new
๛๛C F
Lazy
๛๛G K
<
๛๛K L
ServiceContainer
๛๛L \
>
๛๛\ ]
(
๛๛] ^
(
๛๛^ _
)
๛๛_ `
=>
๛๛a c
new
 
ServiceContainer
  
(
  !
)
! "
)
 	
;
	 

private
 
readonly
 "
ConcurrentDictionary
 -
<
- .
Type
. 2
,
2 3
ServiceDescriptor
4 E
>
E F
	_services
G P
;
P Q
private
 
readonly
 "
ReaderWriterLockSlim
 -
_lock
. 3
;
3 4
private
 
readonly
 
ThreadLocal
 $
<
$ %
ServiceScope
% 1
>
1 2
_currentScope
3 @
;
@ A
private
 
readonly
 
ThreadLocal
 $
<
$ %
HashSet
% ,
<
, -
Type
- 1
>
1 2
>
2 3
_resolutionStack
4 D
;
D E
public
 
static
 
ServiceContainer
 &
Instance
' /
=>
0 2
	_instance
3 <
.
< =
Value
= B
;
B C
private
 
ServiceContainer
  
(
  !
)
! "
{
 	
	_services
 
=
 
new
 "
ConcurrentDictionary
 0
<
0 1
Type
1 5
,
5 6
ServiceDescriptor
7 H
>
H I
(
I J
)
J K
;
K L
_lock
 
=
 
new
 "
ReaderWriterLockSlim
 ,
(
, -
)
- .
;
. /
_currentScope
 
=
 
new
 
ThreadLocal
  +
<
+ ,
ServiceScope
, 8
>
8 9
(
9 :
)
: ;
;
; <
_resolutionStack
 
=
 
new
 "
ThreadLocal
# .
<
. /
HashSet
/ 6
<
6 7
Type
7 ;
>
; <
>
< =
(
= >
(
> ?
)
? @
=>
A C
new
D G
HashSet
H O
<
O P
Type
P T
>
T U
(
U V
)
V W
)
W X
;
X Y
}
 	
public
 
void
 
RegisterSingleton
 %
<
% &

TInterface
& 0
,
0 1
TImplementation
2 A
>
A B
(
B C
)
C D
where
 
TImplementation
 !
:
" #
class
$ )
,
) *

TInterface
+ 5
{
 	
RegisterSingleton
 
(
 
typeof
 $
(
$ %

TInterface
% /
)
/ 0
,
0 1
typeof
2 8
(
8 9
TImplementation
9 H
)
H I
)
I J
;
J K
}
กก 	
public
ฆฆ 
void
ฆฆ 
RegisterSingleton
ฆฆ %
<
ฆฆ% &

TInterface
ฆฆ& 0
>
ฆฆ0 1
(
ฆฆ1 2
Func
ฆฆ2 6
<
ฆฆ6 7
IServiceProvider
ฆฆ7 G
,
ฆฆG H

TInterface
ฆฆI S
>
ฆฆS T
factory
ฆฆU \
)
ฆฆ\ ]
{
งง 	
var
จจ 

descriptor
จจ 
=
จจ 
new
จจ  
ServiceDescriptor
จจ! 2
(
จจ2 3
typeof
ฉฉ 
(
ฉฉ 

TInterface
ฉฉ !
)
ฉฉ! "
,
ฉฉ" #
provider
ชช 
=>
ชช 
factory
ชช #
(
ชช# $
provider
ชช$ ,
)
ชช, -
,
ชช- .
ServiceLifetime
ซซ 
.
ซซ  
	Singleton
ซซ  )
)
ฌฌ 
;
ฌฌ 
	_services
ญญ 
.
ญญ 
TryAdd
ญญ 
(
ญญ 
typeof
ญญ #
(
ญญ# $

TInterface
ญญ$ .
)
ญญ. /
,
ญญ/ 0

descriptor
ญญ1 ;
)
ญญ; <
;
ญญ< =
}
ฎฎ 	
public
ณณ 
void
ณณ 
RegisterSingleton
ณณ %
<
ณณ% &

TInterface
ณณ& 0
>
ณณ0 1
(
ณณ1 2

TInterface
ณณ2 <
instance
ณณ= E
)
ณณE F
{
ดด 	
var
ตต 

descriptor
ตต 
=
ตต 
new
ตต  
ServiceDescriptor
ตต! 2
(
ตต2 3
typeof
ถถ 
(
ถถ 

TInterface
ถถ !
)
ถถ! "
,
ถถ" #
typeof
ทท 
(
ทท 

TInterface
ทท !
)
ทท! "
,
ทท" #
ServiceLifetime
ธธ 
.
ธธ  
	Singleton
ธธ  )
)
นน 
{
บบ 
SingletonInstance
ปป !
=
ปป" #
instance
ปป$ ,
,
ปป, -
}
ผผ 
;
ผผ 
	_services
ฝฝ 
.
ฝฝ 
TryAdd
ฝฝ 
(
ฝฝ 
typeof
ฝฝ #
(
ฝฝ# $

TInterface
ฝฝ$ .
)
ฝฝ. /
,
ฝฝ/ 0

descriptor
ฝฝ1 ;
)
ฝฝ; <
;
ฝฝ< =
}
พพ 	
public
รร 
void
รร 
RegisterTransient
รร %
<
รร% &

TInterface
รร& 0
,
รร0 1
TImplementation
รร2 A
>
รรA B
(
รรB C
)
รรC D
where
ฤฤ 
TImplementation
ฤฤ !
:
ฤฤ" #
class
ฤฤ$ )
,
ฤฤ) *

TInterface
ฤฤ+ 5
{
ลล 	
RegisterTransient
ฦฦ 
(
ฦฦ 
typeof
ฦฦ $
(
ฦฦ$ %

TInterface
ฦฦ% /
)
ฦฦ/ 0
,
ฦฦ0 1
typeof
ฦฦ2 8
(
ฦฦ8 9
TImplementation
ฦฦ9 H
)
ฦฦH I
)
ฦฦI J
;
ฦฦJ K
}
วว 	
public
ฬฬ 
void
ฬฬ 
RegisterTransient
ฬฬ %
<
ฬฬ% &

TInterface
ฬฬ& 0
>
ฬฬ0 1
(
ฬฬ1 2
Func
ฬฬ2 6
<
ฬฬ6 7
IServiceProvider
ฬฬ7 G
,
ฬฬG H

TInterface
ฬฬI S
>
ฬฬS T
factory
ฬฬU \
)
ฬฬ\ ]
{
ออ 	
var
ฮฮ 

descriptor
ฮฮ 
=
ฮฮ 
new
ฮฮ  
ServiceDescriptor
ฮฮ! 2
(
ฮฮ2 3
typeof
ฯฯ 
(
ฯฯ 

TInterface
ฯฯ !
)
ฯฯ! "
,
ฯฯ" #
provider
ะะ 
=>
ะะ 
factory
ะะ #
(
ะะ# $
provider
ะะ$ ,
)
ะะ, -
,
ะะ- .
ServiceLifetime
ัั 
.
ัั  
	Transient
ัั  )
)
าา 
;
าา 
	_services
ำำ 
.
ำำ 
TryAdd
ำำ 
(
ำำ 
typeof
ำำ #
(
ำำ# $

TInterface
ำำ$ .
)
ำำ. /
,
ำำ/ 0

descriptor
ำำ1 ;
)
ำำ; <
;
ำำ< =
}
ิิ 	
public
ูู 
void
ูู 
RegisterScoped
ูู "
<
ูู" #

TInterface
ูู# -
,
ูู- .
TImplementation
ูู/ >
>
ูู> ?
(
ูู? @
)
ูู@ A
where
ฺฺ 
TImplementation
ฺฺ !
:
ฺฺ" #
class
ฺฺ$ )
,
ฺฺ) *

TInterface
ฺฺ+ 5
{
 	
RegisterScoped
 
(
 
typeof
 !
(
! "

TInterface
" ,
)
, -
,
- .
typeof
/ 5
(
5 6
TImplementation
6 E
)
E F
)
F G
;
G H
}
 	
public
โโ 
void
โโ 
RegisterScoped
โโ "
<
โโ" #

TInterface
โโ# -
>
โโ- .
(
โโ. /
Func
โโ/ 3
<
โโ3 4
IServiceProvider
โโ4 D
,
โโD E

TInterface
โโF P
>
โโP Q
factory
โโR Y
)
โโY Z
{
ใใ 	
var
ไไ 

descriptor
ไไ 
=
ไไ 
new
ไไ  
ServiceDescriptor
ไไ! 2
(
ไไ2 3
typeof
ๅๅ 
(
ๅๅ 

TInterface
ๅๅ !
)
ๅๅ! "
,
ๅๅ" #
provider
ๆๆ 
=>
ๆๆ 
factory
ๆๆ #
(
ๆๆ# $
provider
ๆๆ$ ,
)
ๆๆ, -
,
ๆๆ- .
ServiceLifetime
็็ 
.
็็  
Scoped
็็  &
)
่่ 
;
่่ 
	_services
้้ 
.
้้ 
TryAdd
้้ 
(
้้ 
typeof
้้ #
(
้้# $

TInterface
้้$ .
)
้้. /
,
้้/ 0

descriptor
้้1 ;
)
้้; <
;
้้< =
}
๊๊ 	
private
๐๐ 
void
๐๐ 
RegisterSingleton
๐๐ &
(
๐๐& '
Type
๐๐' +
serviceType
๐๐, 7
,
๐๐7 8
Type
๐๐9 = 
implementationType
๐๐> P
)
๐๐P Q
{
๑๑ 	
var
๒๒ 

descriptor
๒๒ 
=
๒๒ 
new
๒๒  
ServiceDescriptor
๒๒! 2
(
๒๒2 3
serviceType
๓๓ 
,
๓๓  
implementationType
๔๔ "
,
๔๔" #
ServiceLifetime
๕๕ 
.
๕๕  
	Singleton
๕๕  )
)
๖๖ 
;
๖๖ 
	_services
๗๗ 
.
๗๗ 
TryAdd
๗๗ 
(
๗๗ 
serviceType
๗๗ (
,
๗๗( )

descriptor
๗๗* 4
)
๗๗4 5
;
๗๗5 6
}
๘๘ 	
private
๚๚ 
void
๚๚ 
RegisterTransient
๚๚ &
(
๚๚& '
Type
๚๚' +
serviceType
๚๚, 7
,
๚๚7 8
Type
๚๚9 = 
implementationType
๚๚> P
)
๚๚P Q
{
๛๛ 	
var
 

descriptor
 
=
 
new
  
ServiceDescriptor
! 2
(
2 3
serviceType
 
,
  
implementationType
 "
,
" #
ServiceLifetime
 
.
  
	Transient
  )
)
 
;
 
	_services
 
.
 
TryAdd
 
(
 
serviceType
 (
,
( )

descriptor
* 4
)
4 5
;
5 6
}
 	
private
 
void
 
RegisterScoped
 #
(
# $
Type
$ (
serviceType
) 4
,
4 5
Type
6 : 
implementationType
; M
)
M N
{
 	
var
 

descriptor
 
=
 
new
  
ServiceDescriptor
! 2
(
2 3
serviceType
 
,
  
implementationType
 "
,
" #
ServiceLifetime
 
.
  
Scoped
  &
)
 
;
 
	_services
 
.
 
TryAdd
 
(
 
serviceType
 (
,
( )

descriptor
* 4
)
4 5
;
5 6
}
 	
public
 
T
 

GetService
 
<
 
T
 
>
 
(
 
)
  
{
 	
return
 
(
 
T
 
)
 

GetService
  
(
  !
typeof
! '
(
' (
T
( )
)
) *
)
* +
;
+ ,
}
 	
public
 
object
 

GetService
  
(
  !
Type
! %
serviceType
& 1
)
1 2
{
 	
if
 
(
 
!
 
	_services
 
.
 
TryGetValue
 &
(
& '
serviceType
' 2
,
2 3
out
4 7
var
8 ;

descriptor
< F
)
F G
)
G H
{
 
return
กก 
null
กก 
;
กก 
}
ขข 
return
คค #
CreateServiceInstance
คค (
(
คค( )

descriptor
คค) 3
)
คค3 4
;
คค4 5
}
ฅฅ 	
public
ชช 
T
ชช  
GetRequiredService
ชช #
<
ชช# $
T
ชช$ %
>
ชช% &
(
ชช& '
)
ชช' (
{
ซซ 	
return
ฌฌ 
(
ฌฌ 
T
ฌฌ 
)
ฌฌ  
GetRequiredService
ฌฌ (
(
ฌฌ( )
typeof
ฌฌ) /
(
ฌฌ/ 0
T
ฌฌ0 1
)
ฌฌ1 2
)
ฌฌ2 3
;
ฌฌ3 4
}
ญญ 	
public
ฒฒ 
object
ฒฒ  
GetRequiredService
ฒฒ (
(
ฒฒ( )
Type
ฒฒ) -
serviceType
ฒฒ. 9
)
ฒฒ9 :
{
ณณ 	
var
ดด 
service
ดด 
=
ดด 

GetService
ดด $
(
ดด$ %
serviceType
ดด% 0
)
ดด0 1
;
ดด1 2
if
ตต 
(
ตต 
service
ตต 
==
ตต 
null
ตต 
)
ตต  
{
ถถ 
throw
ทท 
new
ทท '
InvalidOperationException
ทท 3
(
ทท3 4
$"
ธธ 
$str
ธธ &
{
ธธ& '
serviceType
ธธ' 2
.
ธธ2 3
Name
ธธ3 7
}
ธธ7 8
$str
ธธ8 J
"
ธธJ K
)
นน 
;
นน 
}
บบ 
return
ปป 
service
ปป 
;
ปป 
}
ผผ 	
private
ยย 
object
ยย #
CreateServiceInstance
ยย ,
(
ยย, -
ServiceDescriptor
ยย- >

descriptor
ยย? I
)
ยยI J
{
รร 	
var
ลล 
resolutionStack
ลล 
=
ลล  !
_resolutionStack
ลล" 2
.
ลล2 3
Value
ลล3 8
;
ลล8 9
if
ศศ 
(
ศศ 
resolutionStack
ศศ 
.
ศศ  
Contains
ศศ  (
(
ศศ( )

descriptor
ศศ) 3
.
ศศ3 4
ServiceType
ศศ4 ?
)
ศศ? @
)
ศศ@ A
{
ษษ 
throw
สส 
new
สส '
InvalidOperationException
สส 3
(
สส3 4
$"
หห 
$str
หห ?
{
หห? @

descriptor
หห@ J
.
หหJ K
ServiceType
หหK V
.
หหV W
Name
หหW [
}
หห[ \
"
หห\ ]
)
ฬฬ 
;
ฬฬ 
}
ออ 
try
ฯฯ 
{
ะะ 
resolutionStack
ัั 
.
ัั  
Add
ัั  #
(
ัั# $

descriptor
ัั$ .
.
ัั. /
ServiceType
ัั/ :
)
ัั: ;
;
ัั; <
switch
ำำ 
(
ำำ 

descriptor
ำำ "
.
ำำ" #
Lifetime
ำำ# +
)
ำำ+ ,
{
ิิ 
case
ีี 
ServiceLifetime
ีี (
.
ีี( )
	Singleton
ีี) 2
:
ีี2 3
return
ึึ "
GetOrCreateSingleton
ึึ 3
(
ึึ3 4

descriptor
ึึ4 >
)
ึึ> ?
;
ึึ? @
case
ุุ 
ServiceLifetime
ุุ (
.
ุุ( )
	Transient
ุุ) 2
:
ุุ2 3
return
ูู 
CreateInstance
ูู -
(
ูู- .

descriptor
ูู. 8
)
ูู8 9
;
ูู9 :
case
 
ServiceLifetime
 (
.
( )
Scoped
) /
:
/ 0
return
 
GetOrCreateScoped
 0
(
0 1

descriptor
1 ;
)
; <
;
< =
default
 
:
 
throw
฿฿ 
new
฿฿ !
ArgumentException
฿฿" 3
(
฿฿3 4
$"
เเ 
$str
เเ 8
{
เเ8 9

descriptor
เเ9 C
.
เเC D
Lifetime
เเD L
}
เเL M
"
เเM N
)
แแ 
;
แแ 
}
โโ 
}
ใใ 
finally
ไไ 
{
ๅๅ 
resolutionStack
ๆๆ 
.
ๆๆ  
Remove
ๆๆ  &
(
ๆๆ& '

descriptor
ๆๆ' 1
.
ๆๆ1 2
ServiceType
ๆๆ2 =
)
ๆๆ= >
;
ๆๆ> ?
}
็็ 
}
่่ 	
private
๊๊ 
object
๊๊ "
GetOrCreateSingleton
๊๊ +
(
๊๊+ ,
ServiceDescriptor
๊๊, =

descriptor
๊๊> H
)
๊๊H I
{
๋๋ 	
if
ํํ 
(
ํํ 

descriptor
ํํ 
.
ํํ 
SingletonInstance
ํํ ,
!=
ํํ- /
null
ํํ0 4
)
ํํ4 5
{
๎๎ 
return
๏๏ 

descriptor
๏๏ !
.
๏๏! "
SingletonInstance
๏๏" 3
;
๏๏3 4
}
๐๐ 
lock
๒๒ 
(
๒๒ 

descriptor
๒๒ 
)
๒๒ 
{
๓๓ 
if
๔๔ 
(
๔๔ 

descriptor
๔๔ 
.
๔๔ 
SingletonInstance
๔๔ 0
!=
๔๔1 3
null
๔๔4 8
)
๔๔8 9
{
๕๕ 
return
๖๖ 

descriptor
๖๖ %
.
๖๖% &
SingletonInstance
๖๖& 7
;
๖๖7 8
}
๗๗ 

descriptor
๙๙ 
.
๙๙ 
SingletonInstance
๙๙ ,
=
๙๙- .
CreateInstance
๙๙/ =
(
๙๙= >

descriptor
๙๙> H
)
๙๙H I
;
๙๙I J
return
๚๚ 

descriptor
๚๚ !
.
๚๚! "
SingletonInstance
๚๚" 3
;
๚๚3 4
}
๛๛ 
}
 	
private
 
object
 
GetOrCreateScoped
 (
(
( )
ServiceDescriptor
) :

descriptor
; E
)
E F
{
 	
var
 
scope
 
=
 
_currentScope
 %
.
% &
Value
& +
;
+ ,
if
 
(
 
scope
 
==
 
null
 
)
 
{
 
return
 "
GetOrCreateSingleton
 +
(
+ ,

descriptor
, 6
)
6 7
;
7 8
}
 
return
 
scope
 
.
 
GetScopedService
 )
(
) *
(
* +
)
+ ,
=>
- /
CreateInstance
0 >
(
> ?

descriptor
? I
)
I J
)
J K
;
K L
}
 	
private
 
object
 
CreateInstance
 %
(
% &
ServiceDescriptor
& 7

descriptor
8 B
)
B C
{
 	
if
 
(
 

descriptor
 
.
 
Factory
 "
!=
# %
null
& *
)
* +
{
 
return
 

descriptor
 !
.
! "
Factory
" )
(
) *
this
* .
)
. /
;
/ 0
}
 
if
 
(
 

descriptor
 
.
  
ImplementationType
 -
!=
. 0
null
1 5
)
5 6
{
 
return
 4
&CreateInstanceWithConstructorInjection
 =
(
= >

descriptor
> H
.
H I 
ImplementationType
I [
)
[ \
;
\ ]
}
 
throw
 
new
 '
InvalidOperationException
 /
(
/ 0
$"
 
$str
 5
{
5 6

descriptor
6 @
.
@ A
ServiceType
A L
.
L M
Name
M Q
}
Q R
"
R S
)
 
;
 
}
 	
private
 
object
 4
&CreateInstanceWithConstructorInjection
 =
(
= >
Type
> B 
implementationType
C U
)
U V
{
 	
var
 
constructors
 
=
  
implementationType
 1
.
 
GetConstructors
  
(
  !
)
! "
.
 
OrderByDescending
 "
(
" #
c
# $
=>
% '
c
( )
.
) *
GetParameters
* 7
(
7 8
)
8 9
.
9 :
Length
: @
)
@ A
.
 
ToArray
 
(
 
)
 
;
 
foreach
ขข 
(
ขข 
var
ขข 
constructor
ขข $
in
ขข% '
constructors
ขข( 4
)
ขข4 5
{
ฃฃ 
var
คค 

parameters
คค 
=
คค  
constructor
คค! ,
.
คค, -
GetParameters
คค- :
(
คค: ;
)
คค; <
;
คค< =
var
ฅฅ  
parameterInstances
ฅฅ &
=
ฅฅ' (
new
ฅฅ) ,
object
ฅฅ- 3
[
ฅฅ3 4

parameters
ฅฅ4 >
.
ฅฅ> ?
Length
ฅฅ? E
]
ฅฅE F
;
ฅฅF G
bool
ฆฆ 
canResolveAll
ฆฆ "
=
ฆฆ# $
true
ฆฆ% )
;
ฆฆ) *
for
จจ 
(
จจ 
int
จจ 
i
จจ 
=
จจ 
$num
จจ 
;
จจ 
i
จจ  !
<
จจ" #

parameters
จจ$ .
.
จจ. /
Length
จจ/ 5
;
จจ5 6
i
จจ7 8
++
จจ8 :
)
จจ: ;
{
ฉฉ 
var
ชช 
parameterType
ชช %
=
ชช& '

parameters
ชช( 2
[
ชช2 3
i
ชช3 4
]
ชช4 5
.
ชช5 6
ParameterType
ชช6 C
;
ชชC D
var
ซซ 
parameterInstance
ซซ )
=
ซซ* +

GetService
ซซ, 6
(
ซซ6 7
parameterType
ซซ7 D
)
ซซD E
;
ซซE F
if
ญญ 
(
ญญ 
parameterInstance
ญญ )
==
ญญ* ,
null
ญญ- 1
)
ญญ1 2
{
ฎฎ 
canResolveAll
ฏฏ %
=
ฏฏ& '
false
ฏฏ( -
;
ฏฏ- .
break
ฐฐ 
;
ฐฐ 
}
ฑฑ  
parameterInstances
ณณ &
[
ณณ& '
i
ณณ' (
]
ณณ( )
=
ณณ* +
parameterInstance
ณณ, =
;
ณณ= >
}
ดด 
if
ถถ 
(
ถถ 
canResolveAll
ถถ !
)
ถถ! "
{
ทท 
return
ธธ 
	Activator
ธธ $
.
ธธ$ %
CreateInstance
ธธ% 3
(
ธธ3 4 
implementationType
ธธ4 F
,
ธธF G 
parameterInstances
ธธH Z
)
ธธZ [
;
ธธ[ \
}
นน 
}
บบ 
if
ฝฝ 
(
ฝฝ 
constructors
ฝฝ 
.
ฝฝ 
Any
ฝฝ  
(
ฝฝ  !
c
ฝฝ! "
=>
ฝฝ# %
c
ฝฝ& '
.
ฝฝ' (
GetParameters
ฝฝ( 5
(
ฝฝ5 6
)
ฝฝ6 7
.
ฝฝ7 8
Length
ฝฝ8 >
==
ฝฝ? A
$num
ฝฝB C
)
ฝฝC D
)
ฝฝD E
{
พพ 
return
ฟฟ 
	Activator
ฟฟ  
.
ฟฟ  !
CreateInstance
ฟฟ! /
(
ฟฟ/ 0 
implementationType
ฟฟ0 B
)
ฟฟB C
;
ฟฟC D
}
ภภ 
throw
ยย 
new
ยย '
InvalidOperationException
ยย /
(
ยย/ 0
$"
รร 
$str
รร >
{
รร> ? 
implementationType
รร? Q
.
รรQ R
Name
รรR V
}
รรV W
"
รรW X
)
ฤฤ 
;
ฤฤ 
}
ลล 	
public
ฮฮ 
IServiceScope
ฮฮ 
CreateScope
ฮฮ (
(
ฮฮ( )
)
ฮฮ) *
{
ฯฯ 	
return
ะะ 
new
ะะ !
ServiceScopeWrapper
ะะ *
(
ะะ* +
this
ะะ+ /
)
ะะ/ 0
;
ะะ0 1
}
ัั 	
private
ำำ 
class
ำำ !
ServiceScopeWrapper
ำำ )
:
ำำ* +
IServiceScope
ำำ, 9
{
ิิ 	
private
ีี 
readonly
ีี 
ServiceContainer
ีี -

_container
ีี. 8
;
ีี8 9
private
ึึ 
readonly
ึึ 
ServiceScope
ึึ )
_scope
ึึ* 0
;
ึึ0 1
public
ุุ !
ServiceScopeWrapper
ุุ &
(
ุุ& '
ServiceContainer
ุุ' 7
	container
ุุ8 A
)
ุุA B
{
ูู 

_container
ฺฺ 
=
ฺฺ 
	container
ฺฺ &
;
ฺฺ& '
_scope
 
=
 
new
 
ServiceScope
 )
(
) *
)
* +
;
+ ,

_container
 
.
 
_currentScope
 (
.
( )
Value
) .
=
/ 0
_scope
1 7
;
7 8
}
 
public
฿฿ 
IServiceProvider
฿฿ #
ServiceProvider
฿฿$ 3
=>
฿฿4 6

_container
฿฿7 A
;
฿฿A B
public
แแ 
void
แแ 
Dispose
แแ 
(
แแ  
)
แแ  !
{
โโ 

_container
ใใ 
.
ใใ 
_currentScope
ใใ (
.
ใใ( )
Value
ใใ) .
=
ใใ/ 0
null
ใใ1 5
;
ใใ5 6
_scope
ไไ 
?
ไไ 
.
ไไ 
Dispose
ไไ 
(
ไไ  
)
ไไ  !
;
ไไ! "
}
ๅๅ 
}
ๆๆ 	
public
๏๏ 
bool
๏๏ 
IsRegistered
๏๏  
<
๏๏  !
T
๏๏! "
>
๏๏" #
(
๏๏# $
)
๏๏$ %
{
๐๐ 	
return
๑๑ 
IsRegistered
๑๑ 
(
๑๑  
typeof
๑๑  &
(
๑๑& '
T
๑๑' (
)
๑๑( )
)
๑๑) *
;
๑๑* +
}
๒๒ 	
public
๗๗ 
bool
๗๗ 
IsRegistered
๗๗  
(
๗๗  !
Type
๗๗! %
serviceType
๗๗& 1
)
๗๗1 2
{
๘๘ 	
return
๙๙ 
	_services
๙๙ 
.
๙๙ 
ContainsKey
๙๙ (
(
๙๙( )
serviceType
๙๙) 4
)
๙๙4 5
;
๙๙5 6
}
๚๚ 	
public
 
IEnumerable
 
<
 
Type
 
>
  #
GetRegisteredServices
! 6
(
6 7
)
7 8
{
 	
return
 
	_services
 
.
 
Keys
 !
;
! "
}
 	
public
 
void
 
ValidateServices
 $
(
$ %
)
% &
{
 	
var
 
errors
 
=
 
new
 
List
 !
<
! "
string
" (
>
( )
(
) *
)
* +
;
+ ,
foreach
 
(
 
var
 
kvp
 
in
 
	_services
  )
)
) *
{
 
try
 
{
 

GetService
 
(
 
kvp
 "
.
" #
Key
# &
)
& '
;
' (
}
 
catch
 
(
 
	Exception
  
ex
! #
)
# $
{
 
errors
 
.
 
Add
 
(
 
$"
 !
$str
! )
{
) *
kvp
* -
.
- .
Key
. 1
.
1 2
Name
2 6
}
6 7
$str
7 9
{
9 :
ex
: <
.
< =
Message
= D
}
D E
"
E F
)
F G
;
G H
}
 
}
 
if
 
(
 
errors
 
.
 
Any
 
(
 
)
 
)
 
{
 
throw
 
new
 '
InvalidOperationException
 3
(
3 4
$"
 
$str
 2
{
2 3
string
3 9
.
9 :
Join
: >
(
> ?
$str
? C
,
C D
errors
E K
)
K L
}
L M
"
M N
)
 
;
 
}
 
}
 	
public
ขข 
void
ขข 
Clear
ขข 
(
ขข 
)
ขข 
{
ฃฃ 	
_lock
คค 
.
คค 
EnterWriteLock
คค  
(
คค  !
)
คค! "
;
คค" #
try
ฅฅ 
{
ฆฆ 
	_services
งง 
.
งง 
Clear
งง 
(
งง  
)
งง  !
;
งง! "
}
จจ 
finally
ฉฉ 
{
ชช 
_lock
ซซ 
.
ซซ 
ExitWriteLock
ซซ #
(
ซซ# $
)
ซซ$ %
;
ซซ% &
}
ฌฌ 
}
ญญ 	
public
ณณ 
void
ณณ 
Dispose
ณณ 
(
ณณ 
)
ณณ 
{
ดด 	
_lock
ตต 
?
ตต 
.
ตต 
Dispose
ตต 
(
ตต 
)
ตต 
;
ตต 
_currentScope
ถถ 
?
ถถ 
.
ถถ 
Dispose
ถถ "
(
ถถ" #
)
ถถ# $
;
ถถ$ %
}
ทท 	
}
บบ 
public
ฝฝ 

static
ฝฝ 
class
ฝฝ  
ServiceInitializer
ฝฝ *
{
พพ 
public
ยย 
static
ยย 
void
ยย 

Initialize
ยย %
(
ยย% &
	OstPlayer
ยย& /
plugin
ยย0 6
)
ยย6 7
{
รร 	
var
ฤฤ 
	container
ฤฤ 
=
ฤฤ 
ServiceContainer
ฤฤ ,
.
ฤฤ, -
Instance
ฤฤ- 5
;
ฤฤ5 6
try
ฦฦ 
{
วว 
	container
ษษ 
.
ษษ 
Clear
ษษ 
(
ษษ  
)
ษษ  !
;
ษษ! "
	container
ฬฬ 
.
ฬฬ 
RegisterSingleton
ฬฬ +
<
ฬฬ+ ,
	OstPlayer
ฬฬ, 5
>
ฬฬ5 6
(
ฬฬ6 7
plugin
ฬฬ7 =
)
ฬฬ= >
;
ฬฬ> ?
	container
ฯฯ 
.
ฯฯ 
RegisterSingleton
ฯฯ +
<
ฯฯ+ ,"
ErrorHandlingService
ฯฯ, @
,
ฯฯ@ A"
ErrorHandlingService
ฯฯB V
>
ฯฯV W
(
ฯฯW X
)
ฯฯX Y
;
ฯฯY Z
	container
ะะ 
.
ะะ 
RegisterSingleton
ะะ +
<
ะะ+ ,
MetadataService
ะะ, ;
,
ะะ; <
MetadataService
ะะ= L
>
ะะL M
(
ะะM N
)
ะะN O
;
ะะO P
	container
ัั 
.
ัั 
RegisterSingleton
ัั +
<
ัั+ ,
MetadataCache
ัั, 9
,
ัั9 :
MetadataCache
ัั; H
>
ััH I
(
ััI J
)
ััJ K
;
ััK L
	container
ิิ 
.
ิิ 
RegisterTransient
ิิ +
<
ิิ+ ,"
MusicPlaybackService
ิิ, @
,
ิิ@ A"
MusicPlaybackService
ิิB V
>
ิิV W
(
ิิW X
)
ิิX Y
;
ิิY Z
	container
ืื 
.
ืื 
RegisterSingleton
ืื +
<
ืื+ ,
IMetadataService
ืื, <
,
ืื< =
MetadataService
ืื> M
>
ืืM N
(
ืืN O
)
ืืO P
;
ืืP Q
	container
ุุ 
.
ุุ 
RegisterSingleton
ุุ +
<
ุุ+ ,
IGameService
ุุ, 8
,
ุุ8 9
GameService
ุุ: E
>
ุุE F
(
ุุF G
)
ุุG H
;
ุุH I
	container
ูู 
.
ูู 
RegisterTransient
ูู +
<
ูู+ ,
IAudioService
ูู, 9
,
ูู9 :
AudioService
ูู; G
>
ููG H
(
ููH I
)
ููI J
;
ููJ K
	container
 
.
 
RegisterSingleton
 +
<
+ ,
IDiscogsClient
, :
,
: ;"
DiscogsClientService
< P
>
P Q
(
Q R
)
R S
;
S T
	container
 
.
 
RegisterSingleton
 +
<
+ , 
IMusicBrainzClient
, >
,
> ?&
MusicBrainzClientService
@ X
>
X Y
(
Y Z
)
Z [
;
[ \
	container
แแ 
.
แแ 
RegisterTransient
แแ +
<
แแ+ ,'
OstPlayerSidebarViewModel
แแ, E
,
แแE F'
OstPlayerSidebarViewModel
แแG `
>
แแ` a
(
แแa b
)
แแb c
;
แแc d
	container
โโ 
.
โโ 
RegisterTransient
โโ +
<
โโ+ ,(
OstPlayerSettingsViewModel
ใใ .
,
ใใ. /(
OstPlayerSettingsViewModel
ไไ .
>
ๅๅ 
(
ๅๅ 
)
ๅๅ 
;
ๅๅ 
	container
่่ 
.
่่ 
ValidateServices
่่ *
(
่่* +
)
่่+ ,
;
่่, -
System
๊๊ 
.
๊๊ 
Diagnostics
๊๊ "
.
๊๊" #
Debug
๊๊# (
.
๊๊( )
	WriteLine
๊๊) 2
(
๊๊2 3
$str
๋๋ a
)
์์ 
;
์์ 
}
ํํ 
catch
๎๎ 
(
๎๎ 
	Exception
๎๎ 
ex
๎๎ 
)
๎๎  
{
๏๏ 
System
๐๐ 
.
๐๐ 
Diagnostics
๐๐ "
.
๐๐" #
Debug
๐๐# (
.
๐๐( )
	WriteLine
๐๐) 2
(
๐๐2 3
$"
๑๑ 
$str
๑๑ 9
{
๑๑9 :
ex
๑๑: <
.
๑๑< =
Message
๑๑= D
}
๑๑D E
"
๑๑E F
)
๒๒ 
;
๒๒ 
throw
๓๓ 
;
๓๓ 
}
๔๔ 
}
๕๕ 	
public
๚๚ 
static
๚๚ 
IServiceScope
๚๚ #
CreateScope
๚๚$ /
(
๚๚/ 0
)
๚๚0 1
{
๛๛ 	
return
 
ServiceContainer
 #
.
# $
Instance
$ ,
.
, -
CreateScope
- 8
(
8 9
)
9 :
;
: ;
}
 	
public
 
static
 
string
 (
GetServiceValidationReport
 7
(
7 8
)
8 9
{
 	
var
 
	container
 
=
 
ServiceContainer
 ,
.
, -
Instance
- 5
;
5 6
var
  
registeredServices
 "
=
# $
	container
% .
.
. /#
GetRegisteredServices
/ D
(
D E
)
E F
.
F G
ToList
G M
(
M N
)
N O
;
O P
var
 
report
 
=
 
new
 
System
 #
.
# $
Text
$ (
.
( )
StringBuilder
) 6
(
6 7
)
7 8
;
8 9
report
 
.
 

AppendLine
 
(
 
$str
 C
)
C D
;
D E
report
 
.
 

AppendLine
 
(
 
$"
  
$str
  ;
{
; < 
registeredServices
< N
.
N O
Count
O T
}
T U
"
U V
)
V W
;
W X
report
 
.
 

AppendLine
 
(
 
)
 
;
  
foreach
 
(
 
var
 
serviceType
 $
in
% ' 
registeredServices
( :
.
: ;
OrderBy
; B
(
B C
t
C D
=>
E G
t
H I
.
I J
Name
J N
)
N O
)
O P
{
 
var
 

canResolve
 
=
  
$str
! &
;
& '
try
 
{
 
	container
 
.
 

GetService
 (
(
( )
serviceType
) 4
)
4 5
;
5 6
}
 
catch
 
{
 

canResolve
 
=
  
$str
! %
;
% &
}
 
report
 
.
 

AppendLine
 !
(
! "
$"
" $
$str
$ &
{
& '
serviceType
' 2
.
2 3
Name
3 7
}
7 8
$str
8 :
{
: ;

canResolve
; E
}
E F
"
F G
)
G H
;
H I
}
 
return
 
report
 
.
 
ToString
 "
(
" #
)
# $
;
$ %
}
 	
}
 
} ๅA
IC:\Playnite\_github\OstPlayer\source\Services\MusicBrainzClientService.cs
	namespaceMM 	
	OstPlayerMM
 
.MM 
ServicesMM 
{NN 
publicSS 

classSS $
MusicBrainzClientServiceSS )
:SS* +
IMusicBrainzClientSS, >
,SS> ?
IDisposableSS@ K
{TT 
privateWW 
readonlyWW 
ILoggerWW  
loggerWW! '
;WW' (
privateXX 
volatileXX 
boolXX 
disposedXX &
=XX' (
falseXX) .
;XX. /
publicbb $
MusicBrainzClientServicebb '
(bb' (
ILoggerbb( /
loggerbb0 6
=bb7 8
nullbb9 =
)bb= >
{cc 	
thisdd 
.dd 
loggerdd 
=dd 
loggerdd  
??dd! #

LogManagerdd$ .
.dd. /
	GetLoggerdd/ 8
(dd8 9
)dd9 :
;dd: ;
tryff 
{gg 
thishh 
.hh 
loggerhh 
.hh 
Infohh  
(hh  !
$strii X
)jj 
;jj 
thiskk 
.kk 
loggerkk 
.kk 
Infokk  
(kk  !
$strkk! \
)kk\ ]
;kk] ^
}ll 
catchmm 
(mm 
	Exceptionmm 
exmm 
)mm  
{nn 
thisoo 
.oo 
loggeroo 
.oo 
Erroroo !
(oo! "
expp 
,pp 
$strqq ]
)rr 
;rr 
throwss 
;ss 
}tt 
}uu 	
public~~ 
async~~ 
Task~~ 
<~~ $
MusicBrainzMetadataModel~~ 2
>~~2 3
SearchReleaseAsync~~4 F
(~~F G
string 
artist 
, 
string
 
album
 
,
 
CancellationToken
 
cancellationToken
 /
=
0 1
default
2 9
)
 	
{
 	
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9&
MusicBrainzClientService
9 Q
)
Q R
)
R S
;
S T
if
 
(
 
string
 
.
  
IsNullOrWhiteSpace
 )
(
) *
artist
* 0
)
0 1
||
2 4
string
5 ;
.
; < 
IsNullOrWhiteSpace
< N
(
N O
album
O T
)
T U
)
U V
{
 
logger
 
.
 
Warn
 
(
 
$str
 W
)
W X
;
X Y
return
 
null
 
;
 
}
 
try
 
{
 
cancellationToken
 !
.
! "*
ThrowIfCancellationRequested
" >
(
> ?
)
? @
;
@ A
logger
 
.
 
Debug
 
(
 
$"
 
$str
 :
{
: ;
artist
; A
}
A B
$str
B E
{
E F
album
F K
}
K L
"
L M
)
M N
;
N O
var
 
result
 
=
 
await
 "
MusicBrainzClient
# 4
.
4 5 
SearchReleaseAsync
5 G
(
G H
artist
H N
,
N O
album
P U
)
U V
;
V W
logger
 
.
 
Debug
 
(
 
$"
 
$str
 A
{
A B
artist
B H
}
H I
$str
I L
{
L M
album
M R
}
R S
"
S T
)
T U
;
U V
return
 
null
 
;
 
}
 
catch
 
(
 (
OperationCanceledException
 -
)
- .
{
 
logger
 
.
 
Info
 
(
 
$"
 
$str
 @
{
@ A
artist
A G
}
G H
$str
H K
{
K L
album
L Q
}
Q R
"
R S
)
S T
;
T U
throw
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
logger
 
.
 
Error
 
(
 
ex
 
,
  
$"
! #
$str
# E
{
E F
artist
F L
}
L M
$str
M P
{
P Q
album
Q V
}
V W
"
W X
)
X Y
;
Y Z
return
กก 
null
กก 
;
กก 
}
ขข 
}
ฃฃ 	
public
จจ 
async
จจ 
Task
จจ 
<
จจ 
bool
จจ 
>
จจ 
CheckHealthAsync
จจ  0
(
จจ0 1
CancellationToken
จจ1 B
cancellationToken
จจC T
=
จจU V
default
จจW ^
)
จจ^ _
{
ฉฉ 	
if
ชช 
(
ชช 
disposed
ชช 
)
ชช 
return
ซซ 
false
ซซ 
;
ซซ 
try
ญญ 
{
ฎฎ 
cancellationToken
ฏฏ !
.
ฏฏ! "*
ThrowIfCancellationRequested
ฏฏ" >
(
ฏฏ> ?
)
ฏฏ? @
;
ฏฏ@ A
logger
ฑฑ 
.
ฑฑ 
Debug
ฑฑ 
(
ฑฑ 
$str
ฑฑ I
)
ฑฑI J
;
ฑฑJ K
await
ดด 
Task
ดด 
.
ดด 
Delay
ดด  
(
ดด  !
$num
ดด! $
,
ดด$ %
cancellationToken
ดด& 7
)
ดด7 8
;
ดด8 9
logger
ถถ 
.
ถถ 
Debug
ถถ 
(
ถถ 
$str
ถถ R
)
ถถR S
;
ถถS T
return
ทท 
true
ทท 
;
ทท 
}
ธธ 
catch
นน 
(
นน (
OperationCanceledException
นน -
)
นน- .
{
บบ 
logger
ปป 
.
ปป 
Info
ปป 
(
ปป 
$str
ปป J
)
ปปJ K
;
ปปK L
throw
ผผ 
;
ผผ 
}
ฝฝ 
catch
พพ 
(
พพ 
	Exception
พพ 
ex
พพ 
)
พพ  
{
ฟฟ 
logger
ภภ 
.
ภภ 
Error
ภภ 
(
ภภ 
ex
ภภ 
,
ภภ  
$str
ภภ! F
)
ภภF G
;
ภภG H
return
มม 
false
มม 
;
มม 
}
ยย 
}
รร 	
public
ษษ 
void
ษษ 
Dispose
ษษ 
(
ษษ 
)
ษษ 
{
สส 	
Dispose
หห 
(
หห 
true
หห 
)
หห 
;
หห 
GC
ฬฬ 
.
ฬฬ 
SuppressFinalize
ฬฬ 
(
ฬฬ  
this
ฬฬ  $
)
ฬฬ$ %
;
ฬฬ% &
}
ออ 	
	protected
ฯฯ 
virtual
ฯฯ 
void
ฯฯ 
Dispose
ฯฯ &
(
ฯฯ& '
bool
ฯฯ' +
	disposing
ฯฯ, 5
)
ฯฯ5 6
{
ะะ 	
if
ัั 
(
ัั 
!
ัั 
disposed
ัั 
&&
ัั 
	disposing
ัั &
)
ัั& '
{
าา 
try
ำำ 
{
ิิ 
logger
ีี 
.
ีี 
Info
ีี 
(
ีี  
$str
ีี  G
)
ีีG H
;
ีีH I
logger
ึึ 
.
ึึ 
Info
ึึ 
(
ึึ  
$str
ึึ  P
)
ึึP Q
;
ึึQ R
}
ืื 
catch
ุุ 
(
ุุ 
	Exception
ุุ  
ex
ุุ! #
)
ุุ# $
{
ูู 
logger
ฺฺ 
.
ฺฺ 
Error
ฺฺ  
(
ฺฺ  !
ex
ฺฺ! #
,
ฺฺ# $
$str
ฺฺ% O
)
ฺฺO P
;
ฺฺP Q
}
 
finally
 
{
 
disposed
 
=
 
true
 #
;
# $
}
฿฿ 
}
เเ 
}
แแ 	
}
ไไ 
}ๅๅ ๎
@C:\Playnite\_github\OstPlayer\source\Services\MetadataService.cs
	namespace 	
	OstPlayer

 
.
 
Services
 
{ 
public
 

class
 
MetadataService
  
:
! "
IMetadataService
# 3
,
3 4
IDisposable
5 @
{
 
private
 
readonly
 
ILogger
  
logger
! '
;
' (
private
 
readonly
 "
ErrorHandlingService
 -
errorHandler
. :
;
: ;
private
 
readonly
 
MetadataCache
 &
metadataCache
' 4
;
4 5
private
 
readonly
 
IDiscogsClient
 '
discogsClient
( 5
;
5 6
private
 
readonly
  
IMusicBrainzClient
 +
musicBrainzClient
, =
;
= >
private
 
readonly
 !
MetadataCacheConfig
 ,
cacheConfig
- 8
;
8 9
private
 
volatile
 
bool
 
disposed
 &
=
' (
false
) .
;
. /
public
คค 
MetadataService
คค 
(
คค 
ILogger
ฅฅ 
logger
ฅฅ 
=
ฅฅ 
null
ฅฅ !
,
ฅฅ! ""
ErrorHandlingService
ฆฆ  
errorHandler
ฆฆ! -
=
ฆฆ. /
null
ฆฆ0 4
,
ฆฆ4 5
IDiscogsClient
งง 
discogsClient
งง (
=
งง) *
null
งง+ /
,
งง/ 0 
IMusicBrainzClient
จจ 
musicBrainzClient
จจ 0
=
จจ1 2
null
จจ3 7
,
จจ7 8!
MetadataCacheConfig
ฉฉ 
customCacheConfig
ฉฉ  1
=
ฉฉ2 3
null
ฉฉ4 8
)
ชช 	
{
ซซ 	
this
ญญ 
.
ญญ 
logger
ญญ 
=
ญญ 
logger
ญญ  
??
ญญ! #

LogManager
ญญ$ .
.
ญญ. /
	GetLogger
ญญ/ 8
(
ญญ8 9
)
ญญ9 :
;
ญญ: ;
this
ฎฎ 
.
ฎฎ 
errorHandler
ฎฎ 
=
ฎฎ 
errorHandler
ฎฎ  ,
??
ฎฎ- /
new
ฎฎ0 3"
ErrorHandlingService
ฎฎ4 H
(
ฎฎH I
)
ฎฎI J
;
ฎฎJ K
this
ฏฏ 
.
ฏฏ 
discogsClient
ฏฏ 
=
ฏฏ  
discogsClient
ฏฏ! .
??
ฏฏ/ 1
new
ฏฏ2 5"
DiscogsClientService
ฏฏ6 J
(
ฏฏJ K
)
ฏฏK L
;
ฏฏL M
this
ฐฐ 
.
ฐฐ 
musicBrainzClient
ฐฐ "
=
ฐฐ# $
musicBrainzClient
ฐฐ% 6
??
ฐฐ7 9
new
ฐฐ: =&
MusicBrainzClientService
ฐฐ> V
(
ฐฐV W
)
ฐฐW X
;
ฐฐX Y
try
ฒฒ 
{
ณณ 
this
ดด 
.
ดด 
logger
ดด 
.
ดด 
Info
ดด  
(
ดด  !
$str
ดด! \
)
ดด\ ]
;
ดด] ^
cacheConfig
ทท 
=
ทท 
customCacheConfig
ธธ %
??
นน 
new
นน !
MetadataCacheConfig
นน .
{
บบ 
TrackMetadataTTL
ปป (
=
ปป) *
TimeSpan
ปป+ 3
.
ปป3 4
	FromHours
ปป4 =
(
ปป= >
$num
ปป> ?
)
ปป? @
,
ปป@ A
AlbumMetadataTTL
ผผ (
=
ผผ) *
TimeSpan
ผผ+ 3
.
ผผ3 4
	FromHours
ผผ4 =
(
ผผ= >
$num
ผผ> ?
)
ผผ? @
,
ผผ@ A!
ExternalMetadataTTL
ฝฝ +
=
ฝฝ, -
TimeSpan
ฝฝ. 6
.
ฝฝ6 7
	FromHours
ฝฝ7 @
(
ฝฝ@ A
$num
ฝฝA C
)
ฝฝC D
,
ฝฝD E
MaxCacheSize
พพ $
=
พพ% &
$num
พพ' +
,
พพ+ ,
CleanupInterval
ฟฟ '
=
ฟฟ( )
TimeSpan
ฟฟ* 2
.
ฟฟ2 3
FromMinutes
ฟฟ3 >
(
ฟฟ> ?
$num
ฟฟ? @
)
ฟฟ@ A
,
ฟฟA B,
EnableMemoryPressureAdjustment
ภภ 6
=
ภภ7 8
true
ภภ9 =
,
ภภ= > 
EnableCacheWarming
มม *
=
มม+ ,
true
มม- 1
,
มม1 2
}
ยย 
;
ยย 
metadataCache
ฦฦ 
=
ฦฦ 
new
ฦฦ  #
MetadataCache
ฦฦ$ 1
(
ฦฦ1 2
cacheConfig
ฦฦ2 =
)
ฦฦ= >
;
ฦฦ> ?
this
ศศ 
.
ศศ 
logger
ศศ 
.
ศศ 
Info
ศศ  
(
ศศ  !
$"
ษษ 
$str
ษษ M
{
ษษM N
cacheConfig
ษษN Y
.
ษษY Z
MaxCacheSize
ษษZ f
}
ษษf g
$str
ษษg n
"
ษษn o
)
สส 
;
สส 
}
หห 
catch
ฬฬ 
(
ฬฬ 
	Exception
ฬฬ 
ex
ฬฬ 
)
ฬฬ  
{
ออ 
this
ฮฮ 
.
ฮฮ 
logger
ฮฮ 
.
ฮฮ 
Error
ฮฮ !
(
ฮฮ! "
ex
ฯฯ 
,
ฯฯ 
$str
ะะ T
)
ัั 
;
ัั 
this
าา 
.
าา 
errorHandler
าา !
.
าา! "!
HandlePlaybackError
าา" 5
(
าา5 6
ex
าา6 8
,
าา8 9
$str
าา: Z
)
าาZ [
;
าา[ \
throw
ำำ 
;
ำำ 
}
ิิ 
}
ีี 	
public
 
async
 
Task
 
<
  
TrackMetadataModel
 ,
>
, -$
LoadTrackMetadataAsync
. D
(
D E
string
฿฿ 
filePath
฿฿ 
,
฿฿ 
CancellationToken
เเ 
cancellationToken
เเ /
=
เเ0 1
default
เเ2 9
)
แแ 	
{
โโ 	
if
ใใ 
(
ใใ 
disposed
ใใ 
)
ใใ 
throw
ไไ 
new
ไไ %
ObjectDisposedException
ไไ 1
(
ไไ1 2
nameof
ไไ2 8
(
ไไ8 9
MetadataService
ไไ9 H
)
ไไH I
)
ไไI J
;
ไไJ K
if
ๆๆ 
(
ๆๆ 
string
ๆๆ 
.
ๆๆ 
IsNullOrEmpty
ๆๆ $
(
ๆๆ$ %
filePath
ๆๆ% -
)
ๆๆ- .
)
ๆๆ. /
{
็็ 
logger
่่ 
.
่่ 
Warn
่่ 
(
่่ 
$str
่่ X
)
่่X Y
;
่่Y Z
return
้้ 
null
้้ 
;
้้ 
}
๊๊ 
logger
์์ 
.
์์ 
Debug
์์ 
(
์์ 
$"
์์ 
$str
์์ 6
{
์์6 7
filePath
์์7 ?
}
์์? @
"
์์@ A
)
์์A B
;
์์B C
try
๎๎ 
{
๏๏ 
cancellationToken
๑๑ !
.
๑๑! "*
ThrowIfCancellationRequested
๑๑" >
(
๑๑> ?
)
๑๑? @
;
๑๑@ A
var
๔๔ 
cachedMetadata
๔๔ "
=
๔๔# $
metadataCache
๔๔% 2
.
๔๔2 3
GetTrackMetadata
๔๔3 C
(
๔๔C D
filePath
๔๔D L
)
๔๔L M
;
๔๔M N
if
๕๕ 
(
๕๕ 
cachedMetadata
๕๕ "
!=
๕๕# %
null
๕๕& *
)
๕๕* +
{
๖๖ 
logger
๗๗ 
.
๗๗ 
Debug
๗๗  
(
๗๗  !
$"
๗๗! #
$str
๗๗# ;
{
๗๗; <
filePath
๗๗< D
}
๗๗D E
"
๗๗E F
)
๗๗F G
;
๗๗G H
return
๘๘ 
cachedMetadata
๘๘ )
;
๘๘) *
}
๙๙ 
logger
๛๛ 
.
๛๛ 
Debug
๛๛ 
(
๛๛ 
$"
๛๛ 
$str
๛๛ 8
{
๛๛8 9
filePath
๛๛9 A
}
๛๛A B
$str
๛๛B [
"
๛๛[ \
)
๛๛\ ]
;
๛๛] ^
var
 
mp3Metadata
 
=
  !
await
" '"
LoadMp3MetadataAsync
( <
(
< =
filePath
= E
,
E F
cancellationToken
G X
)
X Y
;
Y Z
if
 
(
 
mp3Metadata
 
==
  "
null
# '
)
' (
{
 
logger
 
.
 
Warn
 
(
  
$"
  "
$str
" B
{
B C
filePath
C K
}
K L
"
L M
)
M N
;
N O
return
 
null
 
;
  
}
 
cancellationToken
 !
.
! "*
ThrowIfCancellationRequested
" >
(
> ?
)
? @
;
@ A
var
 
discogsMetadata
 #
=
$ %
await
& +&
LoadDiscogsMetadataAsync
, D
(
D E
mp3Metadata
 
,
  
cancellationToken
 %
)
 
;
 
var
 !
musicBrainzMetadata
 '
=
( )
await
* /*
LoadMusicBrainzMetadataAsync
0 L
(
L M
mp3Metadata
 
,
  
cancellationToken
 %
)
 
;
 
var
 
mergedMetadata
 "
=
# $&
MergeMetadataFromSources
% =
(
= >
mp3Metadata
 
,
  
discogsMetadata
 #
,
# $!
musicBrainzMetadata
 '
)
 
;
 
if
 
(
 
mergedMetadata
 "
!=
# %
null
& *
)
* +
{
 
metadataCache
 !
.
! " 
CacheTrackMetadata
" 4
(
4 5
filePath
5 =
,
= >
mergedMetadata
? M
)
M N
;
N O
logger
 
.
 
Debug
  
(
  !
$"
! #
$str
# F
{
F G
filePath
G O
}
O P
"
P Q
)
Q R
;
R S
}
 
return
 
mergedMetadata
 %
;
% &
}
กก 
catch
ขข 
(
ขข (
OperationCanceledException
ขข -
)
ขข- .
{
ฃฃ 
logger
คค 
.
คค 
Info
คค 
(
คค 
$"
คค 
$str
คค C
{
คคC D
filePath
คคD L
}
คคL M
"
คคM N
)
คคN O
;
คคO P
throw
ฅฅ 
;
ฅฅ 
}
ฆฆ 
catch
งง 
(
งง 
	Exception
งง 
ex
งง 
)
งง  
{
จจ 
logger
ฉฉ 
.
ฉฉ 
Error
ฉฉ 
(
ฉฉ 
ex
ฉฉ 
,
ฉฉ  
$"
ฉฉ! #
$str
ฉฉ# E
{
ฉฉE F
filePath
ฉฉF N
}
ฉฉN O
"
ฉฉO P
)
ฉฉP Q
;
ฉฉQ R
errorHandler
ชช 
.
ชช !
HandlePlaybackError
ชช 0
(
ชช0 1
ex
ชช1 3
,
ชช3 4
filePath
ชช5 =
)
ชช= >
;
ชช> ?
return
ซซ 
null
ซซ 
;
ซซ 
}
ฌฌ 
}
ญญ 	
public
ฒฒ 
async
ฒฒ 
Task
ฒฒ 
<
ฒฒ 
List
ฒฒ 
<
ฒฒ  
TrackMetadataModel
ฒฒ 1
>
ฒฒ1 2
>
ฒฒ2 3-
LoadMultipleTracksMetadataAsync
ฒฒ4 S
(
ฒฒS T
IEnumerable
ณณ 
<
ณณ 
string
ณณ 
>
ณณ 
	filePaths
ณณ  )
,
ณณ) *
	IProgress
ดด 
<
ดด 
int
ดด 
>
ดด 
progress
ดด #
=
ดด$ %
null
ดด& *
,
ดด* +
CancellationToken
ตต 
cancellationToken
ตต /
=
ตต0 1
default
ตต2 9
)
ถถ 	
{
ทท 	
if
ธธ 
(
ธธ 
disposed
ธธ 
)
ธธ 
throw
นน 
new
นน %
ObjectDisposedException
นน 1
(
นน1 2
nameof
นน2 8
(
นน8 9
MetadataService
นน9 H
)
นนH I
)
นนI J
;
นนJ K
var
ปป 
results
ปป 
=
ปป 
new
ปป 
List
ปป "
<
ปป" # 
TrackMetadataModel
ปป# 5
>
ปป5 6
(
ปป6 7
)
ปป7 8
;
ปป8 9
var
ผผ 
filePathList
ผผ 
=
ผผ 
	filePaths
ผผ (
?
ผผ( )
.
ผผ) *
ToList
ผผ* 0
(
ผผ0 1
)
ผผ1 2
??
ผผ3 5
new
ผผ6 9
List
ผผ: >
<
ผผ> ?
string
ผผ? E
>
ผผE F
(
ผผF G
)
ผผG H
;
ผผH I
int
ฝฝ 
processedCount
ฝฝ 
=
ฝฝ  
$num
ฝฝ! "
;
ฝฝ" #
try
ฟฟ 
{
ภภ 
logger
มม 
.
มม 
Info
มม 
(
มม 
$"
มม 
$str
มม 3
{
มม3 4
filePathList
มม4 @
.
มม@ A
Count
มมA F
}
มมF G
$str
มมG Q
"
มมQ R
)
มมR S
;
มมS T
foreach
รร 
(
รร 
var
รร 
filePath
รร %
in
รร& (
filePathList
รร) 5
)
รร5 6
{
ฤฤ 
cancellationToken
ลล %
.
ลล% &*
ThrowIfCancellationRequested
ลล& B
(
ลลB C
)
ลลC D
;
ลลD E
var
วว 
metadata
วว  
=
วว! "
await
วว# ($
LoadTrackMetadataAsync
วว) ?
(
วว? @
filePath
วว@ H
,
ววH I
cancellationToken
ววJ [
)
วว[ \
;
วว\ ]
if
ศศ 
(
ศศ 
metadata
ศศ  
!=
ศศ! #
null
ศศ$ (
)
ศศ( )
{
ษษ 
results
สส 
.
สส  
Add
สส  #
(
สส# $
metadata
สส$ ,
)
สส, -
;
สส- .
}
หห 
processedCount
ออ "
++
ออ" $
;
ออ$ %
progress
ฮฮ 
?
ฮฮ 
.
ฮฮ 
Report
ฮฮ $
(
ฮฮ$ %
processedCount
ฮฮ% 3
)
ฮฮ3 4
;
ฮฮ4 5
}
ฯฯ 
logger
ัั 
.
ัั 
Info
ัั 
(
ัั 
$"
าา 
$str
าา 7
{
าา7 8
results
าา8 ?
.
าา? @
Count
าา@ E
}
าาE F
$str
าาF G
{
าาG H
filePathList
าาH T
.
าาT U
Count
าาU Z
}
าาZ [
$str
าา[ b
"
าาb c
)
ำำ 
;
ำำ 
return
ิิ 
results
ิิ 
;
ิิ 
}
ีี 
catch
ึึ 
(
ึึ (
OperationCanceledException
ึึ -
)
ึึ- .
{
ืื 
logger
ุุ 
.
ุุ 
Info
ุุ 
(
ุุ 
$"
ูู 
$str
ูู G
{
ููG H
processedCount
ููH V
}
ููV W
$str
ููW X
{
ููX Y
filePathList
ููY e
.
ููe f
Count
ููf k
}
ููk l
$str
ููl r
"
ููr s
)
ฺฺ 
;
ฺฺ 
throw
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
logger
฿฿ 
.
฿฿ 
Error
฿฿ 
(
฿฿ 
ex
เเ 
,
เเ 
$"
แแ 
$str
แแ C
{
แแC D
processedCount
แแD R
}
แแR S
$str
แแS T
{
แแT U
filePathList
แแU a
.
แแa b
Count
แแb g
}
แแg h
$str
แแh n
"
แแn o
)
โโ 
;
โโ 
return
ใใ 
results
ใใ 
;
ใใ 
}
ไไ 
}
ๅๅ 	
public
๊๊ 
async
๊๊ 
Task
๊๊ $
SaveTrackMetadataAsync
๊๊ 0
(
๊๊0 1
string
๋๋ 
filePath
๋๋ 
,
๋๋  
TrackMetadataModel
์์ 
metadata
์์ '
,
์์' (
CancellationToken
ํํ 
cancellationToken
ํํ /
=
ํํ0 1
default
ํํ2 9
)
๎๎ 	
{
๏๏ 	
if
๐๐ 
(
๐๐ 
disposed
๐๐ 
)
๐๐ 
throw
๑๑ 
new
๑๑ %
ObjectDisposedException
๑๑ 1
(
๑๑1 2
nameof
๑๑2 8
(
๑๑8 9
MetadataService
๑๑9 H
)
๑๑H I
)
๑๑I J
;
๑๑J K
if
๓๓ 
(
๓๓ 
string
๓๓ 
.
๓๓ 
IsNullOrEmpty
๓๓ $
(
๓๓$ %
filePath
๓๓% -
)
๓๓- .
||
๓๓/ 1
metadata
๓๓2 :
==
๓๓; =
null
๓๓> B
)
๓๓B C
return
๔๔ 
;
๔๔ 
try
๖๖ 
{
๗๗ 
await
๘๘ 
Task
๘๘ 
.
๘๘ 
Run
๘๘ 
(
๘๘ 
(
๙๙ 
)
๙๙ 
=>
๙๙ 
{
๚๚ 
cancellationToken
๛๛ )
.
๛๛) **
ThrowIfCancellationRequested
๛๛* F
(
๛๛F G
)
๛๛G H
;
๛๛H I
metadataCache
 %
.
% & 
CacheTrackMetadata
& 8
(
8 9
filePath
9 A
,
A B
metadata
C K
)
K L
;
L M
logger
 
.
 
Debug
 $
(
$ %
$"
% '
$str
' F
{
F G
filePath
G O
}
O P
"
P Q
)
Q R
;
R S
}
 
,
 
cancellationToken
 %
)
 
;
 
}
 
catch
 
(
 (
OperationCanceledException
 -
)
- .
{
 
logger
 
.
 
Info
 
(
 
$"
 
$str
 A
{
A B
filePath
B J
}
J K
"
K L
)
L M
;
M N
throw
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
logger
 
.
 
Error
 
(
 
ex
 
,
  
$"
! #
$str
# F
{
F G
filePath
G O
}
O P
"
P Q
)
Q R
;
R S
throw
 
;
 
}
 
}
 	
public
 
async
 
Task
 
<
  
AlbumMetadataModel
 ,
>
, -$
LoadAlbumMetadataAsync
. D
(
D E
Game
 
game
 
,
 
CancellationToken
 
cancellationToken
 /
=
0 1
default
2 9
)
 	
{
 	
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
MetadataService
9 H
)
H I
)
I J
;
J K
if
 
(
 
game
 
==
 
null
 
)
 
{
 
logger
 
.
 
Warn
 
(
 
$str
 J
)
J K
;
K L
return
 
null
 
;
 
}
กก 
try
ฃฃ 
{
คค 
cancellationToken
ฅฅ !
.
ฅฅ! "*
ThrowIfCancellationRequested
ฅฅ" >
(
ฅฅ> ?
)
ฅฅ? @
;
ฅฅ@ A
var
จจ 
albumKey
จจ 
=
จจ 
MetadataCache
จจ ,
.
จจ, -
GenerateAlbumKey
จจ- =
(
จจ= >
game
จจ> B
.
จจB C
Name
จจC G
,
จจG H
game
จจI M
.
จจM N
Name
จจN R
)
จจR S
;
จจS T
logger
ฉฉ 
.
ฉฉ 
Debug
ฉฉ 
(
ฉฉ 
$"
ฉฉ 
$str
ฉฉ @
{
ฉฉ@ A
game
ฉฉA E
.
ฉฉE F
Name
ฉฉF J
}
ฉฉJ K
"
ฉฉK L
)
ฉฉL M
;
ฉฉM N
var
ฌฌ 
cachedAlbum
ฌฌ 
=
ฌฌ  !
metadataCache
ฌฌ" /
.
ฌฌ/ 0
GetAlbumMetadata
ฌฌ0 @
(
ฌฌ@ A
albumKey
ฌฌA I
)
ฌฌI J
;
ฌฌJ K
if
ญญ 
(
ญญ 
cachedAlbum
ญญ 
!=
ญญ  "
null
ญญ# '
)
ญญ' (
{
ฎฎ 
logger
ฏฏ 
.
ฏฏ 
Debug
ฏฏ  
(
ฏฏ  !
$"
ฏฏ! #
$str
ฏฏ# A
{
ฏฏA B
game
ฏฏB F
.
ฏฏF G
Name
ฏฏG K
}
ฏฏK L
"
ฏฏL M
)
ฏฏM N
;
ฏฏN O
return
ฐฐ 
cachedAlbum
ฐฐ &
;
ฐฐ& '
}
ฑฑ 
logger
ณณ 
.
ณณ 
Debug
ณณ 
(
ณณ 
$"
ดด 
$str
ดด 5
{
ดด5 6
game
ดด6 :
.
ดด: ;
Name
ดด; ?
}
ดด? @
$str
ดด@ Y
"
ดดY Z
)
ตต 
;
ตต 
var
ธธ 
albumMetadata
ธธ !
=
ธธ" #
await
ธธ$ )*
LoadAlbumFromExternalSources
ธธ* F
(
ธธF G
game
นน 
.
นน 
Name
นน 
,
นน 
game
บบ 
.
บบ 
Name
บบ 
,
บบ 
cancellationToken
ปป %
)
ผผ 
;
ผผ 
if
ฟฟ 
(
ฟฟ 
albumMetadata
ฟฟ !
!=
ฟฟ" $
null
ฟฟ% )
)
ฟฟ) *
{
ภภ 
metadataCache
มม !
.
มม! " 
CacheAlbumMetadata
มม" 4
(
มม4 5
albumKey
มม5 =
,
มม= >
albumMetadata
มม? L
)
มมL M
;
มมM N
logger
ยย 
.
ยย 
Debug
ยย  
(
ยย  !
$"
ยย! #
$str
ยย# L
{
ยยL M
game
ยยM Q
.
ยยQ R
Name
ยยR V
}
ยยV W
"
ยยW X
)
ยยX Y
;
ยยY Z
}
รร 
return
ลล 
albumMetadata
ลล $
;
ลล$ %
}
ฦฦ 
catch
วว 
(
วว (
OperationCanceledException
วว -
)
วว- .
{
ศศ 
logger
ษษ 
.
ษษ 
Info
ษษ 
(
ษษ 
$"
ษษ 
$str
ษษ I
{
ษษI J
game
ษษJ N
.
ษษN O
Name
ษษO S
}
ษษS T
"
ษษT U
)
ษษU V
;
ษษV W
throw
สส 
;
สส 
}
หห 
catch
ฬฬ 
(
ฬฬ 
	Exception
ฬฬ 
ex
ฬฬ 
)
ฬฬ  
{
ออ 
logger
ฮฮ 
.
ฮฮ 
Error
ฮฮ 
(
ฮฮ 
ex
ฮฮ 
,
ฮฮ  
$"
ฮฮ! #
$str
ฮฮ# K
{
ฮฮK L
game
ฮฮL P
.
ฮฮP Q
Name
ฮฮQ U
}
ฮฮU V
"
ฮฮV W
)
ฮฮW X
;
ฮฮX Y
errorHandler
ฯฯ 
.
ฯฯ !
HandlePlaybackError
ฯฯ 0
(
ฯฯ0 1
ex
ฯฯ1 3
,
ฯฯ3 4
game
ฯฯ5 9
.
ฯฯ9 :
Name
ฯฯ: >
)
ฯฯ> ?
;
ฯฯ? @
return
ะะ 
null
ะะ 
;
ะะ 
}
ัั 
}
าา 	
public
ืื 
async
ืื 
Task
ืื 
<
ืื "
DiscogsMetadataModel
ืื .
>
ืื. /&
LoadDiscogsMetadataAsync
ืื0 H
(
ืืH I
Game
ุุ 
game
ุุ 
,
ุุ 
string
ูู 
discogsToken
ูู 
,
ูู  
CancellationToken
ฺฺ 
cancellationToken
ฺฺ /
=
ฺฺ0 1
default
ฺฺ2 9
)
 	
{
 	
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
MetadataService
9 H
)
H I
)
I J
;
J K
if
เเ 
(
เเ 
game
เเ 
==
เเ 
null
เเ 
||
เเ 
string
เเ  &
.
เเ& '
IsNullOrEmpty
เเ' 4
(
เเ4 5
discogsToken
เเ5 A
)
เเA B
)
เเB C
return
แแ 
null
แแ 
;
แแ 
try
ใใ 
{
ไไ 
cancellationToken
ๅๅ !
.
ๅๅ! "*
ThrowIfCancellationRequested
ๅๅ" >
(
ๅๅ> ?
)
ๅๅ? @
;
ๅๅ@ A
var
่่ 

discogsKey
่่ 
=
่่  
$"
่่! #
$str
่่# +
{
่่+ ,
game
่่, 0
.
่่0 1
Name
่่1 5
}
่่5 6
"
่่6 7
;
่่7 8
var
๋๋ 
cachedDiscogs
๋๋ !
=
๋๋" #
metadataCache
๋๋$ 1
.
๋๋1 2!
GetExternalMetadata
๋๋2 E
<
๋๋E F"
DiscogsMetadataModel
๋๋F Z
>
๋๋Z [
(
๋๋[ \

discogsKey
์์ 
)
ํํ 
;
ํํ 
if
๎๎ 
(
๎๎ 
cachedDiscogs
๎๎ !
!=
๎๎" $
null
๎๎% )
)
๎๎) *
{
๏๏ 
logger
๐๐ 
.
๐๐ 
Debug
๐๐  
(
๐๐  !
$"
๐๐! #
$str
๐๐# H
{
๐๐H I
game
๐๐I M
.
๐๐M N
Name
๐๐N R
}
๐๐R S
"
๐๐S T
)
๐๐T U
;
๐๐U V
return
๑๑ 
cachedDiscogs
๑๑ (
;
๑๑( )
}
๒๒ 
logger
๔๔ 
.
๔๔ 
Debug
๔๔ 
(
๔๔ 
$"
๔๔ 
$str
๔๔ B
{
๔๔B C
game
๔๔C G
.
๔๔G H
Name
๔๔H L
}
๔๔L M
"
๔๔M N
)
๔๔N O
;
๔๔O P
var
๗๗ 
discogsResults
๗๗ "
=
๗๗# $
await
๗๗% *
discogsClient
๗๗+ 8
.
๗๗8 9 
SearchReleaseAsync
๗๗9 K
(
๗๗K L
game
๘๘ 
.
๘๘ 
Name
๘๘ 
,
๘๘ 
discogsToken
๙๙  
,
๙๙  !
cancellationToken
๚๚ %
)
๛๛ 
;
๛๛ 
var
 
discogsMetadata
 #
=
$ %
discogsResults
& 4
?
4 5
.
5 6
FirstOrDefault
6 D
(
D E
)
E F
;
F G
if
 
(
 
discogsMetadata
 #
!=
$ &
null
' +
)
+ ,
{
 
metadataCache
 !
.
! "#
CacheExternalMetadata
" 7
(
7 8

discogsKey
8 B
,
B C
discogsMetadata
D S
)
S T
;
T U
logger
 
.
 
Debug
  
(
  !
$"
! #
$str
# E
{
E F
game
F J
.
J K
Name
K O
}
O P
"
P Q
)
Q R
;
R S
}
 
return
 
discogsMetadata
 &
;
& '
}
 
catch
 
(
 (
OperationCanceledException
 -
)
- .
{
 
logger
 
.
 
Info
 
(
 
$"
 
$str
 K
{
K L
game
L P
.
P Q
Name
Q U
}
U V
"
V W
)
W X
;
X Y
throw
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
logger
 
.
 
Error
 
(
 
ex
 
,
  
$"
! #
$str
# M
{
M N
game
N R
.
R S
Name
S W
}
W X
"
X Y
)
Y Z
;
Z [
errorHandler
 
.
  
HandleNetworkError
 /
(
/ 0
ex
0 2
,
2 3
$str
4 A
)
A B
;
B C
return
 
null
 
;
 
}
 
}
 	
public
 
async
 
Task
 
<
 &
MusicBrainzMetadataModel
 2
>
2 3*
LoadMusicBrainzMetadataAsync
4 P
(
P Q
Game
 
game
 
,
 
CancellationToken
 
cancellationToken
 /
=
0 1
default
2 9
)
 	
{
 	
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
MetadataService
9 H
)
H I
)
I J
;
J K
if
 
(
 
game
 
==
 
null
 
)
 
return
 
null
 
;
 
try
กก 
{
ขข 
cancellationToken
ฃฃ !
.
ฃฃ! "*
ThrowIfCancellationRequested
ฃฃ" >
(
ฃฃ> ?
)
ฃฃ? @
;
ฃฃ@ A
var
ฆฆ 
mbKey
ฆฆ 
=
ฆฆ 
$"
ฆฆ 
$str
ฆฆ *
{
ฆฆ* +
game
ฆฆ+ /
.
ฆฆ/ 0
Name
ฆฆ0 4
}
ฆฆ4 5
"
ฆฆ5 6
;
ฆฆ6 7
var
ฉฉ 
cachedMB
ฉฉ 
=
ฉฉ 
metadataCache
ฉฉ ,
.
ฉฉ, -!
GetExternalMetadata
ฉฉ- @
<
ฉฉ@ A&
MusicBrainzMetadataModel
ฉฉA Y
>
ฉฉY Z
(
ฉฉZ [
mbKey
ฉฉ[ `
)
ฉฉ` a
;
ฉฉa b
if
ชช 
(
ชช 
cachedMB
ชช 
!=
ชช 
null
ชช  $
)
ชช$ %
{
ซซ 
logger
ฌฌ 
.
ฌฌ 
Debug
ฌฌ  
(
ฌฌ  !
$"
ฌฌ! #
$str
ฌฌ# L
{
ฌฌL M
game
ฌฌM Q
.
ฌฌQ R
Name
ฌฌR V
}
ฌฌV W
"
ฌฌW X
)
ฌฌX Y
;
ฌฌY Z
return
ญญ 
cachedMB
ญญ #
;
ญญ# $
}
ฎฎ 
logger
ฐฐ 
.
ฐฐ 
Debug
ฐฐ 
(
ฐฐ 
$"
ฐฐ 
$str
ฐฐ F
{
ฐฐF G
game
ฐฐG K
.
ฐฐK L
Name
ฐฐL P
}
ฐฐP Q
"
ฐฐQ R
)
ฐฐR S
;
ฐฐS T
var
ณณ 

mbMetadata
ณณ 
=
ณณ  
await
ณณ! &
musicBrainzClient
ณณ' 8
.
ณณ8 9 
SearchReleaseAsync
ณณ9 K
(
ณณK L
game
ดด 
.
ดด 
Name
ดด 
,
ดด 
game
ตต 
.
ตต 
Name
ตต 
,
ตต 
cancellationToken
ถถ %
)
ทท 
;
ทท 
if
นน 
(
นน 

mbMetadata
นน 
!=
นน !
null
นน" &
)
นน& '
{
บบ 
metadataCache
ปป !
.
ปป! "#
CacheExternalMetadata
ปป" 7
(
ปป7 8
mbKey
ปป8 =
,
ปป= >

mbMetadata
ปป? I
)
ปปI J
;
ปปJ K
logger
ผผ 
.
ผผ 
Debug
ผผ  
(
ผผ  !
$"
ผผ! #
$str
ผผ# I
{
ผผI J
game
ผผJ N
.
ผผN O
Name
ผผO S
}
ผผS T
"
ผผT U
)
ผผU V
;
ผผV W
}
ฝฝ 
return
ฟฟ 

mbMetadata
ฟฟ !
;
ฟฟ! "
}
ภภ 
catch
มม 
(
มม (
OperationCanceledException
มม -
)
มม- .
{
ยย 
logger
รร 
.
รร 
Info
รร 
(
รร 
$"
รร 
$str
รร O
{
รรO P
game
รรP T
.
รรT U
Name
รรU Y
}
รรY Z
"
รรZ [
)
รร[ \
;
รร\ ]
throw
ฤฤ 
;
ฤฤ 
}
ลล 
catch
ฦฦ 
(
ฦฦ 
	Exception
ฦฦ 
ex
ฦฦ 
)
ฦฦ  
{
วว 
logger
ศศ 
.
ศศ 
Error
ศศ 
(
ศศ 
ex
ศศ 
,
ศศ  
$"
ศศ! #
$str
ศศ# Q
{
ศศQ R
game
ศศR V
.
ศศV W
Name
ศศW [
}
ศศ[ \
"
ศศ\ ]
)
ศศ] ^
;
ศศ^ _
errorHandler
ษษ 
.
ษษ  
HandleNetworkError
ษษ /
(
ษษ/ 0
ex
ษษ0 2
,
ษษ2 3
$str
ษษ4 E
)
ษษE F
;
ษษF G
return
สส 
null
สส 
;
สส 
}
หห 
}
ฬฬ 	
public
ีี 
async
ีี 
Task
ีี "
InvalidateCacheAsync
ีี .
(
ีี. /
string
ึึ 
key
ึึ 
,
ึึ 
CancellationToken
ืื 
cancellationToken
ืื /
=
ืื0 1
default
ืื2 9
)
ุุ 	
{
ูู 	
if
ฺฺ 
(
ฺฺ 
disposed
ฺฺ 
)
ฺฺ 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
MetadataService
9 H
)
H I
)
I J
;
J K
try
 
{
 
await
฿฿ 
Task
฿฿ 
.
฿฿ 
Run
฿฿ 
(
฿฿ 
(
เเ 
)
เเ 
=>
เเ 
{
แแ 
cancellationToken
โโ )
.
โโ) **
ThrowIfCancellationRequested
โโ* F
(
โโF G
)
โโG H
;
โโH I
var
ๅๅ 
removed
ๅๅ #
=
ๅๅ$ %
metadataCache
ๅๅ& 3
.
ๅๅ3 4!
RemoveTrackMetadata
ๅๅ4 G
(
ๅๅG H
key
ๅๅH K
)
ๅๅK L
;
ๅๅL M
if
็็ 
(
็็ 
removed
็็ #
)
็็# $
{
่่ 
logger
้้ "
.
้้" #
Debug
้้# (
(
้้( )
$"
้้) +
$str
้้+ F
{
้้F G
key
้้G J
}
้้J K
"
้้K L
)
้้L M
;
้้M N
}
๊๊ 
}
๋๋ 
,
๋๋ 
cancellationToken
์์ %
)
ํํ 
;
ํํ 
}
๎๎ 
catch
๏๏ 
(
๏๏ (
OperationCanceledException
๏๏ -
)
๏๏- .
{
๐๐ 
logger
๑๑ 
.
๑๑ 
Info
๑๑ 
(
๑๑ 
$"
๑๑ 
$str
๑๑ D
{
๑๑D E
key
๑๑E H
}
๑๑H I
"
๑๑I J
)
๑๑J K
;
๑๑K L
throw
๒๒ 
;
๒๒ 
}
๓๓ 
catch
๔๔ 
(
๔๔ 
	Exception
๔๔ 
ex
๔๔ 
)
๔๔  
{
๕๕ 
logger
๖๖ 
.
๖๖ 
Error
๖๖ 
(
๖๖ 
ex
๖๖ 
,
๖๖  
$"
๖๖! #
$str
๖๖# G
{
๖๖G H
key
๖๖H K
}
๖๖K L
"
๖๖L M
)
๖๖M N
;
๖๖N O
throw
๗๗ 
;
๗๗ 
}
๘๘ 
}
๙๙ 	
public
 
async
 
Task
  
ClearAllCacheAsync
 ,
(
, -
CancellationToken
- >
cancellationToken
? P
=
Q R
default
S Z
)
Z [
{
 	
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
MetadataService
9 H
)
H I
)
I J
;
J K
try
 
{
 
await
 
Task
 
.
 
Run
 
(
 
(
 
)
 
=>
 
{
 
cancellationToken
 )
.
) **
ThrowIfCancellationRequested
* F
(
F G
)
G H
;
H I
logger
 
.
 
Info
 #
(
# $
$str
$ E
)
E F
;
F G
metadataCache
 %
.
% &
ClearAllCaches
& 4
(
4 5
)
5 6
;
6 7
logger
 
.
 
Info
 #
(
# $
$str
$ N
)
N O
;
O P
}
 
,
 
cancellationToken
 %
)
 
;
 
}
 
catch
 
(
 (
OperationCanceledException
 -
)
- .
{
 
logger
 
.
 
Info
 
(
 
$str
 A
)
A B
;
B C
throw
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
logger
 
.
 
Error
 
(
 
ex
 
,
  
$str
! E
)
E F
;
F G
throw
 
;
 
}
 
}
 	
public
 
async
 
Task
 
<
 
CacheStatistics
 )
>
) *%
GetCacheStatisticsAsync
+ B
(
B C
CancellationToken
กก 
cancellationToken
กก /
=
กก0 1
default
กก2 9
)
ขข 	
{
ฃฃ 	
if
คค 
(
คค 
disposed
คค 
)
คค 
throw
ฅฅ 
new
ฅฅ %
ObjectDisposedException
ฅฅ 1
(
ฅฅ1 2
nameof
ฅฅ2 8
(
ฅฅ8 9
MetadataService
ฅฅ9 H
)
ฅฅH I
)
ฅฅI J
;
ฅฅJ K
try
งง 
{
จจ 
return
ฉฉ 
await
ฉฉ 
Task
ฉฉ !
.
ฉฉ! "
Run
ฉฉ" %
(
ฉฉ% &
(
ชช 
)
ชช 
=>
ชช 
{
ซซ 
cancellationToken
ฌฌ )
.
ฌฌ) **
ThrowIfCancellationRequested
ฌฌ* F
(
ฌฌF G
)
ฌฌG H
;
ฌฌH I
var
ฎฎ 
metrics
ฎฎ #
=
ฎฎ$ %
metadataCache
ฎฎ& 3
.
ฎฎ3 4

GetMetrics
ฎฎ4 >
(
ฎฎ> ?
)
ฎฎ? @
;
ฎฎ@ A
var
ฑฑ 

trackStats
ฑฑ &
=
ฑฑ' (
metrics
ฑฑ) 0
.
ฑฑ0 1

TrackCache
ฑฑ1 ;
;
ฑฑ; <
return
ณณ 
new
ณณ "
CacheStatistics
ณณ# 2
{
ดด 
TotalEntries
ตต (
=
ตต) *

trackStats
ตต+ 5
.
ตต5 6
CurrentSize
ตต6 A
,
ตตA B
HitCount
ถถ $
=
ถถ% &
(
ถถ' (
int
ถถ( +
)
ถถ+ ,

trackStats
ถถ, 6
.
ถถ6 7
	CacheHits
ถถ7 @
,
ถถ@ A
	MissCount
ทท %
=
ทท& '
(
ทท( )
int
ทท) ,
)
ทท, -

trackStats
ทท- 7
.
ทท7 8
CacheMisses
ทท8 C
,
ททC D
MemoryUsageBytes
ธธ ,
=
ธธ- .

trackStats
ธธ/ 9
.
ธธ9 :
CurrentSize
ธธ: E
*
ธธF G
$num
ธธH L
,
ธธL M!
AverageResponseTime
นน /
=
นน0 1
TimeSpan
นน2 :
.
นน: ;
FromMilliseconds
นน; K
(
นนK L
$num
นนL M
)
นนM N
,
นนN O
}
บบ 
;
บบ 
}
ปป 
,
ปป 
cancellationToken
ผผ %
)
ฝฝ 
;
ฝฝ 
}
พพ 
catch
ฟฟ 
(
ฟฟ (
OperationCanceledException
ฟฟ -
)
ฟฟ- .
{
ภภ 
logger
มม 
.
มม 
Info
มม 
(
มม 
$str
มม F
)
มมF G
;
มมG H
throw
ยย 
;
ยย 
}
รร 
catch
ฤฤ 
(
ฤฤ 
	Exception
ฤฤ 
ex
ฤฤ 
)
ฤฤ  
{
ลล 
logger
ฦฦ 
.
ฦฦ 
Error
ฦฦ 
(
ฦฦ 
ex
ฦฦ 
,
ฦฦ  
$str
ฦฦ! A
)
ฦฦA B
;
ฦฦB C
return
วว 
new
วว 
CacheStatistics
วว *
(
วว* +
)
วว+ ,
;
วว, -
}
ศศ 
}
ษษ 	
public
าา 
void
าา 
	Configure
าา 
(
าา 
OstPlayerSettings
าา /
settings
าา0 8
)
าา8 9
{
ำำ 	
if
ิิ 
(
ิิ 
disposed
ิิ 
)
ิิ 
throw
ีี 
new
ีี %
ObjectDisposedException
ีี 1
(
ีี1 2
nameof
ีี2 8
(
ีี8 9
MetadataService
ีี9 H
)
ีีH I
)
ีีI J
;
ีีJ K
try
ืื 
{
ุุ 
logger
ูู 
.
ูู 
Info
ูู 
(
ูู 
$str
ูู N
)
ููN O
;
ููO P
if
 
(
 
settings
 
.
 !
EnableMetadataCache
 0
)
0 1
{
 
logger
เเ 
.
เเ 
Info
เเ 
(
เเ  
$"
แแ 
$str
แแ ;
{
แแ; <
settings
แแ< D
.
แแD E#
MetadataCacheTTLHours
แแE Z
}
แแZ [
$str
แแ[ m
{
แแm n
settings
แแn v
.
แแv w
MaxCacheSizeแแw 
}แแ 
"แแ 
)
โโ 
;
โโ 
}
ใใ 
logger
ๅๅ 
.
ๅๅ 
Info
ๅๅ 
(
ๅๅ 
$str
ๅๅ P
)
ๅๅP Q
;
ๅๅQ R
}
ๆๆ 
catch
็็ 
(
็็ 
	Exception
็็ 
ex
็็ 
)
็็  
{
่่ 
logger
้้ 
.
้้ 
Error
้้ 
(
้้ 
ex
้้ 
,
้้  
$str
้้! D
)
้้D E
;
้้E F
throw
๊๊ 
;
๊๊ 
}
๋๋ 
}
์์ 	
public
๑๑ 
async
๑๑ 
Task
๑๑ 
<
๑๑ !
ServiceHealthStatus
๑๑ -
>
๑๑- .
CheckHealthAsync
๑๑/ ?
(
๑๑? @
CancellationToken
๒๒ 
cancellationToken
๒๒ /
=
๒๒0 1
default
๒๒2 9
)
๓๓ 	
{
๔๔ 	
if
๕๕ 
(
๕๕ 
disposed
๕๕ 
)
๕๕ 
throw
๖๖ 
new
๖๖ %
ObjectDisposedException
๖๖ 1
(
๖๖1 2
nameof
๖๖2 8
(
๖๖8 9
MetadataService
๖๖9 H
)
๖๖H I
)
๖๖I J
;
๖๖J K
var
๘๘ 
healthStatus
๘๘ 
=
๘๘ 
new
๘๘ "!
ServiceHealthStatus
๘๘# 6
{
๙๙ 
	IsHealthy
๚๚ 
=
๚๚ 
true
๚๚  
,
๚๚  !
Status
๛๛ 
=
๛๛ 
$str
๛๛ "
,
๛๛" #
Details
 
=
 
new
 

Dictionary
 (
<
( )
string
) /
,
/ 0
string
1 7
>
7 8
(
8 9
)
9 :
,
: ;
}
 
;
 
try
 
{
 
var
 
	startTime
 
=
 
DateTime
  (
.
( )
UtcNow
) /
;
/ 0
var
 
cacheMetrics
  
=
! "
await
# (%
GetCacheStatisticsAsync
) @
(
@ A
cancellationToken
A R
)
R S
;
S T
healthStatus
 
.
 
Details
 $
[
$ %
$str
% 3
]
3 4
=
5 6
cacheMetrics
7 C
.
C D
TotalEntries
D P
.
P Q
ToString
Q Y
(
Y Z
)
Z [
;
[ \
healthStatus
 
.
 
Details
 $
[
$ %
$str
% 4
]
4 5
=
6 7
$"
8 :
{
: ;
cacheMetrics
; G
.
G H
HitRatio
H P
:
P Q
$str
Q S
}
S T
"
T U
;
U V
try
 
{
 
var
 
discogsHealthy
 &
=
' (
await
) .
discogsClient
/ <
.
< =
CheckHealthAsync
= M
(
M N
)
N O
;
O P
healthStatus
  
.
  !
Details
! (
[
( )
$str
) 5
]
5 6
=
7 8
discogsHealthy
9 G
?
 
$str
 %
:
 
$str
 '
;
' (
var
 
	mbHealthy
 !
=
" #
await
$ )
musicBrainzClient
* ;
.
; <
CheckHealthAsync
< L
(
L M
)
M N
;
N O
healthStatus
  
.
  !
Details
! (
[
( )
$str
) 9
]
9 :
=
; <
	mbHealthy
= F
?
 
$str
 %
:
 
$str
 '
;
' (
}
 
catch
 
(
 
	Exception
  
ex
! #
)
# $
{
 
healthStatus
  
.
  !
Details
! (
[
( )
$str
) 7
]
7 8
=
9 :
$"
; =
$str
= D
{
D E
ex
E G
.
G H
Message
H O
}
O P
"
P Q
;
Q R
healthStatus
  
.
  !
	IsHealthy
! *
=
+ ,
false
- 2
;
2 3
}
 
healthStatus
 
.
 
ResponseTime
 )
=
* +
DateTime
, 4
.
4 5
UtcNow
5 ;
-
< =
	startTime
> G
;
G H
if
 
(
 
!
 
healthStatus
 !
.
! "
	IsHealthy
" +
)
+ ,
{
 
healthStatus
  
.
  !
Status
! '
=
( )
$str
* 4
;
4 5
}
กก 
}
ขข 
catch
ฃฃ 
(
ฃฃ 
	Exception
ฃฃ 
ex
ฃฃ 
)
ฃฃ  
{
คค 
healthStatus
ฅฅ 
.
ฅฅ 
	IsHealthy
ฅฅ &
=
ฅฅ' (
false
ฅฅ) .
;
ฅฅ. /
healthStatus
ฆฆ 
.
ฆฆ 
Status
ฆฆ #
=
ฆฆ$ %
$str
ฆฆ& 1
;
ฆฆ1 2
healthStatus
งง 
.
งง 
Details
งง $
[
งง$ %
$str
งง% ,
]
งง, -
=
งง. /
ex
งง0 2
.
งง2 3
Message
งง3 :
;
งง: ;
}
จจ 
return
ชช 
healthStatus
ชช 
;
ชช  
}
ซซ 	
private
ฑฑ 
async
ฑฑ 
Task
ฑฑ 
<
ฑฑ  
TrackMetadataModel
ฑฑ -
>
ฑฑ- ."
LoadMp3MetadataAsync
ฑฑ/ C
(
ฑฑC D
string
ฒฒ 
filePath
ฒฒ 
,
ฒฒ 
CancellationToken
ณณ 
cancellationToken
ณณ /
)
ดด 	
{
ตต 	
try
ถถ 
{
ทท 
return
ธธ 
await
ธธ 
Task
ธธ !
.
ธธ! "
Run
ธธ" %
(
ธธ% &
(
นน 
)
นน 
=>
นน 
{
บบ 
cancellationToken
ปป )
.
ปป) **
ThrowIfCancellationRequested
ปป* F
(
ปปF G
)
ปปG H
;
ปปH I
logger
ผผ 
.
ผผ 
Debug
ผผ $
(
ผผ$ %
$"
ผผ% '
$str
ผผ' B
{
ผผB C
filePath
ผผC K
}
ผผK L
"
ผผL M
)
ผผM N
;
ผผN O
return
ฝฝ 
Mp3MetadataReader
ฝฝ 0
.
ฝฝ0 1
ReadMetadata
ฝฝ1 =
(
ฝฝ= >
filePath
ฝฝ> F
)
ฝฝF G
;
ฝฝG H
}
พพ 
,
พพ 
cancellationToken
ฟฟ %
)
ภภ 
;
ภภ 
}
มม 
catch
ยย 
(
ยย (
OperationCanceledException
ยย -
)
ยย- .
{
รร 
throw
ฤฤ 
;
ฤฤ 
}
ลล 
catch
ฦฦ 
(
ฦฦ 
	Exception
ฦฦ 
ex
ฦฦ 
)
ฦฦ  
{
วว 
logger
ศศ 
.
ศศ 
Error
ศศ 
(
ศศ 
ex
ศศ 
,
ศศ  
$"
ศศ! #
$str
ศศ# E
{
ศศE F
filePath
ศศF N
}
ศศN O
"
ศศO P
)
ศศP Q
;
ศศQ R
errorHandler
ษษ 
.
ษษ !
HandleMetadataError
ษษ 0
(
ษษ0 1
ex
ษษ1 3
,
ษษ3 4
filePath
ษษ5 =
)
ษษ= >
;
ษษ> ?
return
สส 
null
สส 
;
สส 
}
หห 
}
ฬฬ 	
private
ฮฮ 
async
ฮฮ 
Task
ฮฮ 
<
ฮฮ "
DiscogsMetadataModel
ฮฮ /
>
ฮฮ/ 0&
LoadDiscogsMetadataAsync
ฮฮ1 I
(
ฮฮI J 
TrackMetadataModel
ฯฯ 
mp3Metadata
ฯฯ *
,
ฯฯ* +
CancellationToken
ะะ 
cancellationToken
ะะ /
)
ัั 	
{
าา 	
if
ำำ 
(
ำำ 
mp3Metadata
ำำ 
==
ำำ 
null
ำำ #
)
ำำ# $
return
ิิ 
null
ิิ 
;
ิิ 
try
ึึ 
{
ืื 
cancellationToken
ุุ !
.
ุุ! "*
ThrowIfCancellationRequested
ุุ" >
(
ุุ> ?
)
ุุ? @
;
ุุ@ A
var
ฺฺ 

discogsKey
ฺฺ 
=
ฺฺ  
$"
ฺฺ! #
$str
ฺฺ# +
{
ฺฺ+ ,
mp3Metadata
ฺฺ, 7
.
ฺฺ7 8
Artist
ฺฺ8 >
}
ฺฺ> ?
$str
ฺฺ? @
{
ฺฺ@ A
mp3Metadata
ฺฺA L
.
ฺฺL M
Album
ฺฺM R
}
ฺฺR S
"
ฺฺS T
;
ฺฺT U
var
 
cachedDiscogs
 !
=
" #
metadataCache
$ 1
.
1 2!
GetExternalMetadata
2 E
<
E F"
DiscogsMetadataModel
F Z
>
Z [
(
[ \

discogsKey
 
)
 
;
 
if
 
(
 
cachedDiscogs
 !
!=
" $
null
% )
)
) *
{
฿฿ 
return
เเ 
cachedDiscogs
เเ (
;
เเ( )
}
แแ 
var
ไไ 
results
ไไ 
=
ไไ 
await
ไไ #
discogsClient
ไไ$ 1
.
ไไ1 2 
SearchReleaseAsync
ไไ2 D
(
ไไD E
$"
ๅๅ 
{
ๅๅ 
mp3Metadata
ๅๅ "
.
ๅๅ" #
Artist
ๅๅ# )
}
ๅๅ) *
$str
ๅๅ* +
{
ๅๅ+ ,
mp3Metadata
ๅๅ, 7
.
ๅๅ7 8
Album
ๅๅ8 =
}
ๅๅ= >
"
ๅๅ> ?
,
ๅๅ? @
string
ๆๆ 
.
ๆๆ 
Empty
ๆๆ  
)
็็ 
;
็็ 
var
่่ 
discogsMetadata
่่ #
=
่่$ %
results
่่& -
?
่่- .
.
่่. /
FirstOrDefault
่่/ =
(
่่= >
)
่่> ?
;
่่? @
if
๊๊ 
(
๊๊ 
discogsMetadata
๊๊ #
!=
๊๊$ &
null
๊๊' +
)
๊๊+ ,
{
๋๋ 
metadataCache
์์ !
.
์์! "#
CacheExternalMetadata
์์" 7
(
์์7 8

discogsKey
์์8 B
,
์์B C
discogsMetadata
์์D S
)
์์S T
;
์์T U
}
ํํ 
return
๏๏ 
discogsMetadata
๏๏ &
;
๏๏& '
}
๐๐ 
catch
๑๑ 
(
๑๑ (
OperationCanceledException
๑๑ -
)
๑๑- .
{
๒๒ 
throw
๓๓ 
;
๓๓ 
}
๔๔ 
catch
๕๕ 
(
๕๕ 
	Exception
๕๕ 
ex
๕๕ 
)
๕๕  
{
๖๖ 
logger
๗๗ 
.
๗๗ 
Error
๗๗ 
(
๗๗ 
ex
๗๗ 
,
๗๗  
$str
๗๗! B
)
๗๗B C
;
๗๗C D
errorHandler
๘๘ 
.
๘๘  
HandleNetworkError
๘๘ /
(
๘๘/ 0
ex
๘๘0 2
,
๘๘2 3
$str
๘๘4 A
)
๘๘A B
;
๘๘B C
return
๙๙ 
null
๙๙ 
;
๙๙ 
}
๚๚ 
}
๛๛ 	
private
 
async
 
Task
 
<
 &
MusicBrainzMetadataModel
 3
>
3 4*
LoadMusicBrainzMetadataAsync
5 Q
(
Q R 
TrackMetadataModel
 
mp3Metadata
 *
,
* +
CancellationToken
 
cancellationToken
 /
)
 	
{
 	
if
 
(
 
mp3Metadata
 
==
 
null
 #
)
# $
return
 
null
 
;
 
try
 
{
 
cancellationToken
 !
.
! "*
ThrowIfCancellationRequested
" >
(
> ?
)
? @
;
@ A
var
 
mbKey
 
=
 
$"
 
$str
 *
{
* +
mp3Metadata
+ 6
.
6 7
Artist
7 =
}
= >
$str
> ?
{
? @
mp3Metadata
@ K
.
K L
Album
L Q
}
Q R
"
R S
;
S T
var
 
cachedMB
 
=
 
metadataCache
 ,
.
, -!
GetExternalMetadata
- @
<
@ A&
MusicBrainzMetadataModel
A Y
>
Y Z
(
Z [
mbKey
[ `
)
` a
;
a b
if
 
(
 
cachedMB
 
!=
 
null
  $
)
$ %
{
 
return
 
cachedMB
 #
;
# $
}
 
var
 

mbMetadata
 
=
  
await
! &
musicBrainzClient
' 8
.
8 9 
SearchReleaseAsync
9 K
(
K L
mp3Metadata
 
.
  
Artist
  &
,
& '
mp3Metadata
 
.
  
Album
  %
,
% &
cancellationToken
 %
)
 
;
 
if
 
(
 

mbMetadata
 
!=
 !
null
" &
)
& '
{
 
metadataCache
 !
.
! "#
CacheExternalMetadata
" 7
(
7 8
mbKey
8 =
,
= >

mbMetadata
? I
)
I J
;
J K
}
 
return
 

mbMetadata
 !
;
! "
}
 
catch
 
(
 (
OperationCanceledException
 -
)
- .
{
 
throw
 
;
 
}
กก 
catch
ขข 
(
ขข 
	Exception
ขข 
ex
ขข 
)
ขข  
{
ฃฃ 
logger
คค 
.
คค 
Error
คค 
(
คค 
ex
คค 
,
คค  
$str
คค! F
)
คคF G
;
คคG H
errorHandler
ฅฅ 
.
ฅฅ  
HandleNetworkError
ฅฅ /
(
ฅฅ/ 0
ex
ฅฅ0 2
,
ฅฅ2 3
$str
ฅฅ4 E
)
ฅฅE F
;
ฅฅF G
return
ฆฆ 
null
ฆฆ 
;
ฆฆ 
}
งง 
}
จจ 	
private
ชช 
async
ชช 
Task
ชช 
<
ชช  
AlbumMetadataModel
ชช -
>
ชช- .*
LoadAlbumFromExternalSources
ชช/ K
(
ชชK L
string
ซซ 
artist
ซซ 
,
ซซ 
string
ฌฌ 
album
ฌฌ 
,
ฌฌ 
CancellationToken
ญญ 
cancellationToken
ญญ /
)
ฎฎ 	
{
ฏฏ 	
try
ฐฐ 
{
ฑฑ 
cancellationToken
ฒฒ !
.
ฒฒ! "*
ThrowIfCancellationRequested
ฒฒ" >
(
ฒฒ> ?
)
ฒฒ? @
;
ฒฒ@ A
await
ถถ 
Task
ถถ 
.
ถถ 
CompletedTask
ถถ (
;
ถถ( )
return
ทท 
null
ทท 
;
ทท 
}
ธธ 
catch
นน 
(
นน (
OperationCanceledException
นน -
)
นน- .
{
บบ 
throw
ปป 
;
ปป 
}
ผผ 
catch
ฝฝ 
(
ฝฝ 
	Exception
ฝฝ 
ex
ฝฝ 
)
ฝฝ  
{
พพ 
logger
ฟฟ 
.
ฟฟ 
Error
ฟฟ 
(
ฟฟ 
ex
ภภ 
,
ภภ 
$"
มม 
$str
มม K
{
มมK L
artist
มมL R
}
มมR S
$str
มมS V
{
มมV W
album
มมW \
}
มม\ ]
"
มม] ^
)
ยย 
;
ยย 
return
รร 
null
รร 
;
รร 
}
ฤฤ 
}
ลล 	
private
วว  
TrackMetadataModel
วว "&
MergeMetadataFromSources
วว# ;
(
วว; < 
TrackMetadataModel
ศศ 
mp3Metadata
ศศ *
,
ศศ* +"
DiscogsMetadataModel
ษษ  
discogsMetadata
ษษ! 0
,
ษษ0 1&
MusicBrainzMetadataModel
สส $!
musicBrainzMetadata
สส% 8
)
หห 	
{
ฬฬ 	
try
ออ 
{
ฮฮ 
logger
ฯฯ 
.
ฯฯ 
Debug
ฯฯ 
(
ฯฯ 
$str
ฯฯ E
)
ฯฯE F
;
ฯฯF G
var
าา 
mergedMetadata
าา "
=
าา# $
mp3Metadata
าา% 0
??
าา1 3
new
าา4 7 
TrackMetadataModel
าา8 J
(
าาJ K
)
าาK L
;
าาL M
if
ีี 
(
ีี !
musicBrainzMetadata
ีี '
!=
ีี( *
null
ีี+ /
)
ีี/ 0
{
ึึ 
if
ืื 
(
ืื 
string
ุุ 
.
ุุ 
IsNullOrEmpty
ุุ ,
(
ุุ, -
mergedMetadata
ุุ- ;
.
ุุ; <
Album
ุุ< A
)
ุุA B
&&
ูู 
!
ูู 
string
ูู "
.
ูู" #
IsNullOrEmpty
ูู# 0
(
ูู0 1!
musicBrainzMetadata
ูู1 D
.
ููD E
Album
ููE J
)
ููJ K
)
ฺฺ 
mergedMetadata
 &
.
& '
Album
' ,
=
- .!
musicBrainzMetadata
/ B
.
B C
Album
C H
;
H I
if
 
(
 
string
 
.
 
IsNullOrEmpty
 ,
(
, -
mergedMetadata
- ;
.
; <
Artist
< B
)
B C
&&
฿฿ 
!
฿฿ 
string
฿฿ "
.
฿฿" #
IsNullOrEmpty
฿฿# 0
(
฿฿0 1!
musicBrainzMetadata
฿฿1 D
.
฿฿D E
Artist
฿฿E K
)
฿฿K L
)
เเ 
mergedMetadata
แแ &
.
แแ& '
Artist
แแ' -
=
แแ. /!
musicBrainzMetadata
แแ0 C
.
แแC D
Artist
แแD J
;
แแJ K
}
โโ 
if
ๅๅ 
(
ๅๅ 
discogsMetadata
ๅๅ #
!=
ๅๅ$ &
null
ๅๅ' +
)
ๅๅ+ ,
{
ๆๆ 
if
็็ 
(
็็ 
string
่่ 
.
่่ 
IsNullOrEmpty
่่ ,
(
่่, -
mergedMetadata
่่- ;
.
่่; <
Album
่่< A
)
่่A B
&&
้้ 
!
้้ 
string
้้ "
.
้้" #
IsNullOrEmpty
้้# 0
(
้้0 1
discogsMetadata
้้1 @
.
้้@ A
Album
้้A F
)
้้F G
)
๊๊ 
mergedMetadata
๋๋ &
.
๋๋& '
Album
๋๋' ,
=
๋๋- .
discogsMetadata
๋๋/ >
.
๋๋> ?
Album
๋๋? D
;
๋๋D E
if
ํํ 
(
ํํ 
string
๎๎ 
.
๎๎ 
IsNullOrEmpty
๎๎ ,
(
๎๎, -
mergedMetadata
๎๎- ;
.
๎๎; <
Artist
๎๎< B
)
๎๎B C
&&
๏๏ 
!
๏๏ 
string
๏๏ "
.
๏๏" #
IsNullOrEmpty
๏๏# 0
(
๏๏0 1
discogsMetadata
๏๏1 @
.
๏๏@ A
Artist
๏๏A G
)
๏๏G H
)
๐๐ 
mergedMetadata
๑๑ &
.
๑๑& '
Artist
๑๑' -
=
๑๑. /
discogsMetadata
๑๑0 ?
.
๑๑? @
Artist
๑๑@ F
;
๑๑F G
}
๒๒ 
logger
๔๔ 
.
๔๔ 
Debug
๔๔ 
(
๔๔ 
$str
๔๔ F
)
๔๔F G
;
๔๔G H
return
๕๕ 
mergedMetadata
๕๕ %
;
๕๕% &
}
๖๖ 
catch
๗๗ 
(
๗๗ 
	Exception
๗๗ 
ex
๗๗ 
)
๗๗  
{
๘๘ 
logger
๙๙ 
.
๙๙ 
Error
๙๙ 
(
๙๙ 
ex
๙๙ 
,
๙๙  
$str
๙๙! F
)
๙๙F G
;
๙๙G H
errorHandler
๚๚ 
.
๚๚ !
HandlePlaybackError
๚๚ 0
(
๚๚0 1
ex
๚๚1 3
,
๚๚3 4
$str
๚๚5 G
)
๚๚G H
;
๚๚H I
return
๛๛ 
mp3Metadata
๛๛ "
;
๛๛" #
}
 
}
 	
public
 
void
 
Dispose
 
(
 
)
 
{
 	
Dispose
 
(
 
true
 
)
 
;
 
GC
 
.
 
SuppressFinalize
 
(
  
this
  $
)
$ %
;
% &
}
 	
	protected
 
virtual
 
void
 
Dispose
 &
(
& '
bool
' +
	disposing
, 5
)
5 6
{
 	
if
 
(
 
!
 
disposed
 
&&
 
	disposing
 &
)
& '
{
 
try
 
{
 
logger
 
.
 
Info
 
(
  
$str
  X
)
X Y
;
Y Z
metadataCache
 !
?
! "
.
" #
Dispose
# *
(
* +
)
+ ,
;
, -
logger
 
.
 
Info
 
(
  
$str
  G
)
G H
;
H I
}
 
catch
 
(
 
	Exception
  
ex
! #
)
# $
{
 
logger
 
.
 
Error
  
(
  !
ex
! #
,
# $
$str
% F
)
F G
;
G H
}
 
finally
 
{
 
disposed
 
=
 
true
 #
;
# $
}
 
}
 
}
 	
}
 
} พ
>C:\Playnite\_github\OstPlayer\source\Services\MetadataCache.cs
	namespacehh 	
	OstPlayerhh
 
.hh 
Serviceshh 
{ii 
publicnn 

classnn 
MetadataCacheConfignn $
{oo 
publicss 
TimeSpanss 
TrackMetadataTTLss (
{ss) *
getss+ .
;ss. /
setss0 3
;ss3 4
}ss5 6
=ss7 8
TimeSpanss9 A
.ssA B
	FromHoursssB K
(ssK L
$numssL M
)ssM N
;ssN O
publicxx 
TimeSpanxx 
AlbumMetadataTTLxx (
{xx) *
getxx+ .
;xx. /
setxx0 3
;xx3 4
}xx5 6
=xx7 8
TimeSpanxx9 A
.xxA B
	FromHoursxxB K
(xxK L
$numxxL M
)xxM N
;xxN O
public}} 
TimeSpan}} 
ArtistMetadataTTL}} )
{}}* +
get}}, /
;}}/ 0
set}}1 4
;}}4 5
}}}6 7
=}}8 9
TimeSpan}}: B
.}}B C
	FromHours}}C L
(}}L M
$num}}M O
)}}O P
;}}P Q
public
 
TimeSpan
 !
ExternalMetadataTTL
 +
{
, -
get
. 1
;
1 2
set
3 6
;
6 7
}
8 9
=
: ;
TimeSpan
< D
.
D E
	FromHours
E N
(
N O
$num
O Q
)
Q R
;
R S
public
 
int
 
MaxCacheSize
 
{
  !
get
" %
;
% &
set
' *
;
* +
}
, -
=
. /
$num
0 4
;
4 5
public
 
TimeSpan
 
CleanupInterval
 '
{
( )
get
* -
;
- .
set
/ 2
;
2 3
}
4 5
=
6 7
TimeSpan
8 @
.
@ A
FromMinutes
A L
(
L M
$num
M N
)
N O
;
O P
public
 
bool
 ,
EnableMemoryPressureAdjustment
 2
{
3 4
get
5 8
;
8 9
set
: =
;
= >
}
? @
=
A B
true
C G
;
G H
public
 
bool
  
EnableCacheWarming
 &
{
' (
get
) ,
;
, -
set
. 1
;
1 2
}
3 4
=
5 6
true
7 ;
;
; <
}
 
public
 

class
 "
MetadataCacheMetrics
 %
{
 
public
 
CacheStatistics
 

TrackCache
 )
{
* +
get
, /
;
/ 0
set
1 4
;
4 5
}
6 7
public
 
CacheStatistics
 

AlbumCache
 )
{
* +
get
, /
;
/ 0
set
1 4
;
4 5
}
6 7
public
 
CacheStatistics
 
ArtistCache
 *
{
+ ,
get
- 0
;
0 1
set
2 5
;
5 6
}
7 8
public
กก 
CacheStatistics
กก 
ExternalCache
กก ,
{
กก- .
get
กก/ 2
;
กก2 3
set
กก4 7
;
กก7 8
}
กก9 :
public
ฃฃ 
double
ฃฃ 
OverallHitRatio
ฃฃ %
{
คค 	
get
ฅฅ 
{
ฆฆ 
var
งง 
totalRequests
งง !
=
งง" #

TrackCache
จจ 
.
จจ 
TotalRequests
จจ ,
+
ฉฉ 

AlbumCache
ฉฉ  
.
ฉฉ  !
TotalRequests
ฉฉ! .
+
ชช 
ArtistCache
ชช !
.
ชช! "
TotalRequests
ชช" /
+
ซซ 
ExternalCache
ซซ #
.
ซซ# $
TotalRequests
ซซ$ 1
;
ซซ1 2
var
ฌฌ 
	totalHits
ฌฌ 
=
ฌฌ 

TrackCache
ญญ 
.
ญญ 
	CacheHits
ญญ (
+
ฎฎ 

AlbumCache
ฎฎ  
.
ฎฎ  !
	CacheHits
ฎฎ! *
+
ฏฏ 
ArtistCache
ฏฏ !
.
ฏฏ! "
	CacheHits
ฏฏ" +
+
ฐฐ 
ExternalCache
ฐฐ #
.
ฐฐ# $
	CacheHits
ฐฐ$ -
;
ฐฐ- .
return
ฑฑ 
totalRequests
ฑฑ $
>
ฑฑ% &
$num
ฑฑ' (
?
ฑฑ) *
(
ฑฑ+ ,
double
ฑฑ, 2
)
ฑฑ2 3
	totalHits
ฑฑ3 <
/
ฑฑ= >
totalRequests
ฑฑ? L
:
ฑฑM N
$num
ฑฑO R
;
ฑฑR S
}
ฒฒ 
}
ณณ 	
public
ตต 
int
ตต 
TotalCacheSize
ตต !
=>
ตต" $

TrackCache
ถถ 
.
ถถ 
CurrentSize
ถถ "
+
ทท 

AlbumCache
ทท 
.
ทท 
CurrentSize
ทท $
+
ธธ 
ArtistCache
ธธ 
.
ธธ 
CurrentSize
ธธ %
+
นน 
ExternalCache
นน 
.
นน 
CurrentSize
นน '
;
นน' (
}
บบ 
public
ยย 

class
ยย 
MetadataCache
ยย 
:
ยย  
IDisposable
ยย! ,
{
รร 
private
ลล 
readonly
ลล !
MetadataCacheConfig
ลล ,
_config
ลล- 4
;
ลล4 5
private
ฦฦ 
readonly
ฦฦ "
ErrorHandlingService
ฦฦ -
_errorHandler
ฦฦ. ;
;
ฦฦ; <
private
วว 
readonly
วว 
ILogger
วว  
_logger
วว! (
;
วว( )
private
สส 
readonly
สส 
TTLCache
สส !
<
สส! "
string
สส" (
,
สส( ) 
TrackMetadataModel
สส* <
>
สส< =
_trackCache
สส> I
;
สสI J
private
หห 
readonly
หห 
TTLCache
หห !
<
หห! "
string
หห" (
,
หห( ) 
AlbumMetadataModel
หห* <
>
หห< =
_albumCache
หห> I
;
หหI J
private
ฬฬ 
readonly
ฬฬ 
TTLCache
ฬฬ !
<
ฬฬ! "
string
ฬฬ" (
,
ฬฬ( )
object
ฬฬ* 0
>
ฬฬ0 1
_artistCache
ฬฬ2 >
;
ฬฬ> ?
private
ออ 
readonly
ออ 
TTLCache
ออ !
<
ออ! "
string
ออ" (
,
ออ( )
object
ออ* 0
>
ออ0 1
_externalCache
ออ2 @
;
ออ@ A
private
ะะ 
readonly
ะะ 

Dictionary
ะะ #
<
ะะ# $
string
ะะ$ *
,
ะะ* +
DateTime
ะะ, 4
>
ะะ4 5
_accessPatterns
ะะ6 E
;
ะะE F
private
ัั 
readonly
ัั 
object
ัั 
_patternsLock
ัั  -
=
ัั. /
new
ัั0 3
object
ัั4 :
(
ัั: ;
)
ัั; <
;
ัั< =
private
าา 
volatile
าา 
bool
าา 
	_disposed
าา '
=
าา( )
false
าา* /
;
าา/ 0
public
ูู 
MetadataCache
ูู 
(
ูู !
MetadataCacheConfig
ูู 0
config
ูู1 7
=
ูู8 9
null
ูู: >
)
ูู> ?
{
ฺฺ 	
_config
 
=
 
config
 
??
 
new
  #!
MetadataCacheConfig
$ 7
(
7 8
)
8 9
;
9 :
_errorHandler
 
=
 
new
 "
ErrorHandlingService
  4
(
4 5
)
5 6
;
6 7
_logger
 
=
 

LogManager
  
.
  !
	GetLogger
! *
(
* +
)
+ ,
;
, -
_logger
฿฿ 
.
฿฿ 
Info
฿฿ 
(
฿฿ 
$str
฿฿ I
)
฿฿I J
;
฿฿J K
try
แแ 
{
โโ 
_trackCache
ไไ 
=
ไไ 
new
ไไ !
TTLCache
ไไ" *
<
ไไ* +
string
ไไ+ 1
,
ไไ1 2 
TrackMetadataModel
ไไ3 E
>
ไไE F
(
ไไF G
_config
ๅๅ 
.
ๅๅ 
MaxCacheSize
ๅๅ (
,
ๅๅ( )
_config
ๆๆ 
.
ๆๆ 
TrackMetadataTTL
ๆๆ ,
,
ๆๆ, -
_config
็็ 
.
็็ 
CleanupInterval
็็ +
,
็็+ ,
_config
่่ 
.
่่ ,
EnableMemoryPressureAdjustment
่่ :
)
้้ 
;
้้ 
_albumCache
๋๋ 
=
๋๋ 
new
๋๋ !
TTLCache
๋๋" *
<
๋๋* +
string
๋๋+ 1
,
๋๋1 2 
AlbumMetadataModel
๋๋3 E
>
๋๋E F
(
๋๋F G
_config
์์ 
.
์์ 
MaxCacheSize
์์ (
,
์์( )
_config
ํํ 
.
ํํ 
AlbumMetadataTTL
ํํ ,
,
ํํ, -
_config
๎๎ 
.
๎๎ 
CleanupInterval
๎๎ +
,
๎๎+ ,
_config
๏๏ 
.
๏๏ ,
EnableMemoryPressureAdjustment
๏๏ :
)
๐๐ 
;
๐๐ 
_artistCache
๒๒ 
=
๒๒ 
new
๒๒ "
TTLCache
๒๒# +
<
๒๒+ ,
string
๒๒, 2
,
๒๒2 3
object
๒๒4 :
>
๒๒: ;
(
๒๒; <
_config
๓๓ 
.
๓๓ 
MaxCacheSize
๓๓ (
/
๓๓) *
$num
๓๓+ ,
,
๓๓, -
_config
๔๔ 
.
๔๔ 
ArtistMetadataTTL
๔๔ -
,
๔๔- .
_config
๕๕ 
.
๕๕ 
CleanupInterval
๕๕ +
,
๕๕+ ,
_config
๖๖ 
.
๖๖ ,
EnableMemoryPressureAdjustment
๖๖ :
)
๗๗ 
;
๗๗ 
_externalCache
๙๙ 
=
๙๙  
new
๙๙! $
TTLCache
๙๙% -
<
๙๙- .
string
๙๙. 4
,
๙๙4 5
object
๙๙6 <
>
๙๙< =
(
๙๙= >
_config
๚๚ 
.
๚๚ 
MaxCacheSize
๚๚ (
,
๚๚( )
_config
๛๛ 
.
๛๛ !
ExternalMetadataTTL
๛๛ /
,
๛๛/ 0
_config
 
.
 
CleanupInterval
 +
,
+ ,
_config
 
.
 ,
EnableMemoryPressureAdjustment
 :
)
 
;
 
_accessPatterns
 
=
  !
new
" %

Dictionary
& 0
<
0 1
string
1 7
,
7 8
DateTime
9 A
>
A B
(
B C
)
C D
;
D E
_logger
 
.
 
Info
 
(
 
$"
 
$str
 B
{
B C
_config
C J
.
J K
MaxCacheSize
K W
}
W X
$str
X l
"
l m
)
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
Error
 
(
 
ex
  
,
  !
$str
" F
)
F G
;
G H
_errorHandler
 
.
 !
HandlePlaybackError
 1
(
1 2
ex
2 4
,
4 5
$str
6 T
)
T U
;
U V
throw
 
;
 
}
 
}
 	
public
  
TrackMetadataModel
 !
GetTrackMetadata
" 2
(
2 3
string
3 9
filePath
: B
)
B C
{
 	
if
 
(
 
string
 
.
 
IsNullOrEmpty
 $
(
$ %
filePath
% -
)
- .
)
. /
return
 
null
 
;
 
try
 
{
  
TrackAccessPattern
 "
(
" #
filePath
# +
)
+ ,
;
, -
if
 
(
 
_trackCache
 
.
  
TryGet
  &
(
& '
filePath
' /
,
/ 0
out
1 4
var
5 8
metadata
9 A
)
A B
)
B C
{
 
_logger
 
.
 
Debug
 !
(
! "
$"
" $
$str
$ B
{
B C
filePath
C K
}
K L
"
L M
)
M N
;
N O
return
กก 
metadata
กก #
;
กก# $
}
ขข 
_logger
คค 
.
คค 
Debug
คค 
(
คค 
$"
คค  
$str
คค  ?
{
คค? @
filePath
คค@ H
}
คคH I
"
คคI J
)
คคJ K
;
คคK L
return
ฅฅ 
null
ฅฅ 
;
ฅฅ 
}
ฆฆ 
catch
งง 
(
งง 
	Exception
งง 
ex
งง 
)
งง  
{
จจ 
_logger
ฉฉ 
.
ฉฉ 
Error
ฉฉ 
(
ฉฉ 
ex
ฉฉ  
,
ฉฉ  !
$"
ฉฉ" $
$str
ฉฉ$ P
{
ฉฉP Q
filePath
ฉฉQ Y
}
ฉฉY Z
"
ฉฉZ [
)
ฉฉ[ \
;
ฉฉ\ ]
return
ชช 
null
ชช 
;
ชช 
}
ซซ 
}
ฌฌ 	
public
ถถ 
void
ถถ  
CacheTrackMetadata
ถถ &
(
ถถ& '
string
ทท 
filePath
ทท 
,
ทท  
TrackMetadataModel
ธธ 
metadata
ธธ '
,
ธธ' (
TimeSpan
นน 
?
นน 
	customTTL
นน 
=
นน  !
null
นน" &
)
บบ 	
{
ปป 	
if
ผผ 
(
ผผ 
string
ผผ 
.
ผผ 
IsNullOrEmpty
ผผ $
(
ผผ$ %
filePath
ผผ% -
)
ผผ- .
||
ผผ/ 1
metadata
ผผ2 :
==
ผผ; =
null
ผผ> B
)
ผผB C
return
ฝฝ 
;
ฝฝ 
try
ฟฟ 
{
ภภ 
_trackCache
มม 
.
มม 
Add
มม 
(
มม  
filePath
มม  (
,
มม( )
metadata
มม* 2
,
มม2 3
	customTTL
มม4 =
)
มม= >
;
มม> ?
_logger
ยย 
.
ยย 
Debug
ยย 
(
ยย 
$"
ยย  
$str
ยย  ;
{
ยย; <
filePath
ยย< D
}
ยยD E
"
ยยE F
)
ยยF G
;
ยยG H
}
รร 
catch
ฤฤ 
(
ฤฤ 
	Exception
ฤฤ 
ex
ฤฤ 
)
ฤฤ  
{
ลล 
_logger
ฦฦ 
.
ฦฦ 
Error
ฦฦ 
(
ฦฦ 
ex
ฦฦ  
,
ฦฦ  !
$"
ฦฦ" $
$str
ฦฦ$ B
{
ฦฦB C
filePath
ฦฦC K
}
ฦฦK L
"
ฦฦL M
)
ฦฦM N
;
ฦฦN O
_errorHandler
วว 
.
วว !
HandlePlaybackError
วว 1
(
วว1 2
ex
วว2 4
,
วว4 5
filePath
วว6 >
)
วว> ?
;
วว? @
}
ศศ 
}
ษษ 	
public
าา  
AlbumMetadataModel
าา !
GetAlbumMetadata
าา" 2
(
าา2 3
string
าา3 9
albumKey
าา: B
)
าาB C
{
ำำ 	
if
ิิ 
(
ิิ 
string
ิิ 
.
ิิ 
IsNullOrEmpty
ิิ $
(
ิิ$ %
albumKey
ิิ% -
)
ิิ- .
)
ิิ. /
return
ีี 
null
ีี 
;
ีี 
try
ืื 
{
ุุ 
if
ูู 
(
ูู 
_albumCache
ูู 
.
ูู  
TryGet
ูู  &
(
ูู& '
albumKey
ูู' /
,
ูู/ 0
out
ูู1 4
var
ูู5 8
metadata
ูู9 A
)
ููA B
)
ููB C
{
ฺฺ 
_logger
 
.
 
Debug
 !
(
! "
$"
" $
$str
$ B
{
B C
albumKey
C K
}
K L
"
L M
)
M N
;
N O
return
 
metadata
 #
;
# $
}
 
_logger
฿฿ 
.
฿฿ 
Debug
฿฿ 
(
฿฿ 
$"
฿฿  
$str
฿฿  ?
{
฿฿? @
albumKey
฿฿@ H
}
฿฿H I
"
฿฿I J
)
฿฿J K
;
฿฿K L
return
เเ 
null
เเ 
;
เเ 
}
แแ 
catch
โโ 
(
โโ 
	Exception
โโ 
ex
โโ 
)
โโ  
{
ใใ 
_logger
ไไ 
.
ไไ 
Error
ไไ 
(
ไไ 
ex
ไไ  
,
ไไ  !
$"
ไไ" $
$str
ไไ$ P
{
ไไP Q
albumKey
ไไQ Y
}
ไไY Z
"
ไไZ [
)
ไไ[ \
;
ไไ\ ]
return
ๅๅ 
null
ๅๅ 
;
ๅๅ 
}
ๆๆ 
}
็็ 	
public
๐๐ 
void
๐๐  
CacheAlbumMetadata
๐๐ &
(
๐๐& '
string
๑๑ 
albumKey
๑๑ 
,
๑๑  
AlbumMetadataModel
๒๒ 
metadata
๒๒ '
,
๒๒' (
TimeSpan
๓๓ 
?
๓๓ 
	customTTL
๓๓ 
=
๓๓  !
null
๓๓" &
)
๔๔ 	
{
๕๕ 	
if
๖๖ 
(
๖๖ 
string
๖๖ 
.
๖๖ 
IsNullOrEmpty
๖๖ $
(
๖๖$ %
albumKey
๖๖% -
)
๖๖- .
||
๖๖/ 1
metadata
๖๖2 :
==
๖๖; =
null
๖๖> B
)
๖๖B C
return
๗๗ 
;
๗๗ 
try
๙๙ 
{
๚๚ 
_albumCache
๛๛ 
.
๛๛ 
Add
๛๛ 
(
๛๛  
albumKey
๛๛  (
,
๛๛( )
metadata
๛๛* 2
,
๛๛2 3
	customTTL
๛๛4 =
)
๛๛= >
;
๛๛> ?
_logger
 
.
 
Debug
 
(
 
$"
  
$str
  ;
{
; <
albumKey
< D
}
D E
"
E F
)
F G
;
G H
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
Error
 
(
 
ex
  
,
  !
$"
" $
$str
$ B
{
B C
albumKey
C K
}
K L
"
L M
)
M N
;
N O
_errorHandler
 
.
 !
HandlePlaybackError
 1
(
1 2
ex
2 4
,
4 5
albumKey
6 >
)
> ?
;
? @
}
 
}
 	
public
 
static
 
string
 
GenerateAlbumKey
 -
(
- .
string
. 4
artist
5 ;
,
; <
string
= C
album
D I
)
I J
{
 	
var
 
normalizedArtist
  
=
! "
(
# $
artist
$ *
??
+ -
$str
. 7
)
7 8
.
8 9
Trim
9 =
(
= >
)
> ?
.
? @
ToLowerInvariant
@ P
(
P Q
)
Q R
;
R S
var
 
normalizedAlbum
 
=
  !
(
" #
album
# (
??
) +
$str
, 5
)
5 6
.
6 7
Trim
7 ;
(
; <
)
< =
.
= >
ToLowerInvariant
> N
(
N O
)
O P
;
P Q
return
 
$"
 
{
 
normalizedArtist
 &
}
& '
$str
' )
{
) *
normalizedAlbum
* 9
}
9 :
"
: ;
;
; <
}
 	
public
 
void
 #
CacheExternalMetadata
 )
<
) *
T
* +
>
+ ,
(
, -
string
 
cacheKey
 
,
 
T
 
metadata
 
,
 
TimeSpan
 
?
 
	customTTL
 
=
  !
null
" &
)
กก 	
{
ขข 	
if
ฃฃ 
(
ฃฃ 
string
ฃฃ 
.
ฃฃ 
IsNullOrEmpty
ฃฃ $
(
ฃฃ$ %
cacheKey
ฃฃ% -
)
ฃฃ- .
||
ฃฃ/ 1
metadata
ฃฃ2 :
==
ฃฃ; =
null
ฃฃ> B
)
ฃฃB C
return
คค 
;
คค 
try
ฆฆ 
{
งง 
_externalCache
จจ 
.
จจ 
Add
จจ "
(
จจ" #
cacheKey
จจ# +
,
จจ+ ,
metadata
จจ- 5
,
จจ5 6
	customTTL
จจ7 @
)
จจ@ A
;
จจA B
_logger
ฉฉ 
.
ฉฉ 
Debug
ฉฉ 
(
ฉฉ 
$"
ฉฉ  
$str
ฉฉ  >
{
ฉฉ> ?
cacheKey
ฉฉ? G
}
ฉฉG H
"
ฉฉH I
)
ฉฉI J
;
ฉฉJ K
}
ชช 
catch
ซซ 
(
ซซ 
	Exception
ซซ 
ex
ซซ 
)
ซซ  
{
ฌฌ 
_logger
ญญ 
.
ญญ 
Error
ญญ 
(
ญญ 
ex
ญญ  
,
ญญ  !
$"
ญญ" $
$str
ญญ$ E
{
ญญE F
cacheKey
ญญF N
}
ญญN O
"
ญญO P
)
ญญP Q
;
ญญQ R
_errorHandler
ฎฎ 
.
ฎฎ !
HandlePlaybackError
ฎฎ 1
(
ฎฎ1 2
ex
ฎฎ2 4
,
ฎฎ4 5
cacheKey
ฎฎ6 >
)
ฎฎ> ?
;
ฎฎ? @
}
ฏฏ 
}
ฐฐ 	
public
นน 
T
นน !
GetExternalMetadata
นน $
<
นน$ %
T
นน% &
>
นน& '
(
นน' (
string
นน( .
cacheKey
นน/ 7
)
นน7 8
{
บบ 	
if
ปป 
(
ปป 
string
ปป 
.
ปป 
IsNullOrEmpty
ปป $
(
ปป$ %
cacheKey
ปป% -
)
ปป- .
)
ปป. /
return
ผผ 
default
ผผ 
(
ผผ 
T
ผผ  
)
ผผ  !
;
ผผ! "
try
พพ 
{
ฟฟ 
if
ภภ 
(
ภภ 
_externalCache
ภภ "
.
ภภ" #
TryGet
ภภ# )
(
ภภ) *
cacheKey
ภภ* 2
,
ภภ2 3
out
ภภ4 7
var
ภภ8 ;
metadata
ภภ< D
)
ภภD E
&&
ภภF H
metadata
ภภI Q
is
ภภR T
T
ภภU V
)
ภภV W
{
มม 
_logger
ยย 
.
ยย 
Debug
ยย !
(
ยย! "
$"
ยย" $
$str
ยย$ E
{
ยยE F
cacheKey
ยยF N
}
ยยN O
"
ยยO P
)
ยยP Q
;
ยยQ R
return
รร 
(
รร 
T
รร 
)
รร 
metadata
รร &
;
รร& '
}
ฤฤ 
_logger
ฦฦ 
.
ฦฦ 
Debug
ฦฦ 
(
ฦฦ 
$"
ฦฦ  
$str
ฦฦ  B
{
ฦฦB C
cacheKey
ฦฦC K
}
ฦฦK L
"
ฦฦL M
)
ฦฦM N
;
ฦฦN O
return
วว 
default
วว 
(
วว 
T
วว  
)
วว  !
;
วว! "
}
ศศ 
catch
ษษ 
(
ษษ 
	Exception
ษษ 
ex
ษษ 
)
ษษ  
{
สส 
_logger
หห 
.
หห 
Error
หห 
(
หห 
ex
หห  
,
หห  !
$"
หห" $
$str
หห$ S
{
หหS T
cacheKey
หหT \
}
หห\ ]
"
หห] ^
)
หห^ _
;
หห_ `
return
ฬฬ 
default
ฬฬ 
(
ฬฬ 
T
ฬฬ  
)
ฬฬ  !
;
ฬฬ! "
}
ออ 
}
ฮฮ 	
public
ีี 
void
ีี 
ClearAllCaches
ีี "
(
ีี" #
)
ีี# $
{
ึึ 	
try
ืื 
{
ุุ 
_logger
ูู 
.
ูู 
Info
ูู 
(
ูู 
$str
ูู >
)
ูู> ?
;
ูู? @
_trackCache
 
.
 
Clear
 !
(
! "
)
" #
;
# $
_albumCache
 
.
 
Clear
 !
(
! "
)
" #
;
# $
_artistCache
 
.
 
Clear
 "
(
" #
)
# $
;
$ %
_externalCache
 
.
 
Clear
 $
(
$ %
)
% &
;
& '
lock
เเ 
(
เเ 
_patternsLock
เเ #
)
เเ# $
{
แแ 
_accessPatterns
โโ #
.
โโ# $
Clear
โโ$ )
(
โโ) *
)
โโ* +
;
โโ+ ,
}
ใใ 
_logger
ๅๅ 
.
ๅๅ 
Info
ๅๅ 
(
ๅๅ 
$str
ๅๅ G
)
ๅๅG H
;
ๅๅH I
}
ๆๆ 
catch
็็ 
(
็็ 
	Exception
็็ 
ex
็็ 
)
็็  
{
่่ 
_logger
้้ 
.
้้ 
Error
้้ 
(
้้ 
ex
้้  
,
้้  !
$str
้้" B
)
้้B C
;
้้C D
_errorHandler
๊๊ 
.
๊๊ !
HandlePlaybackError
๊๊ 1
(
๊๊1 2
ex
๊๊2 4
,
๊๊4 5
$str
๊๊6 M
)
๊๊M N
;
๊๊N O
}
๋๋ 
}
์์ 	
public
๔๔ 
bool
๔๔ !
RemoveTrackMetadata
๔๔ '
(
๔๔' (
string
๔๔( .
filePath
๔๔/ 7
)
๔๔7 8
{
๕๕ 	
if
๖๖ 
(
๖๖ 
string
๖๖ 
.
๖๖ 
IsNullOrEmpty
๖๖ $
(
๖๖$ %
filePath
๖๖% -
)
๖๖- .
)
๖๖. /
return
๗๗ 
false
๗๗ 
;
๗๗ 
try
๙๙ 
{
๚๚ 
var
๛๛ 
removed
๛๛ 
=
๛๛ 
_trackCache
๛๛ )
.
๛๛) *
Remove
๛๛* 0
(
๛๛0 1
filePath
๛๛1 9
)
๛๛9 :
;
๛๛: ;
if
 
(
 
removed
 
)
 
{
 
_logger
 
.
 
Debug
 !
(
! "
$"
" $
$str
$ G
{
G H
filePath
H P
}
P Q
"
Q R
)
R S
;
S T
}
 
return
 
removed
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
Error
 
(
 
ex
  
,
  !
$"
" $
$str
$ N
{
N O
filePath
O W
}
W X
"
X Y
)
Y Z
;
Z [
return
 
false
 
;
 
}
 
}
 	
public
 
void
 %
AdjustForMemoryPressure
 +
(
+ ,
)
, -
{
 	
try
 
{
 
_trackCache
 
.
 %
AdjustForMemoryPressure
 3
(
3 4
)
4 5
;
5 6
_albumCache
 
.
 %
AdjustForMemoryPressure
 3
(
3 4
)
4 5
;
5 6
_artistCache
 
.
 %
AdjustForMemoryPressure
 4
(
4 5
)
5 6
;
6 7
_externalCache
 
.
 %
AdjustForMemoryPressure
 6
(
6 7
)
7 8
;
8 9
_logger
 
.
 
Debug
 
(
 
$str
 H
)
H I
;
I J
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
Error
 
(
 
ex
  
,
  !
$str
" N
)
N O
;
O P
}
 
}
 	
public
ฅฅ "
MetadataCacheMetrics
ฅฅ #

GetMetrics
ฅฅ$ .
(
ฅฅ. /
)
ฅฅ/ 0
{
ฆฆ 	
try
งง 
{
จจ 
return
ฉฉ 
new
ฉฉ "
MetadataCacheMetrics
ฉฉ /
{
ชช 

TrackCache
ซซ 
=
ซซ  
_trackCache
ซซ! ,
.
ซซ, -
GetStatistics
ซซ- :
(
ซซ: ;
)
ซซ; <
,
ซซ< =

AlbumCache
ฌฌ 
=
ฌฌ  
_albumCache
ฌฌ! ,
.
ฌฌ, -
GetStatistics
ฌฌ- :
(
ฌฌ: ;
)
ฌฌ; <
,
ฌฌ< =
ArtistCache
ญญ 
=
ญญ  !
_artistCache
ญญ" .
.
ญญ. /
GetStatistics
ญญ/ <
(
ญญ< =
)
ญญ= >
,
ญญ> ?
ExternalCache
ฎฎ !
=
ฎฎ" #
_externalCache
ฎฎ$ 2
.
ฎฎ2 3
GetStatistics
ฎฎ3 @
(
ฎฎ@ A
)
ฎฎA B
,
ฎฎB C
}
ฏฏ 
;
ฏฏ 
}
ฐฐ 
catch
ฑฑ 
(
ฑฑ 
	Exception
ฑฑ 
ex
ฑฑ 
)
ฑฑ  
{
ฒฒ 
_logger
ณณ 
.
ณณ 
Error
ณณ 
(
ณณ 
ex
ณณ  
,
ณณ  !
$str
ณณ" B
)
ณณB C
;
ณณC D
return
ดด 
new
ดด "
MetadataCacheMetrics
ดด /
(
ดด/ 0
)
ดด0 1
;
ดด1 2
}
ตต 
}
ถถ 	
public
ฝฝ 
int
ฝฝ 
GetTotalCacheSize
ฝฝ $
(
ฝฝ$ %
)
ฝฝ% &
{
พพ 	
try
ฟฟ 
{
ภภ 
return
มม 
_trackCache
มม "
.
มม" #
Count
มม# (
+
ยย 
_albumCache
ยย !
.
ยย! "
Count
ยย" '
+
รร 
_artistCache
รร "
.
รร" #
Count
รร# (
+
ฤฤ 
_externalCache
ฤฤ $
.
ฤฤ$ %
Count
ฤฤ% *
;
ฤฤ* +
}
ลล 
catch
ฦฦ 
(
ฦฦ 
	Exception
ฦฦ 
ex
ฦฦ 
)
ฦฦ  
{
วว 
_logger
ศศ 
.
ศศ 
Error
ศศ 
(
ศศ 
ex
ศศ  
,
ศศ  !
$str
ศศ" B
)
ศศB C
;
ศศC D
return
ษษ 
$num
ษษ 
;
ษษ 
}
สส 
}
หห 	
private
ำำ 
void
ำำ  
TrackAccessPattern
ำำ '
(
ำำ' (
string
ำำ( .
filePath
ำำ/ 7
)
ำำ7 8
{
ิิ 	
if
ีี 
(
ีี 
!
ีี 
_config
ีี 
.
ีี  
EnableCacheWarming
ีี +
)
ีี+ ,
return
ึึ 
;
ึึ 
try
ุุ 
{
ูู 
lock
ฺฺ 
(
ฺฺ 
_patternsLock
ฺฺ #
)
ฺฺ# $
{
 
_accessPatterns
 #
[
# $
filePath
$ ,
]
, -
=
. /
DateTime
0 8
.
8 9
UtcNow
9 ?
;
? @
if
฿฿ 
(
฿฿ 
_accessPatterns
฿฿ '
.
฿฿' (
Count
฿฿( -
>
฿฿. /
$num
฿฿0 4
)
฿฿4 5
{
เเ 
var
แแ 
cutoff
แแ "
=
แแ# $
DateTime
แแ% -
.
แแ- .
UtcNow
แแ. 4
.
แแ4 5
AddHours
แแ5 =
(
แแ= >
-
แแ> ?
$num
แแ? A
)
แแA B
;
แแB C
var
โโ 
keysToRemove
โโ (
=
โโ) *
new
โโ+ .
List
โโ/ 3
<
โโ3 4
string
โโ4 :
>
โโ: ;
(
โโ; <
)
โโ< =
;
โโ= >
foreach
ไไ 
(
ไไ  !
var
ไไ! $
kvp
ไไ% (
in
ไไ) +
_accessPatterns
ไไ, ;
)
ไไ; <
{
ๅๅ 
if
ๆๆ 
(
ๆๆ  
kvp
ๆๆ  #
.
ๆๆ# $
Value
ๆๆ$ )
<
ๆๆ* +
cutoff
ๆๆ, 2
)
ๆๆ2 3
{
็็ 
keysToRemove
่่  ,
.
่่, -
Add
่่- 0
(
่่0 1
kvp
่่1 4
.
่่4 5
Key
่่5 8
)
่่8 9
;
่่9 :
}
้้ 
}
๊๊ 
foreach
์์ 
(
์์  !
var
์์! $
key
์์% (
in
์์) +
keysToRemove
์์, 8
)
์์8 9
{
ํํ 
_accessPatterns
๎๎ +
.
๎๎+ ,
Remove
๎๎, 2
(
๎๎2 3
key
๎๎3 6
)
๎๎6 7
;
๎๎7 8
}
๏๏ 
}
๐๐ 
}
๑๑ 
}
๒๒ 
catch
๓๓ 
(
๓๓ 
	Exception
๓๓ 
ex
๓๓ 
)
๓๓  
{
๔๔ 
_logger
๕๕ 
.
๕๕ 
Error
๕๕ 
(
๕๕ 
ex
๕๕  
,
๕๕  !
$str
๕๕" A
)
๕๕A B
;
๕๕B C
}
๖๖ 
}
๗๗ 	
public
 
List
 
<
 
string
 
>
 (
GetFrequentlyAccessedFiles
 6
(
6 7
TimeSpan
7 ?

timeWindow
@ J
)
J K
{
 	
var
 
result
 
=
 
new
 
List
 !
<
! "
string
" (
>
( )
(
) *
)
* +
;
+ ,
var
 
cutoff
 
=
 
DateTime
 !
.
! "
UtcNow
" (
.
( )
Subtract
) 1
(
1 2

timeWindow
2 <
)
< =
;
= >
try
 
{
 
lock
 
(
 
_patternsLock
 #
)
# $
{
 
foreach
 
(
 
var
  
kvp
! $
in
% '
_accessPatterns
( 7
)
7 8
{
 
if
 
(
 
kvp
 
.
  
Value
  %
>=
& (
cutoff
) /
)
/ 0
{
 
result
 "
.
" #
Add
# &
(
& '
kvp
' *
.
* +
Key
+ .
)
. /
;
/ 0
}
 
}
 
}
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
_logger
 
.
 
Error
 
(
 
ex
  
,
  !
$str
" K
)
K L
;
L M
}
 
return
 
result
 
;
 
}
 	
public
 
void
 
Dispose
 
(
 
)
 
{
 	
Dispose
 
(
 
true
 
)
 
;
 
GC
 
.
 
SuppressFinalize
 
(
  
this
  $
)
$ %
;
% &
}
กก 	
	protected
งง 
virtual
งง 
void
งง 
Dispose
งง &
(
งง& '
bool
งง' +
	disposing
งง, 5
)
งง5 6
{
จจ 	
if
ฉฉ 
(
ฉฉ 
!
ฉฉ 
	_disposed
ฉฉ 
&&
ฉฉ 
	disposing
ฉฉ '
)
ฉฉ' (
{
ชช 
try
ซซ 
{
ฌฌ 
_logger
ญญ 
.
ญญ 
Info
ญญ  
(
ญญ  !
$str
ญญ! =
)
ญญ= >
;
ญญ> ?
_trackCache
ฏฏ 
?
ฏฏ  
.
ฏฏ  !
Dispose
ฏฏ! (
(
ฏฏ( )
)
ฏฏ) *
;
ฏฏ* +
_albumCache
ฐฐ 
?
ฐฐ  
.
ฐฐ  !
Dispose
ฐฐ! (
(
ฐฐ( )
)
ฐฐ) *
;
ฐฐ* +
_artistCache
ฑฑ  
?
ฑฑ  !
.
ฑฑ! "
Dispose
ฑฑ" )
(
ฑฑ) *
)
ฑฑ* +
;
ฑฑ+ ,
_externalCache
ฒฒ "
?
ฒฒ" #
.
ฒฒ# $
Dispose
ฒฒ$ +
(
ฒฒ+ ,
)
ฒฒ, -
;
ฒฒ- .
_logger
ดด 
.
ดด 
Info
ดด  
(
ดด  !
$str
ดด! F
)
ดดF G
;
ดดG H
}
ตต 
catch
ถถ 
(
ถถ 
	Exception
ถถ  
ex
ถถ! #
)
ถถ# $
{
ทท 
_logger
ธธ 
.
ธธ 
Error
ธธ !
(
ธธ! "
ex
ธธ" $
,
ธธ$ %
$str
ธธ& E
)
ธธE F
;
ธธF G
}
นน 
finally
บบ 
{
ปป 
	_disposed
ผผ 
=
ผผ 
true
ผผ  $
;
ผผ$ %
}
ฝฝ 
}
พพ 
}
ฟฟ 	
}
ภภ 
}มม ณ
NC:\Playnite\_github\OstPlayer\source\Services\Interfaces\IMusicBrainzClient.cs
	namespaceGG 	
	OstPlayerGG
 
.GG 
ServicesGG 
.GG 

InterfacesGG '
{GG( )
publicKK 

	interfaceKK 
IMusicBrainzClientKK '
{KK( )
TaskOO 
<OO $
MusicBrainzMetadataModelOO %
>OO% &
SearchReleaseAsyncOO' 9
(OO9 :
stringOO: @
artistOOA G
,OOG H
stringOOI O
albumOOP U
,OOU V
CancellationTokenOOW h
cancellationTokenOOi z
=OO{ |
default	OO} 
)
OO 
;
OO 
TaskTT 
<TT 
boolTT 
>TT 
CheckHealthAsyncTT #
(TT# $
CancellationTokenTT$ 5
cancellationTokenTT6 G
=TTH I
defaultTTJ Q
)TTQ R
;TTR S
}UU 
}VV ฯ1
LC:\Playnite\_github\OstPlayer\source\Services\Interfaces\IMetadataService.cs
	namespaceMM 	
	OstPlayerMM
 
.MM 
ServicesMM 
.MM 

InterfacesMM '
{MM( )
publicQQ 

	interfaceQQ 
IMetadataServiceQQ %
{QQ& '
TaskWW 
<WW 
TrackMetadataModelWW 
>WW  "
LoadTrackMetadataAsyncWW! 7
(WW7 8
stringWW8 >
filePathWW? G
,WWG H
CancellationTokenWWI Z
cancellationTokenWW[ l
=WWm n
defaultWWo v
)WWv w
;WWw x
Task\\ 
<\\ 
List\\ 
<\\ 
TrackMetadataModel\\ $
>\\$ %
>\\% &+
LoadMultipleTracksMetadataAsync\\' F
(\\F G
IEnumerable\\G R
<\\R S
string\\S Y
>\\Y Z
	filePaths\\[ d
,\\d e
	IProgress]] 
<]] 
int]] 
>]] 
progress]] #
=]]$ %
null]]& *
,]]* +
CancellationToken]], =
cancellationToken]]> O
=]]P Q
default]]R Y
)]]Y Z
;]]Z [
Taskbb "
SaveTrackMetadataAsyncbb #
(bb# $
stringbb$ *
filePathbb+ 3
,bb3 4
TrackMetadataModelbb5 G
metadatabbH P
,bbP Q
CancellationTokenbbR c
cancellationTokenbbd u
=bbv w
defaultbbx 
)	bb 
;
bb 
Taskkk 
<kk 
AlbumMetadataModelkk 
>kk  "
LoadAlbumMetadataAsynckk! 7
(kk7 8
Gamekk8 <
gamekk= A
,kkA B
CancellationTokenkkC T
cancellationTokenkkU f
=kkg h
defaultkki p
)kkp q
;kkq r
Taskpp 
<pp  
DiscogsMetadataModelpp !
>pp! "$
LoadDiscogsMetadataAsyncpp# ;
(pp; <
Gamepp< @
gameppA E
,ppE F
stringppG M
discogsTokenppN Z
,ppZ [
CancellationTokenqq 
cancellationTokenqq /
=qq0 1
defaultqq2 9
)qq9 :
;qq: ;
Taskvv 
<vv $
MusicBrainzMetadataModelvv %
>vv% &(
LoadMusicBrainzMetadataAsyncvv' C
(vvC D
GamevvD H
gamevvI M
,vvM N
CancellationTokenvvO `
cancellationTokenvva r
=vvs t
defaultvvu |
)vv| }
;vv} ~
Task  
InvalidateCacheAsync !
(! "
string" (
key) ,
,, -
CancellationToken. ?
cancellationToken@ Q
=R S
defaultT [
)[ \
;\ ]
Task
  
ClearAllCacheAsync
 
(
  
CancellationToken
  1
cancellationToken
2 C
=
D E
default
F M
)
M N
;
N O
Task
 
<
 
CacheStatistics
 
>
 %
GetCacheStatisticsAsync
 5
(
5 6
CancellationToken
6 G
cancellationToken
H Y
=
Z [
default
\ c
)
c d
;
d e
void
 
	Configure
 
(
 
OstPlayerSettings
 (
settings
) 1
)
1 2
;
2 3
Task
 
<
 !
ServiceHealthStatus
  
>
  !
CheckHealthAsync
" 2
(
2 3
CancellationToken
3 D
cancellationToken
E V
=
W X
default
Y `
)
` a
;
a b
}
 
public
 

class
 
CacheStatistics
  
{
! "
public
 
int
 
TotalEntries
 
{
  !
get
" %
;
% &
set
' *
;
* +
}
, -
public
กก 
int
กก 
HitCount
กก 
{
กก 
get
กก !
;
กก! "
set
กก# &
;
กก& '
}
กก( )
public
ขข 
int
ขข 
	MissCount
ขข 
{
ขข 
get
ขข "
;
ขข" #
set
ขข$ '
;
ขข' (
}
ขข) *
public
ฃฃ 
double
ฃฃ 
HitRatio
ฃฃ 
=>
ฃฃ !
TotalRequests
ฃฃ" /
>
ฃฃ0 1
$num
ฃฃ2 3
?
ฃฃ4 5
(
ฃฃ6 7
double
ฃฃ7 =
)
ฃฃ= >
HitCount
ฃฃ> F
/
ฃฃG H
TotalRequests
ฃฃI V
:
ฃฃW X
$num
ฃฃY Z
;
ฃฃZ [
public
คค 
int
คค 
TotalRequests
คค  
=>
คค! #
HitCount
คค$ ,
+
คค- .
	MissCount
คค/ 8
;
คค8 9
public
ฅฅ 
long
ฅฅ 
MemoryUsageBytes
ฅฅ $
{
ฅฅ% &
get
ฅฅ' *
;
ฅฅ* +
set
ฅฅ, /
;
ฅฅ/ 0
}
ฅฅ1 2
public
ฆฆ 
TimeSpan
ฆฆ !
AverageResponseTime
ฆฆ +
{
ฆฆ, -
get
ฆฆ. 1
;
ฆฆ1 2
set
ฆฆ3 6
;
ฆฆ6 7
}
ฆฆ8 9
}
งง 
public
ฌฌ 

class
ฌฌ !
ServiceHealthStatus
ฌฌ $
{
ฌฌ% &
public
ญญ 
bool
ญญ 
	IsHealthy
ญญ 
{
ญญ 
get
ญญ  #
;
ญญ# $
set
ญญ% (
;
ญญ( )
}
ญญ* +
public
ฎฎ 
string
ฎฎ 
Status
ฎฎ 
{
ฎฎ 
get
ฎฎ "
;
ฎฎ" #
set
ฎฎ$ '
;
ฎฎ' (
}
ฎฎ) *
public
ฏฏ 

Dictionary
ฏฏ 
<
ฏฏ 
string
ฏฏ  
,
ฏฏ  !
string
ฏฏ" (
>
ฏฏ( )
Details
ฏฏ* 1
{
ฏฏ2 3
get
ฏฏ4 7
;
ฏฏ7 8
set
ฏฏ9 <
;
ฏฏ< =
}
ฏฏ> ?
=
ฏฏ@ A
new
ฏฏB E

Dictionary
ฏฏF P
<
ฏฏP Q
string
ฏฏQ W
,
ฏฏW X
string
ฏฏY _
>
ฏฏ_ `
(
ฏฏ` a
)
ฏฏa b
;
ฏฏb c
public
ฐฐ 
TimeSpan
ฐฐ 
ResponseTime
ฐฐ $
{
ฐฐ% &
get
ฐฐ' *
;
ฐฐ* +
set
ฐฐ, /
;
ฐฐ/ 0
}
ฐฐ1 2
}
ฑฑ 
}ฒฒ ๒V
HC:\Playnite\_github\OstPlayer\source\Services\Interfaces\IGameService.cs
	namespaceMM 	
	OstPlayerMM
 
.MM 
ServicesMM 
.MM 

InterfacesMM '
{MM( )
publicQQ 

classQQ 
GameMusicInfoQQ 
{QQ  
publicRR 
GameRR 
GameRR 
{RR 
getRR 
;RR 
setRR  #
;RR# $
}RR% &
publicSS 
stringSS 
MusicDirectorySS $
{SS% &
getSS' *
;SS* +
setSS, /
;SS/ 0
}SS1 2
publicTT 
ListTT 
<TT 
stringTT 
>TT 

MusicFilesTT &
{TT' (
getTT) ,
;TT, -
setTT. 1
;TT1 2
}TT3 4
=TT5 6
newTT7 :
ListTT; ?
<TT? @
stringTT@ F
>TTF G
(TTG H
)TTH I
;TTI J
publicUU 
intUU 
TotalTracksUU 
{UU  
getUU! $
;UU$ %
setUU& )
;UU) *
}UU+ ,
publicVV 
longVV 
TotalSizeBytesVV "
{VV# $
getVV% (
;VV( )
setVV* -
;VV- .
}VV/ 0
publicWW 
DateTimeWW 
LastScannedWW #
{WW$ %
getWW& )
;WW) *
setWW+ .
;WW. /
}WW0 1
}XX 
public]] 

	interface]] 
IGameService]] !
{]]" #
Taskcc 
<cc 
Listcc 
<cc 
Gamecc 
>cc 
>cc "
GetGamesWithMusicAsynccc /
(cc/ 0
CancellationTokencc0 A
cancellationTokenccB S
=ccT U
defaultccV ]
)cc] ^
;cc^ _
Taskhh 
<hh 
GameMusicInfohh 
>hh !
GetGameMusicInfoAsynchh 1
(hh1 2
Gamehh2 6
gamehh7 ;
,hh; <
CancellationTokenhh= N
cancellationTokenhhO `
=hha b
defaulthhc j
)hhj k
;hhk l
Taskmm 
<mm 
Listmm 
<mm 
Gamemm 
>mm 
>mm 
FilterGamesAsyncmm )
(mm) *
stringmm* 0

searchTextmm1 ;
,mm; <
CancellationTokenmm= N
cancellationTokenmmO `
=mma b
defaultmmc j
)mmj k
;mmk l
Taskrr 
<rr 
Gamerr 
>rr 
FindGameByNameAsyncrr &
(rr& '
stringrr' -
gameNamerr. 6
,rr6 7
CancellationTokenrr8 I
cancellationTokenrrJ [
=rr\ ]
defaultrr^ e
)rre f
;rrf g
Task{{ 
<{{ 
List{{ 
<{{ 
string{{ 
>{{ 
>{{ 
GetMusicFilesAsync{{ -
({{- .
Game{{. 2
game{{3 7
,{{7 8
CancellationToken{{9 J
cancellationToken{{K \
={{] ^
default{{_ f
){{f g
;{{g h
Task
 
<
 
string
 
>
 $
GetMusicDirectoryAsync
 +
(
+ ,
Game
, 0
game
1 5
,
5 6
CancellationToken
7 H
cancellationToken
I Z
=
[ \
default
] d
)
d e
;
e f
Task
 
<
 
bool
 
>
 $
ValidateMusicFileAsync
 )
(
) *
string
* 0
filePath
1 9
,
9 :
CancellationToken
; L
cancellationToken
M ^
=
_ `
default
a h
)
h i
;
i j
Task
 
<
 
List
 
<
 
string
 
>
 
>
 $
ScanForMusicFilesAsync
 1
(
1 2
Game
2 6
game
7 ;
,
; <
	IProgress
= F
<
F G
int
G J
>
J K
progress
L T
=
U V
null
W [
,
[ \
CancellationToken
 
cancellationToken
 /
=
0 1
default
2 9
)
9 :
;
: ;
Task
 
<
 

Dictionary
 
<
 
Game
 
,
 
List
 "
<
" #
string
# )
>
) *
>
* +
>
+ ,'
ScanAllGamesForMusicAsync
- F
(
F G
	IProgress
G P
<
P Q
ScanProgress
Q ]
>
] ^
progress
_ g
=
h i
null
j n
,
n o
CancellationToken
 
cancellationToken
 /
=
0 1
default
2 9
)
9 :
;
: ;
Task
 
<
 

Dictionary
 
<
 
Game
 
,
 
List
 "
<
" #
string
# )
>
) *
>
* +
>
+ ,(
ValidateAllMusicFilesAsync
- G
(
G H
	IProgress
H Q
<
Q R 
ValidationProgress
R d
>
d e
progress
f n
=
o p
null
q u
,
u v
CancellationToken
 
cancellationToken
 /
=
0 1
default
2 9
)
9 :
;
: ;
Task
 
<
 $
MusicLibraryStatistics
 #
>
# $'
GetLibraryStatisticsAsync
% >
(
> ?
CancellationToken
? P
cancellationToken
Q b
=
c d
default
e l
)
l m
;
m n
Task
ฉฉ 
<
ฉฉ 
string
ฉฉ 
>
ฉฉ /
!EnsureMusicMetadataDirectoryAsync
ฉฉ 6
(
ฉฉ6 7
Game
ฉฉ7 ;
game
ฉฉ< @
,
ฉฉ@ A
CancellationToken
ฉฉB S
cancellationToken
ฉฉT e
=
ฉฉf g
default
ฉฉh o
)
ฉฉo p
;
ฉฉp q
Task
ฎฎ 
<
ฎฎ 
bool
ฎฎ 
>
ฎฎ $
HasCachedMetadataAsync
ฎฎ )
(
ฎฎ) *
Game
ฎฎ* .
game
ฎฎ/ 3
,
ฎฎ3 4
CancellationToken
ฎฎ5 F
cancellationToken
ฎฎG X
=
ฎฎY Z
default
ฎฎ[ b
)
ฎฎb c
;
ฎฎc d
Task
ณณ *
CleanupOrphanedMetadataAsync
ณณ )
(
ณณ) *
CancellationToken
ณณ* ;
cancellationToken
ณณ< M
=
ณณN O
default
ณณP W
)
ณณW X
;
ณณX Y
void
ผผ 
	Configure
ผผ 
(
ผผ 
OstPlayerSettings
ผผ (
settings
ผผ) 1
)
ผผ1 2
;
ผผ2 3
Task
มม 
<
มม !
ServiceHealthStatus
มม  
>
มม  !
CheckHealthAsync
มม" 2
(
มม2 3
CancellationToken
มม3 D
cancellationToken
มมE V
=
มมW X
default
มมY `
)
มม` a
;
มมa b
}
ฤฤ 
public
ษษ 

class
ษษ 
ScanProgress
ษษ 
{
ษษ 
public
สส 
int
สส 

TotalGames
สส 
{
สส 
get
สส  #
;
สส# $
set
สส% (
;
สส( )
}
สส* +
public
หห 
int
หห 
ProcessedGames
หห !
{
หห" #
get
หห$ '
;
หห' (
set
หห) ,
;
หห, -
}
หห. /
public
ฬฬ 
Game
ฬฬ 
CurrentGame
ฬฬ 
{
ฬฬ  !
get
ฬฬ" %
;
ฬฬ% &
set
ฬฬ' *
;
ฬฬ* +
}
ฬฬ, -
public
ออ 
string
ออ 
Status
ออ 
{
ออ 
get
ออ "
;
ออ" #
set
ออ$ '
;
ออ' (
}
ออ) *
public
ฮฮ 
int
ฮฮ 
FoundMusicFiles
ฮฮ "
{
ฮฮ# $
get
ฮฮ% (
;
ฮฮ( )
set
ฮฮ* -
;
ฮฮ- .
}
ฮฮ/ 0
}
ฯฯ 
public
ิิ 

class
ิิ  
ValidationProgress
ิิ #
{
ิิ$ %
public
ีี 
int
ีี 

TotalFiles
ีี 
{
ีี 
get
ีี  #
;
ีี# $
set
ีี% (
;
ีี( )
}
ีี* +
public
ึึ 
int
ึึ 
ProcessedFiles
ึึ !
{
ึึ" #
get
ึึ$ '
;
ึึ' (
set
ึึ) ,
;
ึึ, -
}
ึึ. /
public
ืื 
string
ืื 
CurrentFile
ืื !
{
ืื" #
get
ืื$ '
;
ืื' (
set
ืื) ,
;
ืื, -
}
ืื. /
public
ุุ 
string
ุุ 
Status
ุุ 
{
ุุ 
get
ุุ "
;
ุุ" #
set
ุุ$ '
;
ุุ' (
}
ุุ) *
public
ูู 
int
ูู 

ValidFiles
ูู 
{
ูู 
get
ูู  #
;
ูู# $
set
ูู% (
;
ูู( )
}
ูู* +
public
ฺฺ 
int
ฺฺ 
InvalidFiles
ฺฺ 
{
ฺฺ  !
get
ฺฺ" %
;
ฺฺ% &
set
ฺฺ' *
;
ฺฺ* +
}
ฺฺ, -
}
 
public
เเ 

class
เเ $
MusicLibraryStatistics
เเ '
{
เเ( )
public
แแ 
int
แแ 

TotalGames
แแ 
{
แแ 
get
แแ  #
;
แแ# $
set
แแ% (
;
แแ( )
}
แแ* +
public
โโ 
int
โโ 
GamesWithMusic
โโ !
{
โโ" #
get
โโ$ '
;
โโ' (
set
โโ) ,
;
โโ, -
}
โโ. /
public
ใใ 
int
ใใ 
TotalMusicFiles
ใใ "
{
ใใ# $
get
ใใ% (
;
ใใ( )
set
ใใ* -
;
ใใ- .
}
ใใ/ 0
public
ไไ 
long
ไไ 
TotalSizeBytes
ไไ "
{
ไไ# $
get
ไไ% (
;
ไไ( )
set
ไไ* -
;
ไไ- .
}
ไไ/ 0
public
ๅๅ 
string
ๅๅ 
LargestGame
ๅๅ !
{
ๅๅ" #
get
ๅๅ$ '
;
ๅๅ' (
set
ๅๅ) ,
;
ๅๅ, -
}
ๅๅ. /
public
ๆๆ 
int
ๆๆ "
LargestGameFileCount
ๆๆ '
{
ๆๆ( )
get
ๆๆ* -
;
ๆๆ- .
set
ๆๆ/ 2
;
ๆๆ2 3
}
ๆๆ4 5
public
็็ 
DateTime
็็ 
LastScanned
็็ #
{
็็$ %
get
็็& )
;
็็) *
set
็็+ .
;
็็. /
}
็็0 1
public
่่ 

Dictionary
่่ 
<
่่ 
string
่่  
,
่่  !
int
่่" %
>
่่% &"
FileTypeDistribution
่่' ;
{
่่< =
get
่่> A
;
่่A B
set
่่C F
;
่่F G
}
่่H I
=
่่J K
new
่่L O

Dictionary
่่P Z
<
่่Z [
string
่่[ a
,
่่a b
int
่่c f
>
่่f g
(
่่g h
)
่่h i
;
่่i j
}
้้ 
}๊๊ ั

JC:\Playnite\_github\OstPlayer\source\Services\Interfaces\IDiscogsClient.cs
	namespaceHH 	
	OstPlayerHH
 
.HH 
ServicesHH 
.HH 

InterfacesHH '
{HH( )
publicLL 

	interfaceLL 
IDiscogsClientLL #
{LL$ %
TaskPP 
<PP 
ListPP 
<PP  
DiscogsMetadataModelPP &
>PP& '
>PP' (
SearchReleaseAsyncPP) ;
(PP; <
stringPP< B
queryPPC H
,PPH I
stringPPJ P
tokenPPQ V
,PPV W
CancellationTokenPPX i
cancellationTokenPPj {
=PP| }
default	PP~ 
)
PP 
;
PP 
TaskUU 
<UU  
DiscogsMetadataModelUU !
>UU! ""
GetReleaseDetailsAsyncUU# 9
(UU9 :
stringUU: @
	releaseIdUUA J
,UUJ K
stringUUL R
tokenUUS X
,UUX Y
CancellationTokenUUZ k
cancellationTokenUUl }
=UU~ 
default
UU 
)
UU 
;
UU 
TaskZZ 
<ZZ 
boolZZ 
>ZZ 
CheckHealthAsyncZZ #
(ZZ# $
CancellationTokenZZ$ 5
cancellationTokenZZ6 G
=ZZH I
defaultZZJ Q
)ZZQ R
;ZZR S
}[[ 
}\\ ฺ-
IC:\Playnite\_github\OstPlayer\source\Services\Interfaces\IAudioService.cs
	namespaceJJ 	
	OstPlayerJJ
 
.JJ 
ServicesJJ 
.JJ 

InterfacesJJ '
{JJ( )
publicNN 

enumNN 

AudioStateNN 
{NN 
StoppedOO 
,OO 
PlayingPP 
,PP 
PausedQQ 
,QQ 
LoadingRR 
,RR 
ErrorSS 
}TT 
publicYY 

	interfaceYY 
IAudioServiceYY "
{YY# $

AudioState]] 
State]] 
{]] 
get]] 
;]] 
}]]  !
double`` 
Volume`` 
{`` 
get`` 
;`` 
set``  
;``  !
}``" #
doublecc 
Positioncc 
{cc 
getcc 
;cc 
setcc "
;cc" #
}cc$ %
doubleff 
Durationff 
{ff 
getff 
;ff 
}ff  
stringii 
CurrentFileii 
{ii 
getii  
;ii  !
}ii" #
boolll 
IsUserDraggingll 
{ll 
getll !
;ll! "
setll# &
;ll& '
}ll( )
Taskuu 
	PlayAsyncuu 
(uu 
stringuu 
filePathuu &
,uu& '
doubleuu( .
?uu. /
startPositionuu0 =
=uu> ?
nulluu@ D
,uuD E
CancellationTokenuuF W
cancellationTokenuuX i
=uuj k
defaultuul s
)uus t
;uut u
Taskzz 

PauseAsynczz 
(zz 
CancellationTokenzz )
cancellationTokenzz* ;
=zz< =
defaultzz> E
)zzE F
;zzF G
Task 
ResumeAsync 
( 
CancellationToken *
cancellationToken+ <
== >
default? F
)F G
;G H
Task
 
	StopAsync
 
(
 
CancellationToken
 (
cancellationToken
) :
=
; <
default
= D
)
D E
;
E F
Task
 
	SeekAsync
 
(
 
double
 
position
 &
,
& '
CancellationToken
( 9
cancellationToken
: K
=
L M
default
N U
)
U V
;
V W
Task
 
SetVolumeAsync
 
(
 
double
 "
volume
# )
,
) *
CancellationToken
+ <
cancellationToken
= N
=
O P
default
Q X
)
X Y
;
Y Z
Task
  
ApplySettingsAsync
 
(
  
OstPlayerSettings
  1
settings
2 :
,
: ;
CancellationToken
< M
cancellationToken
N _
=
` a
default
b i
)
i j
;
j k
event
 
EventHandler
 
<
 

AudioState
 %
>
% &
StateChanged
' 3
;
3 4
event
กก 
EventHandler
กก 
<
กก 
double
กก !
>
กก! "
PositionChanged
กก# 2
;
กก2 3
event
คค 
EventHandler
คค 
<
คค 
double
คค !
>
คค! "
DurationChanged
คค# 2
;
คค2 3
event
งง 
EventHandler
งง 
<
งง 
double
งง !
>
งง! "
VolumeChanged
งง# 0
;
งง0 1
event
ชช 
EventHandler
ชช 

TrackEnded
ชช %
;
ชช% &
event
ญญ 
EventHandler
ญญ 
<
ญญ 
string
ญญ !
>
ญญ! "
ErrorOccurred
ญญ# 0
;
ญญ0 1
string
ถถ 
[
ถถ 
]
ถถ !
GetSupportedFormats
ถถ $
(
ถถ$ %
)
ถถ% &
;
ถถ& '
bool
ปป 
IsFormatSupported
ปป 
(
ปป 
string
ปป %
filePath
ปป& .
)
ปป. /
;
ปป/ 0
Task
ภภ 
<
ภภ 
AudioEngineInfo
ภภ 
>
ภภ  
GetEngineInfoAsync
ภภ 0
(
ภภ0 1
CancellationToken
ภภ1 B
cancellationToken
ภภC T
=
ภภU V
default
ภภW ^
)
ภภ^ _
;
ภภ_ `
Task
ลล 
<
ลล 
bool
ลล 
>
ลล 
CheckHealthAsync
ลล #
(
ลล# $
CancellationToken
ลล$ 5
cancellationToken
ลล6 G
=
ลลH I
default
ลลJ Q
)
ลลQ R
;
ลลR S
void
ฮฮ 
Dispose
ฮฮ 
(
ฮฮ 
)
ฮฮ 
;
ฮฮ 
}
ัั 
public
ึึ 

class
ึึ 
AudioEngineInfo
ึึ  
{
ึึ! "
public
ืื 
string
ืื 

EngineName
ืื  
{
ืื! "
get
ืื# &
;
ืื& '
set
ืื( +
;
ืื+ ,
}
ืื- .
public
ุุ 
string
ุุ 
Version
ุุ 
{
ุุ 
get
ุุ  #
;
ุุ# $
set
ุุ% (
;
ุุ( )
}
ุุ* +
public
ูู 
string
ูู 
[
ูู 
]
ูู 
SupportedFormats
ูู (
{
ูู) *
get
ูู+ .
;
ูู. /
set
ูู0 3
;
ูู3 4
}
ูู5 6
public
ฺฺ 
bool
ฺฺ 
IsInitialized
ฺฺ !
{
ฺฺ" #
get
ฺฺ$ '
;
ฺฺ' (
set
ฺฺ) ,
;
ฺฺ, -
}
ฺฺ. /
public
 
string
 
Status
 
{
 
get
 "
;
" #
set
$ '
;
' (
}
) *
}
 
} ด
<C:\Playnite\_github\OstPlayer\source\Services\GameService.cs
	namespace[[ 	
	OstPlayer[[
 
.[[ 
Services[[ 
{[[ 
public`` 

class`` 
GameService`` 
:`` 
IGameService`` +
,``+ ,
IDisposable``- 8
{``9 :
privateaa 
readonlyaa 
IPlayniteAPIaa %
playniteApiaa& 1
;aa1 2
privatebb 
readonlybb 
ILoggerbb  
loggerbb! '
;bb' (
privatecc 
readonlycc  
ErrorHandlingServicecc -
errorHandlercc. :
;cc: ;
privatedd 
volatiledd 
booldd 
disposeddd &
=dd' (
falsedd) .
;dd. /
privategg 
Listgg 
<gg 
Gamegg 
>gg  
cachedGamesWithMusicgg /
;gg/ 0
privatehh 
DateTimehh 
lastGameScanTimehh )
=hh* +
DateTimehh, 4
.hh4 5
MinValuehh5 =
;hh= >
privateii 
readonlyii 
TimeSpanii !
cacheValidityPeriodii" 5
=ii6 7
TimeSpanii8 @
.ii@ A
FromMinutesiiA L
(iiL M
$numiiM N
)iiN O
;iiO P
publicrr 
GameServicerr 
(rr 
IPlayniteAPIss 
playniteApiss $
=ss% &
nullss' +
,ss+ ,
ILoggertt 
loggertt 
=tt 
nulltt !
,tt! " 
ErrorHandlingServiceuu  
errorHandleruu! -
=uu. /
nulluu0 4
)uu4 5
{uu6 7
thisww 
.ww 
playniteApiww 
=ww 
playniteApiww *
??ww+ -
throwww. 3
newww4 7!
ArgumentNullExceptionww8 M
(wwM N
nameofwwN T
(wwT U
playniteApiwwU `
)ww` a
,wwa b
$strwwc }
)ww} ~
;ww~ 
thisxx 
.xx 
loggerxx 
=xx 
loggerxx  
??xx! #

LogManagerxx$ .
.xx. /
	GetLoggerxx/ 8
(xx8 9
)xx9 :
;xx: ;
thisyy 
.yy 
errorHandleryy 
=yy 
errorHandleryy  ,
??yy- /
newyy0 3 
ErrorHandlingServiceyy4 H
(yyH I
)yyI J
;yyJ K
try{{ 
{{{ 
this|| 
.|| 
logger|| 
.|| 
Info||  
(||  !
$str||! X
)||X Y
;||Y Z
this}} 
.}} 
logger}} 
.}} 
Info}}  
(}}  !
$str}}! O
)}}O P
;}}P Q
}~~ 
catch 
( 
	Exception 
ex 
)  
{! "
this
 
.
 
logger
 
.
 
Error
 !
(
! "
ex
" $
,
$ %
$str
& b
)
b c
;
c d
this
 
.
 
errorHandler
 !
.
! "!
HandlePlaybackError
" 5
(
5 6
ex
6 8
,
8 9
$str
: V
)
V W
;
W X
throw
 
;
 
}
 
}
 	
public
 
async
 
Task
 
<
 
List
 
<
 
Game
 #
>
# $
>
$ %$
GetGamesWithMusicAsync
& <
(
< =
CancellationToken
= N
cancellationToken
O `
=
a b
default
c j
)
j k
{
l m
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
GameService
9 D
)
D E
)
E F
;
F G
try
 
{
 
cancellationToken
 !
.
! "*
ThrowIfCancellationRequested
" >
(
> ?
)
? @
;
@ A
if
 
(
 "
cachedGamesWithMusic
 (
!=
) +
null
, 0
&&
1 3
DateTime
 
.
 
Now
  
-
! "
lastGameScanTime
# 3
<
4 5!
cacheValidityPeriod
6 I
)
I J
{
K L
logger
 
.
 
Debug
  
(
  !
$"
! #
$str
# F
{
F G"
cachedGamesWithMusic
G [
.
[ \
Count
\ a
}
a b
$str
b i
"
i j
)
j k
;
k l
return
 
new
 
List
 #
<
# $
Game
$ (
>
( )
(
) *"
cachedGamesWithMusic
* >
)
> ?
;
? @
}
 
logger
 
.
 
Info
 
(
 
$str
 D
)
D E
;
E F
return
 
await
 
Task
 !
.
! "
Run
" %
(
% &
(
& '
)
' (
=>
) +
{
, -
cancellationToken
 %
.
% &*
ThrowIfCancellationRequested
& B
(
B C
)
C D
;
D E
var
 
gamesWithMusic
 &
=
' (
playniteApi
) 4
.
4 5
Database
5 =
.
= >
Games
> C
.
C D
Where
D I
(
I J
game
J N
=>
O Q
{
R S
cancellationToken
 )
.
) **
ThrowIfCancellationRequested
* F
(
F G
)
G H
;
H I
try
 
{
 
var
 

musicFiles
  *
=
+ ,
MusicFileHelper
- <
.
< =
GetGameMusicFiles
= N
(
N O
playniteApi
O Z
,
Z [
game
\ `
)
` a
;
a b
return
กก "

musicFiles
กก# -
!=
กก. 0
null
กก1 5
&&
กก6 8

musicFiles
กก9 C
.
กกC D
Count
กกD I
>
กกJ K
$num
กกL M
;
กกM N
}
ขข 
catch
ฃฃ 
(
ฃฃ 
	Exception
ฃฃ (
ex
ฃฃ) +
)
ฃฃ+ ,
{
ฃฃ- .
logger
คค "
.
คค" #
Warn
คค# '
(
คค' (
ex
คค( *
,
คค* +
$"
คค, .
$str
คค. S
{
คคS T
game
คคT X
.
คคX Y
Name
คคY ]
}
คค] ^
"
คค^ _
)
คค_ `
;
คค` a
return
ฅฅ "
false
ฅฅ# (
;
ฅฅ( )
}
ฆฆ 
}
งง 
)
งง 
.
จจ 
OrderBy
จจ 
(
จจ 
g
จจ 
=>
จจ !
g
จจ" #
.
จจ# $
Name
จจ$ (
)
จจ( )
.
ฉฉ 
ToList
ฉฉ 
(
ฉฉ 
)
ฉฉ 
;
ฉฉ "
cachedGamesWithMusic
ฌฌ (
=
ฌฌ) *
gamesWithMusic
ฌฌ+ 9
;
ฌฌ9 :
lastGameScanTime
ญญ $
=
ญญ% &
DateTime
ญญ' /
.
ญญ/ 0
Now
ญญ0 3
;
ญญ3 4
logger
ฏฏ 
.
ฏฏ 
Info
ฏฏ 
(
ฏฏ  
$"
ฏฏ  "
$str
ฏฏ" (
{
ฏฏ( )
gamesWithMusic
ฏฏ) 7
.
ฏฏ7 8
Count
ฏฏ8 =
}
ฏฏ= >
$str
ฏฏ> U
"
ฏฏU V
)
ฏฏV W
;
ฏฏW X
return
ฐฐ 
gamesWithMusic
ฐฐ )
;
ฐฐ) *
}
ฑฑ 
,
ฑฑ 
cancellationToken
ฑฑ $
)
ฑฑ$ %
;
ฑฑ% &
}
ฒฒ 
catch
ณณ 
(
ณณ (
OperationCanceledException
ณณ -
)
ณณ- .
{
ณณ/ 0
logger
ดด 
.
ดด 
Info
ดด 
(
ดด 
$str
ดด F
)
ดดF G
;
ดดG H
throw
ตต 
;
ตต 
}
ถถ 
catch
ทท 
(
ทท 
	Exception
ทท 
ex
ทท 
)
ทท  
{
ทท! "
logger
ธธ 
.
ธธ 
Error
ธธ 
(
ธธ 
ex
ธธ 
,
ธธ  
$str
ธธ! A
)
ธธA B
;
ธธB C
errorHandler
นน 
.
นน !
HandlePlaybackError
นน 0
(
นน0 1
ex
นน1 3
,
นน3 4
$str
นน5 E
)
นนE F
;
นนF G
return
บบ 
new
บบ 
List
บบ 
<
บบ  
Game
บบ  $
>
บบ$ %
(
บบ% &
)
บบ& '
;
บบ' (
}
ปป 
}
ผผ 	
public
มม 
async
มม 
Task
มม 
<
มม 
GameMusicInfo
มม '
>
มม' (#
GetGameMusicInfoAsync
มม) >
(
มม> ?
Game
มม? C
game
มมD H
,
มมH I
CancellationToken
มมJ [
cancellationToken
มม\ m
=
มมn o
default
มมp w
)
มมw x
{
มมy z
if
ยย 
(
ยย 
disposed
ยย 
)
ยย 
throw
รร 
new
รร %
ObjectDisposedException
รร 1
(
รร1 2
nameof
รร2 8
(
รร8 9
GameService
รร9 D
)
รรD E
)
รรE F
;
รรF G
if
ลล 
(
ลล 
game
ลล 
==
ลล 
null
ลล 
)
ลล 
{
ลล 
logger
ฦฦ 
.
ฦฦ 
Warn
ฦฦ 
(
ฦฦ 
$str
ฦฦ I
)
ฦฦI J
;
ฦฦJ K
return
วว 
null
วว 
;
วว 
}
ศศ 
try
สส 
{
สส 
cancellationToken
หห !
.
หห! "*
ThrowIfCancellationRequested
หห" >
(
หห> ?
)
หห? @
;
หห@ A
logger
ออ 
.
ออ 
Debug
ออ 
(
ออ 
$"
ออ 
$str
ออ <
{
ออ< =
game
ออ= A
.
ออA B
Name
ออB F
}
ออF G
"
ออG H
)
ออH I
;
ออI J
return
ฯฯ 
await
ฯฯ 
Task
ฯฯ !
.
ฯฯ! "
Run
ฯฯ" %
(
ฯฯ% &
(
ฯฯ& '
)
ฯฯ' (
=>
ฯฯ) +
{
ฯฯ, -
cancellationToken
ะะ %
.
ะะ% &*
ThrowIfCancellationRequested
ะะ& B
(
ะะB C
)
ะะC D
;
ะะD E
var
าา 
musicDirectory
าา &
=
าา' (
MusicFileHelper
าา) 8
.
าา8 9
GetGameMusicPath
าา9 I
(
าาI J
playniteApi
าาJ U
,
าาU V
game
าาW [
)
าา[ \
;
าา\ ]
var
ำำ 

musicFiles
ำำ "
=
ำำ# $
MusicFileHelper
ำำ% 4
.
ำำ4 5
GetGameMusicFiles
ำำ5 F
(
ำำF G
playniteApi
ำำG R
,
ำำR S
game
ำำT X
)
ำำX Y
;
ำำY Z
var
ีี 
	totalSize
ีี !
=
ีี" #
$num
ีี$ &
;
ีี& '
foreach
ึึ 
(
ึึ 
var
ึึ  
file
ึึ! %
in
ึึ& (

musicFiles
ึึ) 3
)
ึึ3 4
{
ึึ5 6
try
ืื 
{
ืื 
var
ุุ 
fileInfo
ุุ  (
=
ุุ) *
new
ุุ+ .
FileInfo
ุุ/ 7
(
ุุ7 8
file
ุุ8 <
)
ุุ< =
;
ุุ= >
if
ูู 
(
ูู  
fileInfo
ูู  (
.
ูู( )
Exists
ูู) /
)
ูู/ 0
{
ูู1 2
	totalSize
ฺฺ  )
+=
ฺฺ* ,
fileInfo
ฺฺ- 5
.
ฺฺ5 6
Length
ฺฺ6 <
;
ฺฺ< =
}
 
}
 
catch
 
(
 
	Exception
 (
ex
) +
)
+ ,
{
- .
logger
 "
.
" #
Warn
# '
(
' (
ex
( *
,
* +
$"
, .
$str
. K
{
K L
file
L P
}
P Q
"
Q R
)
R S
;
S T
}
฿฿ 
}
เเ 
return
โโ 
new
โโ 
GameMusicInfo
โโ ,
{
โโ- .
Game
ใใ 
=
ใใ 
game
ใใ #
,
ใใ# $
MusicDirectory
ไไ &
=
ไไ' (
musicDirectory
ไไ) 7
,
ไไ7 8

MusicFiles
ๅๅ "
=
ๅๅ# $

musicFiles
ๅๅ% /
,
ๅๅ/ 0
TotalTracks
ๆๆ #
=
ๆๆ$ %

musicFiles
ๆๆ& 0
.
ๆๆ0 1
Count
ๆๆ1 6
,
ๆๆ6 7
TotalSizeBytes
็็ &
=
็็' (
	totalSize
็็) 2
,
็็2 3
LastScanned
่่ #
=
่่$ %
DateTime
่่& .
.
่่. /
Now
่่/ 2
}
้้ 
;
้้ 
}
๊๊ 
,
๊๊ 
cancellationToken
๊๊ $
)
๊๊$ %
;
๊๊% &
}
๋๋ 
catch
์์ 
(
์์ (
OperationCanceledException
์์ -
)
์์- .
{
์์/ 0
logger
ํํ 
.
ํํ 
Info
ํํ 
(
ํํ 
$"
ํํ 
$str
ํํ A
{
ํํA B
game
ํํB F
.
ํํF G
Name
ํํG K
}
ํํK L
"
ํํL M
)
ํํM N
;
ํํN O
throw
๎๎ 
;
๎๎ 
}
๏๏ 
catch
๐๐ 
(
๐๐ 
	Exception
๐๐ 
ex
๐๐ 
)
๐๐  
{
๐๐! "
logger
๑๑ 
.
๑๑ 
Error
๑๑ 
(
๑๑ 
ex
๑๑ 
,
๑๑  
$"
๑๑! #
$str
๑๑# F
{
๑๑F G
game
๑๑G K
.
๑๑K L
Name
๑๑L P
}
๑๑P Q
"
๑๑Q R
)
๑๑R S
;
๑๑S T
errorHandler
๒๒ 
.
๒๒ !
HandlePlaybackError
๒๒ 0
(
๒๒0 1
ex
๒๒1 3
,
๒๒3 4
game
๒๒5 9
.
๒๒9 :
Name
๒๒: >
)
๒๒> ?
;
๒๒? @
return
๓๓ 
null
๓๓ 
;
๓๓ 
}
๔๔ 
}
๕๕ 	
public
๚๚ 
async
๚๚ 
Task
๚๚ 
<
๚๚ 
List
๚๚ 
<
๚๚ 
Game
๚๚ #
>
๚๚# $
>
๚๚$ %
FilterGamesAsync
๚๚& 6
(
๚๚6 7
string
๚๚7 =

searchText
๚๚> H
,
๚๚H I
CancellationToken
๚๚J [
cancellationToken
๚๚\ m
=
๚๚n o
default
๚๚p w
)
๚๚w x
{
๚๚y z
if
๛๛ 
(
๛๛ 
disposed
๛๛ 
)
๛๛ 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
GameService
9 D
)
D E
)
E F
;
F G
try
 
{
 
cancellationToken
 !
.
! "*
ThrowIfCancellationRequested
" >
(
> ?
)
? @
;
@ A
var
 
allGames
 
=
 
await
 $$
GetGamesWithMusicAsync
% ;
(
; <
cancellationToken
< M
)
M N
;
N O
if
 
(
 
string
 
.
  
IsNullOrWhiteSpace
 -
(
- .

searchText
. 8
)
8 9
)
9 :
{
; <
return
 
allGames
 #
;
# $
}
 
return
 
await
 
Task
 !
.
! "
Run
" %
(
% &
(
& '
)
' (
=>
) +
{
, -
cancellationToken
 %
.
% &*
ThrowIfCancellationRequested
& B
(
B C
)
C D
;
D E
var
 
searchLower
 #
=
$ %

searchText
& 0
.
0 1
ToLowerInvariant
1 A
(
A B
)
B C
;
C D
return
 
allGames
 #
.
# $
Where
$ )
(
) *
game
* .
=>
/ 1
game
 
.
 
Name
 !
.
! "
ToLowerInvariant
" 2
(
2 3
)
3 4
.
4 5
Contains
5 =
(
= >
searchLower
> I
)
I J
||
K M
(
 
game
 
.
 
Description
 )
?
) *
.
* +
ToLowerInvariant
+ ;
(
; <
)
< =
.
= >
Contains
> F
(
F G
searchLower
G R
)
R S
??
T V
false
W \
)
\ ]
||
^ `
(
 
game
 
.
 

Developers
 (
?
( )
.
) *
Any
* -
(
- .
d
. /
=>
0 2
d
3 4
.
4 5
Name
5 9
.
9 :
ToLowerInvariant
: J
(
J K
)
K L
.
L M
Contains
M U
(
U V
searchLower
V a
)
a b
)
b c
??
d f
false
g l
)
l m
||
n p
(
 
game
 
.
 

Publishers
 (
?
( )
.
) *
Any
* -
(
- .
p
. /
=>
0 2
p
3 4
.
4 5
Name
5 9
.
9 :
ToLowerInvariant
: J
(
J K
)
K L
.
L M
Contains
M U
(
U V
searchLower
V a
)
a b
)
b c
??
d f
false
g l
)
l m
)
 
.
 
ToList
 
(
 
)
 
;
 
}
 
,
 
cancellationToken
 $
)
$ %
;
% &
}
 
catch
 
(
 (
OperationCanceledException
 -
)
- .
{
/ 0
logger
 
.
 
Info
 
(
 
$"
 
$str
 K
{
K L

searchText
L V
}
V W
"
W X
)
X Y
;
Y Z
throw
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
! "
logger
 
.
 
Error
 
(
 
ex
 
,
  
$"
! #
$str
# G
{
G H

searchText
H R
}
R S
"
S T
)
T U
;
U V
return
 
new
 
List
 
<
  
Game
  $
>
$ %
(
% &
)
& '
;
' (
}
 
}
 	
public
 
async
 
Task
 
<
 
Game
 
>
 !
FindGameByNameAsync
  3
(
3 4
string
4 :
gameName
; C
,
C D
CancellationToken
E V
cancellationToken
W h
=
i j
default
k r
)
r s
{
t u
if
กก 
(
กก 
disposed
กก 
)
กก 
throw
ขข 
new
ขข %
ObjectDisposedException
ขข 1
(
ขข1 2
nameof
ขข2 8
(
ขข8 9
GameService
ขข9 D
)
ขขD E
)
ขขE F
;
ขขF G
if
คค 
(
คค 
string
คค 
.
คค 
IsNullOrEmpty
คค $
(
คค$ %
gameName
คค% -
)
คค- .
)
คค. /
return
ฅฅ 
null
ฅฅ 
;
ฅฅ 
try
งง 
{
งง 
cancellationToken
จจ !
.
จจ! "*
ThrowIfCancellationRequested
จจ" >
(
จจ> ?
)
จจ? @
;
จจ@ A
var
ชช 
allGames
ชช 
=
ชช 
await
ชช $$
GetGamesWithMusicAsync
ชช% ;
(
ชช; <
cancellationToken
ชช< M
)
ชชM N
;
ชชN O
return
ฌฌ 
await
ฌฌ 
Task
ฌฌ !
.
ฌฌ! "
Run
ฌฌ" %
(
ฌฌ% &
(
ฌฌ& '
)
ฌฌ' (
=>
ฌฌ) +
{
ฌฌ, -
cancellationToken
ญญ %
.
ญญ% &*
ThrowIfCancellationRequested
ญญ& B
(
ญญB C
)
ญญC D
;
ญญD E
return
ฏฏ 
allGames
ฏฏ #
.
ฏฏ# $
FirstOrDefault
ฏฏ$ 2
(
ฏฏ2 3
game
ฏฏ3 7
=>
ฏฏ8 :
string
ฐฐ 
.
ฐฐ 
Equals
ฐฐ %
(
ฐฐ% &
game
ฐฐ& *
.
ฐฐ* +
Name
ฐฐ+ /
,
ฐฐ/ 0
gameName
ฐฐ1 9
,
ฐฐ9 :
StringComparison
ฐฐ; K
.
ฐฐK L
OrdinalIgnoreCase
ฐฐL ]
)
ฐฐ] ^
)
ฐฐ^ _
;
ฐฐ_ `
}
ฑฑ 
,
ฑฑ 
cancellationToken
ฑฑ $
)
ฑฑ$ %
;
ฑฑ% &
}
ฒฒ 
catch
ณณ 
(
ณณ (
OperationCanceledException
ณณ -
)
ณณ- .
{
ณณ/ 0
logger
ดด 
.
ดด 
Info
ดด 
(
ดด 
$"
ดด 
$str
ดด ?
{
ดด? @
gameName
ดด@ H
}
ดดH I
"
ดดI J
)
ดดJ K
;
ดดK L
throw
ตต 
;
ตต 
}
ถถ 
catch
ทท 
(
ทท 
	Exception
ทท 
ex
ทท 
)
ทท  
{
ทท! "
logger
ธธ 
.
ธธ 
Error
ธธ 
(
ธธ 
ex
ธธ 
,
ธธ  
$"
ธธ! #
$str
ธธ# @
{
ธธ@ A
gameName
ธธA I
}
ธธI J
"
ธธJ K
)
ธธK L
;
ธธL M
return
นน 
null
นน 
;
นน 
}
บบ 
}
ปป 	
private
ภภ 
struct
ภภ 
GameFileInfo
ภภ #
{
ภภ$ %
public
มม 
Game
มม 
Game
มม 
{
มม 
get
มม "
;
มม" #
set
มม$ '
;
มม' (
}
มม) *
public
ยย 
string
ยย 
FilePath
ยย "
{
ยย# $
get
ยย% (
;
ยย( )
set
ยย* -
;
ยย- .
}
ยย/ 0
}
รร 	
private
ศศ 
bool
ศศ 
IsValidAudioFile
ศศ %
(
ศศ% &
string
ศศ& ,
filePath
ศศ- 5
)
ศศ5 6
{
ศศ7 8
try
ษษ 
{
ษษ 
var
สส !
supportedExtensions
สส '
=
สส( )
new
สส* -
[
สส- .
]
สส. /
{
สส0 1
$str
สส2 8
,
สส8 9
$str
สส: @
,
สส@ A
$str
สสB I
,
สสI J
$str
สสK Q
,
สสQ R
$str
สสS Y
}
สสZ [
;
สส[ \
var
หห 
	extension
หห 
=
หห 
Path
หห  $
.
หห$ %
GetExtension
หห% 1
(
หห1 2
filePath
หห2 :
)
หห: ;
.
หห; <
ToLowerInvariant
หห< L
(
หหL M
)
หหM N
;
หหN O
return
ออ !
supportedExtensions
ออ *
.
ออ* +
Contains
ออ+ 3
(
ออ3 4
	extension
ออ4 =
)
ออ= >
&&
ออ? A
File
ฮฮ 
.
ฮฮ 
Exists
ฮฮ "
(
ฮฮ" #
filePath
ฮฮ# +
)
ฮฮ+ ,
&&
ฮฮ- /
new
ฯฯ 
FileInfo
ฯฯ #
(
ฯฯ# $
filePath
ฯฯ$ ,
)
ฯฯ, -
.
ฯฯ- .
Length
ฯฯ. 4
>
ฯฯ5 6
$num
ฯฯ7 ;
;
ฯฯ; <
}
ะะ 
catch
ัั 
{
ัั 
return
าา 
false
าา 
;
าา 
}
ำำ 
}
ิิ 	
public
ูู 
async
ูู 
Task
ูู 
<
ูู 
List
ูู 
<
ูู 
string
ูู %
>
ูู% &
>
ูู& ' 
GetMusicFilesAsync
ูู( :
(
ูู: ;
Game
ูู; ?
game
ูู@ D
,
ููD E
CancellationToken
ููF W
cancellationToken
ููX i
=
ููj k
default
ููl s
)
ููs t
{
ููu v
if
ฺฺ 
(
ฺฺ 
disposed
ฺฺ 
)
ฺฺ 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
GameService
9 D
)
D E
)
E F
;
F G
if
 
(
 
game
 
==
 
null
 
)
 
return
 
new
 
List
 
<
  
string
  &
>
& '
(
' (
)
( )
;
) *
try
เเ 
{
เเ 
cancellationToken
แแ !
.
แแ! "*
ThrowIfCancellationRequested
แแ" >
(
แแ> ?
)
แแ? @
;
แแ@ A
return
ใใ 
await
ใใ 
Task
ใใ !
.
ใใ! "
Run
ใใ" %
(
ใใ% &
(
ใใ& '
)
ใใ' (
=>
ใใ) +
{
ใใ, -
cancellationToken
ไไ %
.
ไไ% &*
ThrowIfCancellationRequested
ไไ& B
(
ไไB C
)
ไไC D
;
ไไD E
return
ๅๅ 
MusicFileHelper
ๅๅ *
.
ๅๅ* +
GetGameMusicFiles
ๅๅ+ <
(
ๅๅ< =
playniteApi
ๅๅ= H
,
ๅๅH I
game
ๅๅJ N
)
ๅๅN O
;
ๅๅO P
}
ๆๆ 
,
ๆๆ 
cancellationToken
ๆๆ $
)
ๆๆ$ %
;
ๆๆ% &
}
็็ 
catch
่่ 
(
่่ (
OperationCanceledException
่่ -
)
่่- .
{
่่/ 0
logger
้้ 
.
้้ 
Info
้้ 
(
้้ 
$"
้้ 
$str
้้ B
{
้้B C
game
้้C G
.
้้G H
Name
้้H L
}
้้L M
"
้้M N
)
้้N O
;
้้O P
throw
๊๊ 
;
๊๊ 
}
๋๋ 
catch
์์ 
(
์์ 
	Exception
์์ 
ex
์์ 
)
์์  
{
์์! "
logger
ํํ 
.
ํํ 
Error
ํํ 
(
ํํ 
ex
ํํ 
,
ํํ  
$"
ํํ! #
$str
ํํ# G
{
ํํG H
game
ํํH L
.
ํํL M
Name
ํํM Q
}
ํํQ R
"
ํํR S
)
ํํS T
;
ํํT U
return
๎๎ 
new
๎๎ 
List
๎๎ 
<
๎๎  
string
๎๎  &
>
๎๎& '
(
๎๎' (
)
๎๎( )
;
๎๎) *
}
๏๏ 
}
๐๐ 	
public
๕๕ 
async
๕๕ 
Task
๕๕ 
<
๕๕ 
string
๕๕  
>
๕๕  !$
GetMusicDirectoryAsync
๕๕" 8
(
๕๕8 9
Game
๕๕9 =
game
๕๕> B
,
๕๕B C
CancellationToken
๕๕D U
cancellationToken
๕๕V g
=
๕๕h i
default
๕๕j q
)
๕๕q r
{
๕๕s t
if
๖๖ 
(
๖๖ 
disposed
๖๖ 
)
๖๖ 
throw
๗๗ 
new
๗๗ %
ObjectDisposedException
๗๗ 1
(
๗๗1 2
nameof
๗๗2 8
(
๗๗8 9
GameService
๗๗9 D
)
๗๗D E
)
๗๗E F
;
๗๗F G
if
๙๙ 
(
๙๙ 
game
๙๙ 
==
๙๙ 
null
๙๙ 
)
๙๙ 
return
๚๚ 
string
๚๚ 
.
๚๚ 
Empty
๚๚ #
;
๚๚# $
try
 
{
 
cancellationToken
 !
.
! "*
ThrowIfCancellationRequested
" >
(
> ?
)
? @
;
@ A
return
 
await
 
Task
 !
.
! "
Run
" %
(
% &
(
& '
)
' (
=>
) +
{
, -
cancellationToken
 %
.
% &*
ThrowIfCancellationRequested
& B
(
B C
)
C D
;
D E
return
 
MusicFileHelper
 *
.
* +
GetGameMusicPath
+ ;
(
; <
playniteApi
< G
,
G H
game
I M
)
M N
;
N O
}
 
,
 
cancellationToken
 $
)
$ %
;
% &
}
 
catch
 
(
 (
OperationCanceledException
 -
)
- .
{
/ 0
logger
 
.
 
Info
 
(
 
$"
 
$str
 F
{
F G
game
G K
.
K L
Name
L P
}
P Q
"
Q R
)
R S
;
S T
throw
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
! "
logger
 
.
 
Error
 
(
 
ex
 
,
  
$"
! #
$str
# K
{
K L
game
L P
.
P Q
Name
Q U
}
U V
"
V W
)
W X
;
X Y
return
 
string
 
.
 
Empty
 #
;
# $
}
 
}
 	
public
 
async
 
Task
 
<
 
bool
 
>
 $
ValidateMusicFileAsync
  6
(
6 7
string
7 =
filePath
> F
,
F G
CancellationToken
H Y
cancellationToken
Z k
=
l m
default
n u
)
u v
{
w x
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
GameService
9 D
)
D E
)
E F
;
F G
if
 
(
 
string
 
.
 
IsNullOrEmpty
 $
(
$ %
filePath
% -
)
- .
)
. /
return
 
false
 
;
 
try
 
{
 
cancellationToken
 !
.
! "*
ThrowIfCancellationRequested
" >
(
> ?
)
? @
;
@ A
return
 
await
 
Task
 !
.
! "
Run
" %
(
% &
(
& '
)
' (
=>
) +
{
, -
cancellationToken
 %
.
% &*
ThrowIfCancellationRequested
& B
(
B C
)
C D
;
D E
try
 
{
 
return
 
File
 #
.
# $
Exists
$ *
(
* +
filePath
+ 3
)
3 4
&&
5 7
new
 "
FileInfo
# +
(
+ ,
filePath
, 4
)
4 5
.
5 6
Length
6 <
>
= >
$num
? @
&&
A C
IsValidAudioFile
กก /
(
กก/ 0
filePath
กก0 8
)
กก8 9
;
กก9 :
}
ขข 
catch
ฃฃ 
{
ฃฃ 
return
คค 
false
คค $
;
คค$ %
}
ฅฅ 
}
ฆฆ 
,
ฆฆ 
cancellationToken
ฆฆ $
)
ฆฆ$ %
;
ฆฆ% &
}
งง 
catch
จจ 
(
จจ (
OperationCanceledException
จจ -
)
จจ- .
{
จจ/ 0
logger
ฉฉ 
.
ฉฉ 
Info
ฉฉ 
(
ฉฉ 
$"
ฉฉ 
$str
ฉฉ A
{
ฉฉA B
filePath
ฉฉB J
}
ฉฉJ K
"
ฉฉK L
)
ฉฉL M
;
ฉฉM N
throw
ชช 
;
ชช 
}
ซซ 
catch
ฌฌ 
(
ฌฌ 
	Exception
ฌฌ 
ex
ฌฌ 
)
ฌฌ  
{
ฌฌ! "
logger
ญญ 
.
ญญ 
Error
ญญ 
(
ญญ 
ex
ญญ 
,
ญญ  
$"
ญญ! #
$str
ญญ# B
{
ญญB C
filePath
ญญC K
}
ญญK L
"
ญญL M
)
ญญM N
;
ญญN O
return
ฎฎ 
false
ฎฎ 
;
ฎฎ 
}
ฏฏ 
}
ฐฐ 	
public
ตต 
async
ตต 
Task
ตต 
<
ตต 
List
ตต 
<
ตต 
string
ตต %
>
ตต% &
>
ตต& '$
ScanForMusicFilesAsync
ตต( >
(
ตต> ?
Game
ตต? C
game
ตตD H
,
ตตH I
	IProgress
ตตJ S
<
ตตS T
int
ตตT W
>
ตตW X
progress
ตตY a
=
ตตb c
null
ตตd h
,
ตตh i
CancellationToken
ถถ 
cancellationToken
ถถ /
=
ถถ0 1
default
ถถ2 9
)
ถถ9 :
{
ถถ; <
if
ทท 
(
ทท 
disposed
ทท 
)
ทท 
throw
ธธ 
new
ธธ %
ObjectDisposedException
ธธ 1
(
ธธ1 2
nameof
ธธ2 8
(
ธธ8 9
GameService
ธธ9 D
)
ธธD E
)
ธธE F
;
ธธF G
if
บบ 
(
บบ 
game
บบ 
==
บบ 
null
บบ 
)
บบ 
return
ปป 
new
ปป 
List
ปป 
<
ปป  
string
ปป  &
>
ปป& '
(
ปป' (
)
ปป( )
;
ปป) *
try
ฝฝ 
{
ฝฝ 
cancellationToken
พพ !
.
พพ! "*
ThrowIfCancellationRequested
พพ" >
(
พพ> ?
)
พพ? @
;
พพ@ A
logger
ภภ 
.
ภภ 
Debug
ภภ 
(
ภภ 
$"
ภภ 
$str
ภภ A
{
ภภA B
game
ภภB F
.
ภภF G
Name
ภภG K
}
ภภK L
"
ภภL M
)
ภภM N
;
ภภN O
return
ยย 
await
ยย 
Task
ยย !
.
ยย! "
Run
ยย" %
(
ยย% &
(
ยย& '
)
ยย' (
=>
ยย) +
{
ยย, -
cancellationToken
รร %
.
รร% &*
ThrowIfCancellationRequested
รร& B
(
รรB C
)
รรC D
;
รรD E
var
ลล 
musicDirectory
ลล &
=
ลล' (
MusicFileHelper
ลล) 8
.
ลล8 9
GetGameMusicPath
ลล9 I
(
ลลI J
playniteApi
ลลJ U
,
ลลU V
game
ลลW [
)
ลล[ \
;
ลล\ ]
if
ฦฦ 
(
ฦฦ 
string
ฦฦ 
.
ฦฦ 
IsNullOrEmpty
ฦฦ ,
(
ฦฦ, -
musicDirectory
ฦฦ- ;
)
ฦฦ; <
||
ฦฦ= ?
!
ฦฦ@ A
	Directory
ฦฦA J
.
ฦฦJ K
Exists
ฦฦK Q
(
ฦฦQ R
musicDirectory
ฦฦR `
)
ฦฦ` a
)
ฦฦa b
{
ฦฦc d
return
วว 
new
วว "
List
วว# '
<
วว' (
string
วว( .
>
วว. /
(
วว/ 0
)
วว0 1
;
วว1 2
}
ศศ 
var
สส !
supportedExtensions
สส +
=
สส, -
new
สส. 1
[
สส1 2
]
สส2 3
{
สส4 5
$str
สส6 <
,
สส< =
$str
สส> D
,
สสD E
$str
สสF M
,
สสM N
$str
สสO U
,
สสU V
$str
สสW ]
}
สส^ _
;
สส_ `
var
หห 

musicFiles
หห "
=
หห# $
new
หห% (
List
หห) -
<
หห- .
string
หห. 4
>
หห4 5
(
หห5 6
)
หห6 7
;
หห7 8
var
ออ 
allFiles
ออ  
=
ออ! "
	Directory
ออ# ,
.
ออ, -
GetFiles
ออ- 5
(
ออ5 6
musicDirectory
ออ6 D
,
ออD E
$str
ออF K
,
ออK L
SearchOption
ออM Y
.
ออY Z
AllDirectories
ออZ h
)
ออh i
.
ฮฮ 
Where
ฮฮ 
(
ฮฮ 
file
ฮฮ #
=>
ฮฮ$ &!
supportedExtensions
ฮฮ' :
.
ฮฮ: ;
Contains
ฮฮ; C
(
ฮฮC D
Path
ฮฮD H
.
ฮฮH I
GetExtension
ฮฮI U
(
ฮฮU V
file
ฮฮV Z
)
ฮฮZ [
.
ฮฮ[ \
ToLowerInvariant
ฮฮ\ l
(
ฮฮl m
)
ฮฮm n
)
ฮฮn o
)
ฮฮo p
.
ฯฯ 
ToList
ฯฯ 
(
ฯฯ  
)
ฯฯ  !
;
ฯฯ! "
int
ัั 
processedCount
ัั &
=
ัั' (
$num
ัั) *
;
ัั* +
foreach
าา 
(
าา 
var
าา  
file
าา! %
in
าา& (
allFiles
าา) 1
)
าา1 2
{
าา3 4
cancellationToken
ำำ )
.
ำำ) **
ThrowIfCancellationRequested
ำำ* F
(
ำำF G
)
ำำG H
;
ำำH I
if
ีี 
(
ีี 
IsValidAudioFile
ีี ,
(
ีี, -
file
ีี- 1
)
ีี1 2
)
ีี2 3
{
ีี4 5

musicFiles
ึึ &
.
ึึ& '
Add
ึึ' *
(
ึึ* +
file
ึึ+ /
)
ึึ/ 0
;
ึึ0 1
}
ืื 
processedCount
ูู &
++
ูู& (
;
ูู( )
progress
ฺฺ  
?
ฺฺ  !
.
ฺฺ! "
Report
ฺฺ" (
(
ฺฺ( )
(
ฺฺ) *
processedCount
ฺฺ* 8
*
ฺฺ9 :
$num
ฺฺ; >
)
ฺฺ> ?
/
ฺฺ@ A
allFiles
ฺฺB J
.
ฺฺJ K
Count
ฺฺK P
)
ฺฺP Q
;
ฺฺQ R
}
 
logger
 
.
 
Debug
  
(
  !
$"
! #
$str
# )
{
) *

musicFiles
* 4
.
4 5
Count
5 :
}
: ;
$str
; Q
{
Q R
game
R V
.
V W
Name
W [
}
[ \
"
\ ]
)
] ^
;
^ _
return
 

musicFiles
 %
;
% &
}
฿฿ 
,
฿฿ 
cancellationToken
฿฿ $
)
฿฿$ %
;
฿฿% &
}
เเ 
catch
แแ 
(
แแ (
OperationCanceledException
แแ -
)
แแ- .
{
แแ/ 0
logger
โโ 
.
โโ 
Info
โโ 
(
โโ 
$"
โโ 
$str
โโ G
{
โโG H
game
โโH L
.
โโL M
Name
โโM Q
}
โโQ R
"
โโR S
)
โโS T
;
โโT U
throw
ใใ 
;
ใใ 
}
ไไ 
catch
ๅๅ 
(
ๅๅ 
	Exception
ๅๅ 
ex
ๅๅ 
)
ๅๅ  
{
ๅๅ! "
logger
ๆๆ 
.
ๆๆ 
Error
ๆๆ 
(
ๆๆ 
ex
ๆๆ 
,
ๆๆ  
$"
ๆๆ! #
$str
ๆๆ# K
{
ๆๆK L
game
ๆๆL P
.
ๆๆP Q
Name
ๆๆQ U
}
ๆๆU V
"
ๆๆV W
)
ๆๆW X
;
ๆๆX Y
return
็็ 
new
็็ 
List
็็ 
<
็็  
string
็็  &
>
็็& '
(
็็' (
)
็็( )
;
็็) *
}
่่ 
}
้้ 	
public
๎๎ 
async
๎๎ 
Task
๎๎ 
<
๎๎ 

Dictionary
๎๎ $
<
๎๎$ %
Game
๎๎% )
,
๎๎) *
List
๎๎+ /
<
๎๎/ 0
string
๎๎0 6
>
๎๎6 7
>
๎๎7 8
>
๎๎8 9'
ScanAllGamesForMusicAsync
๎๎: S
(
๎๎S T
	IProgress
๎๎T ]
<
๎๎] ^
ScanProgress
๎๎^ j
>
๎๎j k
progress
๎๎l t
=
๎๎u v
null
๎๎w {
,
๎๎{ |
CancellationToken
๏๏ 
cancellationToken
๏๏ /
=
๏๏0 1
default
๏๏2 9
)
๏๏9 :
{
๏๏; <
if
๐๐ 
(
๐๐ 
disposed
๐๐ 
)
๐๐ 
throw
๑๑ 
new
๑๑ %
ObjectDisposedException
๑๑ 1
(
๑๑1 2
nameof
๑๑2 8
(
๑๑8 9
GameService
๑๑9 D
)
๑๑D E
)
๑๑E F
;
๑๑F G
var
๓๓ 
results
๓๓ 
=
๓๓ 
new
๓๓ 

Dictionary
๓๓ (
<
๓๓( )
Game
๓๓) -
,
๓๓- .
List
๓๓/ 3
<
๓๓3 4
string
๓๓4 :
>
๓๓: ;
>
๓๓; <
(
๓๓< =
)
๓๓= >
;
๓๓> ?
try
๕๕ 
{
๕๕ 
cancellationToken
๖๖ !
.
๖๖! "*
ThrowIfCancellationRequested
๖๖" >
(
๖๖> ?
)
๖๖? @
;
๖๖@ A
logger
๘๘ 
.
๘๘ 
Info
๘๘ 
(
๘๘ 
$str
๘๘ U
)
๘๘U V
;
๘๘V W
var
๚๚ 
allGames
๚๚ 
=
๚๚ 
playniteApi
๚๚ *
.
๚๚* +
Database
๚๚+ 3
.
๚๚3 4
Games
๚๚4 9
.
๚๚9 :
ToList
๚๚: @
(
๚๚@ A
)
๚๚A B
;
๚๚B C
int
๛๛ 
processedGames
๛๛ "
=
๛๛# $
$num
๛๛% &
;
๛๛& '
int
 
totalFoundFiles
 #
=
$ %
$num
& '
;
' (
foreach
 
(
 
var
 
game
 !
in
" $
allGames
% -
)
- .
{
/ 0
cancellationToken
 %
.
% &*
ThrowIfCancellationRequested
& B
(
B C
)
C D
;
D E
progress
 
?
 
.
 
Report
 $
(
$ %
new
% (
ScanProgress
) 5
{
6 7

TotalGames
 "
=
# $
allGames
% -
.
- .
Count
. 3
,
3 4
ProcessedGames
 &
=
' (
processedGames
) 7
,
7 8
CurrentGame
 #
=
$ %
game
& *
,
* +
Status
 
=
  
$"
! #
$str
# ,
{
, -
game
- 1
.
1 2
Name
2 6
}
6 7
$str
7 :
"
: ;
,
; <
FoundMusicFiles
 '
=
( )
totalFoundFiles
* 9
}
 
)
 
;
 
try
 
{
 
var
 

musicFiles
 &
=
' (
await
) .$
ScanForMusicFilesAsync
/ E
(
E F
game
F J
,
J K
null
L P
,
P Q
cancellationToken
R c
)
c d
;
d e
if
 
(
 

musicFiles
 &
.
& '
Count
' ,
>
- .
$num
/ 0
)
0 1
{
2 3
results
 #
[
# $
game
$ (
]
( )
=
* +

musicFiles
, 6
;
6 7
totalFoundFiles
 +
+=
, .

musicFiles
/ 9
.
9 :
Count
: ?
;
? @
}
 
}
 
catch
 
(
 (
OperationCanceledException
 5
)
5 6
{
7 8
throw
 
;
 
}
 
catch
 
(
 
	Exception
 $
ex
% '
)
' (
{
) *
logger
 
.
 
Warn
 #
(
# $
ex
$ &
,
& '
$"
( *
$str
* ?
{
? @
game
@ D
.
D E
Name
E I
}
I J
"
J K
)
K L
;
L M
}
 
processedGames
 "
++
" $
;
$ %
}
 
progress
 
?
 
.
 
Report
  
(
  !
new
! $
ScanProgress
% 1
{
2 3

TotalGames
 
=
  
allGames
! )
.
) *
Count
* /
,
/ 0
ProcessedGames
 "
=
# $
processedGames
% 3
,
3 4
Status
 
=
 
$str
 -
,
- .
FoundMusicFiles
 #
=
$ %
totalFoundFiles
& 5
}
 
)
 
;
 
logger
กก 
.
กก 
Info
กก 
(
กก 
$"
กก 
$str
กก C
{
กกC D
results
กกD K
.
กกK L
Count
กกL Q
}
กกQ R
$str
กกR Z
{
กกZ [
totalFoundFiles
กก[ j
}
กกj k
$str
กกk x
"
กกx y
)
กกy z
;
กกz {
return
ขข 
results
ขข 
;
ขข 
}
ฃฃ 
catch
คค 
(
คค (
OperationCanceledException
คค -
)
คค- .
{
คค/ 0
logger
ฅฅ 
.
ฅฅ 
Info
ฅฅ 
(
ฅฅ 
$str
ฅฅ <
)
ฅฅ< =
;
ฅฅ= >
throw
ฆฆ 
;
ฆฆ 
}
งง 
catch
จจ 
(
จจ 
	Exception
จจ 
ex
จจ 
)
จจ  
{
จจ! "
logger
ฉฉ 
.
ฉฉ 
Error
ฉฉ 
(
ฉฉ 
ex
ฉฉ 
,
ฉฉ  
$str
ฉฉ! O
)
ฉฉO P
;
ฉฉP Q
return
ชช 
results
ชช 
;
ชช 
}
ซซ 
}
ฌฌ 	
public
ฑฑ 
async
ฑฑ 
Task
ฑฑ 
<
ฑฑ 

Dictionary
ฑฑ $
<
ฑฑ$ %
Game
ฑฑ% )
,
ฑฑ) *
List
ฑฑ+ /
<
ฑฑ/ 0
string
ฑฑ0 6
>
ฑฑ6 7
>
ฑฑ7 8
>
ฑฑ8 9(
ValidateAllMusicFilesAsync
ฑฑ: T
(
ฑฑT U
	IProgress
ฑฑU ^
<
ฑฑ^ _ 
ValidationProgress
ฑฑ_ q
>
ฑฑq r
progress
ฑฑs {
=
ฑฑ| }
nullฑฑ~ 
,ฑฑ 
CancellationToken
ฒฒ 
cancellationToken
ฒฒ /
=
ฒฒ0 1
default
ฒฒ2 9
)
ฒฒ9 :
{
ฒฒ; <
if
ณณ 
(
ณณ 
disposed
ณณ 
)
ณณ 
throw
ดด 
new
ดด %
ObjectDisposedException
ดด 1
(
ดด1 2
nameof
ดด2 8
(
ดด8 9
GameService
ดด9 D
)
ดดD E
)
ดดE F
;
ดดF G
var
ถถ 
results
ถถ 
=
ถถ 
new
ถถ 

Dictionary
ถถ (
<
ถถ( )
Game
ถถ) -
,
ถถ- .
List
ถถ/ 3
<
ถถ3 4
string
ถถ4 :
>
ถถ: ;
>
ถถ; <
(
ถถ< =
)
ถถ= >
;
ถถ> ?
try
ธธ 
{
ธธ 
cancellationToken
นน !
.
นน! "*
ThrowIfCancellationRequested
นน" >
(
นน> ?
)
นน? @
;
นน@ A
logger
ปป 
.
ปป 
Info
ปป 
(
ปป 
$str
ปป I
)
ปปI J
;
ปปJ K
var
ฝฝ 
gamesWithMusic
ฝฝ "
=
ฝฝ# $
await
ฝฝ% *$
GetGamesWithMusicAsync
ฝฝ+ A
(
ฝฝA B
cancellationToken
ฝฝB S
)
ฝฝS T
;
ฝฝT U
var
พพ 
allMusicFiles
พพ !
=
พพ" #
new
พพ$ '
List
พพ( ,
<
พพ, -
GameFileInfo
พพ- 9
>
พพ9 :
(
พพ: ;
)
พพ; <
;
พพ< =
foreach
มม 
(
มม 
var
มม 
game
มม !
in
มม" $
gamesWithMusic
มม% 3
)
มม3 4
{
มม5 6
var
ยย 

musicFiles
ยย "
=
ยย# $
await
ยย% * 
GetMusicFilesAsync
ยย+ =
(
ยย= >
game
ยย> B
,
ยยB C
cancellationToken
ยยD U
)
ยยU V
;
ยยV W
foreach
รร 
(
รร 
var
รร  
file
รร! %
in
รร& (

musicFiles
รร) 3
)
รร3 4
{
รร5 6
allMusicFiles
ฤฤ %
.
ฤฤ% &
Add
ฤฤ& )
(
ฤฤ) *
new
ฤฤ* -
GameFileInfo
ฤฤ. :
{
ฤฤ; <
Game
ฤฤ= A
=
ฤฤB C
game
ฤฤD H
,
ฤฤH I
FilePath
ฤฤJ R
=
ฤฤS T
file
ฤฤU Y
}
ฤฤZ [
)
ฤฤ[ \
;
ฤฤ\ ]
}
ลล 
}
ฦฦ 
int
ศศ 
processedFiles
ศศ "
=
ศศ# $
$num
ศศ% &
;
ศศ& '
int
ษษ 

validFiles
ษษ 
=
ษษ  
$num
ษษ! "
;
ษษ" #
int
สส 
invalidFiles
สส  
=
สส! "
$num
สส# $
;
สส$ %
foreach
ฬฬ 
(
ฬฬ 
var
ฬฬ 
gameFile
ฬฬ %
in
ฬฬ& (
allMusicFiles
ฬฬ) 6
)
ฬฬ6 7
{
ฬฬ8 9
cancellationToken
ออ %
.
ออ% &*
ThrowIfCancellationRequested
ออ& B
(
ออB C
)
ออC D
;
ออD E
progress
ฯฯ 
?
ฯฯ 
.
ฯฯ 
Report
ฯฯ $
(
ฯฯ$ %
new
ฯฯ% ( 
ValidationProgress
ฯฯ) ;
{
ฯฯ< =

TotalFiles
ะะ "
=
ะะ# $
allMusicFiles
ะะ% 2
.
ะะ2 3
Count
ะะ3 8
,
ะะ8 9
ProcessedFiles
ัั &
=
ัั' (
processedFiles
ัั) 7
,
ัั7 8
CurrentFile
าา #
=
าา$ %
Path
าา& *
.
าา* +
GetFileName
าา+ 6
(
าา6 7
gameFile
าา7 ?
.
าา? @
FilePath
าา@ H
)
าาH I
,
าาI J
Status
ำำ 
=
ำำ  
$"
ำำ! #
$str
ำำ# .
{
ำำ. /
Path
ำำ/ 3
.
ำำ3 4
GetFileName
ำำ4 ?
(
ำำ? @
gameFile
ำำ@ H
.
ำำH I
FilePath
ำำI Q
)
ำำQ R
}
ำำR S
$str
ำำS V
"
ำำV W
,
ำำW X

ValidFiles
ิิ "
=
ิิ# $

validFiles
ิิ% /
,
ิิ/ 0
InvalidFiles
ีี $
=
ีี% &
invalidFiles
ีี' 3
}
ึึ 
)
ึึ 
;
ึึ 
try
ุุ 
{
ุุ 
var
ูู 
isValid
ูู #
=
ูู$ %
await
ูู& +$
ValidateMusicFileAsync
ูู, B
(
ููB C
gameFile
ููC K
.
ููK L
FilePath
ููL T
,
ููT U
cancellationToken
ููV g
)
ููg h
;
ููh i
if
ฺฺ 
(
ฺฺ 
isValid
ฺฺ #
)
ฺฺ# $
{
ฺฺ% &
if
 
(
  
!
  !
results
! (
.
( )
ContainsKey
) 4
(
4 5
gameFile
5 =
.
= >
Game
> B
)
B C
)
C D
{
E F
results
  '
[
' (
gameFile
( 0
.
0 1
Game
1 5
]
5 6
=
7 8
new
9 <
List
= A
<
A B
string
B H
>
H I
(
I J
)
J K
;
K L
}
 
results
 #
[
# $
gameFile
$ ,
.
, -
Game
- 1
]
1 2
.
2 3
Add
3 6
(
6 7
gameFile
7 ?
.
? @
FilePath
@ H
)
H I
;
I J

validFiles
฿฿ &
++
฿฿& (
;
฿฿( )
}
เเ 
else
แแ 
{
แแ 
invalidFiles
โโ (
++
โโ( *
;
โโ* +
}
ใใ 
}
ไไ 
catch
ๅๅ 
(
ๅๅ (
OperationCanceledException
ๅๅ 5
)
ๅๅ5 6
{
ๅๅ7 8
throw
ๆๆ 
;
ๆๆ 
}
็็ 
catch
่่ 
(
่่ 
	Exception
่่ $
ex
่่% '
)
่่' (
{
่่) *
logger
้้ 
.
้้ 
Warn
้้ #
(
้้# $
ex
้้$ &
,
้้& '
$"
้้( *
$str
้้* A
{
้้A B
gameFile
้้B J
.
้้J K
FilePath
้้K S
}
้้S T
"
้้T U
)
้้U V
;
้้V W
invalidFiles
๊๊ $
++
๊๊$ &
;
๊๊& '
}
๋๋ 
processedFiles
ํํ "
++
ํํ" $
;
ํํ$ %
}
๎๎ 
progress
๐๐ 
?
๐๐ 
.
๐๐ 
Report
๐๐  
(
๐๐  !
new
๐๐! $ 
ValidationProgress
๐๐% 7
{
๐๐8 9

TotalFiles
๑๑ 
=
๑๑  
allMusicFiles
๑๑! .
.
๑๑. /
Count
๑๑/ 4
,
๑๑4 5
ProcessedFiles
๒๒ "
=
๒๒# $
processedFiles
๒๒% 3
,
๒๒3 4
Status
๓๓ 
=
๓๓ 
$str
๓๓ 3
,
๓๓3 4

ValidFiles
๔๔ 
=
๔๔  

validFiles
๔๔! +
,
๔๔+ ,
InvalidFiles
๕๕  
=
๕๕! "
invalidFiles
๕๕# /
}
๖๖ 
)
๖๖ 
;
๖๖ 
logger
๘๘ 
.
๘๘ 
Info
๘๘ 
(
๘๘ 
$"
๘๘ 
$str
๘๘ A
{
๘๘A B

validFiles
๘๘B L
}
๘๘L M
$str
๘๘M X
{
๘๘X Y
invalidFiles
๘๘Y e
}
๘๘e f
"
๘๘f g
)
๘๘g h
;
๘๘h i
return
๙๙ 
results
๙๙ 
;
๙๙ 
}
๚๚ 
catch
๛๛ 
(
๛๛ (
OperationCanceledException
๛๛ -
)
๛๛- .
{
๛๛/ 0
logger
 
.
 
Info
 
(
 
$str
 B
)
B C
;
C D
throw
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
! "
logger
 
.
 
Error
 
(
 
ex
 
,
  
$str
! T
)
T U
;
U V
return
 
results
 
;
 
}
 
}
 	
public
 
async
 
Task
 
<
 $
MusicLibraryStatistics
 0
>
0 1'
GetLibraryStatisticsAsync
2 K
(
K L
CancellationToken
L ]
cancellationToken
^ o
=
p q
default
r y
)
y z
{
{ |
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
GameService
9 D
)
D E
)
E F
;
F G
try
 
{
 
cancellationToken
 !
.
! "*
ThrowIfCancellationRequested
" >
(
> ?
)
? @
;
@ A
logger
 
.
 
Debug
 
(
 
$str
 F
)
F G
;
G H
return
 
await
 
Task
 !
.
! "
Run
" %
(
% &
async
& +
(
, -
)
- .
=>
/ 1
{
2 3
cancellationToken
 %
.
% &*
ThrowIfCancellationRequested
& B
(
B C
)
C D
;
D E
var
 

statistics
 "
=
# $
new
% ($
MusicLibraryStatistics
) ?
{
@ A
LastScanned
 #
=
$ %
DateTime
& .
.
. /
Now
/ 2
}
 
;
 
var
 
allGames
  
=
! "
playniteApi
# .
.
. /
Database
/ 7
.
7 8
Games
8 =
.
= >
ToList
> D
(
D E
)
E F
;
F G

statistics
 
.
 

TotalGames
 )
=
* +
allGames
, 4
.
4 5
Count
5 :
;
: ;
var
 
gamesWithMusic
 &
=
' (
await
) .$
GetGamesWithMusicAsync
/ E
(
E F
cancellationToken
F W
)
W X
;
X Y

statistics
 
.
 
GamesWithMusic
 -
=
. /
gamesWithMusic
0 >
.
> ?
Count
? D
;
D E
long
 
	totalSize
 "
=
# $
$num
% &
;
& '
int
 

totalFiles
 "
=
# $
$num
% &
;
& '
string
 
largestGame
 &
=
' (
string
) /
.
/ 0
Empty
0 5
;
5 6
int
กก "
largestGameFileCount
กก ,
=
กก- .
$num
กก/ 0
;
กก0 1
var
ขข "
fileTypeDistribution
ขข ,
=
ขข- .
new
ขข/ 2

Dictionary
ขข3 =
<
ขข= >
string
ขข> D
,
ขขD E
int
ขขF I
>
ขขI J
(
ขขJ K
)
ขขK L
;
ขขL M
foreach
คค 
(
คค 
var
คค  
game
คค! %
in
คค& (
gamesWithMusic
คค) 7
)
คค7 8
{
คค9 :
cancellationToken
ฅฅ )
.
ฅฅ) **
ThrowIfCancellationRequested
ฅฅ* F
(
ฅฅF G
)
ฅฅG H
;
ฅฅH I
var
งง 

musicFiles
งง &
=
งง' (
await
งง) . 
GetMusicFilesAsync
งง/ A
(
งงA B
game
งงB F
,
งงF G
cancellationToken
งงH Y
)
งงY Z
;
งงZ [

totalFiles
จจ "
+=
จจ# %

musicFiles
จจ& 0
.
จจ0 1
Count
จจ1 6
;
จจ6 7
if
ชช 
(
ชช 

musicFiles
ชช &
.
ชช& '
Count
ชช' ,
>
ชช- ."
largestGameFileCount
ชช/ C
)
ชชC D
{
ชชE F"
largestGameFileCount
ซซ 0
=
ซซ1 2

musicFiles
ซซ3 =
.
ซซ= >
Count
ซซ> C
;
ซซC D
largestGame
ฌฌ '
=
ฌฌ( )
game
ฌฌ* .
.
ฌฌ. /
Name
ฌฌ/ 3
;
ฌฌ3 4
}
ญญ 
foreach
ฏฏ 
(
ฏฏ  !
var
ฏฏ! $
file
ฏฏ% )
in
ฏฏ* ,

musicFiles
ฏฏ- 7
)
ฏฏ7 8
{
ฏฏ9 :
try
ฐฐ 
{
ฐฐ  !
var
ฑฑ  #
fileInfo
ฑฑ$ ,
=
ฑฑ- .
new
ฑฑ/ 2
FileInfo
ฑฑ3 ;
(
ฑฑ; <
file
ฑฑ< @
)
ฑฑ@ A
;
ฑฑA B
if
ฒฒ  "
(
ฒฒ# $
fileInfo
ฒฒ$ ,
.
ฒฒ, -
Exists
ฒฒ- 3
)
ฒฒ3 4
{
ฒฒ5 6
	totalSize
ณณ$ -
+=
ณณ. 0
fileInfo
ณณ1 9
.
ณณ9 :
Length
ณณ: @
;
ณณ@ A
var
ตต$ '
	extension
ตต( 1
=
ตต2 3
fileInfo
ตต4 <
.
ตต< =
	Extension
ตต= F
.
ตตF G
ToLowerInvariant
ตตG W
(
ตตW X
)
ตตX Y
;
ตตY Z
if
ถถ$ &
(
ถถ' ("
fileTypeDistribution
ถถ( <
.
ถถ< =
ContainsKey
ถถ= H
(
ถถH I
	extension
ถถI R
)
ถถR S
)
ถถS T
{
ถถU V"
fileTypeDistribution
ทท( <
[
ทท< =
	extension
ทท= F
]
ททF G
++
ททG I
;
ททI J
}
ธธ$ %
else
นน$ (
{
นน) *"
fileTypeDistribution
บบ( <
[
บบ< =
	extension
บบ= F
]
บบF G
=
บบH I
$num
บบJ K
;
บบK L
}
ปป$ %
}
ผผ  !
}
ฝฝ 
catch
พพ !
(
พพ" #
	Exception
พพ# ,
ex
พพ- /
)
พพ/ 0
{
พพ1 2
logger
ฟฟ  &
.
ฟฟ& '
Warn
ฟฟ' +
(
ฟฟ+ ,
ex
ฟฟ, .
,
ฟฟ. /
$"
ฟฟ0 2
$str
ฟฟ2 I
{
ฟฟI J
file
ฟฟJ N
}
ฟฟN O
"
ฟฟO P
)
ฟฟP Q
;
ฟฟQ R
}
ภภ 
}
มม 
}
ยย 

statistics
ฤฤ 
.
ฤฤ 
TotalMusicFiles
ฤฤ .
=
ฤฤ/ 0

totalFiles
ฤฤ1 ;
;
ฤฤ; <

statistics
ลล 
.
ลล 
TotalSizeBytes
ลล -
=
ลล. /
	totalSize
ลล0 9
;
ลล9 :

statistics
ฦฦ 
.
ฦฦ 
LargestGame
ฦฦ *
=
ฦฦ+ ,
largestGame
ฦฦ- 8
;
ฦฦ8 9

statistics
วว 
.
วว "
LargestGameFileCount
วว 3
=
วว4 5"
largestGameFileCount
วว6 J
;
ววJ K

statistics
ศศ 
.
ศศ "
FileTypeDistribution
ศศ 3
=
ศศ4 5"
fileTypeDistribution
ศศ6 J
;
ศศJ K
logger
สส 
.
สส 
Debug
สส  
(
สส  !
$"
สส! #
$str
สส# B
{
สสB C

totalFiles
สสC M
}
สสM N
$str
สสN V
{
สสV W
	totalSize
สสW `
}
สส` a
$str
สสa g
"
สสg h
)
สสh i
;
สสi j
return
หห 

statistics
หห %
;
หห% &
}
ฬฬ 
,
ฬฬ 
cancellationToken
ฬฬ $
)
ฬฬ$ %
;
ฬฬ% &
}
ออ 
catch
ฮฮ 
(
ฮฮ (
OperationCanceledException
ฮฮ -
)
ฮฮ- .
{
ฮฮ/ 0
logger
ฯฯ 
.
ฯฯ 
Info
ฯฯ 
(
ฯฯ 
$str
ฯฯ H
)
ฯฯH I
;
ฯฯI J
throw
ะะ 
;
ะะ 
}
ัั 
catch
าา 
(
าา 
	Exception
าา 
ex
าา 
)
าา  
{
าา! "
logger
ำำ 
.
ำำ 
Error
ำำ 
(
ำำ 
ex
ำำ 
,
ำำ  
$str
ำำ! I
)
ำำI J
;
ำำJ K
return
ิิ 
new
ิิ $
MusicLibraryStatistics
ิิ 1
{
ิิ2 3
LastScanned
ิิ4 ?
=
ิิ@ A
DateTime
ิิB J
.
ิิJ K
Now
ิิK N
}
ิิO P
;
ิิP Q
}
ีี 
}
ึึ 	
public
 
async
 
Task
 
<
 
string
  
>
  !/
!EnsureMusicMetadataDirectoryAsync
" C
(
C D
Game
D H
game
I M
,
M N
CancellationToken
O `
cancellationToken
a r
=
s t
default
u |
)
| }
{
~ 
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
GameService
9 D
)
D E
)
E F
;
F G
if
฿฿ 
(
฿฿ 
game
฿฿ 
==
฿฿ 
null
฿฿ 
)
฿฿ 
return
เเ 
string
เเ 
.
เเ 
Empty
เเ #
;
เเ# $
try
โโ 
{
โโ 
cancellationToken
ใใ !
.
ใใ! "*
ThrowIfCancellationRequested
ใใ" >
(
ใใ> ?
)
ใใ? @
;
ใใ@ A
return
ๅๅ 
await
ๅๅ 
Task
ๅๅ !
.
ๅๅ! "
Run
ๅๅ" %
(
ๅๅ% &
(
ๅๅ& '
)
ๅๅ' (
=>
ๅๅ) +
{
ๅๅ, -
cancellationToken
ๆๆ %
.
ๆๆ% &*
ThrowIfCancellationRequested
ๆๆ& B
(
ๆๆB C
)
ๆๆC D
;
ๆๆD E
var
่่ 
metadataDir
่่ #
=
่่$ %
Path
่่& *
.
่่* +
Combine
่่+ 2
(
่่2 3
playniteApi
้้ #
.
้้# $
Paths
้้$ )
.
้้) *
ConfigurationPath
้้* ;
,
้้; <
$str
๊๊ '
,
๊๊' (
$str
๋๋ 
,
๋๋  
game
์์ 
.
์์ 
Id
์์ 
.
์์  
ToString
์์  (
(
์์( )
)
์์) *
,
์์* +
$str
ํํ %
)
๎๎ 
;
๎๎ 
if
๐๐ 
(
๐๐ 
!
๐๐ 
	Directory
๐๐ "
.
๐๐" #
Exists
๐๐# )
(
๐๐) *
metadataDir
๐๐* 5
)
๐๐5 6
)
๐๐6 7
{
๐๐8 9
	Directory
๑๑ !
.
๑๑! "
CreateDirectory
๑๑" 1
(
๑๑1 2
metadataDir
๑๑2 =
)
๑๑= >
;
๑๑> ?
logger
๒๒ 
.
๒๒ 
Debug
๒๒ $
(
๒๒$ %
$"
๒๒% '
$str
๒๒' L
{
๒๒L M
game
๒๒M Q
.
๒๒Q R
Name
๒๒R V
}
๒๒V W
"
๒๒W X
)
๒๒X Y
;
๒๒Y Z
}
๓๓ 
return
๕๕ 
metadataDir
๕๕ &
;
๕๕& '
}
๖๖ 
,
๖๖ 
cancellationToken
๖๖ $
)
๖๖$ %
;
๖๖% &
}
๗๗ 
catch
๘๘ 
(
๘๘ (
OperationCanceledException
๘๘ -
)
๘๘- .
{
๘๘/ 0
logger
๙๙ 
.
๙๙ 
Info
๙๙ 
(
๙๙ 
$"
๙๙ 
$str
๙๙ L
{
๙๙L M
game
๙๙M Q
.
๙๙Q R
Name
๙๙R V
}
๙๙V W
"
๙๙W X
)
๙๙X Y
;
๙๙Y Z
throw
๚๚ 
;
๚๚ 
}
๛๛ 
catch
 
(
 
	Exception
 
ex
 
)
  
{
! "
logger
 
.
 
Error
 
(
 
ex
 
,
  
$"
! #
$str
# Q
{
Q R
game
R V
.
V W
Name
W [
}
[ \
"
\ ]
)
] ^
;
^ _
return
 
string
 
.
 
Empty
 #
;
# $
}
 
}
 	
public
 
async
 
Task
 
<
 
bool
 
>
 $
HasCachedMetadataAsync
  6
(
6 7
Game
7 ;
game
< @
,
@ A
CancellationToken
B S
cancellationToken
T e
=
f g
default
h o
)
o p
{
q r
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
GameService
9 D
)
D E
)
E F
;
F G
if
 
(
 
game
 
==
 
null
 
)
 
return
 
false
 
;
 
try
 
{
 
cancellationToken
 !
.
! "*
ThrowIfCancellationRequested
" >
(
> ?
)
? @
;
@ A
return
 
await
 
Task
 !
.
! "
Run
" %
(
% &
(
& '
)
' (
=>
) +
{
, -
cancellationToken
 %
.
% &*
ThrowIfCancellationRequested
& B
(
B C
)
C D
;
D E
var
 
metadataDir
 #
=
$ %
Path
& *
.
* +
Combine
+ 2
(
2 3
playniteApi
 #
.
# $
Paths
$ )
.
) *
ConfigurationPath
* ;
,
; <
$str
 '
,
' (
$str
 
,
  
game
 
.
 
Id
 
.
  
ToString
  (
(
( )
)
) *
,
* +
$str
 %
)
 
;
 
return
 
	Directory
 $
.
$ %
Exists
% +
(
+ ,
metadataDir
, 7
)
7 8
&&
9 ;
	Directory
 $
.
$ %
GetFiles
% -
(
- .
metadataDir
. 9
,
9 :
$str
; C
)
C D
.
D E
Length
E K
>
L M
$num
N O
;
O P
}
 
,
 
cancellationToken
 $
)
$ %
;
% &
}
 
catch
 
(
 (
OperationCanceledException
 -
)
- .
{
/ 0
logger
 
.
 
Info
 
(
 
$"
 
$str
 H
{
H I
game
I M
.
M N
Name
N R
}
R S
"
S T
)
T U
;
U V
throw
 
;
 
}
กก 
catch
ขข 
(
ขข 
	Exception
ขข 
ex
ขข 
)
ขข  
{
ขข! "
logger
ฃฃ 
.
ฃฃ 
Error
ฃฃ 
(
ฃฃ 
ex
ฃฃ 
,
ฃฃ  
$"
ฃฃ! #
$str
ฃฃ# M
{
ฃฃM N
game
ฃฃN R
.
ฃฃR S
Name
ฃฃS W
}
ฃฃW X
"
ฃฃX Y
)
ฃฃY Z
;
ฃฃZ [
return
คค 
false
คค 
;
คค 
}
ฅฅ 
}
ฆฆ 	
public
ซซ 
async
ซซ 
Task
ซซ *
CleanupOrphanedMetadataAsync
ซซ 6
(
ซซ6 7
CancellationToken
ซซ7 H
cancellationToken
ซซI Z
=
ซซ[ \
default
ซซ] d
)
ซซd e
{
ซซf g
if
ฌฌ 
(
ฌฌ 
disposed
ฌฌ 
)
ฌฌ 
throw
ญญ 
new
ญญ %
ObjectDisposedException
ญญ 1
(
ญญ1 2
nameof
ญญ2 8
(
ญญ8 9
GameService
ญญ9 D
)
ญญD E
)
ญญE F
;
ญญF G
try
ฏฏ 
{
ฏฏ 
cancellationToken
ฐฐ !
.
ฐฐ! "*
ThrowIfCancellationRequested
ฐฐ" >
(
ฐฐ> ?
)
ฐฐ? @
;
ฐฐ@ A
logger
ฒฒ 
.
ฒฒ 
Info
ฒฒ 
(
ฒฒ 
$str
ฒฒ L
)
ฒฒL M
;
ฒฒM N
await
ดด 
Task
ดด 
.
ดด 
Run
ดด 
(
ดด 
(
ดด  
)
ดด  !
=>
ดด" $
{
ดด% &
cancellationToken
ตต %
.
ตต% &*
ThrowIfCancellationRequested
ตต& B
(
ตตB C
)
ตตC D
;
ตตD E
var
ทท 
metadataBaseDir
ทท '
=
ทท( )
Path
ทท* .
.
ทท. /
Combine
ทท/ 6
(
ทท6 7
playniteApi
ธธ #
.
ธธ# $
Paths
ธธ$ )
.
ธธ) *
ConfigurationPath
ธธ* ;
,
ธธ; <
$str
นน '
,
นน' (
$str
บบ 
)
ปป 
;
ปป 
if
ฝฝ 
(
ฝฝ 
!
ฝฝ 
	Directory
ฝฝ "
.
ฝฝ" #
Exists
ฝฝ# )
(
ฝฝ) *
metadataBaseDir
ฝฝ* 9
)
ฝฝ9 :
)
ฝฝ: ;
return
พพ 
;
พพ 
var
ภภ 

allGameIds
ภภ "
=
ภภ# $
playniteApi
ภภ% 0
.
ภภ0 1
Database
ภภ1 9
.
ภภ9 :
Games
ภภ: ?
.
ภภ? @
Select
ภภ@ F
(
ภภF G
g
ภภG H
=>
ภภI K
g
ภภL M
.
ภภM N
Id
ภภN P
.
ภภP Q
ToString
ภภQ Y
(
ภภY Z
)
ภภZ [
)
ภภ[ \
.
ภภ\ ]
	ToHashSet
ภภ] f
(
ภภf g
)
ภภg h
;
ภภh i
var
มม 
orphanedDirs
มม $
=
มม% &
new
มม' *
List
มม+ /
<
มม/ 0
string
มม0 6
>
มม6 7
(
มม7 8
)
มม8 9
;
มม9 :
foreach
รร 
(
รร 
var
รร  
gameDir
รร! (
in
รร) +
	Directory
รร, 5
.
รร5 6
GetDirectories
รร6 D
(
รรD E
metadataBaseDir
รรE T
)
รรT U
)
รรU V
{
รรW X
cancellationToken
ฤฤ )
.
ฤฤ) **
ThrowIfCancellationRequested
ฤฤ* F
(
ฤฤF G
)
ฤฤG H
;
ฤฤH I
var
ฦฦ 
gameId
ฦฦ "
=
ฦฦ# $
Path
ฦฦ% )
.
ฦฦ) *
GetFileName
ฦฦ* 5
(
ฦฦ5 6
gameDir
ฦฦ6 =
)
ฦฦ= >
;
ฦฦ> ?
if
วว 
(
วว 
!
วว 

allGameIds
วว '
.
วว' (
Contains
วว( 0
(
วว0 1
gameId
วว1 7
)
วว7 8
)
วว8 9
{
วว: ;
orphanedDirs
ศศ (
.
ศศ( )
Add
ศศ) ,
(
ศศ, -
gameDir
ศศ- 4
)
ศศ4 5
;
ศศ5 6
}
ษษ 
}
สส 
foreach
ฬฬ 
(
ฬฬ 
var
ฬฬ  
orphanedDir
ฬฬ! ,
in
ฬฬ- /
orphanedDirs
ฬฬ0 <
)
ฬฬ< =
{
ฬฬ> ?
try
ออ 
{
ออ 
	Directory
ฮฮ %
.
ฮฮ% &
Delete
ฮฮ& ,
(
ฮฮ, -
orphanedDir
ฮฮ- 8
,
ฮฮ8 9
true
ฮฮ: >
)
ฮฮ> ?
;
ฮฮ? @
logger
ฯฯ "
.
ฯฯ" #
Debug
ฯฯ# (
(
ฯฯ( )
$"
ฯฯ) +
$str
ฯฯ+ P
{
ฯฯP Q
orphanedDir
ฯฯQ \
}
ฯฯ\ ]
"
ฯฯ] ^
)
ฯฯ^ _
;
ฯฯ_ `
}
ะะ 
catch
ัั 
(
ัั 
	Exception
ัั (
ex
ัั) +
)
ัั+ ,
{
ัั- .
logger
าา "
.
าา" #
Warn
าา# '
(
าา' (
ex
าา( *
,
าา* +
$"
าา, .
$str
าา. S
{
าาS T
orphanedDir
าาT _
}
าา_ `
"
าา` a
)
าาa b
;
าาb c
}
ำำ 
}
ิิ 
logger
ึึ 
.
ึึ 
Info
ึึ 
(
ึึ  
$"
ึึ  "
$str
ึึ" =
{
ึึ= >
orphanedDirs
ึึ> J
.
ึึJ K
Count
ึึK P
}
ึึP Q
$str
ึึQ f
"
ึึf g
)
ึึg h
;
ึึh i
}
ืื 
,
ืื 
cancellationToken
ืื $
)
ืื$ %
;
ืื% &
}
ุุ 
catch
ูู 
(
ูู (
OperationCanceledException
ูู -
)
ูู- .
{
ูู/ 0
logger
ฺฺ 
.
ฺฺ 
Info
ฺฺ 
(
ฺฺ 
$str
ฺฺ K
)
ฺฺK L
;
ฺฺL M
throw
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
! "
logger
 
.
 
Error
 
(
 
ex
 
,
  
$str
! F
)
F G
;
G H
throw
฿฿ 
;
฿฿ 
}
เเ 
}
แแ 	
public
ๆๆ 
void
ๆๆ 
	Configure
ๆๆ 
(
ๆๆ 
OstPlayerSettings
ๆๆ /
settings
ๆๆ0 8
)
ๆๆ8 9
{
ๆๆ: ;
if
็็ 
(
็็ 
disposed
็็ 
)
็็ 
throw
่่ 
new
่่ %
ObjectDisposedException
่่ 1
(
่่1 2
nameof
่่2 8
(
่่8 9
GameService
่่9 D
)
่่D E
)
่่E F
;
่่F G
try
๊๊ 
{
๊๊ 
logger
๋๋ 
.
๋๋ 
Info
๋๋ 
(
๋๋ 
$str
๋๋ J
)
๋๋J K
;
๋๋K L
if
๎๎ 
(
๎๎ 
settings
๎๎ 
!=
๎๎ 
null
๎๎  $
)
๎๎$ %
{
๎๎& '"
cachedGamesWithMusic
๐๐ (
=
๐๐) *
null
๐๐+ /
;
๐๐/ 0
lastGameScanTime
๑๑ $
=
๑๑% &
DateTime
๑๑' /
.
๑๑/ 0
MinValue
๑๑0 8
;
๑๑8 9
}
๒๒ 
logger
๔๔ 
.
๔๔ 
Info
๔๔ 
(
๔๔ 
$str
๔๔ L
)
๔๔L M
;
๔๔M N
}
๕๕ 
catch
๖๖ 
(
๖๖ 
	Exception
๖๖ 
ex
๖๖ 
)
๖๖  
{
๖๖! "
logger
๗๗ 
.
๗๗ 
Error
๗๗ 
(
๗๗ 
ex
๗๗ 
,
๗๗  
$str
๗๗! @
)
๗๗@ A
;
๗๗A B
throw
๘๘ 
;
๘๘ 
}
๙๙ 
}
๚๚ 	
public
 
async
 
Task
 
<
 !
ServiceHealthStatus
 -
>
- .
CheckHealthAsync
/ ?
(
? @
CancellationToken
@ Q
cancellationToken
R c
=
d e
default
f m
)
m n
{
o p
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
GameService
9 D
)
D E
)
E F
;
F G
var
 
healthStatus
 
=
 
new
 "!
ServiceHealthStatus
# 6
{
7 8
	IsHealthy
 
=
 
true
  
,
  !
Status
 
=
 
$str
 "
,
" #
Details
 
=
 
new
 

Dictionary
 (
<
( )
string
) /
,
/ 0
string
1 7
>
7 8
(
8 9
)
9 :
}
 
;
 
try
 
{
 
var
 
	startTime
 
=
 
DateTime
  (
.
( )
UtcNow
) /
;
/ 0
try
 
{
 
var
 
	gameCount
 !
=
" #
playniteApi
$ /
.
/ 0
Database
0 8
.
8 9
Games
9 >
.
> ?
Count
? D
;
D E
healthStatus
  
.
  !
Details
! (
[
( )
$str
) 5
]
5 6
=
7 8
	gameCount
9 B
.
B C
ToString
C K
(
K L
)
L M
;
M N
var
 
gamesWithMusic
 &
=
' (
await
) .$
GetGamesWithMusicAsync
/ E
(
E F
cancellationToken
F W
)
W X
;
X Y
healthStatus
  
.
  !
Details
! (
[
( )
$str
) 9
]
9 :
=
; <
gamesWithMusic
= K
.
K L
Count
L Q
.
Q R
ToString
R Z
(
Z [
)
[ \
;
\ ]
}
 
catch
 
(
 
	Exception
  
ex
! #
)
# $
{
% &
healthStatus
  
.
  !
Details
! (
[
( )
$str
) 6
]
6 7
=
8 9
$"
: <
$str
< C
{
C D
ex
D F
.
F G
Message
G N
}
N O
"
O P
;
P Q
healthStatus
  
.
  !
	IsHealthy
! *
=
+ ,
false
- 2
;
2 3
}
 
try
 
{
 
var
 

configPath
 "
=
# $
playniteApi
% 0
.
0 1
Paths
1 6
.
6 7
ConfigurationPath
7 H
;
H I
var
 
	canAccess
 !
=
" #
	Directory
$ -
.
- .
Exists
. 4
(
4 5

configPath
5 ?
)
? @
;
@ A
healthStatus
  
.
  !
Details
! (
[
( )
$str
) ;
]
; <
=
= >
	canAccess
? H
?
I J
$str
K V
:
W X
$str
Y f
;
f g
if
 
(
 
!
 
	canAccess
 "
)
" #
{
$ %
healthStatus
 $
.
$ %
	IsHealthy
% .
=
/ 0
false
1 6
;
6 7
}
กก 
}
ขข 
catch
ฃฃ 
(
ฃฃ 
	Exception
ฃฃ  
ex
ฃฃ! #
)
ฃฃ# $
{
ฃฃ% &
healthStatus
คค  
.
คค  !
Details
คค! (
[
คค( )
$str
คค) ;
]
คค; <
=
คค= >
$"
คค? A
$str
คคA H
{
คคH I
ex
คคI K
.
คคK L
Message
คคL S
}
คคS T
"
คคT U
;
คคU V
healthStatus
ฅฅ  
.
ฅฅ  !
	IsHealthy
ฅฅ! *
=
ฅฅ+ ,
false
ฅฅ- 2
;
ฅฅ2 3
}
ฆฆ 
healthStatus
จจ 
.
จจ 
ResponseTime
จจ )
=
จจ* +
DateTime
จจ, 4
.
จจ4 5
UtcNow
จจ5 ;
-
จจ< =
	startTime
จจ> G
;
จจG H
if
ชช 
(
ชช 
!
ชช 
healthStatus
ชช !
.
ชช! "
	IsHealthy
ชช" +
)
ชช+ ,
{
ชช- .
healthStatus
ซซ  
.
ซซ  !
Status
ซซ! '
=
ซซ( )
$str
ซซ* 4
;
ซซ4 5
}
ฌฌ 
}
ญญ 
catch
ฎฎ 
(
ฎฎ 
	Exception
ฎฎ 
ex
ฎฎ 
)
ฎฎ  
{
ฎฎ! "
healthStatus
ฏฏ 
.
ฏฏ 
	IsHealthy
ฏฏ &
=
ฏฏ' (
false
ฏฏ) .
;
ฏฏ. /
healthStatus
ฐฐ 
.
ฐฐ 
Status
ฐฐ #
=
ฐฐ$ %
$str
ฐฐ& 1
;
ฐฐ1 2
healthStatus
ฑฑ 
.
ฑฑ 
Details
ฑฑ $
[
ฑฑ$ %
$str
ฑฑ% ,
]
ฑฑ, -
=
ฑฑ. /
ex
ฑฑ0 2
.
ฑฑ2 3
Message
ฑฑ3 :
;
ฑฑ: ;
}
ฒฒ 
return
ดด 
healthStatus
ดด 
;
ดด  
}
ตต 	
public
ทท 
void
ทท 
Dispose
ทท 
(
ทท 
)
ทท 
{
ทท 
Dispose
ธธ 
(
ธธ 
true
ธธ 
)
ธธ 
;
ธธ 
GC
นน 
.
นน 
SuppressFinalize
นน 
(
นน  
this
นน  $
)
นน$ %
;
นน% &
}
บบ 	
	protected
ผผ 
virtual
ผผ 
void
ผผ 
Dispose
ผผ &
(
ผผ& '
bool
ผผ' +
	disposing
ผผ, 5
)
ผผ5 6
{
ผผ7 8
if
ฝฝ 
(
ฝฝ 
!
ฝฝ 
disposed
ฝฝ 
&&
ฝฝ 
	disposing
ฝฝ &
)
ฝฝ& '
{
ฝฝ( )
try
พพ 
{
พพ 
logger
ฟฟ 
.
ฟฟ 
Info
ฟฟ 
(
ฟฟ  
$str
ฟฟ  :
)
ฟฟ: ;
;
ฟฟ; <"
cachedGamesWithMusic
ยย (
=
ยย) *
null
ยย+ /
;
ยย/ 0
logger
ฤฤ 
.
ฤฤ 
Info
ฤฤ 
(
ฤฤ  
$str
ฤฤ  C
)
ฤฤC D
;
ฤฤD E
}
ลล 
catch
ฦฦ 
(
ฦฦ 
	Exception
ฦฦ  
ex
ฦฦ! #
)
ฦฦ# $
{
ฦฦ% &
logger
วว 
.
วว 
Error
วว  
(
วว  !
ex
วว! #
,
วว# $
$str
วว% B
)
ววB C
;
ววC D
}
ศศ 
finally
ษษ 
{
ษษ 
disposed
สส 
=
สส 
true
สส #
;
สส# $
}
หห 
}
ฬฬ 
}
ออ 	
}
ฮฮ 
}ฯฯ <
EC:\Playnite\_github\OstPlayer\source\Services\ErrorHandlingService.cs
	namespaceii 	
	OstPlayerii
 
.ii 
Servicesii 
{ii 
publicjj 

classjj  
ErrorHandlingServicejj %
{jj& '
privatekk 
readonlykk 
ILoggerkk  
loggerkk! '
;kk' (
publicmm  
ErrorHandlingServicemm #
(mm# $
)mm$ %
{mm& '
loggernn 
=nn 

LogManagernn 
.nn  
	GetLoggernn  )
(nn) *
)nn* +
;nn+ ,
}oo 	
publictt 
voidtt 
HandlePlaybackErrortt '
(tt' (
	Exceptiontt( 1
extt2 4
,tt4 5
stringtt6 <
filePathtt= E
)ttE F
{ttG H
loggeruu 
.uu 
Erroruu 
(uu 
exuu 
,uu 
$"uu 
$struu 8
{uu8 9
filePathuu9 A
}uuA B
"uuB C
)uuC D
;uuD E
stringww 
userMessageww 
;ww 
ifxx 
(xx 
exxx 
isxx '
UnauthorizedAccessExceptionxx 1
)xx1 2
{xx3 4
userMessageyy 
=yy 
$stryy U
;yyU V
}zz 
else{{ 
if{{ 
({{ 
ex{{ 
is{{ !
FileNotFoundException{{ 0
){{0 1
{{{2 3
userMessage|| 
=|| 
$str|| ^
;||^ _
}}} 
else~~ 
if~~ 
(~~ 
ex~~ 
is~~  
InvalidDataException~~ /
)~~/ 0
{~~1 2
userMessage 
= 
$str c
;c d
}
 
else
 
if
 
(
 
ex
 
.
 
GetType
 
(
  
)
  !
.
! "
Name
" &
.
& '
Contains
' /
(
/ 0
$str
0 A
)
A B
)
B C
{
D E
userMessage
 
=
 
$str
 S
;
S T
}
 
else
 
{
 
userMessage
 
=
 
$"
  
$str
  G
{
G H
ex
H J
.
J K
Message
K R
}
R S
"
S T
;
T U
}
 
	ShowError
 
(
 
$str
 &
,
& '
userMessage
( 3
)
3 4
;
4 5
}
 	
public
 
void
 !
HandleMetadataError
 '
(
' (
	Exception
( 1
ex
2 4
,
4 5
string
6 <
filePath
= E
)
E F
{
G H
logger
 
.
 
Warn
 
(
 
ex
 
,
 
$"
 
$str
 @
{
@ A
filePath
A I
}
I J
"
J K
)
K L
;
L M
}
 	
public
 
void
  
HandleNetworkError
 &
(
& '
	Exception
' 0
ex
1 3
,
3 4
string
5 ;
	operation
< E
)
E F
{
G H
logger
 
.
 
Error
 
(
 
ex
 
,
 
$"
 
$str
 5
{
5 6
	operation
6 ?
}
? @
"
@ A
)
A B
;
B C
string
 
userMessage
 
;
 
if
 
(
 
ex
 
.
 
GetType
 
(
 
)
 
.
 
Name
 !
.
! "
Contains
" *
(
* +
$str
+ 8
)
8 9
)
9 :
{
; <
userMessage
 
=
 
$str
 Y
;
Y Z
}
 
else
 
if
 
(
 
ex
 
is
 #
TaskCanceledException
 0
)
0 1
{
2 3
userMessage
 
=
 
$str
 H
;
H I
}
กก 
else
ขข 
{
ขข 
userMessage
ฃฃ 
=
ฃฃ 
$"
ฃฃ  
$str
ฃฃ  5
{
ฃฃ5 6
	operation
ฃฃ6 ?
}
ฃฃ? @
$str
ฃฃ@ B
{
ฃฃB C
ex
ฃฃC E
.
ฃฃE F
Message
ฃฃF M
}
ฃฃM N
"
ฃฃN O
;
ฃฃO P
}
คค 
	ShowError
ฆฆ 
(
ฆฆ 
$str
ฆฆ %
,
ฆฆ% &
userMessage
ฆฆ' 2
)
ฆฆ2 3
;
ฆฆ3 4
}
งง 	
private
ฌฌ 
void
ฌฌ 
	ShowError
ฌฌ 
(
ฌฌ 
string
ฌฌ %
title
ฌฌ& +
,
ฌฌ+ ,
string
ฌฌ- 3
message
ฌฌ4 ;
)
ฌฌ; <
{
ฌฌ= >
try
ญญ 
{
ญญ 

MessageBox
ฎฎ 
.
ฎฎ 
Show
ฎฎ 
(
ฎฎ  
message
ฎฎ  '
,
ฎฎ' (
title
ฎฎ) .
,
ฎฎ. /
MessageBoxButton
ฎฎ0 @
.
ฎฎ@ A
OK
ฎฎA C
,
ฎฎC D
MessageBoxImage
ฎฎE T
.
ฎฎT U
Error
ฎฎU Z
)
ฎฎZ [
;
ฎฎ[ \
}
ฏฏ 
catch
ฐฐ 
(
ฐฐ 
	Exception
ฐฐ 
ex
ฐฐ 
)
ฐฐ  
{
ฐฐ! "
logger
ฒฒ 
.
ฒฒ 
Error
ฒฒ 
(
ฒฒ 
ex
ฒฒ 
,
ฒฒ  
$str
ฒฒ! G
)
ฒฒG H
;
ฒฒH I
}
ณณ 
}
ดด 	
public
นน 
void
นน 
ShowWarning
นน 
(
นน  
string
นน  &
title
นน' ,
,
นน, -
string
นน. 4
message
นน5 <
)
นน< =
{
นน> ?
try
บบ 
{
บบ 

MessageBox
ปป 
.
ปป 
Show
ปป 
(
ปป  
message
ปป  '
,
ปป' (
title
ปป) .
,
ปป. /
MessageBoxButton
ปป0 @
.
ปป@ A
OK
ปปA C
,
ปปC D
MessageBoxImage
ปปE T
.
ปปT U
Warning
ปปU \
)
ปป\ ]
;
ปป] ^
}
ผผ 
catch
ฝฝ 
(
ฝฝ 
	Exception
ฝฝ 
ex
ฝฝ 
)
ฝฝ  
{
ฝฝ! "
logger
พพ 
.
พพ 
Error
พพ 
(
พพ 
ex
พพ 
,
พพ  
$str
พพ! I
)
พพI J
;
พพJ K
}
ฟฟ 
}
ภภ 	
public
ลล 
void
ลล 
ShowInfo
ลล 
(
ลล 
string
ลล #
title
ลล$ )
,
ลล) *
string
ลล+ 1
message
ลล2 9
)
ลล9 :
{
ลล; <
try
ฦฦ 
{
ฦฦ 

MessageBox
วว 
.
วว 
Show
วว 
(
วว  
message
วว  '
,
วว' (
title
วว) .
,
วว. /
MessageBoxButton
วว0 @
.
วว@ A
OK
ววA C
,
ววC D
MessageBoxImage
ววE T
.
ววT U
Information
ววU `
)
วว` a
;
ววa b
}
ศศ 
catch
ษษ 
(
ษษ 
	Exception
ษษ 
ex
ษษ 
)
ษษ  
{
ษษ! "
logger
สส 
.
สส 
Error
สส 
(
สส 
ex
สส 
,
สส  
$str
สส! F
)
สสF G
;
สสG H
}
หห 
}
ฬฬ 	
}
ออ 
}ฮฮ Z
EC:\Playnite\_github\OstPlayer\source\Services\DiscogsClientService.cs
	namespaceNN 	
	OstPlayerNN
 
.NN 
ServicesNN 
{OO 
publicTT 

classTT  
DiscogsClientServiceTT %
:TT& '
IDiscogsClientTT( 6
,TT6 7
IDisposableTT8 C
{UU 
privateXX 
readonlyXX 
ILoggerXX  
loggerXX! '
;XX' (
privateYY 
volatileYY 
boolYY 
disposedYY &
=YY' (
falseYY) .
;YY. /
publiccc  
DiscogsClientServicecc #
(cc# $
ILoggercc$ +
loggercc, 2
=cc3 4
nullcc5 9
)cc9 :
{dd 	
thisee 
.ee 
loggeree 
=ee 
loggeree  
??ee! #

LogManageree$ .
.ee. /
	GetLoggeree/ 8
(ee8 9
)ee9 :
;ee: ;
trygg 
{hh 
thisii 
.ii 
loggerii 
.ii 
Infoii  
(ii  !
$strii! a
)iia b
;iib c
thisjj 
.jj 
loggerjj 
.jj 
Infojj  
(jj  !
$strjj! X
)jjX Y
;jjY Z
}kk 
catchll 
(ll 
	Exceptionll 
exll 
)ll  
{mm 
thisnn 
.nn 
loggernn 
.nn 
Errornn !
(nn! "
exoo 
,oo 
$strpp Y
)qq 
;qq 
throwrr 
;rr 
}ss 
}tt 	
public}} 
async}} 
Task}} 
<}} 
List}} 
<}}  
DiscogsMetadataModel}} 3
>}}3 4
>}}4 5
SearchReleaseAsync}}6 H
(}}H I
string~~ 
query~~ 
,~~ 
string 
token 
, 
CancellationToken
 
cancellationToken
 /
=
0 1
default
2 9
)
 	
{
 	
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9"
DiscogsClientService
9 M
)
M N
)
N O
;
O P
if
 
(
 
string
 
.
  
IsNullOrWhiteSpace
 )
(
) *
query
* /
)
/ 0
||
1 3
string
4 :
.
: ; 
IsNullOrWhiteSpace
; M
(
M N
token
N S
)
S T
)
T U
{
 
logger
 
.
 
Warn
 
(
 
$str
 V
)
V W
;
W X
return
 
new
 
List
 
<
  "
DiscogsMetadataModel
  4
>
4 5
(
5 6
)
6 7
;
7 8
}
 
try
 
{
 
cancellationToken
 !
.
! "*
ThrowIfCancellationRequested
" >
(
> ?
)
? @
;
@ A
logger
 
.
 
Debug
 
(
 
$"
 
$str
 6
{
6 7
query
7 <
}
< =
"
= >
)
> ?
;
? @
var
 
results
 
=
 
await
 #
DiscogsClient
$ 1
.
1 2 
SearchReleaseAsync
2 D
(
D E
query
E J
,
J K
token
L Q
)
Q R
;
R S
logger
 
.
 
Debug
 
(
 
$"
 
$str
 7
{
7 8
results
8 ?
.
? @
Count
@ E
}
E F
$str
F T
{
T U
query
U Z
}
Z [
"
[ \
)
\ ]
;
] ^
return
 
results
 
;
 
}
 
catch
 
(
 (
OperationCanceledException
 -
)
- .
{
 
logger
 
.
 
Info
 
(
 
$"
 
$str
 <
{
< =
query
= B
}
B C
"
C D
)
D E
;
E F
throw
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
logger
 
.
 
Error
 
(
 
ex
 
,
  
$"
! #
$str
# A
{
A B
query
B G
}
G H
"
H I
)
I J
;
J K
return
 
new
 
List
 
<
  "
DiscogsMetadataModel
  4
>
4 5
(
5 6
)
6 7
;
7 8
}
กก 
}
ขข 	
public
งง 
async
งง 
Task
งง 
<
งง "
DiscogsMetadataModel
งง .
>
งง. /$
GetReleaseDetailsAsync
งง0 F
(
งงF G
string
จจ 
	releaseId
จจ 
,
จจ 
string
ฉฉ 
token
ฉฉ 
,
ฉฉ 
CancellationToken
ชช 
cancellationToken
ชช /
=
ชช0 1
default
ชช2 9
)
ซซ 	
{
ฌฌ 	
if
ญญ 
(
ญญ 
disposed
ญญ 
)
ญญ 
throw
ฎฎ 
new
ฎฎ %
ObjectDisposedException
ฎฎ 1
(
ฎฎ1 2
nameof
ฎฎ2 8
(
ฎฎ8 9"
DiscogsClientService
ฎฎ9 M
)
ฎฎM N
)
ฎฎN O
;
ฎฎO P
if
ฐฐ 
(
ฐฐ 
string
ฐฐ 
.
ฐฐ  
IsNullOrWhiteSpace
ฐฐ )
(
ฐฐ) *
	releaseId
ฐฐ* 3
)
ฐฐ3 4
||
ฐฐ5 7
string
ฐฐ8 >
.
ฐฐ> ? 
IsNullOrWhiteSpace
ฐฐ? Q
(
ฐฐQ R
token
ฐฐR W
)
ฐฐW X
)
ฐฐX Y
{
ฑฑ 
logger
ฒฒ 
.
ฒฒ 
Warn
ฒฒ 
(
ฒฒ 
$str
ฒฒ ^
)
ฒฒ^ _
;
ฒฒ_ `
return
ณณ 
null
ณณ 
;
ณณ 
}
ดด 
try
ถถ 
{
ทท 
cancellationToken
ธธ !
.
ธธ! "*
ThrowIfCancellationRequested
ธธ" >
(
ธธ> ?
)
ธธ? @
;
ธธ@ A
logger
บบ 
.
บบ 
Debug
บบ 
(
บบ 
$"
บบ 
$str
บบ G
{
บบG H
	releaseId
บบH Q
}
บบQ R
"
บบR S
)
บบS T
;
บบT U
var
ฝฝ 
details
ฝฝ 
=
ฝฝ 
await
ฝฝ #
DiscogsClient
ฝฝ$ 1
.
ฝฝ1 2$
GetReleaseDetailsAsync
ฝฝ2 H
(
ฝฝH I
	releaseId
ฝฝI R
,
ฝฝR S
token
ฝฝT Y
)
ฝฝY Z
;
ฝฝZ [
logger
ฟฟ 
.
ฟฟ 
Debug
ฟฟ 
(
ฟฟ 
$"
ฟฟ 
$str
ฟฟ I
{
ฟฟI J
	releaseId
ฟฟJ S
}
ฟฟS T
"
ฟฟT U
)
ฟฟU V
;
ฟฟV W
return
ภภ 
details
ภภ 
;
ภภ 
}
มม 
catch
ยย 
(
ยย (
OperationCanceledException
ยย -
)
ยย- .
{
รร 
logger
ฤฤ 
.
ฤฤ 
Info
ฤฤ 
(
ฤฤ 
$"
ฤฤ 
$str
ฤฤ H
{
ฤฤH I
	releaseId
ฤฤI R
}
ฤฤR S
"
ฤฤS T
)
ฤฤT U
;
ฤฤU V
throw
ลล 
;
ลล 
}
ฦฦ 
catch
วว 
(
วว 
	Exception
วว 
ex
วว 
)
วว  
{
ศศ 
logger
ษษ 
.
ษษ 
Error
ษษ 
(
ษษ 
ex
ษษ 
,
ษษ  
$"
ษษ! #
$str
ษษ# Q
{
ษษQ R
	releaseId
ษษR [
}
ษษ[ \
"
ษษ\ ]
)
ษษ] ^
;
ษษ^ _
return
สส 
null
สส 
;
สส 
}
หห 
}
ฬฬ 	
public
ัั 
async
ัั 
Task
ัั 
<
ัั 
bool
ัั 
>
ัั 
CheckHealthAsync
ัั  0
(
ัั0 1
CancellationToken
ัั1 B
cancellationToken
ััC T
=
ััU V
default
ััW ^
)
ัั^ _
{
าา 	
if
ำำ 
(
ำำ 
disposed
ำำ 
)
ำำ 
return
ิิ 
false
ิิ 
;
ิิ 
try
ึึ 
{
ืื 
cancellationToken
ุุ !
.
ุุ! "*
ThrowIfCancellationRequested
ุุ" >
(
ุุ> ?
)
ุุ? @
;
ุุ@ A
logger
ฺฺ 
.
ฺฺ 
Debug
ฺฺ 
(
ฺฺ 
$str
ฺฺ E
)
ฺฺE F
;
ฺฺF G
await
 
Task
 
.
 
Delay
  
(
  !
$num
! $
,
$ %
cancellationToken
& 7
)
7 8
;
8 9
logger
เเ 
.
เเ 
Debug
เเ 
(
เเ 
$str
เเ N
)
เเN O
;
เเO P
return
แแ 
true
แแ 
;
แแ 
}
โโ 
catch
ใใ 
(
ใใ (
OperationCanceledException
ใใ -
)
ใใ- .
{
ไไ 
logger
ๅๅ 
.
ๅๅ 
Info
ๅๅ 
(
ๅๅ 
$str
ๅๅ F
)
ๅๅF G
;
ๅๅG H
throw
ๆๆ 
;
ๆๆ 
}
็็ 
catch
่่ 
(
่่ 
	Exception
่่ 
ex
่่ 
)
่่  
{
้้ 
logger
๊๊ 
.
๊๊ 
Error
๊๊ 
(
๊๊ 
ex
๊๊ 
,
๊๊  
$str
๊๊! B
)
๊๊B C
;
๊๊C D
return
๋๋ 
false
๋๋ 
;
๋๋ 
}
์์ 
}
ํํ 	
public
๓๓ 
void
๓๓ 
Dispose
๓๓ 
(
๓๓ 
)
๓๓ 
{
๔๔ 	
Dispose
๕๕ 
(
๕๕ 
true
๕๕ 
)
๕๕ 
;
๕๕ 
GC
๖๖ 
.
๖๖ 
SuppressFinalize
๖๖ 
(
๖๖  
this
๖๖  $
)
๖๖$ %
;
๖๖% &
}
๗๗ 	
	protected
๙๙ 
virtual
๙๙ 
void
๙๙ 
Dispose
๙๙ &
(
๙๙& '
bool
๙๙' +
	disposing
๙๙, 5
)
๙๙5 6
{
๚๚ 	
if
๛๛ 
(
๛๛ 
!
๛๛ 
disposed
๛๛ 
&&
๛๛ 
	disposing
๛๛ &
)
๛๛& '
{
 
try
 
{
 
logger
 
.
 
Info
 
(
  
$str
  C
)
C D
;
D E
logger
 
.
 
Info
 
(
  
$str
  L
)
L M
;
M N
}
 
catch
 
(
 
	Exception
  
ex
! #
)
# $
{
 
logger
 
.
 
Error
  
(
  !
ex
! #
,
# $
$str
% K
)
K L
;
L M
}
 
finally
 
{
 
disposed
 
=
 
true
 #
;
# $
}
 
}
 
}
 	
}
 
} ีุ
=C:\Playnite\_github\OstPlayer\source\Services\AudioService.cs
	namespace^^ 	
	OstPlayer^^
 
.^^ 
Services^^ 
{^^ 
publiccc 

classcc 
AudioServicecc 
:cc 
IAudioServicecc  -
,cc- .
IDisposablecc/ :
{cc; <
privateff 
readonlyff 
ILoggerff  
loggerff! '
;ff' (
privategg 
readonlygg  
ErrorHandlingServicegg -
errorHandlergg. :
;gg: ;
privatehh 
readonlyhh  
MusicPlaybackServicehh -
playbackServicehh. =
;hh= >
privateii 
volatileii 
boolii 
disposedii &
=ii' (
falseii) .
;ii. /
privatell 

AudioStatell 
currentStatell '
=ll( )

AudioStatell* 4
.ll4 5
Stoppedll5 <
;ll< =
privatemm 
doublemm 
currentVolumemm $
=mm% &
$nummm' *
;mm* +
privatenn 
doublenn 
currentPositionnn &
=nn' (
$numnn) ,
;nn, -
privateoo 
doubleoo 
currentDurationoo &
=oo' (
$numoo) ,
;oo, -
privatepp 
stringpp 
currentFilepp "
=pp# $
stringpp% +
.pp+ ,
Emptypp, 1
;pp1 2
privateqq 
boolqq 
isUserDraggingqq #
=qq$ %
falseqq& +
;qq+ ,
privatett 
readonlytt 
stringtt 
[tt  
]tt  !
supportedFormatstt" 2
=tt3 4
{tt5 6
$strtt7 =
,tt= >
$strtt? E
,ttE F
$strttG N
,ttN O
$strttP V
,ttV W
$strttX ^
}tt_ `
;tt` a
public
 
AudioService
 
(
 
ILogger
 
logger
 
=
 
null
 !
,
! ""
ErrorHandlingService
  
errorHandler
! -
=
. /
null
0 4
,
4 5"
MusicPlaybackService
  
playbackService
! 0
=
1 2
null
3 7
)
7 8
{
9 :
this
 
.
 
logger
 
=
 
logger
  
??
! #

LogManager
$ .
.
. /
	GetLogger
/ 8
(
8 9
)
9 :
;
: ;
this
 
.
 
errorHandler
 
=
 
errorHandler
  ,
??
- /
new
0 3"
ErrorHandlingService
4 H
(
H I
)
I J
;
J K
this
 
.
 
playbackService
  
=
! "
playbackService
# 2
??
3 5
new
6 9"
MusicPlaybackService
: N
(
N O
)
O P
;
P Q
try
 
{
 
this
 
.
 
logger
 
.
 
Info
  
(
  !
$str
! Y
)
Y Z
;
Z [%
InitializeEventHandlers
 '
(
' (
)
( )
;
) *
this
 
.
 
logger
 
.
 
Info
  
(
  !
$str
! P
)
P Q
;
Q R
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
! "
this
 
.
 
logger
 
.
 
Error
 !
(
! "
ex
" $
,
$ %
$str
& c
)
c d
;
d e
this
 
.
 
errorHandler
 !
.
! "!
HandlePlaybackError
" 5
(
5 6
ex
6 8
,
8 9
$str
: W
)
W X
;
X Y
throw
 
;
 
}
 
}
 	
public
 

AudioState
 
State
 
{
  !
get
 
=>
 
currentState
 
;
  
private
 
set
 
{
 
if
กก 
(
กก 
currentState
กก  
!=
กก! #
value
กก$ )
)
กก) *
{
กก+ ,
currentState
ขข  
=
ขข! "
value
ขข# (
;
ขข( )
StateChanged
ฃฃ  
?
ฃฃ  !
.
ฃฃ! "
Invoke
ฃฃ" (
(
ฃฃ( )
this
ฃฃ) -
,
ฃฃ- .
value
ฃฃ/ 4
)
ฃฃ4 5
;
ฃฃ5 6
logger
คค 
.
คค 
Debug
คค  
(
คค  !
$"
คค! #
$str
คค# ;
{
คค; <
value
คค< A
}
คคA B
"
คคB C
)
คคC D
;
คคD E
}
ฅฅ 
}
ฆฆ 
}
งง 	
public
ชช 
double
ชช 
Volume
ชช 
{
ชช 
get
ซซ 
=>
ซซ 
currentVolume
ซซ  
;
ซซ  !
set
ฌฌ 
{
ฌฌ 
var
ญญ 
clampedValue
ญญ  
=
ญญ! "
Math
ญญ# '
.
ญญ' (
Max
ญญ( +
(
ญญ+ ,
$num
ญญ, /
,
ญญ/ 0
Math
ญญ1 5
.
ญญ5 6
Min
ญญ6 9
(
ญญ9 :
$num
ญญ: =
,
ญญ= >
value
ญญ? D
)
ญญD E
)
ญญE F
;
ญญF G
if
ฎฎ 
(
ฎฎ 
Math
ฎฎ 
.
ฎฎ 
Abs
ฎฎ 
(
ฎฎ 
currentVolume
ฎฎ *
-
ฎฎ+ ,
clampedValue
ฎฎ- 9
)
ฎฎ9 :
>
ฎฎ; <
$num
ฎฎ= B
)
ฎฎB C
{
ฎฎD E
currentVolume
ฏฏ !
=
ฏฏ" #
clampedValue
ฏฏ$ 0
;
ฏฏ0 1
playbackService
ฐฐ #
?
ฐฐ# $
.
ฐฐ$ %
	SetVolume
ฐฐ% .
(
ฐฐ. /
clampedValue
ฐฐ/ ;
)
ฐฐ; <
;
ฐฐ< =
VolumeChanged
ฑฑ !
?
ฑฑ! "
.
ฑฑ" #
Invoke
ฑฑ# )
(
ฑฑ) *
this
ฑฑ* .
,
ฑฑ. /
clampedValue
ฑฑ0 <
)
ฑฑ< =
;
ฑฑ= >
logger
ฒฒ 
.
ฒฒ 
Debug
ฒฒ  
(
ฒฒ  !
$"
ฒฒ! #
$str
ฒฒ# 6
{
ฒฒ6 7
clampedValue
ฒฒ7 C
:
ฒฒC D
$str
ฒฒD F
}
ฒฒF G
"
ฒฒG H
)
ฒฒH I
;
ฒฒI J
}
ณณ 
}
ดด 
}
ตต 	
public
ธธ 
double
ธธ 
Position
ธธ 
{
ธธ  
get
นน 
=>
นน 
currentPosition
นน "
;
นน" #
set
บบ 
{
บบ 
if
ปป 
(
ปป 
!
ปป 
isUserDragging
ปป #
&&
ปป$ &
Math
ปป' +
.
ปป+ ,
Abs
ปป, /
(
ปป/ 0
currentPosition
ปป0 ?
-
ปป@ A
value
ปปB G
)
ปปG H
>
ปปI J
$num
ปปK N
)
ปปN O
{
ปปP Q
currentPosition
ผผ #
=
ผผ$ %
value
ผผ& +
;
ผผ+ ,
PositionChanged
ฝฝ #
?
ฝฝ# $
.
ฝฝ$ %
Invoke
ฝฝ% +
(
ฝฝ+ ,
this
ฝฝ, 0
,
ฝฝ0 1
value
ฝฝ2 7
)
ฝฝ7 8
;
ฝฝ8 9
}
พพ 
}
ฟฟ 
}
ภภ 	
public
รร 
double
รร 
Duration
รร 
{
รร  
get
ฤฤ 
=>
ฤฤ 
currentDuration
ฤฤ "
;
ฤฤ" #
private
ลล 
set
ลล 
{
ลล 
if
ฦฦ 
(
ฦฦ 
Math
ฦฦ 
.
ฦฦ 
Abs
ฦฦ 
(
ฦฦ 
currentDuration
ฦฦ ,
-
ฦฦ- .
value
ฦฦ/ 4
)
ฦฦ4 5
>
ฦฦ6 7
$num
ฦฦ8 ;
)
ฦฦ; <
{
ฦฦ= >
currentDuration
วว #
=
วว$ %
value
วว& +
;
วว+ ,
DurationChanged
ศศ #
?
ศศ# $
.
ศศ$ %
Invoke
ศศ% +
(
ศศ+ ,
this
ศศ, 0
,
ศศ0 1
value
ศศ2 7
)
ศศ7 8
;
ศศ8 9
logger
ษษ 
.
ษษ 
Debug
ษษ  
(
ษษ  !
$"
ษษ! #
$str
ษษ# 8
{
ษษ8 9
value
ษษ9 >
:
ษษ> ?
$str
ษษ? A
}
ษษA B
$str
ษษB J
"
ษษJ K
)
ษษK L
;
ษษL M
}
สส 
}
หห 
}
ฬฬ 	
public
ฯฯ 
string
ฯฯ 
CurrentFile
ฯฯ !
{
ฯฯ" #
get
ะะ 
=>
ะะ 
currentFile
ะะ 
;
ะะ 
private
ัั 
set
ัั 
{
ัั 
currentFile
าา 
=
าา 
value
าา #
??
าา$ &
string
าา' -
.
าา- .
Empty
าา. 3
;
าา3 4
logger
ำำ 
.
ำำ 
Debug
ำำ 
(
ำำ 
$"
ำำ 
$str
ำำ 8
{
ำำ8 9
currentFile
ำำ9 D
}
ำำD E
"
ำำE F
)
ำำF G
;
ำำG H
}
ิิ 
}
ีี 	
public
ุุ 
bool
ุุ 
IsUserDragging
ุุ "
{
ุุ# $
get
ูู 
=>
ูู 
isUserDragging
ูู !
;
ูู! "
set
ฺฺ 
{
ฺฺ 
isUserDragging
 
=
  
value
! &
;
& '
playbackService
 
?
  
.
  !
SetUserDragging
! 0
(
0 1
value
1 6
)
6 7
;
7 8
logger
 
.
 
Debug
 
(
 
$"
 
$str
 4
{
4 5
value
5 :
}
: ;
"
; <
)
< =
;
= >
}
 
}
฿฿ 	
public
่่ 
async
่่ 
Task
่่ 
	PlayAsync
่่ #
(
่่# $
string
่่$ *
filePath
่่+ 3
,
่่3 4
double
่่5 ;
?
่่; <
startPosition
่่= J
=
่่K L
null
่่M Q
,
่่Q R
CancellationToken
่่S d
cancellationToken
่่e v
=
่่w x
default่่y 
)่่ 
{่่ 
if
้้ 
(
้้ 
disposed
้้ 
)
้้ 
throw
๊๊ 
new
๊๊ %
ObjectDisposedException
๊๊ 1
(
๊๊1 2
nameof
๊๊2 8
(
๊๊8 9
AudioService
๊๊9 E
)
๊๊E F
)
๊๊F G
;
๊๊G H
if
์์ 
(
์์ 
string
์์ 
.
์์ 
IsNullOrEmpty
์์ $
(
์์$ %
filePath
์์% -
)
์์- .
)
์์. /
{
์์0 1
logger
ํํ 
.
ํํ 
Warn
ํํ 
(
ํํ 
$str
ํํ K
)
ํํK L
;
ํํL M
return
๎๎ 
;
๎๎ 
}
๏๏ 
try
๑๑ 
{
๑๑ 
cancellationToken
๒๒ !
.
๒๒! "*
ThrowIfCancellationRequested
๒๒" >
(
๒๒> ?
)
๒๒? @
;
๒๒@ A
logger
๔๔ 
.
๔๔ 
Info
๔๔ 
(
๔๔ 
$"
๔๔ 
$str
๔๔ 1
{
๔๔1 2
Path
๔๔2 6
.
๔๔6 7
GetFileName
๔๔7 B
(
๔๔B C
filePath
๔๔C K
)
๔๔K L
}
๔๔L M
"
๔๔M N
)
๔๔N O
;
๔๔O P
State
๕๕ 
=
๕๕ 

AudioState
๕๕ "
.
๕๕" #
Loading
๕๕# *
;
๕๕* +
if
๘๘ 
(
๘๘ 
!
๘๘ 
File
๘๘ 
.
๘๘ 
Exists
๘๘  
(
๘๘  !
filePath
๘๘! )
)
๘๘) *
)
๘๘* +
{
๘๘, -
throw
๙๙ 
new
๙๙ #
FileNotFoundException
๙๙ 3
(
๙๙3 4
$"
๙๙4 6
$str
๙๙6 L
{
๙๙L M
filePath
๙๙M U
}
๙๙U V
"
๙๙V W
)
๙๙W X
;
๙๙X Y
}
๚๚ 
if
 
(
 
!
 
IsFormatSupported
 &
(
& '
filePath
' /
)
/ 0
)
0 1
{
2 3
throw
 
new
 #
NotSupportedException
 3
(
3 4
$"
4 6
$str
6 R
{
R S
Path
S W
.
W X
GetExtension
X d
(
d e
filePath
e m
)
m n
}
n o
"
o p
)
p q
;
q r
}
 
await
 
	StopAsync
 
(
  
cancellationToken
  1
)
1 2
;
2 3
CurrentFile
 
=
 
filePath
 &
;
& '
await
 
playbackService
 %
.
% &
	PlayAsync
& /
(
/ 0
filePath
0 8
,
8 9
startPosition
: G
)
G H
;
H I
State
 
=
 

AudioState
 "
.
" #
Playing
# *
;
* +
logger
 
.
 
Info
 
(
 
$"
 
$str
 =
{
= >
Path
> B
.
B C
GetFileName
C N
(
N O
filePath
O W
)
W X
}
X Y
"
Y Z
)
Z [
;
[ \
}
 
catch
 
(
 (
OperationCanceledException
 -
)
- .
{
/ 0
logger
 
.
 
Info
 
(
 
$"
 
$str
 6
{
6 7
Path
7 ;
.
; <
GetFileName
< G
(
G H
filePath
H P
)
P Q
}
Q R
"
R S
)
S T
;
T U
State
 
=
 

AudioState
 "
.
" #
Stopped
# *
;
* +
throw
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
! "
logger
 
.
 
Error
 
(
 
ex
 
,
  
$"
! #
$str
# =
{
= >
Path
> B
.
B C
GetFileName
C N
(
N O
filePath
O W
)
W X
}
X Y
"
Y Z
)
Z [
;
[ \
State
 
=
 

AudioState
 "
.
" #
Error
# (
;
( )
ErrorOccurred
 
?
 
.
 
Invoke
 %
(
% &
this
& *
,
* +
ex
, .
.
. /
Message
/ 6
)
6 7
;
7 8
errorHandler
 
.
 !
HandlePlaybackError
 0
(
0 1
ex
1 3
,
3 4
filePath
5 =
)
= >
;
> ?
throw
 
;
 
}
 
}
 	
public
 
async
 
Task
 

PauseAsync
 $
(
$ %
CancellationToken
% 6
cancellationToken
7 H
=
I J
default
K R
)
R S
{
T U
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
AudioService
9 E
)
E F
)
F G
;
G H
try
กก 
{
กก 
cancellationToken
ขข !
.
ขข! "*
ThrowIfCancellationRequested
ขข" >
(
ขข> ?
)
ขข? @
;
ขข@ A
if
คค 
(
คค 
State
คค 
==
คค 

AudioState
คค '
.
คค' (
Playing
คค( /
)
คค/ 0
{
คค1 2
await
ฅฅ 
Task
ฅฅ 
.
ฅฅ 
Run
ฅฅ "
(
ฅฅ" #
(
ฅฅ# $
)
ฅฅ$ %
=>
ฅฅ& (
playbackService
ฅฅ) 8
.
ฅฅ8 9
Pause
ฅฅ9 >
(
ฅฅ> ?
)
ฅฅ? @
,
ฅฅ@ A
cancellationToken
ฅฅB S
)
ฅฅS T
;
ฅฅT U
State
ฆฆ 
=
ฆฆ 

AudioState
ฆฆ &
.
ฆฆ& '
Paused
ฆฆ' -
;
ฆฆ- .
logger
งง 
.
งง 
Info
งง 
(
งง  
$str
งง  1
)
งง1 2
;
งง2 3
}
จจ 
}
ฉฉ 
catch
ชช 
(
ชช (
OperationCanceledException
ชช -
)
ชช- .
{
ชช/ 0
logger
ซซ 
.
ซซ 
Info
ซซ 
(
ซซ 
$str
ซซ 7
)
ซซ7 8
;
ซซ8 9
throw
ฌฌ 
;
ฌฌ 
}
ญญ 
catch
ฎฎ 
(
ฎฎ 
	Exception
ฎฎ 
ex
ฎฎ 
)
ฎฎ  
{
ฎฎ! "
logger
ฏฏ 
.
ฏฏ 
Error
ฏฏ 
(
ฏฏ 
ex
ฏฏ 
,
ฏฏ  
$str
ฏฏ! ;
)
ฏฏ; <
;
ฏฏ< =
State
ฐฐ 
=
ฐฐ 

AudioState
ฐฐ "
.
ฐฐ" #
Error
ฐฐ# (
;
ฐฐ( )
ErrorOccurred
ฑฑ 
?
ฑฑ 
.
ฑฑ 
Invoke
ฑฑ %
(
ฑฑ% &
this
ฑฑ& *
,
ฑฑ* +
ex
ฑฑ, .
.
ฑฑ. /
Message
ฑฑ/ 6
)
ฑฑ6 7
;
ฑฑ7 8
throw
ฒฒ 
;
ฒฒ 
}
ณณ 
}
ดด 	
public
นน 
async
นน 
Task
นน 
ResumeAsync
นน %
(
นน% &
CancellationToken
นน& 7
cancellationToken
นน8 I
=
นนJ K
default
นนL S
)
นนS T
{
นนU V
if
บบ 
(
บบ 
disposed
บบ 
)
บบ 
throw
ปป 
new
ปป %
ObjectDisposedException
ปป 1
(
ปป1 2
nameof
ปป2 8
(
ปป8 9
AudioService
ปป9 E
)
ปปE F
)
ปปF G
;
ปปG H
try
ฝฝ 
{
ฝฝ 
cancellationToken
พพ !
.
พพ! "*
ThrowIfCancellationRequested
พพ" >
(
พพ> ?
)
พพ? @
;
พพ@ A
if
ภภ 
(
ภภ 
State
ภภ 
==
ภภ 

AudioState
ภภ '
.
ภภ' (
Paused
ภภ( .
)
ภภ. /
{
ภภ0 1
await
ยย 
Task
ยย 
.
ยย 
Run
ยย "
(
ยย" #
(
ยย# $
)
ยย$ %
=>
ยย& (
playbackService
ยย) 8
.
ยย8 9
Play
ยย9 =
(
ยย= >
CurrentFile
ยย> I
)
ยยI J
,
ยยJ K
cancellationToken
ยยL ]
)
ยย] ^
;
ยย^ _
State
รร 
=
รร 

AudioState
รร &
.
รร& '
Playing
รร' .
;
รร. /
logger
ฤฤ 
.
ฤฤ 
Info
ฤฤ 
(
ฤฤ  
$str
ฤฤ  2
)
ฤฤ2 3
;
ฤฤ3 4
}
ลล 
}
ฦฦ 
catch
วว 
(
วว (
OperationCanceledException
วว -
)
วว- .
{
วว/ 0
logger
ศศ 
.
ศศ 
Info
ศศ 
(
ศศ 
$str
ศศ 8
)
ศศ8 9
;
ศศ9 :
throw
ษษ 
;
ษษ 
}
สส 
catch
หห 
(
หห 
	Exception
หห 
ex
หห 
)
หห  
{
หห! "
logger
ฬฬ 
.
ฬฬ 
Error
ฬฬ 
(
ฬฬ 
ex
ฬฬ 
,
ฬฬ  
$str
ฬฬ! <
)
ฬฬ< =
;
ฬฬ= >
State
ออ 
=
ออ 

AudioState
ออ "
.
ออ" #
Error
ออ# (
;
ออ( )
ErrorOccurred
ฮฮ 
?
ฮฮ 
.
ฮฮ 
Invoke
ฮฮ %
(
ฮฮ% &
this
ฮฮ& *
,
ฮฮ* +
ex
ฮฮ, .
.
ฮฮ. /
Message
ฮฮ/ 6
)
ฮฮ6 7
;
ฮฮ7 8
throw
ฯฯ 
;
ฯฯ 
}
ะะ 
}
ัั 	
public
ึึ 
async
ึึ 
Task
ึึ 
	StopAsync
ึึ #
(
ึึ# $
CancellationToken
ึึ$ 5
cancellationToken
ึึ6 G
=
ึึH I
default
ึึJ Q
)
ึึQ R
{
ึึS T
if
ืื 
(
ืื 
disposed
ืื 
)
ืื 
throw
ุุ 
new
ุุ %
ObjectDisposedException
ุุ 1
(
ุุ1 2
nameof
ุุ2 8
(
ุุ8 9
AudioService
ุุ9 E
)
ุุE F
)
ุุF G
;
ุุG H
try
ฺฺ 
{
ฺฺ 
cancellationToken
 !
.
! "*
ThrowIfCancellationRequested
" >
(
> ?
)
? @
;
@ A
if
 
(
 
State
 
!=
 

AudioState
 '
.
' (
Stopped
( /
)
/ 0
{
1 2
await
 
Task
 
.
 
Run
 "
(
" #
(
# $
)
$ %
=>
& (
playbackService
) 8
.
8 9
Stop
9 =
(
= >
)
> ?
,
? @
cancellationToken
A R
)
R S
;
S T
State
฿฿ 
=
฿฿ 

AudioState
฿฿ &
.
฿฿& '
Stopped
฿฿' .
;
฿฿. /
Position
เเ 
=
เเ 
$num
เเ "
;
เเ" #
CurrentFile
แแ 
=
แแ  !
string
แแ" (
.
แแ( )
Empty
แแ) .
;
แแ. /
logger
โโ 
.
โโ 
Info
โโ 
(
โโ  
$str
โโ  2
)
โโ2 3
;
โโ3 4
}
ใใ 
}
ไไ 
catch
ๅๅ 
(
ๅๅ (
OperationCanceledException
ๅๅ -
)
ๅๅ- .
{
ๅๅ/ 0
logger
ๆๆ 
.
ๆๆ 
Info
ๆๆ 
(
ๆๆ 
$str
ๆๆ 6
)
ๆๆ6 7
;
ๆๆ7 8
throw
็็ 
;
็็ 
}
่่ 
catch
้้ 
(
้้ 
	Exception
้้ 
ex
้้ 
)
้้  
{
้้! "
logger
๊๊ 
.
๊๊ 
Error
๊๊ 
(
๊๊ 
ex
๊๊ 
,
๊๊  
$str
๊๊! :
)
๊๊: ;
;
๊๊; <
State
๋๋ 
=
๋๋ 

AudioState
๋๋ "
.
๋๋" #
Error
๋๋# (
;
๋๋( )
ErrorOccurred
์์ 
?
์์ 
.
์์ 
Invoke
์์ %
(
์์% &
this
์์& *
,
์์* +
ex
์์, .
.
์์. /
Message
์์/ 6
)
์์6 7
;
์์7 8
throw
ํํ 
;
ํํ 
}
๎๎ 
}
๏๏ 	
public
๔๔ 
async
๔๔ 
Task
๔๔ 
	SeekAsync
๔๔ #
(
๔๔# $
double
๔๔$ *
position
๔๔+ 3
,
๔๔3 4
CancellationToken
๔๔5 F
cancellationToken
๔๔G X
=
๔๔Y Z
default
๔๔[ b
)
๔๔b c
{
๔๔d e
if
๕๕ 
(
๕๕ 
disposed
๕๕ 
)
๕๕ 
throw
๖๖ 
new
๖๖ %
ObjectDisposedException
๖๖ 1
(
๖๖1 2
nameof
๖๖2 8
(
๖๖8 9
AudioService
๖๖9 E
)
๖๖E F
)
๖๖F G
;
๖๖G H
try
๘๘ 
{
๘๘ 
cancellationToken
๙๙ !
.
๙๙! "*
ThrowIfCancellationRequested
๙๙" >
(
๙๙> ?
)
๙๙? @
;
๙๙@ A
var
๛๛ 
clampedPosition
๛๛ #
=
๛๛$ %
Math
๛๛& *
.
๛๛* +
Max
๛๛+ .
(
๛๛. /
$num
๛๛/ 2
,
๛๛2 3
Math
๛๛4 8
.
๛๛8 9
Min
๛๛9 <
(
๛๛< =
Duration
๛๛= E
,
๛๛E F
position
๛๛G O
)
๛๛O P
)
๛๛P Q
;
๛๛Q R
await
 
Task
 
.
 
Run
 
(
 
(
  
)
  !
=>
" $
{
% &
playbackService
 #
.
# $
SetPosition
$ /
(
/ 0
clampedPosition
0 ?
)
? @
;
@ A
currentPosition
 #
=
$ %
clampedPosition
& 5
;
5 6
}
 
,
 
cancellationToken
 $
)
$ %
;
% &
PositionChanged
 
?
  
.
  !
Invoke
! '
(
' (
this
( ,
,
, -
clampedPosition
. =
)
= >
;
> ?
logger
 
.
 
Debug
 
(
 
$"
 
$str
 3
{
3 4
clampedPosition
4 C
:
C D
$str
D F
}
F G
$str
G O
"
O P
)
P Q
;
Q R
}
 
catch
 
(
 (
OperationCanceledException
 -
)
- .
{
/ 0
logger
 
.
 
Info
 
(
 
$str
 6
)
6 7
;
7 8
throw
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
! "
logger
 
.
 
Error
 
(
 
ex
 
,
  
$"
! #
$str
# ?
{
? @
position
@ H
}
H I
"
I J
)
J K
;
K L
ErrorOccurred
 
?
 
.
 
Invoke
 %
(
% &
this
& *
,
* +
ex
, .
.
. /
Message
/ 6
)
6 7
;
7 8
throw
 
;
 
}
 
}
 	
public
 
async
 
Task
 
SetVolumeAsync
 (
(
( )
double
) /
volume
0 6
,
6 7
CancellationToken
8 I
cancellationToken
J [
=
\ ]
default
^ e
)
e f
{
g h
if
 
(
 
disposed
 
)
 
throw
 
new
 %
ObjectDisposedException
 1
(
1 2
nameof
2 8
(
8 9
AudioService
9 E
)
E F
)
F G
;
G H
try
 
{
 
cancellationToken
 !
.
! "*
ThrowIfCancellationRequested
" >
(
> ?
)
? @
;
@ A
await
 
Task
 
.
 
Run
 
(
 
(
  
)
  !
=>
" $
{
% &
Volume
 
=
 
volume
 #
;
# $
}
 
,
 
cancellationToken
 $
)
$ %
;
% &
}
กก 
catch
ขข 
(
ขข (
OperationCanceledException
ขข -
)
ขข- .
{
ขข/ 0
logger
ฃฃ 
.
ฃฃ 
Info
ฃฃ 
(
ฃฃ 
$str
ฃฃ <
)
ฃฃ< =
;
ฃฃ= >
throw
คค 
;
คค 
}
ฅฅ 
catch
ฆฆ 
(
ฆฆ 
	Exception
ฆฆ 
ex
ฆฆ 
)
ฆฆ  
{
ฆฆ! "
logger
งง 
.
งง 
Error
งง 
(
งง 
ex
งง 
,
งง  
$"
งง! #
$str
งง# 9
{
งง9 :
volume
งง: @
}
งง@ A
"
งงA B
)
งงB C
;
งงC D
throw
จจ 
;
จจ 
}
ฉฉ 
}
ชช 	
public
ฏฏ 
async
ฏฏ 
Task
ฏฏ  
ApplySettingsAsync
ฏฏ ,
(
ฏฏ, -
OstPlayerSettings
ฏฏ- >
settings
ฏฏ? G
,
ฏฏG H
CancellationToken
ฏฏI Z
cancellationToken
ฏฏ[ l
=
ฏฏm n
default
ฏฏo v
)
ฏฏv w
{
ฏฏx y
if
ฐฐ 
(
ฐฐ 
disposed
ฐฐ 
)
ฐฐ 
throw
ฑฑ 
new
ฑฑ %
ObjectDisposedException
ฑฑ 1
(
ฑฑ1 2
nameof
ฑฑ2 8
(
ฑฑ8 9
AudioService
ฑฑ9 E
)
ฑฑE F
)
ฑฑF G
;
ฑฑG H
if
ณณ 
(
ณณ 
settings
ณณ 
==
ณณ 
null
ณณ  
)
ณณ  !
return
ดด 
;
ดด 
try
ถถ 
{
ถถ 
cancellationToken
ทท !
.
ทท! "*
ThrowIfCancellationRequested
ทท" >
(
ทท> ?
)
ทท? @
;
ทท@ A
await
นน 
Task
นน 
.
นน 
Run
นน 
(
นน 
(
นน  
)
นน  !
=>
นน" $
{
นน% &
Volume
ปป 
=
ปป 
settings
ปป %
.
ปป% &
DefaultVolume
ปป& 3
/
ปป4 5
$num
ปป6 ;
;
ปป; <
logger
ฝฝ 
.
ฝฝ 
Info
ฝฝ 
(
ฝฝ  
$"
ฝฝ  "
$str
ฝฝ" C
{
ฝฝC D
Volume
ฝฝD J
:
ฝฝJ K
$str
ฝฝK M
}
ฝฝM N
"
ฝฝN O
)
ฝฝO P
;
ฝฝP Q
}
พพ 
,
พพ 
cancellationToken
พพ $
)
พพ$ %
;
พพ% &
}
ฟฟ 
catch
ภภ 
(
ภภ (
OperationCanceledException
ภภ -
)
ภภ- .
{
ภภ/ 0
logger
มม 
.
มม 
Info
มม 
(
มม 
$str
มม @
)
มม@ A
;
มมA B
throw
ยย 
;
ยย 
}
รร 
catch
ฤฤ 
(
ฤฤ 
	Exception
ฤฤ 
ex
ฤฤ 
)
ฤฤ  
{
ฤฤ! "
logger
ลล 
.
ลล 
Error
ลล 
(
ลล 
ex
ลล 
,
ลล  
$str
ลล! A
)
ลลA B
;
ลลB C
throw
ฦฦ 
;
ฦฦ 
}
วว 
}
ศศ 	
public
ฯฯ 
event
ฯฯ 
EventHandler
ฯฯ !
<
ฯฯ! "

AudioState
ฯฯ" ,
>
ฯฯ, -
StateChanged
ฯฯ. :
;
ฯฯ: ;
public
าา 
event
าา 
EventHandler
าา !
<
าา! "
double
าา" (
>
าา( )
PositionChanged
าา* 9
;
าา9 :
public
ีี 
event
ีี 
EventHandler
ีี !
<
ีี! "
double
ีี" (
>
ีี( )
DurationChanged
ีี* 9
;
ีี9 :
public
ุุ 
event
ุุ 
EventHandler
ุุ !
<
ุุ! "
double
ุุ" (
>
ุุ( )
VolumeChanged
ุุ* 7
;
ุุ7 8
public
 
event
 
EventHandler
 !

TrackEnded
" ,
;
, -
public
 
event
 
EventHandler
 !
<
! "
string
" (
>
( )
ErrorOccurred
* 7
;
7 8
public
็็ 
string
็็ 
[
็็ 
]
็็ !
GetSupportedFormats
็็ +
(
็็+ ,
)
็็, -
{
็็. /
return
่่ 
(
่่ 
string
่่ 
[
่่ 
]
่่ 
)
่่ 
supportedFormats
่่ -
.
่่- .
Clone
่่. 3
(
่่3 4
)
่่4 5
;
่่5 6
}
้้ 	
public
๎๎ 
bool
๎๎ 
IsFormatSupported
๎๎ %
(
๎๎% &
string
๎๎& ,
filePath
๎๎- 5
)
๎๎5 6
{
๎๎7 8
if
๏๏ 
(
๏๏ 
string
๏๏ 
.
๏๏ 
IsNullOrEmpty
๏๏ $
(
๏๏$ %
filePath
๏๏% -
)
๏๏- .
)
๏๏. /
return
๐๐ 
false
๐๐ 
;
๐๐ 
var
๒๒ 
	extension
๒๒ 
=
๒๒ 
Path
๒๒  
.
๒๒  !
GetExtension
๒๒! -
(
๒๒- .
filePath
๒๒. 6
)
๒๒6 7
.
๒๒7 8
ToLowerInvariant
๒๒8 H
(
๒๒H I
)
๒๒I J
;
๒๒J K
return
๓๓ 
supportedFormats
๓๓ #
.
๓๓# $
Contains
๓๓$ ,
(
๓๓, -
	extension
๓๓- 6
)
๓๓6 7
;
๓๓7 8
}
๔๔ 	
public
๙๙ 
async
๙๙ 
Task
๙๙ 
<
๙๙ 
AudioEngineInfo
๙๙ )
>
๙๙) * 
GetEngineInfoAsync
๙๙+ =
(
๙๙= >
CancellationToken
๙๙> O
cancellationToken
๙๙P a
=
๙๙b c
default
๙๙d k
)
๙๙k l
{
๙๙m n
if
๚๚ 
(
๚๚ 
disposed
๚๚ 
)
๚๚ 
throw
๛๛ 
new
๛๛ %
ObjectDisposedException
๛๛ 1
(
๛๛1 2
nameof
๛๛2 8
(
๛๛8 9
AudioService
๛๛9 E
)
๛๛E F
)
๛๛F G
;
๛๛G H
try
 
{
 
return
 
await
 
Task
 !
.
! "
Run
" %
(
% &
(
& '
)
' (
=>
) +
{
, -
cancellationToken
 %
.
% &*
ThrowIfCancellationRequested
& B
(
B C
)
C D
;
D E
return
 
new
 
AudioEngineInfo
 .
{
/ 0

EngineName
 "
=
# $
$str
% -
,
- .
Version
 
=
  !
$str
" '
,
' (
SupportedFormats
 (
=
) *!
GetSupportedFormats
+ >
(
> ?
)
? @
,
@ A
IsInitialized
 %
=
& '
playbackService
( 7
!=
8 :
null
; ?
,
? @
Status
 
=
  
State
! &
.
& '
ToString
' /
(
/ 0
)
0 1
}
 
;
 
}
 
,
 
cancellationToken
 $
)
$ %
;
% &
}
 
catch
 
(
 (
OperationCanceledException
 -
)
- .
{
/ 0
logger
 
.
 
Info
 
(
 
$str
 A
)
A B
;
B C
throw
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
! "
logger
 
.
 
Error
 
(
 
ex
 
,
  
$str
! B
)
B C
;
C D
throw
 
;
 
}
 
}
 	
public
 
async
 
Task
 
<
 
bool
 
>
 
CheckHealthAsync
  0
(
0 1
CancellationToken
1 B
cancellationToken
C T
=
U V
default
W ^
)
^ _
{
` a
if
 
(
 
disposed
 
)
 
return
 
false
 
;
 
try
 
{
 
return
 
await
 
Task
 !
.
! "
Run
" %
(
% &
(
& '
)
' (
=>
) +
{
, -
cancellationToken
 %
.
% &*
ThrowIfCancellationRequested
& B
(
B C
)
C D
;
D E
var
 
	isHealthy
 !
=
" #
playbackService
$ 3
!=
4 6
null
7 ;
&&
< >
State
กก# (
!=
กก) +

AudioState
กก, 6
.
กก6 7
Error
กก7 <
;
กก< =
logger
ฃฃ 
.
ฃฃ 
Debug
ฃฃ  
(
ฃฃ  !
$"
ฃฃ! #
$str
ฃฃ# >
{
ฃฃ> ?
(
ฃฃ? @
	isHealthy
ฃฃ@ I
?
ฃฃJ K
$str
ฃฃL U
:
ฃฃV W
$str
ฃฃX c
)
ฃฃc d
}
ฃฃd e
"
ฃฃe f
)
ฃฃf g
;
ฃฃg h
return
คค 
	isHealthy
คค $
;
คค$ %
}
ฅฅ 
,
ฅฅ 
cancellationToken
ฅฅ $
)
ฅฅ$ %
;
ฅฅ% &
}
ฆฆ 
catch
งง 
(
งง (
OperationCanceledException
งง -
)
งง- .
{
งง/ 0
logger
จจ 
.
จจ 
Info
จจ 
(
จจ 
$str
จจ >
)
จจ> ?
;
จจ? @
throw
ฉฉ 
;
ฉฉ 
}
ชช 
catch
ซซ 
(
ซซ 
	Exception
ซซ 
ex
ซซ 
)
ซซ  
{
ซซ! "
logger
ฌฌ 
.
ฌฌ 
Error
ฌฌ 
(
ฌฌ 
ex
ฌฌ 
,
ฌฌ  
$str
ฌฌ! N
)
ฌฌN O
;
ฌฌO P
return
ญญ 
false
ญญ 
;
ญญ 
}
ฎฎ 
}
ฏฏ 	
private
ธธ 
void
ธธ %
InitializeEventHandlers
ธธ ,
(
ธธ, -
)
ธธ- .
{
ธธ/ 0
if
นน 
(
นน 
playbackService
นน 
!=
นน  "
null
นน# '
)
นน' (
{
นน) *
playbackService
บบ 
.
บบ  
PlaybackStarted
บบ  /
+=
บบ0 2
OnPlaybackStarted
บบ3 D
;
บบD E
playbackService
ปป 
.
ปป  
PlaybackPaused
ปป  .
+=
ปป/ 1
OnPlaybackPaused
ปป2 B
;
ปปB C
playbackService
ผผ 
.
ผผ  
PlaybackStopped
ผผ  /
+=
ผผ0 2
OnPlaybackStopped
ผผ3 D
;
ผผD E
playbackService
ฝฝ 
.
ฝฝ  
PlaybackEnded
ฝฝ  -
+=
ฝฝ. 0
OnPlaybackEnded
ฝฝ1 @
;
ฝฝ@ A
playbackService
พพ 
.
พพ  
PositionChanged
พพ  /
+=
พพ0 2
OnPositionChanged
พพ3 D
;
พพD E
playbackService
ฟฟ 
.
ฟฟ  
DurationChanged
ฟฟ  /
+=
ฟฟ0 2
OnDurationChanged
ฟฟ3 D
;
ฟฟD E
}
ภภ 
}
มม 	
private
ฦฦ 
void
ฦฦ "
CleanupEventHandlers
ฦฦ )
(
ฦฦ) *
)
ฦฦ* +
{
ฦฦ, -
if
วว 
(
วว 
playbackService
วว 
!=
วว  "
null
วว# '
)
วว' (
{
วว) *
playbackService
ศศ 
.
ศศ  
PlaybackStarted
ศศ  /
-=
ศศ0 2
OnPlaybackStarted
ศศ3 D
;
ศศD E
playbackService
ษษ 
.
ษษ  
PlaybackPaused
ษษ  .
-=
ษษ/ 1
OnPlaybackPaused
ษษ2 B
;
ษษB C
playbackService
สส 
.
สส  
PlaybackStopped
สส  /
-=
สส0 2
OnPlaybackStopped
สส3 D
;
สสD E
playbackService
หห 
.
หห  
PlaybackEnded
หห  -
-=
หห. 0
OnPlaybackEnded
หห1 @
;
หห@ A
playbackService
ฬฬ 
.
ฬฬ  
PositionChanged
ฬฬ  /
-=
ฬฬ0 2
OnPositionChanged
ฬฬ3 D
;
ฬฬD E
playbackService
ออ 
.
ออ  
DurationChanged
ออ  /
-=
ออ0 2
OnDurationChanged
ออ3 D
;
ออD E
}
ฮฮ 
}
ฯฯ 	
private
ัั 
void
ัั 
OnPlaybackStarted
ัั &
(
ัั& '
object
ัั' -
sender
ัั. 4
,
ัั4 5
	EventArgs
ัั6 ?
e
ัั@ A
)
ััA B
{
ััC D
State
าา 
=
าา 

AudioState
าา 
.
าา 
Playing
าา &
;
าา& '
}
ำำ 	
private
ีี 
void
ีี 
OnPlaybackPaused
ีี %
(
ีี% &
object
ีี& ,
sender
ีี- 3
,
ีี3 4
	EventArgs
ีี5 >
e
ีี? @
)
ีี@ A
{
ีีB C
State
ึึ 
=
ึึ 

AudioState
ึึ 
.
ึึ 
Paused
ึึ %
;
ึึ% &
}
ืื 	
private
ูู 
void
ูู 
OnPlaybackStopped
ูู &
(
ูู& '
object
ูู' -
sender
ูู. 4
,
ูู4 5
	EventArgs
ูู6 ?
e
ูู@ A
)
ููA B
{
ููC D
State
ฺฺ 
=
ฺฺ 

AudioState
ฺฺ 
.
ฺฺ 
Stopped
ฺฺ &
;
ฺฺ& '
Position
 
=
 
$num
 
;
 
}
 	
private
 
void
 
OnPlaybackEnded
 $
(
$ %
object
% +
sender
, 2
,
2 3
	EventArgs
4 =
e
> ?
)
? @
{
A B
State
฿฿ 
=
฿฿ 

AudioState
฿฿ 
.
฿฿ 
Stopped
฿฿ &
;
฿฿& '
Position
เเ 
=
เเ 
$num
เเ 
;
เเ 

TrackEnded
แแ 
?
แแ 
.
แแ 
Invoke
แแ 
(
แแ 
this
แแ #
,
แแ# $
	EventArgs
แแ% .
.
แแ. /
Empty
แแ/ 4
)
แแ4 5
;
แแ5 6
}
โโ 	
private
ไไ 
void
ไไ 
OnPositionChanged
ไไ &
(
ไไ& '
object
ไไ' -
sender
ไไ. 4
,
ไไ4 5
double
ไไ6 <
position
ไไ= E
)
ไไE F
{
ไไG H
Position
ๅๅ 
=
ๅๅ 
position
ๅๅ 
;
ๅๅ  
}
ๆๆ 	
private
่่ 
void
่่ 
OnDurationChanged
่่ &
(
่่& '
object
่่' -
sender
่่. 4
,
่่4 5
double
่่6 <
duration
่่= E
)
่่E F
{
่่G H
Duration
้้ 
=
้้ 
duration
้้ 
;
้้  
}
๊๊ 	
public
๐๐ 
void
๐๐ 
Dispose
๐๐ 
(
๐๐ 
)
๐๐ 
{
๐๐ 
Dispose
๑๑ 
(
๑๑ 
true
๑๑ 
)
๑๑ 
;
๑๑ 
GC
๒๒ 
.
๒๒ 
SuppressFinalize
๒๒ 
(
๒๒  
this
๒๒  $
)
๒๒$ %
;
๒๒% &
}
๓๓ 	
	protected
๕๕ 
virtual
๕๕ 
void
๕๕ 
Dispose
๕๕ &
(
๕๕& '
bool
๕๕' +
	disposing
๕๕, 5
)
๕๕5 6
{
๕๕7 8
if
๖๖ 
(
๖๖ 
!
๖๖ 
disposed
๖๖ 
&&
๖๖ 
	disposing
๖๖ &
)
๖๖& '
{
๖๖( )
try
๗๗ 
{
๗๗ 
logger
๘๘ 
.
๘๘ 
Info
๘๘ 
(
๘๘  
$str
๘๘  ;
)
๘๘; <
;
๘๘< ="
CleanupEventHandlers
๛๛ (
(
๛๛( )
)
๛๛) *
;
๛๛* +
playbackService
 #
?
# $
.
$ %
Stop
% )
(
) *
)
* +
;
+ ,
playbackService
 #
?
# $
.
$ %
Dispose
% ,
(
, -
)
- .
;
. /
logger
 
.
 
Info
 
(
  
$str
  D
)
D E
;
E F
}
 
catch
 
(
 
	Exception
  
ex
! #
)
# $
{
% &
logger
 
.
 
Error
  
(
  !
ex
! #
,
# $
$str
% C
)
C D
;
D E
}
 
finally
 
{
 
disposed
 
=
 
true
 #
;
# $
}
 
}
 
}
 	
}
 
} แ
AC:\Playnite\_github\OstPlayer\source\Models\TrackMetadataModel.cs
	namespacedd 	
	OstPlayerdd
 
.dd 
Modelsdd 
{dd 
publicff 

classff 
TrackMetadataModelff #
{ff$ %
publicgg 
BitmapImagegg 
Covergg  
{gg! "
getgg# &
;gg& '
setgg( +
;gg+ ,
}gg- .
publicii 
stringii 
Titleii 
{ii 
getii !
;ii! "
setii# &
;ii& '
}ii( )
publickk 
stringkk 
Artistkk 
{kk 
getkk "
;kk" #
setkk$ '
;kk' (
}kk) *
publicmm 
stringmm 
Albummm 
{mm 
getmm !
;mm! "
setmm# &
;mm& '
}mm( )
publicoo 
stringoo 
Yearoo 
{oo 
getoo  
;oo  !
setoo" %
;oo% &
}oo' (
publicqq 
stringqq 
Genreqq 
{qq 
getqq !
;qq! "
setqq# &
;qq& '
}qq( )
publicss 
stringss 
Commentss 
{ss 
getss  #
;ss# $
setss% (
;ss( )
}ss* +
publicuu 
stringuu 
Durationuu 
{uu  
getuu! $
;uu$ %
setuu& )
;uu) *
}uu+ ,
publicww 
uintww 
TrackNumberww 
{ww  !
getww" %
;ww% &
setww' *
;ww* +
}ww, -
publicyy 
uintyy 
TotalTracksyy 
{yy  !
getyy" %
;yy% &
setyy' *
;yy* +
}yy, -
public{{ 
string{{ 
Source{{ 
{{{ 
get{{ "
;{{" #
set{{$ '
;{{' (
}{{) *
public}} 
string}} 
	ReleaseId}} 
{}}  !
get}}" %
;}}% &
set}}' *
;}}* +
}}}, -
public 
string 
Country 
{ 
get  #
;# $
set% (
;( )
}* +
public
 
string
 
Status
 
{
 
get
 "
;
" #
set
$ '
;
' (
}
) *
public
 
string
 
Style
 
{
 
get
 !
;
! "
set
# &
;
& '
}
( )
public
 
string
 

DiscogsUrl
  
{
! "
get
# &
;
& '
set
( +
;
+ ,
}
- .
public
 
List
 
<
 
string
 
>
 
	Tracklist
 %
{
& '
get
( +
;
+ ,
set
- 0
;
0 1
}
2 3
}
 
} k
<C:\Playnite\_github\OstPlayer\source\Models\TrackListItem.cs
	namespacecc 	
	OstPlayercc
 
.cc 
Modelscc 
{cc 
publichh 

classhh 
TrackListItemhh 
:hh  "
INotifyPropertyChangedhh! 7
,hh7 8
IComparablehh9 D
<hhD E
TrackListItemhhE R
>hhR S
{hhT U
privatejj 
stringjj 
_trackTitlejj "
;jj" #
privatekk 
stringkk 
_trackDurationkk %
;kk% &
privatell 
uintll 
_trackNumberll !
;ll! "
privatemm 
doublemm 
?mm 
_durationSecondsmm (
;mm( )
publictt 
stringtt 

TrackTitlett  
{tt! "
getuu 
=>uu 
_trackTitleuu 
;uu 
setvv 
{vv 
ifww 
(ww 
_trackTitleww 
!=ww  "
valueww# (
)ww( )
{ww* +
_trackTitlexx 
=xx  !
valuexx" '
;xx' (
OnPropertyChangedyy %
(yy% &
nameofyy& ,
(yy, -

TrackTitleyy- 7
)yy7 8
)yy8 9
;yy9 :
}zz 
}{{ 
}|| 	
public
 
string
 
TrackDuration
 #
{
$ %
get
 
=>
 
_trackDuration
 !
;
! "
set
 
{
 
if
 
(
 
_trackDuration
 "
!=
# %
value
& +
)
+ ,
{
- .
_trackDuration
 "
=
# $
value
% *
;
* +
_durationSeconds
 $
=
% &$
ParseDurationToSeconds
' =
(
= >
value
> C
)
C D
;
D E
OnPropertyChanged
 %
(
% &
nameof
& ,
(
, -
TrackDuration
- :
)
: ;
)
; <
;
< =
}
 
}
 
}
 	
public
 
string
 
FilePath
 
{
  
get
! $
;
$ %
set
& )
;
) *
}
+ ,
public
 
uint
 
TrackNumber
 
{
  !
get
 
=>
 
_trackNumber
 
;
  
set
 
{
 
if
 
(
 
_trackNumber
  
!=
! #
value
$ )
)
) *
{
+ ,
_trackNumber
  
=
! "
value
# (
;
( )
OnPropertyChanged
 %
(
% &
nameof
& ,
(
, -
TrackNumber
- 8
)
8 9
)
9 :
;
: ;
}
 
}
 
}
 	
public
ขข 
uint
ขข 
TotalTracks
ขข 
{
ขข  !
get
ขข" %
;
ขข% &
set
ขข' *
;
ขข* +
}
ขข, -
public
จจ 
double
จจ 
DurationSeconds
จจ %
=>
จจ& (
_durationSeconds
จจ) 9
??
จจ: <
$num
จจ= >
;
จจ> ?
private
ฒฒ 
static
ฒฒ 
double
ฒฒ 
?
ฒฒ $
ParseDurationToSeconds
ฒฒ 5
(
ฒฒ5 6
string
ฒฒ6 <
durationString
ฒฒ= K
)
ฒฒK L
{
ฒฒM N
if
ณณ 
(
ณณ 
string
ณณ 
.
ณณ  
IsNullOrWhiteSpace
ณณ )
(
ณณ) *
durationString
ณณ* 8
)
ณณ8 9
)
ณณ9 :
return
ดด 
null
ดด 
;
ดด 
try
ถถ 
{
ถถ 
if
ธธ 
(
ธธ 
TimeSpan
ธธ 
.
ธธ 
TryParse
ธธ %
(
ธธ% &
$str
ธธ& +
+
ธธ, -
durationString
ธธ. <
,
ธธ< =
out
ธธ> A
TimeSpan
ธธB J
duration
ธธK S
)
ธธS T
||
ธธU W
TimeSpan
นน 
.
นน 
TryParse
นน %
(
นน% &
durationString
นน& 4
,
นน4 5
out
นน6 9
duration
นน: B
)
นนB C
)
นนC D
{
นนE F
return
บบ 
duration
บบ #
.
บบ# $
TotalSeconds
บบ$ 0
;
บบ0 1
}
ปป 
var
พพ 
parts
พพ 
=
พพ 
durationString
พพ *
.
พพ* +
Split
พพ+ 0
(
พพ0 1
$char
พพ1 4
)
พพ4 5
;
พพ5 6
if
ฟฟ 
(
ฟฟ 
parts
ฟฟ 
.
ฟฟ 
Length
ฟฟ  
==
ฟฟ! #
$num
ฟฟ$ %
&&
ฟฟ& (
int
ภภ 
.
ภภ 
TryParse
ภภ  
(
ภภ  !
parts
ภภ! &
[
ภภ& '
$num
ภภ' (
]
ภภ( )
,
ภภ) *
out
ภภ+ .
int
ภภ/ 2
minutes
ภภ3 :
)
ภภ: ;
&&
ภภ< >
double
มม 
.
มม 
TryParse
มม #
(
มม# $
parts
มม$ )
[
มม) *
$num
มม* +
]
มม+ ,
,
มม, -
out
มม. 1
double
มม2 8
seconds
มม9 @
)
มม@ A
)
มมA B
{
มมC D
return
ยย 
(
ยย 
minutes
ยย #
*
ยย$ %
$num
ยย& (
)
ยย( )
+
ยย* +
seconds
ยย, 3
;
ยย3 4
}
รร 
}
ฤฤ 
catch
ลล 
{
ลล 
}
วว 
return
ษษ 
null
ษษ 
;
ษษ 
}
สส 	
public
ำำ 
int
ำำ 
	CompareTo
ำำ 
(
ำำ 
TrackListItem
ำำ *
other
ำำ+ 0
)
ำำ0 1
{
ำำ2 3
if
ิิ 
(
ิิ 
other
ิิ 
==
ิิ 
null
ิิ 
)
ิิ 
return
ีี 
$num
ีี 
;
ีี 
if
ุุ 
(
ุุ 
TrackNumber
ุุ 
!=
ุุ 
other
ุุ $
.
ุุ$ %
TrackNumber
ุุ% 0
)
ุุ0 1
{
ุุ2 3
if
ฺฺ 
(
ฺฺ 
TrackNumber
ฺฺ 
==
ฺฺ  "
$num
ฺฺ# $
&&
ฺฺ% '
other
ฺฺ( -
.
ฺฺ- .
TrackNumber
ฺฺ. 9
>
ฺฺ: ;
$num
ฺฺ< =
)
ฺฺ= >
return
 
$num
 
;
 
if
 
(
 
other
 
.
 
TrackNumber
 %
==
& (
$num
) *
&&
+ -
TrackNumber
. 9
>
: ;
$num
< =
)
= >
return
 
-
 
$num
 
;
 
return
฿฿ 
TrackNumber
฿฿ "
.
฿฿" #
	CompareTo
฿฿# ,
(
฿฿, -
other
฿฿- 2
.
฿฿2 3
TrackNumber
฿฿3 >
)
฿฿> ?
;
฿฿? @
}
เเ 
return
ใใ 
string
ใใ 
.
ใใ 
Compare
ใใ !
(
ใใ! "

TrackTitle
ใใ" ,
??
ใใ- /
$str
ใใ0 2
,
ใใ2 3
other
ใใ4 9
.
ใใ9 :

TrackTitle
ใใ: D
??
ใใE G
$str
ใใH J
,
ใใJ K
StringComparison
ไไ  
.
ไไ  !
OrdinalIgnoreCase
ไไ! 2
)
ไไ2 3
;
ไไ3 4
}
ๅๅ 	
public
์์ 
static
์์ 
int
์์ "
CompareByTrackNumber
์์ .
(
์์. /
TrackListItem
์์/ <
a
์์= >
,
์์> ?
TrackListItem
์์@ M
b
์์N O
)
์์O P
{
์์Q R
if
ํํ 
(
ํํ 
a
ํํ 
==
ํํ 
null
ํํ 
&&
ํํ 
b
ํํ 
==
ํํ !
null
ํํ" &
)
ํํ& '
return
ํํ( .
$num
ํํ/ 0
;
ํํ0 1
if
๎๎ 
(
๎๎ 
a
๎๎ 
==
๎๎ 
null
๎๎ 
)
๎๎ 
return
๎๎ !
-
๎๎" #
$num
๎๎# $
;
๎๎$ %
if
๏๏ 
(
๏๏ 
b
๏๏ 
==
๏๏ 
null
๏๏ 
)
๏๏ 
return
๏๏ !
$num
๏๏" #
;
๏๏# $
if
๒๒ 
(
๒๒ 
a
๒๒ 
.
๒๒ 
TrackNumber
๒๒ 
==
๒๒  
$num
๒๒! "
&&
๒๒# %
b
๒๒& '
.
๒๒' (
TrackNumber
๒๒( 3
==
๒๒4 6
$num
๒๒7 8
)
๒๒8 9
return
๓๓ 
string
๓๓ 
.
๓๓ 
Compare
๓๓ %
(
๓๓% &
a
๓๓& '
.
๓๓' (

TrackTitle
๓๓( 2
??
๓๓3 5
$str
๓๓6 8
,
๓๓8 9
b
๓๓: ;
.
๓๓; <

TrackTitle
๓๓< F
??
๓๓G I
$str
๓๓J L
,
๓๓L M
StringComparison
๓๓N ^
.
๓๓^ _
OrdinalIgnoreCase
๓๓_ p
)
๓๓p q
;
๓๓q r
if
๔๔ 
(
๔๔ 
a
๔๔ 
.
๔๔ 
TrackNumber
๔๔ 
==
๔๔  
$num
๔๔! "
)
๔๔" #
return
๔๔$ *
$num
๔๔+ ,
;
๔๔, -
if
๕๕ 
(
๕๕ 
b
๕๕ 
.
๕๕ 
TrackNumber
๕๕ 
==
๕๕  
$num
๕๕! "
)
๕๕" #
return
๕๕$ *
-
๕๕+ ,
$num
๕๕, -
;
๕๕- .
return
๗๗ 
a
๗๗ 
.
๗๗ 
TrackNumber
๗๗  
.
๗๗  !
	CompareTo
๗๗! *
(
๗๗* +
b
๗๗+ ,
.
๗๗, -
TrackNumber
๗๗- 8
)
๗๗8 9
;
๗๗9 :
}
๘๘ 	
public
 
static
 
int
 
CompareByTitle
 (
(
( )
TrackListItem
) 6
a
7 8
,
8 9
TrackListItem
: G
b
H I
)
I J
{
K L
if
 
(
 
a
 
==
 
null
 
&&
 
b
 
==
 !
null
" &
)
& '
return
( .
$num
/ 0
;
0 1
if
 
(
 
a
 
==
 
null
 
)
 
return
 !
-
" #
$num
# $
;
$ %
if
 
(
 
b
 
==
 
null
 
)
 
return
 !
$num
" #
;
# $
return
 
string
 
.
 
Compare
 !
(
! "
a
" #
.
# $

TrackTitle
$ .
??
/ 1
$str
2 4
,
4 5
b
6 7
.
7 8

TrackTitle
8 B
??
C E
$str
F H
,
H I
StringComparison
J Z
.
Z [
OrdinalIgnoreCase
[ l
)
l m
;
m n
}
 	
public
 
static
 
int
 
CompareByDuration
 +
(
+ ,
TrackListItem
, 9
a
: ;
,
; <
TrackListItem
= J
b
K L
)
L M
{
N O
if
 
(
 
a
 
==
 
null
 
&&
 
b
 
==
 !
null
" &
)
& '
return
( .
$num
/ 0
;
0 1
if
 
(
 
a
 
==
 
null
 
)
 
return
 !
-
" #
$num
# $
;
$ %
if
 
(
 
b
 
==
 
null
 
)
 
return
 !
$num
" #
;
# $
return
 
a
 
.
 
DurationSeconds
 $
.
$ %
	CompareTo
% .
(
. /
b
/ 0
.
0 1
DurationSeconds
1 @
)
@ A
;
A B
}
 	
public
 
event
 )
PropertyChangedEventHandler
 0
PropertyChanged
1 @
;
@ A
	protected
 
virtual
 
void
 
OnPropertyChanged
 0
(
0 1
string
1 7
propertyName
8 D
)
D E
{
F G
PropertyChanged
 
?
 
.
 
Invoke
 #
(
# $
this
$ (
,
( )
new
* -&
PropertyChangedEventArgs
. F
(
F G
propertyName
G S
)
S T
)
T U
;
U V
}
 	
public
คค 
override
คค 
string
คค 
ToString
คค '
(
คค' (
)
คค( )
{
คค* +
var
ฅฅ 
trackNum
ฅฅ 
=
ฅฅ 
TrackNumber
ฅฅ &
>
ฅฅ' (
$num
ฅฅ) *
?
ฅฅ+ ,
$"
ฅฅ- /
{
ฅฅ/ 0
TrackNumber
ฅฅ0 ;
:
ฅฅ; <
$str
ฅฅ< >
}
ฅฅ> ?
"
ฅฅ? @
:
ฅฅA B
$str
ฅฅC G
;
ฅฅG H
return
ฆฆ 
$"
ฆฆ 
$str
ฆฆ 
{
ฆฆ 
trackNum
ฆฆ 
}
ฆฆ  
$str
ฆฆ  "
{
ฆฆ" #

TrackTitle
ฆฆ# -
??
ฆฆ. 0
$str
ฆฆ1 :
}
ฆฆ: ;
$str
ฆฆ; =
{
ฆฆ= >
TrackDuration
ฆฆ> K
??
ฆฆL N
$str
ฆฆO X
}
ฆฆX Y
$str
ฆฆY Z
"
ฆฆZ [
;
ฆฆ[ \
}
งง 	
}
จจ 
}ฉฉ ฯ
=C:\Playnite\_github\OstPlayer\source\Models\IMetadataModel.cs
	namespaceaa 	
	OstPlayeraa
 
.aa 
Modelsaa 
{bb 
publicff 

	interfaceff 
IMetadataModelff #
{gg 
stringhh 
Sourcehh 
{hh 
gethh 
;hh 
}hh 
stringjj 
Titlejj 
{jj 
getjj 
;jj 
setjj 
;jj  
}jj! "
stringll 
Artistll 
{ll 
getll 
;ll 
setll  
;ll  !
}ll" #
stringnn 
Albumnn 
{nn 
getnn 
;nn 
setnn 
;nn  
}nn! "
stringpp 
Yearpp 
{pp 
getpp 
;pp 
setpp 
;pp 
}pp  !
stringrr 
Genrerr 
{rr 
getrr 
;rr 
setrr 
;rr  
}rr! "
stringtt 
Durationtt 
{tt 
gettt 
;tt 
settt "
;tt" #
}tt$ %
uintvv 
TrackNumbervv 
{vv 
getvv 
;vv 
setvv  #
;vv# $
}vv% &
uintxx 
TotalTracksxx 
{xx 
getxx 
;xx 
setxx  #
;xx# $
}xx% &
BitmapImagezz 
Coverzz 
{zz 
getzz 
;zz  
setzz! $
;zz$ %
}zz& '
bool 
IsValid 
( 
) 
; 
IMetadataModel
 
	MergeWith
  
(
  !
IMetadataModel
 
other
  
,
  !#
MetadataMergePriority
 !
priority
" *
=
+ ,#
MetadataMergePriority
- B
.
B C

PreferThis
C M
)
 	
;
	 

}
 
public
 

enum
 #
MetadataMergePriority
 %
{
 

PreferThis
 
,
 
PreferOther
 
,
  
PreferMostComplete
 
,
 
}
 
} ฮ
AC:\Playnite\_github\OstPlayer\source\Models\AlbumMetadataModel.cs
	namespacegg 	
	OstPlayergg
 
.gg 
Modelsgg 
{gg 
publickk 

classkk 
AlbumMetadataModelkk #
{kk$ %
publicll 
stringll 
Titlell 
{ll 
getll !
;ll! "
setll# &
;ll& '
}ll( )
publicmm 
stringmm 
Artistmm 
{mm 
getmm "
;mm" #
setmm$ '
;mm' (
}mm) *
publicnn 
stringnn 
Albumnn 
{nn 
getnn !
;nn! "
setnn# &
;nn& '
}nn( )
publicoo 
stringoo 
Releasedoo 
{oo  
getoo! $
;oo$ %
setoo& )
;oo) *
}oo+ ,
publicpp 
Listpp 
<pp 
stringpp 
>pp 
Genrespp "
{pp# $
getpp% (
;pp( )
setpp* -
;pp- .
}pp/ 0
publicqq 
Listqq 
<qq 
stringqq 
>qq 
Stylesqq "
{qq# $
getqq% (
;qq( )
setqq* -
;qq- .
}qq/ 0
publicrr 
stringrr 
Commentrr 
{rr 
getrr  #
;rr# $
setrr% (
;rr( )
}rr* +
publicss 
stringss 
Countryss 
{ss 
getss  #
;ss# $
setss% (
;ss( )
}ss* +
publictt 
stringtt 

DiscogsUrltt  
{tt! "
gettt# &
;tt& '
settt( +
;tt+ ,
}tt- .
publicuu 
BitmapImageuu 
Coveruu  
{uu! "
getuu# &
;uu& '
setuu( +
;uu+ ,
}uu- .
publicvv 
Listvv 
<vv 
stringvv 
>vv 
	Tracklistvv %
{vv& '
getvv( +
;vv+ ,
setvv- 0
;vv0 1
}vv2 3
}xx 
}yy ฺ 
[C:\Playnite\_github\OstPlayer\source\Documentation\References\Interfaces\IAudioViewModel.cs
	namespace'' 	
	OstPlayer''
 
.'' 

References'' 
.'' 

Interfaces'' )
{(( 
public// 

	interface// 
IAudioViewModel// $
://% &
IDisposable//' 2
{00 
bool66 
	IsPlaying66 
{66 
get66 
;66 
}66 
bool;; 
IsPaused;; 
{;; 
get;; 
;;; 
};; 
double@@ 
Position@@ 
{@@ 
get@@ 
;@@ 
set@@ "
;@@" #
}@@$ %
doubleEE 
DurationEE 
{EE 
getEE 
;EE 
}EE  
doubleJJ 
VolumeJJ 
{JJ 
getJJ 
;JJ 
setJJ  
;JJ  !
}JJ" #
stringOO 
CurrentTrackPathOO 
{OO  !
getOO" %
;OO% &
}OO' (
boolXX 
CanPlayXX 
{XX 
getXX 
;XX 
}XX 
bool]] 
CanPause]] 
{]] 
get]] 
;]] 
}]] 
boolbb 
CanStopbb 
{bb 
getbb 
;bb 
}bb 
stringgg 
CurrentTimeDisplaygg !
{gg" #
getgg$ '
;gg' (
}gg) *
stringll 
DurationDisplayll 
{ll  
getll! $
;ll$ %
}ll& '
stringqq 
VolumeDisplayqq 
{qq 
getqq "
;qq" #
}qq$ %
ICommandzz 
PlayPauseCommandzz !
{zz" #
getzz$ '
;zz' (
}zz) *
ICommand 
StopCommand 
{ 
get "
;" #
}$ %
ICommand
 
MuteCommand
 
{
 
get
 "
;
" #
}
$ %
Task
 
	PlayAsync
 
(
 
string
 
	trackPath
 '
,
' (
double
) /
?
/ 0
startPosition
1 >
=
? @
null
A E
)
E F
;
F G
void
 
Play
 
(
 
string
 
	trackPath
 "
,
" #
double
$ *
?
* +
startPosition
, 9
=
: ;
null
< @
)
@ A
;
A B
void
 
Pause
 
(
 
)
 
;
 
void
 
Stop
 
(
 
)
 
;
 
void
ฆฆ 
Seek
ฆฆ 
(
ฆฆ 
double
ฆฆ 
position
ฆฆ !
)
ฆฆ! "
;
ฆฆ" #
void
ฌฌ 
	SetVolume
ฌฌ 
(
ฌฌ 
double
ฌฌ 
volume
ฌฌ $
)
ฌฌ$ %
;
ฌฌ% &
void
ทท 
SetUserDragging
ทท 
(
ทท 
bool
ทท !

isDragging
ทท" ,
)
ทท, -
;
ทท- .
event
ภภ 
EventHandler
ภภ 
PlaybackStarted
ภภ *
;
ภภ* +
event
ลล 
EventHandler
ลล 
PlaybackPaused
ลล )
;
ลล) *
event
สส 
EventHandler
สส 
PlaybackStopped
สส *
;
สส* +
event
ฯฯ 
EventHandler
ฯฯ 
PlaybackEnded
ฯฯ (
;
ฯฯ( )
event
ิิ 
EventHandler
ิิ 
<
ิิ 
double
ิิ !
>
ิิ! "
PositionChanged
ิิ# 2
;
ิิ2 3
event
ูู 
EventHandler
ูู 
<
ูู 
double
ูู !
>
ูู! "
DurationChanged
ูู# 2
;
ูู2 3
event
 
EventHandler
 
<
 
double
 !
>
! "
VolumeChanged
# 0
;
0 1
event
ใใ 
EventHandler
ใใ 
<
ใใ 
string
ใใ !
>
ใใ! "
ErrorOccurred
ใใ# 0
;
ใใ0 1
}
ๆๆ 
}็็ J
EC:\Playnite\_github\OstPlayer\source\Diagnostics\PluginDiagnostics.cs
	namespace

 	
	OstPlayer


 
.

 
Diagnostics

 
{ 
public 

static 
class 
PluginDiagnostics )
{ 
public 
static 
void 
RunBasicDiagnostics .
(. /
IPlayniteAPI/ ;
api< ?
)? @
{ 	
var 
logger 
= 

LogManager #
.# $
	GetLogger$ -
(- .
). /
;/ 0
var 
report 
= 
new 
System #
.# $
Text$ (
.( )
StringBuilder) 6
(6 7
)7 8
;8 9
report 
. 

AppendLine 
( 
$str D
)D E
;E F
try 
{ 
report 
. 

AppendLine !
(! "
$"" $
$str$ >
{> ?
api? B
!=C E
nullF J
}J K
"K L
)L M
;M N
if   
(   
api   
!=   
null   
)    
{!! 
report"" 
."" 

AppendLine"" %
(""% &
$"""& (
$str""( 7
{""7 8
api""8 ;
.""; <
Database""< D
.""D E
Games""E J
.""J K
Count""K P
}""P Q
"""Q R
)""R S
;""S T
report## 
.## 

AppendLine## %
(##% &
$"##& (
$str##( 7
{##7 8
api##8 ;
.##; <
Paths##< A
.##A B
ConfigurationPath##B S
}##S T
"##T U
)##U V
;##V W
}$$ 
try'' 
{(( 
var)) 
	container)) !
=))" #
ServiceContainer))$ 4
.))4 5
Instance))5 =
;))= >
report** 
.** 

AppendLine** %
(**% &
$"**& (
$str**( I
{**I J
	container**J S
!=**T V
null**W [
}**[ \
"**\ ]
)**] ^
;**^ _
if-- 
(-- #
TestServiceRegistration-- /
(--/ 0
)--0 1
)--1 2
{.. 
report// 
.// 

AppendLine// )
(//) *
$str//* N
)//N O
;//O P
}00 
else11 
{22 
report33 
.33 

AppendLine33 )
(33) *
$str33* N
)33N O
;33O P
}44 
}55 
catch66 
(66 
	Exception66  
ex66! #
)66# $
{77 
report88 
.88 

AppendLine88 %
(88% &
$"88& (
$str88( C
{88C D
ex88D F
.88F G
Message88G N
}88N O
"88O P
)88P Q
;88Q R
}99 
try<< 
{== 
var>> 
settings>>  
=>>! "
new>># &
OstPlayerSettings>>' 8
(>>8 9
)>>9 :
;>>: ;
report?? 
.?? 

AppendLine?? %
(??% &
$"??& (
$str??( G
{??G H
settings??H P
!=??Q S
null??T X
}??X Y
"??Y Z
)??Z [
;??[ \
varBB 
errorsBB 
=BB  
settingsBB! )
.BB) *
ValidateBB* 2
(BB2 3
)BB3 4
;BB4 5
ifCC 
(CC 
errorsCC 
.CC 
CountCC $
==CC% '
$numCC( )
)CC) *
{DD 
reportEE 
.EE 

AppendLineEE )
(EE) *
$strEE* H
)EEH I
;EEI J
}FF 
elseGG 
{HH 
reportII 
.II 

AppendLineII )
(II) *
$"II* ,
$strII, L
{IIL M
errorsIIM S
.IIS T
CountIIT Y
}IIY Z
"IIZ [
)II[ \
;II\ ]
}JJ 
}KK 
catchLL 
(LL 
	ExceptionLL  
exLL! #
)LL# $
{MM 
reportNN 
.NN 

AppendLineNN %
(NN% &
$"NN& (
$strNN( :
{NN: ;
exNN; =
.NN= >
MessageNN> E
}NNE F
"NNF G
)NNG H
;NNH I
}OO 
tryRR 
{SS 
varTT 
playbackServiceTT '
=TT( )
newTT* -
UtilsTT. 3
.TT3 4 
MusicPlaybackServiceTT4 H
(TTH I
)TTI J
;TTJ K
playbackServiceUU #
.UU# $
DisposeUU$ +
(UU+ ,
)UU, -
;UU- .
reportVV 
.VV 

AppendLineVV %
(VV% &
$strVV& C
)VVC D
;VVD E
}WW 
catchXX 
(XX 
	ExceptionXX  
exXX! #
)XX# $
{YY 
reportZZ 
.ZZ 

AppendLineZZ %
(ZZ% &
$"ZZ& (
$strZZ( 8
{ZZ8 9
exZZ9 ;
.ZZ; <
MessageZZ< C
}ZZC D
"ZZD E
)ZZE F
;ZZF G
}[[ 
try^^ 
{__ 
var`` 
interfaceTypes`` &
=``' (
new``) ,
Type``- 1
[``1 2
]``2 3
{aa 
typeofbb 
(bb 
Servicesbb '
.bb' (

Interfacesbb( 2
.bb2 3
IAudioServicebb3 @
)bb@ A
,bbA B
typeofcc 
(cc 
Servicescc '
.cc' (

Interfacescc( 2
.cc2 3
IGameServicecc3 ?
)cc? @
,cc@ A
typeofdd 
(dd 
Servicesdd '
.dd' (

Interfacesdd( 2
.dd2 3
IMetadataServicedd3 C
)ddC D
,ddD E
}ee 
;ee 
reportgg 
.gg 

AppendLinegg %
(gg% &
$"gg& (
$strgg( F
{ggF G
interfaceTypesggG U
.ggU V
LengthggV \
}gg\ ]
"gg] ^
)gg^ _
;gg_ `
}hh 
catchii 
(ii 
	Exceptionii  
exii! #
)ii# $
{jj 
reportkk 
.kk 

AppendLinekk %
(kk% &
$"kk& (
$strkk( A
{kkA B
exkkB D
.kkD E
MessagekkE L
}kkL M
"kkM N
)kkN O
;kkO P
}ll 
reportnn 
.nn 

AppendLinenn !
(nn! "
$strnn" @
)nn@ A
;nnA B
loggerqq 
.qq 
Infoqq 
(qq 
reportqq "
.qq" #
ToStringqq# +
(qq+ ,
)qq, -
)qq- .
;qq. /
Debugrr 
.rr 
	WriteLinerr 
(rr  
reportrr  &
.rr& '
ToStringrr' /
(rr/ 0
)rr0 1
)rr1 2
;rr2 3
}ss 
catchtt 
(tt 
	Exceptiontt 
extt 
)tt  
{uu 
varvv 
errorMsgvv 
=vv 
$"vv !
$strvv! 5
{vv5 6
exvv6 8
.vv8 9
Messagevv9 @
}vv@ A
"vvA B
;vvB C
loggerww 
.ww 
Errorww 
(ww 
exww 
,ww  
errorMsgww! )
)ww) *
;ww* +
Debugxx 
.xx 
	WriteLinexx 
(xx  
errorMsgxx  (
)xx( )
;xx) *
}yy 
}zz 	
public 
static 
bool #
TestServiceRegistration 2
(2 3
)3 4
{
 	
try
 
{
 
var
 
	container
 
=
 
ServiceContainer
  0
.
0 1
Instance
1 9
;
9 :
	container
 
.
 
Clear
 
(
  
)
  !
;
! "
	container
 
.
 
RegisterSingleton
 +
<
+ ,
ILogger
, 3
>
3 4
(
4 5

LogManager
5 ?
.
? @
	GetLogger
@ I
(
I J
)
J K
)
K L
;
L M
var
 
logger
 
=
 
	container
 &
.
& '

GetService
' 1
<
1 2
ILogger
2 9
>
9 :
(
: ;
)
; <
;
< =
return
 
logger
 
!=
  
null
! %
;
% &
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
Debug
 
.
 
	WriteLine
 
(
  
$"
  "
$str
" D
{
D E
ex
E G
.
G H
Message
H O
}
O P
"
P Q
)
Q R
;
R S
return
 
false
 
;
 
}
 
}
 	
}
 
} ไํ
BC:\Playnite\_github\OstPlayer\source\DevTools\ReadmeUpdateRules.cs
	namespaceNN 	
	OstPlayerNN
 
.NN 
DevToolsNN 
{NN 
publicRR 

classRR 
UpdateContextRR 
{RR  
publicSS 
stringSS 
ChangedFileSS !
{SS" #
getSS$ '
;SS' (
setSS) ,
;SS, -
}SS. /
publicTT 
stringTT 

ReadmePathTT  
{TT! "
getTT# &
;TT& '
setTT( +
;TT+ ,
}TT- .
publicUU 

ReadmeTypeUU 

ReadmeTypeUU $
{UU% &
getUU' *
;UU* +
setUU, /
;UU/ 0
}UU1 2
publicVV 
DateTimeVV 

ChangeTimeVV "
{VV# $
getVV% (
;VV( )
setVV* -
;VV- .
}VV/ 0
publicWW 
stringWW 
ChangeDescriptionWW '
{WW( )
getWW* -
;WW- .
setWW/ 2
;WW2 3
}WW4 5
publicXX 
boolXX 
IsStructuralChangeXX &
{XX' (
getXX) ,
;XX, -
setXX. 1
;XX1 2
}XX3 4
publicYY 
boolYY 
	IsNewFileYY 
{YY 
getYY  #
;YY# $
setYY% (
;YY( )
}YY* +
publicZZ 
boolZZ 
IsDeletedFileZZ !
{ZZ" #
getZZ$ '
;ZZ' (
setZZ) ,
;ZZ, -
}ZZ. /
}[[ 
public`` 

class``  
RuleEvaluationResult`` %
{``& '
publicaa 
boolaa 
ShouldUpdateaa  
{aa! "
getaa# &
;aa& '
setaa( +
;aa+ ,
}aa- .
publicbb 
stringbb 
Reasonbb 
{bb 
getbb "
;bb" #
setbb$ '
;bb' (
}bb) *
publiccc 
intcc 
Prioritycc 
{cc 
getcc !
;cc! "
setcc# &
;cc& '
}cc( )
publicdd 
stringdd 
[dd 
]dd 
SuggestedActionsdd (
{dd) *
getdd+ .
;dd. /
setdd0 3
;dd3 4
}dd5 6
publicee 

Dictionaryee 
<ee 
stringee  
,ee  !
objectee" (
>ee( )
Metadataee* 2
{ee3 4
getee5 8
;ee8 9
setee: =
;ee= >
}ee? @
publicgg  
RuleEvaluationResultgg #
(gg# $
)gg$ %
{gg& '
SuggestedActionshh 
=hh 
newhh "
stringhh# )
[hh) *
$numhh* +
]hh+ ,
;hh, -
Metadataii 
=ii 
newii 

Dictionaryii %
<ii% &
stringii& ,
,ii, -
objectii. 4
>ii4 5
(ii5 6
)ii6 7
;ii7 8
}jj 	
}kk 
publicpp 

staticpp 
classpp 
ReadmeUpdateRulespp )
{pp* +
privaterr 
staticrr 
readonlyrr 

Dictionaryrr  *
<rr* +
stringrr+ 1
,rr1 2
Regexrr3 8
>rr8 9
CompiledPatternsrr: J
=rrK L
newrrM P

DictionaryrrQ [
<rr[ \
stringrr\ b
,rrb c
Regexrrd i
>rri j
{rrk l
[ss 
$strss 
]ss 
=ss 
newss  
Regexss! &
(ss& '
$str	ss' 
,
ss 
RegexOptions
ss 
.
ss 
Compiled
ss 
|
ss 
RegexOptions
ss จ
.
ssจ ฉ

IgnoreCase
ssฉ ณ
)
ssณ ด
,
ssด ต
[tt 
$strtt 
]tt 
=tt 
newtt  #
Regextt$ )
(tt) *
$strtt* e
,tte f
RegexOptionsttg s
.tts t
Compiledttt |
|tt} ~
RegexOptions	tt 
.
tt 

IgnoreCase
tt 
)
tt 
,
tt 
[uu 
$struu 
]uu  
=uu! "
newuu# &
Regexuu' ,
(uu, -
$struu- T
,uuT U
RegexOptionsuuV b
.uub c
Compileduuc k
|uul m
RegexOptionsuun z
.uuz {

IgnoreCase	uu{ 
)
uu 
,
uu 
[vv 
$strvv 
]vv  
=vv! "
newvv# &
Regexvv' ,
(vv, -
$strvv- }
,vv} ~
RegexOptions	vv 
.
vv 
Compiled
vv 
|
vv 
RegexOptions
vv ฃ
.
vvฃ ค

IgnoreCase
vvค ฎ
)
vvฎ ฏ
,
vvฏ ฐ
[ww 
$strww 
]ww 
=ww 
newww "
Regexww# (
(ww( )
$strww) F
,wwF G
RegexOptionswwH T
.wwT U
CompiledwwU ]
|ww^ _
RegexOptionsww` l
.wwl m

IgnoreCasewwm w
)www x
,wwx y
[xx 
$strxx  
]xx  !
=xx" #
newxx$ '
Regexxx( -
(xx- .
$strxx. N
,xxN O
RegexOptionsxxP \
.xx\ ]
Compiledxx] e
|xxf g
RegexOptionsxxh t
.xxt u

IgnoreCasexxu 
)	xx 
}yy 	
;yy	 

private|| 
static|| 
readonly|| 

Dictionary||  *
<||* +
string||+ 1
,||1 2 
RuleEvaluationResult||3 G
>||G H
	RuleCache||I R
=||S T
new||U X

Dictionary||Y c
<||c d
string||d j
,||j k!
RuleEvaluationResult	||l 
>
|| 
(
|| 
)
|| 
;
|| 
private}} 
static}} 
DateTime}} 
_cacheLastCleaned}}  1
=}}2 3
DateTime}}4 <
.}}< =
Now}}= @
;}}@ A
public
 
static
 "
RuleEvaluationResult
 * 
ShouldUpdateReadme
+ =
(
= >
string
> D

readmePath
E O
,
O P
string
Q W
changedFile
X c
)
c d
{
e f
try
 
{
 
var
 
context
 
=
 !
CreateUpdateContext
 1
(
1 2

readmePath
2 <
,
< =
changedFile
> I
)
I J
;
J K
var
 
cacheKey
 
=
 
$"
 !
{
! "

readmePath
" ,
}
, -
$str
- .
{
. /
changedFile
/ :
}
: ;
"
; <
;
< =
if
 
(
 
	RuleCache
 
.
 
ContainsKey
 )
(
) *
cacheKey
* 2
)
2 3
)
3 4
{
5 6
return
 
	RuleCache
 $
[
$ %
cacheKey
% -
]
- .
;
. /
}
 
var
 
result
 
=
 !
EvaluateUpdateRules
 0
(
0 1
context
1 8
)
8 9
;
9 :
CacheResult
 
(
 
cacheKey
 $
,
$ %
result
& ,
)
, -
;
- .
return
 
result
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
! "
return
 
new
 "
RuleEvaluationResult
 /
{
0 1
ShouldUpdate
  
=
! "
false
# (
,
( )
Reason
 
=
 
$"
 
$str
 7
{
7 8
ex
8 :
.
: ;
Message
; B
}
B C
"
C D
,
D E
Priority
 
=
 
$num
  
}
 
;
 
}
 
}
 	
public
งง 
static
งง 

Dictionary
งง  
<
งง  !
string
งง! '
,
งง' ("
RuleEvaluationResult
งง) =
>
งง= >%
EvaluateMultipleReadmes
งง? V
(
งงV W
string
งงW ]
changedFile
งง^ i
,
งงi j
IEnumerable
งงk v
<
งงv w
string
งงw }
>
งง} ~
readmeFilesงง 
)งง 
{งง 
var
จจ 
results
จจ 
=
จจ 
new
จจ 

Dictionary
จจ (
<
จจ( )
string
จจ) /
,
จจ/ 0"
RuleEvaluationResult
จจ1 E
>
จจE F
(
จจF G
)
จจG H
;
จจH I
foreach
ชช 
(
ชช 
var
ชช 

readmePath
ชช #
in
ชช$ &
readmeFiles
ชช' 2
)
ชช2 3
{
ชช4 5
results
ซซ 
[
ซซ 

readmePath
ซซ "
]
ซซ" #
=
ซซ$ % 
ShouldUpdateReadme
ซซ& 8
(
ซซ8 9

readmePath
ซซ9 C
,
ซซC D
changedFile
ซซE P
)
ซซP Q
;
ซซQ R
}
ฌฌ 
return
ฎฎ 
results
ฎฎ 
;
ฎฎ 
}
ฏฏ 	
public
ถถ 
static
ถถ 
List
ถถ 
<
ถถ 
string
ถถ !
>
ถถ! ")
GetPrioritizedReadmeUpdates
ถถ# >
(
ถถ> ?
string
ถถ? E
changedFile
ถถF Q
)
ถถQ R
{
ถถS T
var
ทท 

allReadmes
ทท 
=
ทท "
DocumentationManager
ทท 1
.
ทท1 2
GetAllReadmeFiles
ทท2 C
(
ททC D
)
ททD E
;
ททE F
var
ธธ 
evaluations
ธธ 
=
ธธ %
EvaluateMultipleReadmes
ธธ 5
(
ธธ5 6
changedFile
ธธ6 A
,
ธธA B

allReadmes
ธธC M
)
ธธM N
;
ธธN O
return
บบ 
evaluations
บบ 
.
ปป 
Where
ปป 
(
ปป 
kvp
ปป 
=>
ปป 
kvp
ปป !
.
ปป! "
Value
ปป" '
.
ปป' (
ShouldUpdate
ปป( 4
)
ปป4 5
.
ผผ 
OrderByDescending
ผผ "
(
ผผ" #
kvp
ผผ# &
=>
ผผ' )
kvp
ผผ* -
.
ผผ- .
Value
ผผ. 3
.
ผผ3 4
Priority
ผผ4 <
)
ผผ< =
.
ฝฝ 
Select
ฝฝ 
(
ฝฝ 
kvp
ฝฝ 
=>
ฝฝ 
kvp
ฝฝ "
.
ฝฝ" #
Key
ฝฝ# &
)
ฝฝ& '
.
พพ 
ToList
พพ 
(
พพ 
)
พพ 
;
พพ 
}
ฟฟ 	
private
หห 
static
หห 
UpdateContext
หห $!
CreateUpdateContext
หห% 8
(
หห8 9
string
หห9 ?

readmePath
หห@ J
,
หหJ K
string
หหL R
changedFile
หหS ^
)
หห^ _
{
หห` a
return
ฬฬ 
new
ฬฬ 
UpdateContext
ฬฬ $
{
ฬฬ% &
ChangedFile
ออ 
=
ออ 
changedFile
ออ )
,
ออ) *

ReadmePath
ฮฮ 
=
ฮฮ 

readmePath
ฮฮ '
,
ฮฮ' (

ReadmeType
ฯฯ 
=
ฯฯ "
DocumentationManager
ฯฯ 1
.
ฯฯ1 2
GetReadmeType
ฯฯ2 ?
(
ฯฯ? @

readmePath
ฯฯ@ J
)
ฯฯJ K
,
ฯฯK L

ChangeTime
ะะ 
=
ะะ 
DateTime
ะะ %
.
ะะ% &
Now
ะะ& )
,
ะะ) * 
IsStructuralChange
ัั "
=
ัั# $ 
IsStructuralChange
ัั% 7
(
ัั7 8
changedFile
ัั8 C
)
ััC D
,
ััD E
	IsNewFile
าา 
=
าา 
	IsNewFile
าา %
(
าา% &
changedFile
าา& 1
)
าา1 2
,
าา2 3
IsDeletedFile
ำำ 
=
ำำ 
IsDeletedFile
ำำ  -
(
ำำ- .
changedFile
ำำ. 9
)
ำำ9 :
,
ำำ: ;
ChangeDescription
ิิ !
=
ิิ" #'
GenerateChangeDescription
ิิ$ =
(
ิิ= >
changedFile
ิิ> I
)
ิิI J
}
ีี 
;
ีี 
}
ึึ 	
private
 
static
 "
RuleEvaluationResult
 +!
EvaluateUpdateRules
, ?
(
? @
UpdateContext
@ M
context
N U
)
U V
{
W X
var
 
result
 
=
 
new
 "
RuleEvaluationResult
 1
(
1 2
)
2 3
;
3 4
switch
แแ 
(
แแ 
context
แแ 
.
แแ 

ReadmeType
แแ &
)
แแ& '
{
แแ( )
case
โโ 

ReadmeType
โโ 
.
โโ  
Root
โโ  $
:
โโ$ %
result
ใใ 
=
ใใ %
EvaluateRootReadmeRules
ใใ 4
(
ใใ4 5
context
ใใ5 <
)
ใใ< =
;
ใใ= >
break
ไไ 
;
ไไ 
case
ๅๅ 

ReadmeType
ๅๅ 
.
ๅๅ  

Navigation
ๅๅ  *
:
ๅๅ* +
result
ๆๆ 
=
ๆๆ +
EvaluateNavigationReadmeRules
ๆๆ :
(
ๆๆ: ;
context
ๆๆ; B
)
ๆๆB C
;
ๆๆC D
break
็็ 
;
็็ 
case
่่ 

ReadmeType
่่ 
.
่่  
	Technical
่่  )
:
่่) *
result
้้ 
=
้้ *
EvaluateTechnicalReadmeRules
้้ 9
(
้้9 :
context
้้: A
)
้้A B
;
้้B C
break
๊๊ 
;
๊๊ 
case
๋๋ 

ReadmeType
๋๋ 
.
๋๋  
Category
๋๋  (
:
๋๋( )
result
์์ 
=
์์ )
EvaluateCategoryReadmeRules
์์ 8
(
์์8 9
context
์์9 @
)
์์@ A
;
์์A B
break
ํํ 
;
ํํ 
default
๎๎ 
:
๎๎ 
result
๏๏ 
=
๏๏ "
EvaluateDefaultRules
๏๏ 1
(
๏๏1 2
context
๏๏2 9
)
๏๏9 :
;
๏๏: ;
break
๐๐ 
;
๐๐ 
}
๑๑ 
result
๔๔ 
.
๔๔ 
Metadata
๔๔ 
[
๔๔ 
$str
๔๔ (
]
๔๔( )
=
๔๔* +
context
๔๔, 3
.
๔๔3 4

ReadmeType
๔๔4 >
.
๔๔> ?
ToString
๔๔? G
(
๔๔G H
)
๔๔H I
;
๔๔I J
result
๕๕ 
.
๕๕ 
Metadata
๕๕ 
[
๕๕ 
$str
๕๕ (
]
๕๕( )
=
๕๕* +
context
๕๕, 3
.
๕๕3 4

ChangeTime
๕๕4 >
;
๕๕> ?
result
๖๖ 
.
๖๖ 
Metadata
๖๖ 
[
๖๖ 
$str
๖๖ *
]
๖๖* +
=
๖๖, -
context
๖๖. 5
.
๖๖5 6 
IsStructuralChange
๖๖6 H
;
๖๖H I
return
๘๘ 
result
๘๘ 
;
๘๘ 
}
๙๙ 	
private
 
static
 "
RuleEvaluationResult
 +%
EvaluateRootReadmeRules
, C
(
C D
UpdateContext
D Q
context
R Y
)
Y Z
{
[ \
var
 
result
 
=
 
new
 "
RuleEvaluationResult
 1
(
1 2
)
2 3
;
3 4
if
 
(
 
CompiledPatterns
  
[
  !
$str
! 3
]
3 4
.
4 5
IsMatch
5 <
(
< =
context
= D
.
D E
ChangedFile
E P
)
P Q
)
Q R
{
S T
result
 
.
 
ShouldUpdate
 #
=
$ %
true
& *
;
* +
result
 
.
 
Reason
 
=
 
$str
  O
;
O P
result
 
.
 
Priority
 
=
  !
$num
" $
;
$ %
result
 
.
 
SuggestedActions
 '
=
( )
new
* -
[
- .
]
. /
{
0 1
$str
2 [
,
[ \
$str
] w
}
x y
;
y z
return
 
result
 
;
 
}
 
if
 
(
 
CompiledPatterns
  
[
  !
$str
! 0
]
0 1
.
1 2
IsMatch
2 9
(
9 :
context
: A
.
A B
ChangedFile
B M
)
M N
)
N O
{
P Q
result
 
.
 
ShouldUpdate
 #
=
$ %
true
& *
;
* +
result
 
.
 
Reason
 
=
 
$str
  :
;
: ;
result
 
.
 
Priority
 
=
  !
$num
" #
;
# $
result
 
.
 
SuggestedActions
 '
=
( )
new
* -
[
- .
]
. /
{
0 1
$str
2 T
}
U V
;
V W
return
 
result
 
;
 
}
 
if
 
(
 
CompiledPatterns
  
[
  !
$str
! 3
]
3 4
.
4 5
IsMatch
5 <
(
< =
context
= D
.
D E
ChangedFile
E P
)
P Q
&&
R T
context
U \
.
\ ]
	IsNewFile
] f
)
f g
{
h i
result
 
.
 
ShouldUpdate
 #
=
$ %
true
& *
;
* +
result
 
.
 
Reason
 
=
 
$str
  E
;
E F
result
 
.
 
Priority
 
=
  !
$num
" #
;
# $
result
 
.
 
SuggestedActions
 '
=
( )
new
* -
[
- .
]
. /
{
0 1
$str
2 _
}
` a
;
a b
return
 
result
 
;
 
}
 
result
ขข 
.
ขข 
ShouldUpdate
ขข 
=
ขข  !
false
ขข" '
;
ขข' (
result
ฃฃ 
.
ฃฃ 
Reason
ฃฃ 
=
ฃฃ 
$str
ฃฃ <
;
ฃฃ< =
return
คค 
result
คค 
;
คค 
}
ฅฅ 	
private
ฌฌ 
static
ฌฌ "
RuleEvaluationResult
ฌฌ ++
EvaluateNavigationReadmeRules
ฌฌ, I
(
ฌฌI J
UpdateContext
ฌฌJ W
context
ฌฌX _
)
ฌฌ_ `
{
ฌฌa b
var
ญญ 
result
ญญ 
=
ญญ 
new
ญญ "
RuleEvaluationResult
ญญ 1
(
ญญ1 2
)
ญญ2 3
;
ญญ3 4
var
ฎฎ 
readmeCategory
ฎฎ 
=
ฎฎ  +
ExtractCategoryFromReadmePath
ฎฎ! >
(
ฎฎ> ?
context
ฎฎ? F
.
ฎฎF G

ReadmePath
ฎฎG Q
)
ฎฎQ R
;
ฎฎR S
if
ฑฑ 
(
ฑฑ "
IsSameCategoryChange
ฑฑ $
(
ฑฑ$ %
context
ฑฑ% ,
.
ฑฑ, -
ChangedFile
ฑฑ- 8
,
ฑฑ8 9
readmeCategory
ฑฑ: H
)
ฑฑH I
)
ฑฑI J
{
ฑฑK L
result
ฒฒ 
.
ฒฒ 
ShouldUpdate
ฒฒ #
=
ฒฒ$ %
true
ฒฒ& *
;
ฒฒ* +
result
ณณ 
.
ณณ 
Reason
ณณ 
=
ณณ 
$"
ณณ  "
$str
ณณ" 7
{
ณณ7 8
readmeCategory
ณณ8 F
}
ณณF G
$str
ณณG P
"
ณณP Q
;
ณณQ R
result
ดด 
.
ดด 
Priority
ดด 
=
ดด  !
$num
ดด" #
;
ดด# $
result
ตต 
.
ตต 
SuggestedActions
ตต '
=
ตต( )
new
ตต* -
[
ตต- .
]
ตต. /
{
ตต0 1
$"
ตต2 4
$str
ตต4 8
{
ตต8 9
Path
ตต9 =
.
ตต= >
GetFileName
ตต> I
(
ตตI J
context
ตตJ Q
.
ตตQ R
ChangedFile
ตตR ]
)
ตต] ^
}
ตต^ _
$str
ตต_ c
{
ตตc d
readmeCategory
ตตd r
}
ตตr s
$str
ตตs ~
"
ตต~ 
}ตต 
;ตต 
return
ถถ 
result
ถถ 
;
ถถ 
}
ทท 
if
บบ 
(
บบ 
readmeCategory
บบ 
==
บบ !
$str
บบ" +
&&
บบ, .
CompiledPatterns
บบ/ ?
[
บบ? @
$str
บบ@ O
]
บบO P
.
บบP Q
IsMatch
บบQ X
(
บบX Y
context
บบY `
.
บบ` a
ChangedFile
บบa l
)
บบl m
)
บบm n
{
บบo p
result
ปป 
.
ปป 
ShouldUpdate
ปป #
=
ปป$ %
true
ปป& *
;
ปป* +
result
ผผ 
.
ผผ 
Reason
ผผ 
=
ผผ 
$str
ผผ  8
;
ผผ8 9
result
ฝฝ 
.
ฝฝ 
Priority
ฝฝ 
=
ฝฝ  !
$num
ฝฝ" #
;
ฝฝ# $
result
พพ 
.
พพ 
SuggestedActions
พพ '
=
พพ( )
new
พพ* -
[
พพ- .
]
พพ. /
{
พพ0 1
$str
พพ2 O
}
พพP Q
;
พพQ R
return
ฟฟ 
result
ฟฟ 
;
ฟฟ 
}
ภภ 
if
รร 
(
รร 
context
รร 
.
รร  
IsStructuralChange
รร *
&&
รร+ -!
IsRelatedToCategory
รร. A
(
รรA B
context
รรB I
.
รรI J
ChangedFile
รรJ U
,
รรU V
readmeCategory
รรW e
)
รรe f
)
รรf g
{
รรh i
result
ฤฤ 
.
ฤฤ 
ShouldUpdate
ฤฤ #
=
ฤฤ$ %
true
ฤฤ& *
;
ฤฤ* +
result
ลล 
.
ลล 
Reason
ลล 
=
ลล 
$str
ลล  D
;
ลลD E
result
ฦฦ 
.
ฦฦ 
Priority
ฦฦ 
=
ฦฦ  !
$num
ฦฦ" #
;
ฦฦ# $
result
วว 
.
วว 
SuggestedActions
วว '
=
วว( )
new
วว* -
[
วว- .
]
วว. /
{
วว0 1
$str
วว2 O
}
ววP Q
;
ววQ R
return
ศศ 
result
ศศ 
;
ศศ 
}
ษษ 
result
หห 
.
หห 
ShouldUpdate
หห 
=
หห  !
false
หห" '
;
หห' (
result
ฬฬ 
.
ฬฬ 
Reason
ฬฬ 
=
ฬฬ 
$str
ฬฬ B
;
ฬฬB C
return
ออ 
result
ออ 
;
ออ 
}
ฮฮ 	
private
ีี 
static
ีี "
RuleEvaluationResult
ีี +*
EvaluateTechnicalReadmeRules
ีี, H
(
ีีH I
UpdateContext
ีีI V
context
ีีW ^
)
ีี^ _
{
ีี` a
var
ึึ 
result
ึึ 
=
ึึ 
new
ึึ "
RuleEvaluationResult
ึึ 1
(
ึึ1 2
)
ึึ2 3
;
ึึ3 4
var
ืื 
moduleFromReadme
ืื  
=
ืื! ")
ExtractModuleFromReadmePath
ืื# >
(
ืื> ?
context
ืื? F
.
ืืF G

ReadmePath
ืืG Q
)
ืืQ R
;
ืืR S
var
ุุ 
moduleFromFile
ุุ 
=
ุุ  '
ExtractModuleFromFilePath
ุุ! :
(
ุุ: ;
context
ุุ; B
.
ุุB C
ChangedFile
ุุC N
)
ุุN O
;
ุุO P
if
 
(
 
moduleFromReadme
  
==
! #
moduleFromFile
$ 2
&&
3 5
CompiledPatterns
6 F
[
F G
$str
G S
]
S T
.
T U
IsMatch
U \
(
\ ]
context
] d
.
d e
ChangedFile
e p
)
p q
)
q r
{
s t
result
 
.
 
ShouldUpdate
 #
=
$ %
true
& *
;
* +
result
 
.
 
Reason
 
=
 
$"
  "
$str
" 4
{
4 5
moduleFromReadme
5 E
}
E F
$str
F M
"
M N
;
N O
result
 
.
 
Priority
 
=
  !
$num
" $
;
$ %
result
฿฿ 
.
฿฿ 
SuggestedActions
฿฿ '
=
฿฿( )
new
฿฿* -
[
฿฿- .
]
฿฿. /
{
฿฿0 1
$"
฿฿2 4
$str
฿฿4 8
{
฿฿8 9
Path
฿฿9 =
.
฿฿= >
GetFileName
฿฿> I
(
฿฿I J
context
฿฿J Q
.
฿฿Q R
ChangedFile
฿฿R ]
)
฿฿] ^
}
฿฿^ _
$str
฿฿_ s
"
฿฿s t
}
฿฿u v
;
฿฿v w
return
เเ 
result
เเ 
;
เเ 
}
แแ 
if
ไไ 
(
ไไ 
moduleFromReadme
ไไ  
==
ไไ! #
$str
ไไ$ .
&&
ไไ/ 1
CompiledPatterns
ไไ2 B
[
ไไB C
$str
ไไC Q
]
ไไQ R
.
ไไR S
IsMatch
ไไS Z
(
ไไZ [
context
ไไ[ b
.
ไไb c
ChangedFile
ไไc n
)
ไไn o
)
ไไo p
{
ไไq r
result
ๅๅ 
.
ๅๅ 
ShouldUpdate
ๅๅ #
=
ๅๅ$ %
true
ๅๅ& *
;
ๅๅ* +
result
ๆๆ 
.
ๆๆ 
Reason
ๆๆ 
=
ๆๆ 
$str
ๆๆ  :
;
ๆๆ: ;
result
็็ 
.
็็ 
Priority
็็ 
=
็็  !
$num
็็" #
;
็็# $
result
่่ 
.
่่ 
SuggestedActions
่่ '
=
่่( )
new
่่* -
[
่่- .
]
่่. /
{
่่0 1
$str
่่2 X
}
่่Y Z
;
่่Z [
return
้้ 
result
้้ 
;
้้ 
}
๊๊ 
if
ํํ 
(
ํํ 
CompiledPatterns
ํํ  
[
ํํ  !
$str
ํํ! 4
]
ํํ4 5
.
ํํ5 6
IsMatch
ํํ6 =
(
ํํ= >
context
ํํ> E
.
ํํE F
ChangedFile
ํํF Q
)
ํํQ R
&&
ํํS U
context
๎๎ 
.
๎๎ 
ChangedFile
๎๎ #
.
๎๎# $
Contains
๎๎$ ,
(
๎๎, -
moduleFromReadme
๎๎- =
)
๎๎= >
)
๎๎> ?
{
๎๎@ A
result
๏๏ 
.
๏๏ 
ShouldUpdate
๏๏ #
=
๏๏$ %
true
๏๏& *
;
๏๏* +
result
๐๐ 
.
๐๐ 
Reason
๐๐ 
=
๐๐ 
$str
๐๐  >
;
๐๐> ?
result
๑๑ 
.
๑๑ 
Priority
๑๑ 
=
๑๑  !
$num
๑๑" #
;
๑๑# $
result
๒๒ 
.
๒๒ 
SuggestedActions
๒๒ '
=
๒๒( )
new
๒๒* -
[
๒๒- .
]
๒๒. /
{
๒๒0 1
$str
๒๒2 U
}
๒๒V W
;
๒๒W X
return
๓๓ 
result
๓๓ 
;
๓๓ 
}
๔๔ 
result
๖๖ 
.
๖๖ 
ShouldUpdate
๖๖ 
=
๖๖  !
false
๖๖" '
;
๖๖' (
result
๗๗ 
.
๗๗ 
Reason
๗๗ 
=
๗๗ 
$str
๗๗ A
;
๗๗A B
return
๘๘ 
result
๘๘ 
;
๘๘ 
}
๙๙ 	
private
 
static
 "
RuleEvaluationResult
 +)
EvaluateCategoryReadmeRules
, G
(
G H
UpdateContext
H U
context
V ]
)
] ^
{
_ `
var
 
result
 
=
 
new
 "
RuleEvaluationResult
 1
(
1 2
)
2 3
;
3 4
var
  
categoryFromReadme
 "
=
# $+
ExtractCategoryFromReadmePath
% B
(
B C
context
C J
.
J K

ReadmePath
K U
)
U V
;
V W
if
 
(
 "
IsSameCategoryChange
 $
(
$ %
context
% ,
.
, -
ChangedFile
- 8
,
8 9 
categoryFromReadme
: L
)
L M
&&
N P
context
Q X
.
X Y
	IsNewFile
Y b
)
b c
{
d e
result
 
.
 
ShouldUpdate
 #
=
$ %
true
& *
;
* +
result
 
.
 
Reason
 
=
 
$"
  "
$str
" 8
{
8 9 
categoryFromReadme
9 K
}
K L
$str
L U
"
U V
;
V W
result
 
.
 
Priority
 
=
  !
$num
" #
;
# $
result
 
.
 
SuggestedActions
 '
=
( )
new
* -
[
- .
]
. /
{
0 1
$"
2 4
$str
4 8
{
8 9
Path
9 =
.
= >)
GetFileNameWithoutExtension
> Y
(
Y Z
context
Z a
.
a b
ChangedFile
b m
)
m n
}
n o
$stro 
" 
} 
; 
return
 
result
 
;
 
}
 
if
 
(
 !
IsSubcategoryChange
 #
(
# $
context
$ +
.
+ ,
ChangedFile
, 7
,
7 8 
categoryFromReadme
9 K
)
K L
)
L M
{
N O
result
 
.
 
ShouldUpdate
 #
=
$ %
true
& *
;
* +
result
 
.
 
Reason
 
=
 
$str
  =
;
= >
result
 
.
 
Priority
 
=
  !
$num
" #
;
# $
result
 
.
 
SuggestedActions
 '
=
( )
new
* -
[
- .
]
. /
{
0 1
$str
2 S
}
T U
;
U V
return
 
result
 
;
 
}
 
result
 
.
 
ShouldUpdate
 
=
  !
false
" '
;
' (
result
 
.
 
Reason
 
=
 
$str
 @
;
@ A
return
 
result
 
;
 
}
 	
private
 
static
 "
RuleEvaluationResult
 +"
EvaluateDefaultRules
, @
(
@ A
UpdateContext
A N
context
O V
)
V W
{
X Y
var
กก 
result
กก 
=
กก 
new
กก "
RuleEvaluationResult
กก 1
(
กก1 2
)
กก2 3
;
กก3 4
if
คค 
(
คค 
context
คค 
.
คค  
IsStructuralChange
คค *
)
คค* +
{
คค, -
result
ฅฅ 
.
ฅฅ 
ShouldUpdate
ฅฅ #
=
ฅฅ$ %
true
ฅฅ& *
;
ฅฅ* +
result
ฆฆ 
.
ฆฆ 
Reason
ฆฆ 
=
ฆฆ 
$str
ฆฆ  X
;
ฆฆX Y
result
งง 
.
งง 
Priority
งง 
=
งง  !
$num
งง" #
;
งง# $
result
จจ 
.
จจ 
SuggestedActions
จจ '
=
จจ( )
new
จจ* -
[
จจ- .
]
จจ. /
{
จจ0 1
$str
จจ2 S
}
จจT U
;
จจU V
return
ฉฉ 
result
ฉฉ 
;
ฉฉ 
}
ชช 
result
ฌฌ 
.
ฌฌ 
ShouldUpdate
ฌฌ 
=
ฌฌ  !
false
ฌฌ" '
;
ฌฌ' (
result
ญญ 
.
ญญ 
Reason
ญญ 
=
ญญ 
$str
ญญ >
;
ญญ> ?
return
ฎฎ 
result
ฎฎ 
;
ฎฎ 
}
ฏฏ 	
private
บบ 
static
บบ 
bool
บบ  
IsStructuralChange
บบ .
(
บบ. /
string
บบ/ 5
changedFile
บบ6 A
)
บบA B
{
บบC D
return
ปป 
changedFile
ปป 
.
ปป 
Contains
ปป '
(
ปป' (
$str
ปป( 4
)
ปป4 5
||
ปป6 8
changedFile
ผผ 
.
ผผ 
Contains
ผผ '
(
ผผ' (
$str
ผผ( 5
)
ผผ5 6
||
ผผ7 9
changedFile
ฝฝ 
.
ฝฝ 
Contains
ฝฝ '
(
ฝฝ' (
$str
ฝฝ( @
)
ฝฝ@ A
||
ฝฝB D
CompiledPatterns
พพ #
[
พพ# $
$str
พพ$ 6
]
พพ6 7
.
พพ7 8
IsMatch
พพ8 ?
(
พพ? @
changedFile
พพ@ K
)
พพK L
||
พพM O
CompiledPatterns
ฟฟ #
[
ฟฟ# $
$str
ฟฟ$ 6
]
ฟฟ6 7
.
ฟฟ7 8
IsMatch
ฟฟ8 ?
(
ฟฟ? @
changedFile
ฟฟ@ K
)
ฟฟK L
;
ฟฟL M
}
ภภ 	
private
วว 
static
วว 
bool
วว 
	IsNewFile
วว %
(
วว% &
string
วว& ,
changedFile
วว- 8
)
วว8 9
{
วว: ;
return
สส 
File
สส 
.
สส 
Exists
สส 
(
สส 
changedFile
สส *
)
สส* +
;
สส+ ,
}
หห 	
private
าา 
static
าา 
bool
าา 
IsDeletedFile
าา )
(
าา) *
string
าา* 0
changedFile
าา1 <
)
าา< =
{
าา> ?
return
ิิ 
!
ิิ 
File
ิิ 
.
ิิ 
Exists
ิิ 
(
ิิ  
changedFile
ิิ  +
)
ิิ+ ,
;
ิิ, -
}
ีี 	
private
 
static
 
string
 '
GenerateChangeDescription
 7
(
7 8
string
8 >
changedFile
? J
)
J K
{
L M
var
 
fileName
 
=
 
Path
 
.
  
GetFileName
  +
(
+ ,
changedFile
, 7
)
7 8
;
8 9
var
 
	extension
 
=
 
Path
  
.
  !
GetExtension
! -
(
- .
changedFile
. 9
)
9 :
.
: ;
ToLower
; B
(
B C
)
C D
;
D E
switch
เเ 
(
เเ 
	extension
เเ 
)
เเ 
{
เเ  
case
แแ 
$str
แแ 
:
แแ 
return
โโ 
$"
โโ 
$str
โโ .
{
โโ. /
fileName
โโ/ 7
}
โโ7 8
$str
โโ8 A
"
โโA B
;
โโB C
case
ใใ 
$str
ใใ 
:
ใใ 
return
ไไ 
$"
ไไ 
$str
ไไ 0
{
ไไ0 1
fileName
ไไ1 9
}
ไไ9 :
$str
ไไ: B
"
ไไB C
;
ไไC D
case
ๅๅ 
$str
ๅๅ 
:
ๅๅ 
return
ๆๆ 
$"
ๆๆ 
$str
ๆๆ %
{
ๆๆ% &
fileName
ๆๆ& .
}
ๆๆ. /
$str
ๆๆ/ 7
"
ๆๆ7 8
;
ๆๆ8 9
case
็็ 
$str
็็ 
:
็็ 
return
่่ 
$"
่่ 
$str
่่ )
{
่่) *
fileName
่่* 2
}
่่2 3
$str
่่3 ;
"
่่; <
;
่่< =
default
้้ 
:
้้ 
return
๊๊ 
$"
๊๊ 
$str
๊๊ "
{
๊๊" #
fileName
๊๊# +
}
๊๊+ ,
$str
๊๊, 5
"
๊๊5 6
;
๊๊6 7
}
๋๋ 
}
์์ 	
private
๓๓ 
static
๓๓ 
string
๓๓ +
ExtractCategoryFromReadmePath
๓๓ ;
(
๓๓; <
string
๓๓< B

readmePath
๓๓C M
)
๓๓M N
{
๓๓O P
var
๔๔ 
normalizedPath
๔๔ 
=
๔๔  

readmePath
๔๔! +
.
๔๔+ ,
Replace
๔๔, 3
(
๔๔3 4
$char
๔๔4 8
,
๔๔8 9
$char
๔๔: =
)
๔๔= >
;
๔๔> ?
if
๕๕ 
(
๕๕ 
normalizedPath
๕๕ 
.
๕๕ 

StartsWith
๕๕ )
(
๕๕) *
$str
๕๕* :
)
๕๕: ;
)
๕๕; <
{
๕๕= >
var
๖๖ 
parts
๖๖ 
=
๖๖ 
normalizedPath
๖๖ *
.
๖๖* +
Split
๖๖+ 0
(
๖๖0 1
$char
๖๖1 4
)
๖๖4 5
;
๖๖5 6
if
๗๗ 
(
๗๗ 
parts
๗๗ 
.
๗๗ 
Length
๗๗  
>=
๗๗! #
$num
๗๗$ %
)
๗๗% &
{
๗๗' (
return
๘๘ 
parts
๘๘  
[
๘๘  !
$num
๘๘! "
]
๘๘" #
;
๘๘# $
}
๙๙ 
}
๚๚ 
return
๛๛ 
string
๛๛ 
.
๛๛ 
Empty
๛๛ 
;
๛๛  
}
 	
private
 
static
 
string
 )
ExtractModuleFromReadmePath
 9
(
9 :
string
: @

readmePath
A K
)
K L
{
M N
var
 
normalizedPath
 
=
  

readmePath
! +
.
+ ,
Replace
, 3
(
3 4
$char
4 8
,
8 9
$char
: =
)
= >
;
> ?
var
 
parts
 
=
 
normalizedPath
 &
.
& '
Split
' ,
(
, -
$char
- 0
)
0 1
;
1 2
if
 
(
 
parts
 
.
 
Length
 
>=
 
$num
  !
)
! "
{
# $
var
 
potentialModule
 #
=
$ %
parts
& +
[
+ ,
$num
, -
]
- .
;
. /
if
 
(
 
IsModuleName
  
(
  !
potentialModule
! 0
)
0 1
)
1 2
{
3 4
return
 
potentialModule
 *
;
* +
}
 
}
 
return
 
string
 
.
 
Empty
 
;
  
}
 	
private
 
static
 
string
 '
ExtractModuleFromFilePath
 7
(
7 8
string
8 >
filePath
? G
)
G H
{
I J
var
 
normalizedPath
 
=
  
filePath
! )
.
) *
Replace
* 1
(
1 2
$char
2 6
,
6 7
$char
8 ;
)
; <
;
< =
var
 
parts
 
=
 
normalizedPath
 &
.
& '
Split
' ,
(
, -
$char
- 0
)
0 1
;
1 2
foreach
 
(
 
var
 
part
 
in
  
parts
! &
)
& '
{
( )
if
 
(
 
IsModuleName
  
(
  !
part
! %
)
% &
)
& '
{
( )
return
 
part
 
;
  
}
 
}
 
return
 
string
 
.
 
Empty
 
;
  
}
 	
private
คค 
static
คค 
bool
คค 
IsModuleName
คค (
(
คค( )
string
คค) /
name
คค0 4
)
คค4 5
{
คค6 7
var
ฅฅ 
modules
ฅฅ 
=
ฅฅ 
new
ฅฅ 
[
ฅฅ 
]
ฅฅ 
{
ฅฅ  !
$str
ฅฅ" .
,
ฅฅ. /
$str
ฅฅ0 8
,
ฅฅ8 9
$str
ฅฅ: A
,
ฅฅA B
$str
ฅฅC M
,
ฅฅM N
$str
ฅฅO X
,
ฅฅX Y
$str
ฅฅZ a
,
ฅฅa b
$str
ฅฅc o
,
ฅฅo p
$str
ฅฅq {
}
ฅฅ| }
;
ฅฅ} ~
return
ฆฆ 
modules
ฆฆ 
.
ฆฆ 
Contains
ฆฆ #
(
ฆฆ# $
name
ฆฆ$ (
,
ฆฆ( )
StringComparer
ฆฆ* 8
.
ฆฆ8 9
OrdinalIgnoreCase
ฆฆ9 J
)
ฆฆJ K
;
ฆฆK L
}
งง 	
private
ฏฏ 
static
ฏฏ 
bool
ฏฏ "
IsSameCategoryChange
ฏฏ 0
(
ฏฏ0 1
string
ฏฏ1 7
changedFile
ฏฏ8 C
,
ฏฏC D
string
ฏฏE K
category
ฏฏL T
)
ฏฏT U
{
ฏฏV W
if
ฐฐ 
(
ฐฐ 
string
ฐฐ 
.
ฐฐ 
IsNullOrEmpty
ฐฐ $
(
ฐฐ$ %
category
ฐฐ% -
)
ฐฐ- .
)
ฐฐ. /
return
ฑฑ 
false
ฑฑ 
;
ฑฑ 
var
ณณ 
normalizedFile
ณณ 
=
ณณ  
changedFile
ณณ! ,
.
ณณ, -
Replace
ณณ- 4
(
ณณ4 5
$char
ณณ5 9
,
ณณ9 :
$char
ณณ; >
)
ณณ> ?
;
ณณ? @
return
ดด 
normalizedFile
ดด !
.
ดด! "

StartsWith
ดด" ,
(
ดด, -
$"
ดด- /
$str
ดด/ =
{
ดด= >
category
ดด> F
}
ดดF G
$str
ดดG H
"
ดดH I
,
ดดI J
StringComparison
ดดK [
.
ดด[ \
OrdinalIgnoreCase
ดด\ m
)
ดดm n
;
ดดn o
}
ตต 	
private
ฝฝ 
static
ฝฝ 
bool
ฝฝ !
IsRelatedToCategory
ฝฝ /
(
ฝฝ/ 0
string
ฝฝ0 6
changedFile
ฝฝ7 B
,
ฝฝB C
string
ฝฝD J
category
ฝฝK S
)
ฝฝS T
{
ฝฝU V
if
พพ 
(
พพ 
string
พพ 
.
พพ 
IsNullOrEmpty
พพ $
(
พพ$ %
category
พพ% -
)
พพ- .
)
พพ. /
return
ฟฟ 
false
ฟฟ 
;
ฟฟ 
var
ยย 
categoryLower
ยย 
=
ยย 
category
ยย  (
.
ยย( )
ToLower
ยย) 0
(
ยย0 1
)
ยย1 2
;
ยย2 3
switch
รร 
(
รร 
categoryLower
รร !
)
รร! "
{
รร# $
case
ฤฤ 
$str
ฤฤ 
:
ฤฤ 
return
ลล 
changedFile
ลล &
.
ลล& '
Contains
ลล' /
(
ลล/ 0
$str
ลล0 H
)
ลลH I
;
ลลI J
case
ฦฦ 
$str
ฦฦ "
:
ฦฦ" #
return
วว 
changedFile
วว &
.
วว& '
Contains
วว' /
(
วว/ 0
$str
วว0 >
)
วว> ?
||
วว@ B
IsModuleName
ววC O
(
ววO P'
ExtractModuleFromFilePath
ววP i
(
ววi j
changedFile
ววj u
)
ววu v
)
ววv w
;
ววw x
case
ศศ 
$str
ศศ #
:
ศศ# $
return
ษษ 
changedFile
ษษ &
.
ษษ& '
Contains
ษษ' /
(
ษษ/ 0
$str
ษษ0 ;
)
ษษ; <
||
ษษ= ?
changedFile
ษษ@ K
.
ษษK L
Contains
ษษL T
(
ษษT U
$str
ษษU d
)
ษษd e
;
ษษe f
default
สส 
:
สส 
return
หห 
false
หห  
;
หห  !
}
ฬฬ 
}
ออ 	
private
ีี 
static
ีี 
bool
ีี !
IsSubcategoryChange
ีี /
(
ีี/ 0
string
ีี0 6
changedFile
ีี7 B
,
ีีB C
string
ีีD J
category
ีีK S
)
ีีS T
{
ีีU V
if
ึึ 
(
ึึ 
string
ึึ 
.
ึึ 
IsNullOrEmpty
ึึ $
(
ึึ$ %
category
ึึ% -
)
ึึ- .
)
ึึ. /
return
ืื 
false
ืื 
;
ืื 
var
ูู 
normalizedFile
ูู 
=
ูู  
changedFile
ูู! ,
.
ูู, -
Replace
ูู- 4
(
ูู4 5
$char
ูู5 9
,
ูู9 :
$char
ูู; >
)
ูู> ?
;
ูู? @
var
ฺฺ 
categoryPattern
ฺฺ 
=
ฺฺ  !
$"
ฺฺ" $
$str
ฺฺ$ 2
{
ฺฺ2 3
category
ฺฺ3 ;
}
ฺฺ; <
$str
ฺฺ< =
"
ฺฺ= >
;
ฺฺ> ?
if
 
(
 
normalizedFile
 
.
 

StartsWith
 )
(
) *
categoryPattern
* 9
,
9 :
StringComparison
; K
.
K L
OrdinalIgnoreCase
L ]
)
] ^
)
^ _
{
` a
var
 
remainingPath
 !
=
" #
normalizedFile
$ 2
.
2 3
	Substring
3 <
(
< =
categoryPattern
= L
.
L M
Length
M S
)
S T
;
T U
return
 
remainingPath
 $
.
$ %
Contains
% -
(
- .
$char
. 1
)
1 2
;
2 3
}
฿฿ 
return
แแ 
false
แแ 
;
แแ 
}
โโ 	
private
้้ 
static
้้ 
void
้้ 
CacheResult
้้ '
(
้้' (
string
้้( .
cacheKey
้้/ 7
,
้้7 8"
RuleEvaluationResult
้้9 M
result
้้N T
)
้้T U
{
้้V W
if
๋๋ 
(
๋๋ 
DateTime
๋๋ 
.
๋๋ 
Now
๋๋ 
-
๋๋ 
_cacheLastCleaned
๋๋ 0
>
๋๋1 2
TimeSpan
๋๋3 ;
.
๋๋; <
FromMinutes
๋๋< G
(
๋๋G H
$num
๋๋H J
)
๋๋J K
)
๋๋K L
{
๋๋M N
	RuleCache
์์ 
.
์์ 
Clear
์์ 
(
์์  
)
์์  !
;
์์! "
_cacheLastCleaned
ํํ !
=
ํํ" #
DateTime
ํํ$ ,
.
ํํ, -
Now
ํํ- 0
;
ํํ0 1
}
๎๎ 
	RuleCache
๐๐ 
[
๐๐ 
cacheKey
๐๐ 
]
๐๐ 
=
๐๐  !
result
๐๐" (
;
๐๐( )
}
๑๑ 	
}
๔๔ 
}๕๕ คฅ
?C:\Playnite\_github\OstPlayer\source\DevTools\TemplateEngine.cs
	namespaceWW 	
	OstPlayerWW
 
.WW 
DevToolsWW 
{WW 
public[[ 

static[[ 
class[[ 
TemplateEngine[[ &
{[[' (
private]] 
static]] 
readonly]] 

Dictionary]]  *
<]]* +
string]]+ 1
,]]1 2
Template]]3 ;
>]]; <
TemplateCache]]= J
=]]K L
new]]M P

Dictionary]]Q [
<]][ \
string]]\ b
,]]b c
Template]]d l
>]]l m
(]]m n
)]]n o
;]]o p
private`` 
static`` 
readonly`` 
string``  &
[``& '
]``' (
TemplatePaths``) 6
=``7 8
{``9 :
$straa !
,aa! "
$strbb &
,bb& '
$strcc 
}dd 	
;dd	 

privategg 
staticgg 
readonlygg 
Regexgg  %
ParameterRegexgg& 4
=gg5 6
newgg7 :
Regexgg; @
(gg@ A
$strggA ^
,gg^ _
RegexOptionsgg` l
.ggl m
Compiledggm u
)ggu v
;ggv w
privatehh 
statichh 
readonlyhh 
Regexhh  %
ConditionalRegexhh& 6
=hh7 8
newhh9 <
Regexhh= B
(hhB C
$strhhC i
,hhi j
RegexOptionshhk w
.hhw x
Compiled	hhx 
|
hh 
RegexOptions
hh 
.
hh 

Singleline
hh 
)
hh 
;
hh 
privateii 
staticii 
readonlyii 
Regexii  %
	LoopRegexii& /
=ii0 1
newii2 5
Regexii6 ;
(ii; <
$strii< f
,iif g
RegexOptionsiih t
.iit u
Compilediiu }
|ii~ 
RegexOptions
ii 
.
ii 

Singleline
ii 
)
ii 
;
ii 
privatell 
staticll 
DateTimell 
_cacheLastUpdatedll  1
=ll2 3
DateTimell4 <
.ll< =
MinValuell= E
;llE F
staticnn 
TemplateEnginenn 
(nn 
)nn 
{nn  !&
InitializeBuiltInTemplatesoo &
(oo& '
)oo' (
;oo( )
}pp 	
publiczz 
staticzz 
stringzz  
GenerateFromTemplatezz 1
(zz1 2
stringzz2 8
templateNamezz9 E
,zzE F

DictionaryzzG Q
<zzQ R
stringzzR X
,zzX Y
objectzzZ `
>zz` a

parameterszzb l
)zzl m
{zzn o
try{{ 
{{{ 
var|| 
template|| 
=|| 
GetTemplate|| *
(||* +
templateName||+ 7
)||7 8
;||8 9
if}} 
(}} 
template}} 
==}} 
null}}  $
)}}$ %
{}}& '
return~~ 
null~~ 
;~~  
} 
return
 
ProcessTemplate
 &
(
& '
template
' /
.
/ 0
Content
0 7
,
7 8

parameters
9 C
)
C D
;
D E
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
null
 
;
 
}
 
}
 	
public
 
static
 
bool
 $
CreateFileFromTemplate
 1
(
1 2
string
2 8
templatePath
9 E
,
E F
string
G M

outputPath
N X
,
X Y
object
Z `
model
a f
)
f g
{
h i
try
 
{
 
var
 
template
 
=
 "
LoadTemplateFromFile
 3
(
3 4
templatePath
4 @
)
@ A
;
A B
if
 
(
 
template
 
==
 
null
  $
)
$ %
{
& '
return
 
false
  
;
  !
}
 
var
 

parameters
 
=
  '
ConvertObjectToDictionary
! :
(
: ;
model
; @
)
@ A
;
A B
var
 
content
 
=
 
ProcessTemplate
 -
(
- .
template
. 6
.
6 7
Content
7 >
,
> ?

parameters
@ J
)
J K
;
K L
var
 
	outputDir
 
=
 
Path
  $
.
$ %
GetDirectoryName
% 5
(
5 6

outputPath
6 @
)
@ A
;
A B
if
 
(
 
!
 
string
 
.
 
IsNullOrEmpty
 )
(
) *
	outputDir
* 3
)
3 4
&&
5 7
!
8 9
	Directory
9 B
.
B C
Exists
C I
(
I J
	outputDir
J S
)
S T
)
T U
{
V W
	Directory
 
.
 
CreateDirectory
 -
(
- .
	outputDir
. 7
)
7 8
;
8 9
}
 
File
 
.
 
WriteAllText
 !
(
! "

outputPath
" ,
,
, -
content
. 5
,
5 6
Encoding
7 ?
.
? @
UTF8
@ D
)
D E
;
E F
return
 
true
 
;
 
}
กก 
catch
ขข 
(
ขข 
	Exception
ขข 
)
ขข 
{
ขข 
return
ฃฃ 
false
ฃฃ 
;
ฃฃ 
}
คค 
}
ฅฅ 	
private
ญญ 
static
ญญ 
string
ญญ 
ProcessTemplate
ญญ -
(
ญญ- .
string
ญญ. 4
templateContent
ญญ5 D
,
ญญD E

Dictionary
ญญF P
<
ญญP Q
string
ญญQ W
,
ญญW X
object
ญญY _
>
ญญ_ `

parameters
ญญa k
)
ญญk l
{
ญญm n
var
ฎฎ 
result
ฎฎ 
=
ฎฎ 
templateContent
ฎฎ (
;
ฎฎ( )
result
ฑฑ 
=
ฑฑ !
ProcessConditionals
ฑฑ (
(
ฑฑ( )
result
ฑฑ) /
,
ฑฑ/ 0

parameters
ฑฑ1 ;
)
ฑฑ; <
;
ฑฑ< =
result
ดด 
=
ดด 
ProcessLoops
ดด !
(
ดด! "
result
ดด" (
,
ดด( )

parameters
ดด* 4
)
ดด4 5
;
ดด5 6
result
ทท 
=
ทท 
ProcessParameters
ทท &
(
ทท& '
result
ทท' -
,
ทท- .

parameters
ทท/ 9
)
ทท9 :
;
ทท: ;
result
บบ 
=
บบ %
ProcessSpecialFunctions
บบ ,
(
บบ, -
result
บบ- 3
,
บบ3 4

parameters
บบ5 ?
)
บบ? @
;
บบ@ A
return
ผผ 
result
ผผ 
;
ผผ 
}
ฝฝ 	
public
ศศ 
static
ศศ 
List
ศศ 
<
ศศ 
Template
ศศ #
>
ศศ# $#
GetAvailableTemplates
ศศ% :
(
ศศ: ;
string
ศศ; A
category
ศศB J
=
ศศK L
null
ศศM Q
)
ศศQ R
{
ศศS T"
RefreshTemplateCache
ษษ  
(
ษษ  !
)
ษษ! "
;
ษษ" #
var
หห 
	templates
หห 
=
หห 
TemplateCache
หห )
.
หห) *
Values
หห* 0
.
หห0 1
ToList
หห1 7
(
หห7 8
)
หห8 9
;
หห9 :
if
ออ 
(
ออ 
!
ออ 
string
ออ 
.
ออ 
IsNullOrEmpty
ออ %
(
ออ% &
category
ออ& .
)
ออ. /
)
ออ/ 0
{
ออ1 2
	templates
ฮฮ 
=
ฮฮ 
	templates
ฮฮ %
.
ฮฮ% &
Where
ฮฮ& +
(
ฮฮ+ ,
t
ฮฮ, -
=>
ฮฮ. 0
t
ฮฮ1 2
.
ฮฮ2 3
Category
ฮฮ3 ;
.
ฮฮ; <
Equals
ฮฮ< B
(
ฮฮB C
category
ฮฮC K
,
ฮฮK L
StringComparison
ฮฮM ]
.
ฮฮ] ^
OrdinalIgnoreCase
ฮฮ^ o
)
ฮฮo p
)
ฮฮp q
.
ฮฮq r
ToList
ฮฮr x
(
ฮฮx y
)
ฮฮy z
;
ฮฮz {
}
ฯฯ 
return
ัั 
	templates
ัั 
;
ัั 
}
าา 	
public
ูู 
static
ูู 
bool
ูู 
ValidateTemplate
ูู +
(
ูู+ ,
string
ูู, 2
templateContent
ูู3 B
)
ููB C
{
ููD E
try
ฺฺ 
{
ฺฺ 
var
 
ifCount
 
=
 
Regex
 #
.
# $
Matches
$ +
(
+ ,
templateContent
, ;
,
; <
$str
= Q
)
Q R
.
R S
Count
S X
;
X Y
var
 

endIfCount
 
=
  
Regex
! &
.
& '
Matches
' .
(
. /
templateContent
/ >
,
> ?
$str
@ N
)
N O
.
O P
Count
P U
;
U V
if
 
(
 
ifCount
 
!=
 

endIfCount
 )
)
) *
{
+ ,
return
฿฿ 
false
฿฿  
;
฿฿  !
}
เเ 
var
ใใ 
	eachCount
ใใ 
=
ใใ 
Regex
ใใ  %
.
ใใ% &
Matches
ใใ& -
(
ใใ- .
templateContent
ใใ. =
,
ใใ= >
$str
ใใ? U
)
ใใU V
.
ใใV W
Count
ใใW \
;
ใใ\ ]
var
ไไ 
endEachCount
ไไ  
=
ไไ! "
Regex
ไไ# (
.
ไไ( )
Matches
ไไ) 0
(
ไไ0 1
templateContent
ไไ1 @
,
ไไ@ A
$str
ไไB R
)
ไไR S
.
ไไS T
Count
ไไT Y
;
ไไY Z
if
ๅๅ 
(
ๅๅ 
	eachCount
ๅๅ 
!=
ๅๅ  
endEachCount
ๅๅ! -
)
ๅๅ- .
{
ๅๅ/ 0
return
ๆๆ 
false
ๆๆ  
;
ๆๆ  !
}
็็ 
var
๊๊ 
paramMatches
๊๊  
=
๊๊! "
ParameterRegex
๊๊# 1
.
๊๊1 2
Matches
๊๊2 9
(
๊๊9 :
templateContent
๊๊: I
)
๊๊I J
;
๊๊J K
foreach
๋๋ 
(
๋๋ 
Match
๋๋ 
match
๋๋ $
in
๋๋% '
paramMatches
๋๋( 4
)
๋๋4 5
{
๋๋6 7
var
์์ 
	paramName
์์ !
=
์์" #
match
์์$ )
.
์์) *
Groups
์์* 0
[
์์0 1
$num
์์1 2
]
์์2 3
.
์์3 4
Value
์์4 9
;
์์9 :
if
ํํ 
(
ํํ 
string
ํํ 
.
ํํ  
IsNullOrWhiteSpace
ํํ 1
(
ํํ1 2
	paramName
ํํ2 ;
)
ํํ; <
)
ํํ< =
{
ํํ> ?
return
๎๎ 
false
๎๎ $
;
๎๎$ %
}
๏๏ 
}
๐๐ 
return
๒๒ 
true
๒๒ 
;
๒๒ 
}
๓๓ 
catch
๔๔ 
(
๔๔ 
	Exception
๔๔ 
)
๔๔ 
{
๔๔ 
return
๕๕ 
false
๕๕ 
;
๕๕ 
}
๖๖ 
}
๗๗ 	
public
 
static
 
bool
 
RegisterTemplate
 +
(
+ ,
string
, 2
name
3 7
,
7 8
string
9 ?
content
@ G
,
G H
string
I O
category
P X
,
X Y
string
Z `
description
a l
=
m n
null
o s
)
s t
{
u v
try
 
{
 
if
 
(
 
!
 
ValidateTemplate
 %
(
% &
content
& -
)
- .
)
. /
{
0 1
return
 
false
  
;
  !
}
 
var
 
template
 
=
 
new
 "
Template
# +
{
, -
Name
 
=
 
name
 
,
  
Content
 
=
 
content
 %
,
% &
Category
 
=
 
category
 '
,
' (
Description
 
=
  !
description
" -
??
. 0
$"
1 3
$str
3 :
{
: ;
category
; C
}
C D
$str
D M
"
M N
,
N O
	IsBuiltIn
 
=
 
false
  %
}
 
;
 
TemplateCache
 
[
 
name
 "
]
" #
=
$ %
template
& .
;
. /
return
 
true
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
private
กก 
static
กก 
string
กก !
ProcessConditionals
กก 1
(
กก1 2
string
กก2 8
content
กก9 @
,
กก@ A

Dictionary
กกB L
<
กกL M
string
กกM S
,
กกS T
object
กกU [
>
กก[ \

parameters
กก] g
)
กกg h
{
กกi j
return
ขข 
ConditionalRegex
ขข #
.
ขข# $
Replace
ขข$ +
(
ขข+ ,
content
ขข, 3
,
ขข3 4
match
ขข5 :
=>
ขข; =
{
ขข> ?
var
ฃฃ 
	condition
ฃฃ 
=
ฃฃ 
match
ฃฃ  %
.
ฃฃ% &
Groups
ฃฃ& ,
[
ฃฃ, -
$num
ฃฃ- .
]
ฃฃ. /
.
ฃฃ/ 0
Value
ฃฃ0 5
;
ฃฃ5 6
var
คค 
innerContent
คค  
=
คค! "
match
คค# (
.
คค( )
Groups
คค) /
[
คค/ 0
$num
คค0 1
]
คค1 2
.
คค2 3
Value
คค3 8
;
คค8 9
if
ฆฆ 
(
ฆฆ 

parameters
ฆฆ 
.
ฆฆ 
ContainsKey
ฆฆ *
(
ฆฆ* +
	condition
ฆฆ+ 4
)
ฆฆ4 5
&&
ฆฆ6 8
IsTrue
ฆฆ9 ?
(
ฆฆ? @

parameters
ฆฆ@ J
[
ฆฆJ K
	condition
ฆฆK T
]
ฆฆT U
)
ฆฆU V
)
ฆฆV W
{
ฆฆX Y
return
งง 
innerContent
งง '
;
งง' (
}
จจ 
return
ชช 
string
ชช 
.
ชช 
Empty
ชช #
;
ชช# $
}
ซซ 
)
ซซ 
;
ซซ 
}
ฌฌ 	
private
ดด 
static
ดด 
string
ดด 
ProcessLoops
ดด *
(
ดด* +
string
ดด+ 1
content
ดด2 9
,
ดด9 :

Dictionary
ดด; E
<
ดดE F
string
ดดF L
,
ดดL M
object
ดดN T
>
ดดT U

parameters
ดดV `
)
ดด` a
{
ดดb c
return
ตต 
	LoopRegex
ตต 
.
ตต 
Replace
ตต $
(
ตต$ %
content
ตต% ,
,
ตต, -
match
ตต. 3
=>
ตต4 6
{
ตต7 8
var
ถถ 
	arrayName
ถถ 
=
ถถ 
match
ถถ  %
.
ถถ% &
Groups
ถถ& ,
[
ถถ, -
$num
ถถ- .
]
ถถ. /
.
ถถ/ 0
Value
ถถ0 5
;
ถถ5 6
var
ทท 
loopContent
ทท 
=
ทท  !
match
ทท" '
.
ทท' (
Groups
ทท( .
[
ทท. /
$num
ทท/ 0
]
ทท0 1
.
ทท1 2
Value
ทท2 7
;
ทท7 8
if
นน 
(
นน 
!
นน 

parameters
นน 
.
นน  
ContainsKey
นน  +
(
นน+ ,
	arrayName
นน, 5
)
นน5 6
)
นน6 7
{
นน8 9
return
บบ 
string
บบ !
.
บบ! "
Empty
บบ" '
;
บบ' (
}
ปป 
var
ฝฝ 
array
ฝฝ 
=
ฝฝ 

parameters
ฝฝ &
[
ฝฝ& '
	arrayName
ฝฝ' 0
]
ฝฝ0 1
as
ฝฝ2 4
IEnumerable
ฝฝ5 @
<
ฝฝ@ A
object
ฝฝA G
>
ฝฝG H
;
ฝฝH I
if
พพ 
(
พพ 
array
พพ 
==
พพ 
null
พพ !
)
พพ! "
{
พพ# $
return
ฟฟ 
string
ฟฟ !
.
ฟฟ! "
Empty
ฟฟ" '
;
ฟฟ' (
}
ภภ 
var
ยย 
result
ยย 
=
ยย 
new
ยย  
StringBuilder
ยย! .
(
ยย. /
)
ยย/ 0
;
ยย0 1
foreach
รร 
(
รร 
var
รร 
item
รร !
in
รร" $
array
รร% *
)
รร* +
{
รร, -
var
ฤฤ 
itemContent
ฤฤ #
=
ฤฤ$ %
loopContent
ฤฤ& 1
;
ฤฤ1 2
itemContent
วว 
=
วว  !
itemContent
วว" -
.
วว- .
Replace
วว. 5
(
วว5 6
$str
วว6 @
,
วว@ A
item
ววB F
?
ววF G
.
ววG H
ToString
ววH P
(
ววP Q
)
ววQ R
??
ววS U
string
ววV \
.
วว\ ]
Empty
วว] b
)
ววb c
;
ววc d
if
สส 
(
สส 
item
สส 
is
สส 

Dictionary
สส  *
<
สส* +
string
สส+ 1
,
สส1 2
object
สส3 9
>
สส9 :
itemDict
สส; C
)
สสC D
{
สสE F
foreach
หห 
(
หห  !
var
หห! $
prop
หห% )
in
หห* ,
itemDict
หห- 5
)
หห5 6
{
หห7 8
itemContent
ฬฬ '
=
ฬฬ( )
itemContent
ฬฬ* 5
.
ฬฬ5 6
Replace
ฬฬ6 =
(
ฬฬ= >
$"
ฬฬ> @
$str
ฬฬ@ D
{
ฬฬD E
prop
ฬฬE I
.
ฬฬI J
Key
ฬฬJ M
}
ฬฬM N
$str
ฬฬN R
"
ฬฬR S
,
ฬฬS T
prop
ฬฬU Y
.
ฬฬY Z
Value
ฬฬZ _
?
ฬฬ_ `
.
ฬฬ` a
ToString
ฬฬa i
(
ฬฬi j
)
ฬฬj k
??
ฬฬl n
string
ฬฬo u
.
ฬฬu v
Empty
ฬฬv {
)
ฬฬ{ |
;
ฬฬ| }
}
ออ 
}
ฮฮ 
result
ะะ 
.
ะะ 

AppendLine
ะะ %
(
ะะ% &
itemContent
ะะ& 1
)
ะะ1 2
;
ะะ2 3
}
ัั 
return
ำำ 
result
ำำ 
.
ำำ 
ToString
ำำ &
(
ำำ& '
)
ำำ' (
;
ำำ( )
}
ิิ 
)
ิิ 
;
ิิ 
}
ีี 	
private
 
static
 
string
 
ProcessParameters
 /
(
/ 0
string
0 6
content
7 >
,
> ?

Dictionary
@ J
<
J K
string
K Q
,
Q R
object
S Y
>
Y Z

parameters
[ e
)
e f
{
g h
return
 
ParameterRegex
 !
.
! "
Replace
" )
(
) *
content
* 1
,
1 2
match
3 8
=>
9 ;
{
< =
var
฿฿ 
	paramName
฿฿ 
=
฿฿ 
match
฿฿  %
.
฿฿% &
Groups
฿฿& ,
[
฿฿, -
$num
฿฿- .
]
฿฿. /
.
฿฿/ 0
Value
฿฿0 5
;
฿฿5 6
var
เเ 
defaultValue
เเ  
=
เเ! "
match
เเ# (
.
เเ( )
Groups
เเ) /
[
เเ/ 0
$num
เเ0 1
]
เเ1 2
.
เเ2 3
Success
เเ3 :
?
เเ; <
match
เเ= B
.
เเB C
Groups
เเC I
[
เเI J
$num
เเJ K
]
เเK L
.
เเL M
Value
เเM R
:
เเS T
string
เเU [
.
เเ[ \
Empty
เเ\ a
;
เเa b
if
โโ 
(
โโ 

parameters
โโ 
.
โโ 
ContainsKey
โโ *
(
โโ* +
	paramName
โโ+ 4
)
โโ4 5
)
โโ5 6
{
โโ7 8
return
ใใ 

parameters
ใใ %
[
ใใ% &
	paramName
ใใ& /
]
ใใ/ 0
?
ใใ0 1
.
ใใ1 2
ToString
ใใ2 :
(
ใใ: ;
)
ใใ; <
??
ใใ= ?
defaultValue
ใใ@ L
;
ใใL M
}
ไไ 
return
ๆๆ 
defaultValue
ๆๆ #
;
ๆๆ# $
}
็็ 
)
็็ 
;
็็ 
}
่่ 	
private
๐๐ 
static
๐๐ 
string
๐๐ %
ProcessSpecialFunctions
๐๐ 5
(
๐๐5 6
string
๐๐6 <
content
๐๐= D
,
๐๐D E

Dictionary
๐๐F P
<
๐๐P Q
string
๐๐Q W
,
๐๐W X
object
๐๐Y _
>
๐๐_ `

parameters
๐๐a k
)
๐๐k l
{
๐๐m n
content
๒๒ 
=
๒๒ 
content
๒๒ 
.
๒๒ 
Replace
๒๒ %
(
๒๒% &
$str
๒๒& 7
,
๒๒7 8

DateHelper
๒๒9 C
.
๒๒C D"
GetCurrentDateString
๒๒D X
(
๒๒X Y
)
๒๒Y Z
)
๒๒Z [
;
๒๒[ \
content
๓๓ 
=
๓๓ 
content
๓๓ 
.
๓๓ 
Replace
๓๓ %
(
๓๓% &
$str
๓๓& 7
,
๓๓7 8
DateTime
๓๓9 A
.
๓๓A B
Now
๓๓B E
.
๓๓E F
Year
๓๓F J
.
๓๓J K
ToString
๓๓K S
(
๓๓S T
)
๓๓T U
)
๓๓U V
;
๓๓V W
content
๖๖ 
=
๖๖ 
content
๖๖ 
.
๖๖ 
Replace
๖๖ %
(
๖๖% &
$str
๖๖& 7
,
๖๖7 8
$str
๖๖9 D
)
๖๖D E
;
๖๖E F
content
๗๗ 
=
๗๗ 
content
๗๗ 
.
๗๗ 
Replace
๗๗ %
(
๗๗% &
$str
๗๗& 2
,
๗๗2 3
$str
๗๗4 >
)
๗๗> ?
;
๗๗? @
content
๘๘ 
=
๘๘ 
content
๘๘ 
.
๘๘ 
Replace
๘๘ %
(
๘๘% &
$str
๘๘& 5
,
๘๘5 6
$str
๘๘7 M
)
๘๘M N
;
๘๘N O
content
๙๙ 
=
๙๙ 
content
๙๙ 
.
๙๙ 
Replace
๙๙ %
(
๙๙% &
$str
๙๙& 9
,
๙๙9 :
$str
๙๙; C
)
๙๙C D
;
๙๙D E
return
๛๛ 
content
๛๛ 
;
๛๛ 
}
 	
private
 
static
 
Template
 
GetTemplate
  +
(
+ ,
string
, 2
templateName
3 ?
)
? @
{
A B"
RefreshTemplateCache
  
(
  !
)
! "
;
" #
return
 
TemplateCache
  
.
  !
ContainsKey
! ,
(
, -
templateName
- 9
)
9 :
?
; <
TemplateCache
= J
[
J K
templateName
K W
]
W X
:
Y Z
null
[ _
;
_ `
}
 	
private
 
static
 
Template
 "
LoadTemplateFromFile
  4
(
4 5
string
5 ;
templatePath
< H
)
H I
{
J K
try
 
{
 
if
 
(
 
!
 
File
 
.
 
Exists
  
(
  !
templatePath
! -
)
- .
)
. /
{
0 1
return
 
null
 
;
  
}
 
var
 
content
 
=
 
File
 "
.
" #
ReadAllText
# .
(
. /
templatePath
/ ;
,
; <
Encoding
= E
.
E F
UTF8
F J
)
J K
;
K L
var
 
fileName
 
=
 
Path
 #
.
# $)
GetFileNameWithoutExtension
$ ?
(
? @
templatePath
@ L
)
L M
;
M N
var
 
category
 
=
 '
DetermineCategoryFromPath
 8
(
8 9
templatePath
9 E
)
E F
;
F G
return
 
new
 
Template
 #
{
$ %
Name
 
=
 
fileName
 #
,
# $
Content
 
=
 
content
 %
,
% &
Category
 
=
 
category
 '
,
' (
Description
 
=
  !
$"
" $
$str
$ 9
{
9 :
templatePath
: F
}
F G
"
G H
,
H I
	IsBuiltIn
กก 
=
กก 
false
กก  %
}
ขข 
;
ขข 
}
ฃฃ 
catch
คค 
(
คค 
	Exception
คค 
)
คค 
{
คค 
return
ฅฅ 
null
ฅฅ 
;
ฅฅ 
}
ฆฆ 
}
งง 	
private
ฌฌ 
static
ฌฌ 
void
ฌฌ "
RefreshTemplateCache
ฌฌ 0
(
ฌฌ0 1
)
ฌฌ1 2
{
ฌฌ3 4
if
ญญ 
(
ญญ 
DateTime
ญญ 
.
ญญ 
Now
ญญ 
-
ญญ 
_cacheLastUpdated
ญญ 0
<
ญญ1 2
TimeSpan
ญญ3 ;
.
ญญ; <
FromMinutes
ญญ< G
(
ญญG H
$num
ญญH I
)
ญญI J
)
ญญJ K
{
ญญL M
return
ฎฎ 
;
ฎฎ 
}
ฏฏ 
foreach
ฑฑ 
(
ฑฑ 
var
ฑฑ 
templatePath
ฑฑ %
in
ฑฑ& (
TemplatePaths
ฑฑ) 6
)
ฑฑ6 7
{
ฑฑ8 9
if
ฒฒ 
(
ฒฒ 
	Directory
ฒฒ 
.
ฒฒ 
Exists
ฒฒ $
(
ฒฒ$ %
templatePath
ฒฒ% 1
)
ฒฒ1 2
)
ฒฒ2 3
{
ฒฒ4 5(
LoadTemplatesFromDirectory
ณณ .
(
ณณ. /
templatePath
ณณ/ ;
)
ณณ; <
;
ณณ< =
}
ดด 
}
ตต 
_cacheLastUpdated
ทท 
=
ทท 
DateTime
ทท  (
.
ทท( )
Now
ทท) ,
;
ทท, -
}
ธธ 	
private
พพ 
static
พพ 
void
พพ (
LoadTemplatesFromDirectory
พพ 6
(
พพ6 7
string
พพ7 =
directoryPath
พพ> K
)
พพK L
{
พพM N
try
ฟฟ 
{
ฟฟ 
var
ภภ 
templateFiles
ภภ !
=
ภภ" #
	Directory
ภภ$ -
.
ภภ- .
GetFiles
ภภ. 6
(
ภภ6 7
directoryPath
ภภ7 D
,
ภภD E
$str
ภภF R
,
ภภR S
SearchOption
ภภT `
.
ภภ` a
AllDirectories
ภภa o
)
ภภo p
;
ภภp q
foreach
ยย 
(
ยย 
var
ยย 
templateFile
ยย )
in
ยย* ,
templateFiles
ยย- :
)
ยย: ;
{
ยย< =
var
รร 
template
รร  
=
รร! ""
LoadTemplateFromFile
รร# 7
(
รร7 8
templateFile
รร8 D
)
รรD E
;
รรE F
if
ฤฤ 
(
ฤฤ 
template
ฤฤ  
!=
ฤฤ! #
null
ฤฤ$ (
)
ฤฤ( )
{
ฤฤ* +
TemplateCache
ลล %
[
ลล% &
template
ลล& .
.
ลล. /
Name
ลล/ 3
]
ลล3 4
=
ลล5 6
template
ลล7 ?
;
ลล? @
}
ฦฦ 
}
วว 
}
ศศ 
catch
ษษ 
(
ษษ 
	Exception
ษษ 
)
ษษ 
{
ษษ 
}
หห 
}
ฬฬ 	
private
ีี 
static
ีี 
void
ีี (
InitializeBuiltInTemplates
ีี 6
(
ีี6 7
)
ีี7 8
{
ีี9 :
RegisterTemplate
ืื 
(
ืื 
$str
ืื *
,
ืื* +
$str
ื, 
,
 
$str
 
,
 
$str
 '
)
' (
;
( )
RegisterTemplate
 
(
 
$str
 (
,
( )
$str
ๆ* 
,
ๆๆ 
$str
ๆๆ 
,
ๆๆ 
$str
ๆๆ '
)
ๆๆ' (
;
ๆๆ( )
RegisterTemplate
้้ 
(
้้ 
$str
้้ &
,
้้& '
$str
้( 
,
 
$str
 
,
 
$str
 &
)
& '
;
' (
RegisterTemplate
 
(
 
$str
 ,
,
, -
$str
ฟ. 
,
ฟฟ 
$str
ฟฟ 
,
ฟฟ 
$str
ฟฟ ;
)
ฟฟ; <
;
ฟฟ< =
}
ภภ 	
private
หห 
static
หห 

Dictionary
หห !
<
หห! "
string
หห" (
,
หห( )
object
หห* 0
>
หห0 1'
ConvertObjectToDictionary
หห2 K
(
หหK L
object
หหL R
obj
หหS V
)
หหV W
{
หหX Y
var
ฬฬ 
result
ฬฬ 
=
ฬฬ 
new
ฬฬ 

Dictionary
ฬฬ '
<
ฬฬ' (
string
ฬฬ( .
,
ฬฬ. /
object
ฬฬ0 6
>
ฬฬ6 7
(
ฬฬ7 8
)
ฬฬ8 9
;
ฬฬ9 :
if
ฮฮ 
(
ฮฮ 
obj
ฮฮ 
==
ฮฮ 
null
ฮฮ 
)
ฮฮ 
{
ฮฮ 
return
ฯฯ 
result
ฯฯ 
;
ฯฯ 
}
ะะ 
if
าา 
(
าา 
obj
าา 
is
าา 

Dictionary
าา !
<
าา! "
string
าา" (
,
าา( )
object
าา* 0
>
าา0 1
dict
าา2 6
)
าา6 7
{
าา8 9
return
ำำ 
dict
ำำ 
;
ำำ 
}
ิิ 
var
ืื 

properties
ืื 
=
ืื 
obj
ืื  
.
ืื  !
GetType
ืื! (
(
ืื( )
)
ืื) *
.
ืื* +
GetProperties
ืื+ 8
(
ืื8 9
)
ืื9 :
;
ืื: ;
foreach
ุุ 
(
ุุ 
var
ุุ 
prop
ุุ 
in
ุุ  

properties
ุุ! +
)
ุุ+ ,
{
ุุ- .
try
ูู 
{
ูู 
var
ฺฺ 
value
ฺฺ 
=
ฺฺ 
prop
ฺฺ  $
.
ฺฺ$ %
GetValue
ฺฺ% -
(
ฺฺ- .
obj
ฺฺ. 1
)
ฺฺ1 2
;
ฺฺ2 3
result
 
[
 
prop
 
.
  
Name
  $
]
$ %
=
& '
value
( -
;
- .
}
 
catch
 
(
 
	Exception
  
)
  !
{
" #
}
฿฿ 
}
เเ 
return
โโ 
result
โโ 
;
โโ 
}
ใใ 	
private
๊๊ 
static
๊๊ 
bool
๊๊ 
IsTrue
๊๊ "
(
๊๊" #
object
๊๊# )
value
๊๊* /
)
๊๊/ 0
{
๊๊1 2
if
๋๋ 
(
๋๋ 
value
๋๋ 
==
๋๋ 
null
๋๋ 
)
๋๋ 
{
๋๋  
return
์์ 
false
์์ 
;
์์ 
}
ํํ 
if
๏๏ 
(
๏๏ 
value
๏๏ 
is
๏๏ 
bool
๏๏ 
	boolValue
๏๏ '
)
๏๏' (
{
๏๏) *
return
๐๐ 
	boolValue
๐๐  
;
๐๐  !
}
๑๑ 
if
๓๓ 
(
๓๓ 
value
๓๓ 
is
๓๓ 
string
๓๓ 
stringValue
๓๓  +
)
๓๓+ ,
{
๓๓- .
return
๔๔ 
!
๔๔ 
string
๔๔ 
.
๔๔  
IsNullOrWhiteSpace
๔๔ 1
(
๔๔1 2
stringValue
๔๔2 =
)
๔๔= >
&&
๔๔? A
!
๕๕ 
stringValue
๕๕ #
.
๕๕# $
Equals
๕๕$ *
(
๕๕* +
$str
๕๕+ 2
,
๕๕2 3
StringComparison
๕๕4 D
.
๕๕D E
OrdinalIgnoreCase
๕๕E V
)
๕๕V W
;
๕๕W X
}
๖๖ 
if
๘๘ 
(
๘๘ 
value
๘๘ 
is
๘๘ 
int
๘๘ 
intValue
๘๘ %
)
๘๘% &
{
๘๘' (
return
๙๙ 
intValue
๙๙ 
!=
๙๙  "
$num
๙๙# $
;
๙๙$ %
}
๚๚ 
return
 
true
 
;
 
}
 	
private
 
static
 
string
 '
DetermineCategoryFromPath
 7
(
7 8
string
8 >
path
? C
)
C D
{
E F
var
 
	extension
 
=
 
Path
  
.
  !
GetExtension
! -
(
- .
path
. 2
)
2 3
.
3 4
ToLowerInvariant
4 D
(
D E
)
E F
;
F G
var
 
	directory
 
=
 
Path
  
.
  !
GetDirectoryName
! 1
(
1 2
path
2 6
)
6 7
.
7 8
ToLowerInvariant
8 H
(
H I
)
I J
;
J K
if
 
(
 
	directory
 
.
 
Contains
 "
(
" #
$str
# +
)
+ ,
||
- /
	extension
0 9
==
: <
$str
= B
)
B C
{
D E
return
 
$str
 
;
  
}
 
if
 
(
 
	directory
 
.
 
Contains
 "
(
" #
$str
# )
)
) *
||
+ -
	extension
. 7
==
8 :
$str
; B
)
B C
{
D E
return
 
$str
 
;
 
}
 
if
 
(
 
	directory
 
.
 
Contains
 "
(
" #
$str
# (
)
( )
||
* ,
	extension
- 6
==
7 9
$str
: ?
)
? @
{
A B
return
 
$str
 &
;
& '
}
 
if
 
(
 
	directory
 
.
 
Contains
 "
(
" #
$str
# /
)
/ 0
||
1 3
	extension
4 =
==
> @
$str
A G
)
G H
{
I J
return
 
$str
 #
;
# $
}
 
return
 
$str
 
;
 
}
 	
}
 
public
 

class
 
Template
 
{
 
public
ขข 
string
ขข 
Name
ขข 
{
ขข 
get
ขข  
;
ขข  !
set
ขข" %
;
ขข% &
}
ขข' (
public
งง 
string
งง 
Content
งง 
{
งง 
get
งง  #
;
งง# $
set
งง% (
;
งง( )
}
งง* +
public
ฌฌ 
string
ฌฌ 
Category
ฌฌ 
{
ฌฌ  
get
ฌฌ! $
;
ฌฌ$ %
set
ฌฌ& )
;
ฌฌ) *
}
ฌฌ+ ,
public
ฑฑ 
string
ฑฑ 
Description
ฑฑ !
{
ฑฑ" #
get
ฑฑ$ '
;
ฑฑ' (
set
ฑฑ) ,
;
ฑฑ, -
}
ฑฑ. /
public
ถถ 
bool
ถถ 
	IsBuiltIn
ถถ 
{
ถถ 
get
ถถ  #
;
ถถ# $
set
ถถ% (
;
ถถ( )
}
ถถ* +
public
ปป 
List
ปป 
<
ปป 
TemplateParameter
ปป %
>
ปป% &

Parameters
ปป' 1
{
ปป2 3
get
ปป4 7
;
ปป7 8
set
ปป9 <
;
ปป< =
}
ปป> ?
=
ปป@ A
new
ปปB E
List
ปปF J
<
ปปJ K
TemplateParameter
ปปK \
>
ปป\ ]
(
ปป] ^
)
ปป^ _
;
ปป_ `
}
ผผ 
public
มม 

class
มม 
TemplateParameter
มม "
{
มม# $
public
ลล 
string
ลล 
Name
ลล 
{
ลล 
get
ลล  
;
ลล  !
set
ลล" %
;
ลล% &
}
ลล' (
public
สส 
string
สส 
Description
สส !
{
สส" #
get
สส$ '
;
สส' (
set
สส) ,
;
สส, -
}
สส. /
public
ฯฯ 
string
ฯฯ 
Type
ฯฯ 
{
ฯฯ 
get
ฯฯ  
;
ฯฯ  !
set
ฯฯ" %
;
ฯฯ% &
}
ฯฯ' (
public
ิิ 
bool
ิิ 

IsRequired
ิิ 
{
ิิ  
get
ิิ! $
;
ิิ$ %
set
ิิ& )
;
ิิ) *
}
ิิ+ ,
public
ูู 
string
ูู 
DefaultValue
ูู "
{
ูู# $
get
ูู% (
;
ูู( )
set
ูู* -
;
ูู- .
}
ูู/ 0
}
ฺฺ 
} ุ
DC:\Playnite\_github\OstPlayer\source\DevTools\ModuleUpdateService.cs
	namespaceSS 	
	OstPlayerSS
 
.SS 
DevToolsSS 
{TT 
publicYY 

staticYY 
classYY 
ModuleUpdateServiceYY +
{ZZ 
privateaa 
staticaa 
readonlyaa 

Dictionaryaa  *
<aa* +
stringaa+ 1
,aa1 2
stringaa3 9
>aa9 :
TrackedModulesaa; I
=aaJ K
newaaL O

DictionaryaaP Z
<aaZ [
stringbb 
,bb 
stringcc 
>dd 	
{ee 	
{ff 
$strff 
,ff 
$strff J
}ffK L
,ffL M
{gg 
$strgg 
,gg 
$strgg E
}ggF G
,ggG H
{hh 
$strhh 
,hh 
$strhh =
}hh> ?
,hh? @
{ii 
$strii 
,ii 
$strii <
}ii= >
,ii> ?
{jj 
$strjj 
,jj 
$strjj :
}jj; <
,jj< =
{kk 
$strkk 
,kk 
$strkk 5
}kk6 7
,kk7 8
{ll 
$strll 
,ll 
$strll ?
}ll@ A
,llA B
{mm 
$strmm 
,mm 
$strmm C
}mmD E
,mmE F
}nn 	
;nn	 

privatess 
staticss 
readonlyss 
HashSetss  '
<ss' (
stringss( .
>ss. /
MonitoredExtensionsss0 C
=ssD E
newssF I
HashSetssJ Q
<ssQ R
stringssR X
>ssX Y
{tt 	
$struu 
,uu 
$strvv 
,vv 
$strww 
,ww 
$strxx 
,xx 
$stryy 
,yy 
$strzz 
,zz 
}{{ 	
;{{	 

private
 
static
 
readonly
 
List
  $
<
$ %
string
% +
>
+ ,
IgnorePatterns
- ;
=
< =
new
> A
List
B F
<
F G
string
G M
>
M N
{
 	
$str
 
,
 
$str
 
,
 
$str
 
,
 
$str
 
,
 
$str
 
,
 
$str
 '
,
' (
}
 	
;
	 

private
 
static
 
readonly
 

Dictionary
  *
<
* +
string
+ 1
,
1 2
DateTime
3 ;
>
; <
_recentChanges
= K
=
L M
new
 

Dictionary
 
<
 
string
 !
,
! "
DateTime
# +
>
+ ,
(
, -
)
- .
;
. /
private
 
static
 
readonly
 
object
  &
_lockObject
' 2
=
3 4
new
5 8
object
9 ?
(
? @
)
@ A
;
A B
private
 
static
 
Timer
 
_debounceTimer
 +
;
+ ,
private
 
static
 
readonly
 
HashSet
  '
<
' (
string
( .
>
. /
_pendingChanges
0 ?
=
@ A
new
B E
HashSet
F M
<
M N
string
N T
>
T U
(
U V
)
V W
;
W X
public
ฉฉ 
static
ฉฉ  
ModuleUpdateResult
ฉฉ ( 
ProcessFileChanges
ฉฉ) ;
(
ฉฉ; <
IEnumerable
ฉฉ< G
<
ฉฉG H
string
ฉฉH N
>
ฉฉN O
changedFiles
ฉฉP \
)
ฉฉ\ ]
{
ชช 	
var
ซซ 
result
ซซ 
=
ซซ 
new
ซซ  
ModuleUpdateResult
ซซ /
{
ฌฌ 
ProcessedAt
ญญ 
=
ญญ 
DateTime
ญญ &
.
ญญ& '
Now
ญญ' *
,
ญญ* +
FilesProcessed
ฎฎ 
=
ฎฎ  
changedFiles
ฎฎ! -
.
ฎฎ- .
ToList
ฎฎ. 4
(
ฎฎ4 5
)
ฎฎ5 6
,
ฎฎ6 7
UpdatedModules
ฏฏ 
=
ฏฏ  
new
ฏฏ! $
List
ฏฏ% )
<
ฏฏ) *
string
ฏฏ* 0
>
ฏฏ0 1
(
ฏฏ1 2
)
ฏฏ2 3
,
ฏฏ3 4
Errors
ฐฐ 
=
ฐฐ 
new
ฐฐ 
List
ฐฐ !
<
ฐฐ! "
string
ฐฐ" (
>
ฐฐ( )
(
ฐฐ) *
)
ฐฐ* +
,
ฐฐ+ ,
}
ฑฑ 
;
ฑฑ 
try
ณณ 
{
ดด 
var
ถถ 
relevantFiles
ถถ !
=
ถถ" #!
FilterRelevantFiles
ถถ$ 7
(
ถถ7 8
changedFiles
ถถ8 D
)
ถถD E
;
ถถE F
result
ทท 
.
ทท 
RelevantFiles
ทท $
=
ทท% &
relevantFiles
ทท' 4
.
ทท4 5
ToList
ทท5 ;
(
ทท; <
)
ทท< =
;
ทท= >
if
นน 
(
นน 
!
นน 
relevantFiles
นน "
.
นน" #
Any
นน# &
(
นน& '
)
นน' (
)
นน( )
{
บบ 
result
ปป 
.
ปป 
Message
ปป "
=
ปป# $
$str
ปป% O
;
ปปO P
return
ผผ 
result
ผผ !
;
ผผ! "
}
ฝฝ 
var
ภภ 
recommendations
ภภ #
=
ภภ$ %"
DocumentationManager
ภภ& :
.
ภภ: ;,
GetModuleUpdateRecommendations
ภภ; Y
(
ภภY Z
relevantFiles
มม !
)
ยย 
;
ยย 
result
รร 
.
รร 
Recommendations
รร &
=
รร' (
recommendations
รร) 8
;
รร8 9
var
ฦฦ 
highPriorityRecs
ฦฦ $
=
ฦฦ% &
recommendations
ฦฦ' 6
.
ฦฦ6 7
Where
ฦฦ7 <
(
ฦฦ< =
r
ฦฦ= >
=>
ฦฦ? A
r
ฦฦB C
.
ฦฦC D
Priority
ฦฦD L
>=
ฦฦM O
$num
ฦฦP Q
)
ฦฦQ R
.
ฦฦR S
ToList
ฦฦS Y
(
ฦฦY Z
)
ฦฦZ [
;
ฦฦ[ \
var
วว 
processedCount
วว "
=
วว# $"
DocumentationManager
วว% 9
.
วว9 :0
"ProcessModuleUpdateRecommendations
วว: \
(
วว\ ]
highPriorityRecs
ศศ $
)
ษษ 
;
ษษ 
result
หห 
.
หห 
UpdatedModules
หห %
=
หห& '
highPriorityRecs
หห( 8
.
ฬฬ 
Take
ฬฬ 
(
ฬฬ 
processedCount
ฬฬ (
)
ฬฬ( )
.
ออ 
Select
ออ 
(
ออ 
r
ออ 
=>
ออ  
r
ออ! "
.
ออ" #

ModuleName
ออ# -
)
ออ- .
.
ฮฮ 
ToList
ฮฮ 
(
ฮฮ 
)
ฮฮ 
;
ฮฮ 
result
ฯฯ 
.
ฯฯ 
UpdatedCount
ฯฯ #
=
ฯฯ$ %
processedCount
ฯฯ& 4
;
ฯฯ4 5
result
ะะ 
.
ะะ 
Message
ะะ 
=
ะะ  
$"
ะะ! #
$str
ะะ# 8
{
ะะ8 9
processedCount
ะะ9 G
}
ะะG H
$str
ะะH Y
"
ะะY Z
;
ะะZ [
return
าา 
result
าา 
;
าา 
}
ำำ 
catch
ิิ 
(
ิิ 
	Exception
ิิ 
ex
ิิ 
)
ิิ  
{
ีี 
result
ึึ 
.
ึึ 
Errors
ึึ 
.
ึึ 
Add
ึึ !
(
ึึ! "
$"
ึึ" $
$str
ึึ$ C
{
ึึC D
ex
ึึD F
.
ึึF G
Message
ึึG N
}
ึึN O
"
ึึO P
)
ึึP Q
;
ึึQ R
result
ืื 
.
ืื 
Message
ืื 
=
ืื  
$str
ืื! Q
;
ืืQ R
return
ุุ 
result
ุุ 
;
ุุ 
}
ูู 
}
ฺฺ 	
public
โโ 
static
โโ 
bool
โโ %
ProcessSingleFileChange
โโ 2
(
โโ2 3
string
โโ3 9
filePath
โโ: B
)
โโB C
{
ใใ 	
if
ไไ 
(
ไไ 
string
ไไ 
.
ไไ 
IsNullOrEmpty
ไไ $
(
ไไ$ %
filePath
ไไ% -
)
ไไ- .
)
ไไ. /
return
ๅๅ 
false
ๅๅ 
;
ๅๅ 
var
็็ 
result
็็ 
=
็็  
ProcessFileChanges
็็ +
(
็็+ ,
new
็็, /
[
็็/ 0
]
็็0 1
{
็็2 3
filePath
็็4 <
}
็็= >
)
็็> ?
;
็็? @
return
่่ 
result
่่ 
.
่่ 
UpdatedCount
่่ &
>
่่' (
$num
่่) *
;
่่* +
}
้้ 	
public
๐๐ 
static
๐๐ 
ModuleScanResult
๐๐ &
ScanAllModules
๐๐' 5
(
๐๐5 6
)
๐๐6 7
{
๑๑ 	
var
๒๒ 

scanResult
๒๒ 
=
๒๒ 
new
๒๒  
ModuleScanResult
๒๒! 1
{
๓๓ 
ScanDate
๔๔ 
=
๔๔ 
DateTime
๔๔ #
.
๔๔# $
Now
๔๔$ '
,
๔๔' (
ScannedModules
๕๕ 
=
๕๕  
new
๕๕! $
List
๕๕% )
<
๕๕) *
string
๕๕* 0
>
๕๕0 1
(
๕๕1 2
)
๕๕2 3
,
๕๕3 4"
MissingDocumentation
๖๖ $
=
๖๖% &
new
๖๖' *
List
๖๖+ /
<
๖๖/ 0
string
๖๖0 6
>
๖๖6 7
(
๖๖7 8
)
๖๖8 9
,
๖๖9 :#
OutdatedDocumentation
๗๗ %
=
๗๗& '
new
๗๗( +
List
๗๗, 0
<
๗๗0 1
string
๗๗1 7
>
๗๗7 8
(
๗๗8 9
)
๗๗9 :
,
๗๗: ;
Recommendations
๘๘ 
=
๘๘  !
new
๘๘" %
List
๘๘& *
<
๘๘* +
string
๘๘+ 1
>
๘๘1 2
(
๘๘2 3
)
๘๘3 4
,
๘๘4 5
}
๙๙ 
;
๙๙ 
try
๛๛ 
{
 
foreach
 
(
 
var
 
module
 #
in
$ &
TrackedModules
' 5
)
5 6
{
 
var
 

moduleName
 "
=
# $
module
% +
.
+ ,
Key
, /
;
/ 0
var
 
moduleDescription
 )
=
* +
module
, 2
.
2 3
Value
3 8
;
8 9

scanResult
 
.
 
ScannedModules
 -
.
- .
Add
. 1
(
1 2

moduleName
2 <
)
< =
;
= >
if
 
(
 
!
 
	Directory
 "
.
" #
Exists
# )
(
) *

moduleName
* 4
)
4 5
)
5 6
{
 
continue
  
;
  !
}
 
var
 
summaryPath
 #
=
$ %
ProjectAnalyzer
& 5
.
5 6"
GetModuleSummaryPath
6 J
(
J K

moduleName
K U
)
U V
;
V W
if
 
(
 
!
 
File
 
.
 
Exists
 $
(
$ %
summaryPath
% 0
)
0 1
)
1 2
{
 

scanResult
 "
.
" #"
MissingDocumentation
# 7
.
7 8
Add
8 ;
(
; <

moduleName
< F
)
F G
;
G H

scanResult
 "
.
" #
Recommendations
# 2
.
2 3
Add
3 6
(
6 7
$"
 
$str
 %
{
% &

moduleName
& 0
}
0 1
$str
1 G
"
G H
)
 
;
 
continue
  
;
  !
}
 
if
 
(
 +
IsModuleDocumentationOutdated
 5
(
5 6

moduleName
6 @
,
@ A
summaryPath
B M
)
M N
)
N O
{
 

scanResult
 "
.
" ##
OutdatedDocumentation
# 8
.
8 9
Add
9 <
(
< =

moduleName
= G
)
G H
;
H I

scanResult
 "
.
" #
Recommendations
# 2
.
2 3
Add
3 6
(
6 7
$"
7 9
$str
9 @
{
@ A

moduleName
A K
}
K L
$str
L a
"
a b
)
b c
;
c d
}
 
}
 

scanResult
 
.
 
	IsHealthy
 $
=
% &

scanResult
 
.
 "
MissingDocumentation
 3
.
3 4
Count
4 9
==
: <
$num
= >
&&
 

scanResult
 !
.
! "#
OutdatedDocumentation
" 7
.
7 8
Count
8 =
==
> @
$num
A B
;
B C
}
 
catch
กก 
(
กก 
	Exception
กก 
ex
กก 
)
กก  
{
ขข 

scanResult
ฃฃ 
.
ฃฃ 
	ScanError
ฃฃ $
=
ฃฃ% &
ex
ฃฃ' )
.
ฃฃ) *
Message
ฃฃ* 1
;
ฃฃ1 2

scanResult
คค 
.
คค 
	IsHealthy
คค $
=
คค% &
false
คค' ,
;
คค, -
}
ฅฅ 
return
งง 

scanResult
งง 
;
งง 
}
จจ 	
public
ฏฏ 
static
ฏฏ 
int
ฏฏ .
 CreateMissingModuleDocumentation
ฏฏ :
(
ฏฏ: ;
)
ฏฏ; <
{
ฐฐ 	
var
ฑฑ 
createdCount
ฑฑ 
=
ฑฑ 
$num
ฑฑ  
;
ฑฑ  !
foreach
ณณ 
(
ณณ 
var
ณณ 
module
ณณ 
in
ณณ  "
TrackedModules
ณณ# 1
)
ณณ1 2
{
ดด 
var
ตต 

moduleName
ตต 
=
ตต  
module
ตต! '
.
ตต' (
Key
ตต( +
;
ตต+ ,
var
ถถ 
moduleDescription
ถถ %
=
ถถ& '
module
ถถ( .
.
ถถ. /
Value
ถถ/ 4
;
ถถ4 5
if
นน 
(
นน 
!
นน 
	Directory
นน 
.
นน 
Exists
นน %
(
นน% &

moduleName
นน& 0
)
นน0 1
)
นน1 2
continue
บบ 
;
บบ 
if
ฝฝ 
(
ฝฝ 
ProjectAnalyzer
ฝฝ #
.
ฝฝ# $!
ModuleSummaryExists
ฝฝ$ 7
(
ฝฝ7 8

moduleName
ฝฝ8 B
)
ฝฝB C
)
ฝฝC D
continue
พพ 
;
พพ 
try
ภภ 
{
มม 
var
ยย 
success
ยย 
=
ยย  !"
DocumentationManager
ยย" 6
.
ยย6 7)
UpdateModuleSummaryEnhanced
ยย7 R
(
ยยR S

moduleName
รร "
,
รร" #
$"
ฤฤ 
$str
ฤฤ ;
{
ฤฤ; <
moduleDescription
ฤฤ< M
}
ฤฤM N
"
ฤฤN O
,
ฤฤO P
$str
ลล 
)
ฦฦ 
;
ฦฦ 
if
ศศ 
(
ศศ 
success
ศศ 
)
ศศ  
createdCount
ษษ $
++
ษษ$ &
;
ษษ& '
}
สส 
catch
หห 
(
หห 
	Exception
หห  
)
หห  !
{
ฬฬ 
continue
ฮฮ 
;
ฮฮ 
}
ฯฯ 
}
ะะ 
return
าา 
createdCount
าา 
;
าา  
}
ำำ 	
private
 
static
 
IEnumerable
 "
<
" #
string
# )
>
) *!
FilterRelevantFiles
+ >
(
> ?
IEnumerable
? J
<
J K
string
K Q
>
Q R
files
S X
)
X Y
{
฿฿ 	
return
เเ 
files
เเ 
.
เเ 
Where
เเ 
(
เเ 
file
เเ #
=>
เเ$ &
{
แแ 
var
ใใ 

moduleName
ใใ 
=
ใใ  
ProjectAnalyzer
ใใ! 0
.
ใใ0 1
ExtractModuleName
ใใ1 B
(
ใใB C
file
ใใC G
)
ใใG H
;
ใใH I
if
ไไ 
(
ไไ 
string
ไไ 
.
ไไ 
IsNullOrEmpty
ไไ (
(
ไไ( )

moduleName
ไไ) 3
)
ไไ3 4
||
ไไ5 7
!
ไไ8 9
TrackedModules
ไไ9 G
.
ไไG H
ContainsKey
ไไH S
(
ไไS T

moduleName
ไไT ^
)
ไไ^ _
)
ไไ_ `
return
ๅๅ 
false
ๅๅ  
;
ๅๅ  !
var
่่ 
	extension
่่ 
=
่่ 
Path
่่  $
.
่่$ %
GetExtension
่่% 1
(
่่1 2
file
่่2 6
)
่่6 7
;
่่7 8
if
้้ 
(
้้ 
!
้้ !
MonitoredExtensions
้้ (
.
้้( )
Contains
้้) 1
(
้้1 2
	extension
้้2 ;
)
้้; <
)
้้< =
return
๊๊ 
false
๊๊  
;
๊๊  !
foreach
ํํ 
(
ํํ 
var
ํํ 
pattern
ํํ $
in
ํํ% '
IgnorePatterns
ํํ( 6
)
ํํ6 7
{
๎๎ 
if
๏๏ 
(
๏๏ 
Regex
๏๏ 
.
๏๏ 
IsMatch
๏๏ %
(
๏๏% &
file
๏๏& *
,
๏๏* +
pattern
๏๏, 3
,
๏๏3 4
RegexOptions
๏๏5 A
.
๏๏A B

IgnoreCase
๏๏B L
)
๏๏L M
)
๏๏M N
return
๐๐ 
false
๐๐ $
;
๐๐$ %
}
๑๑ 
return
๓๓ 
true
๓๓ 
;
๓๓ 
}
๔๔ 
)
๔๔ 
;
๔๔ 
}
๕๕ 	
private
 
static
 
bool
 +
IsModuleDocumentationOutdated
 9
(
9 :
string
: @

moduleName
A K
,
K L
string
M S
summaryPath
T _
)
_ `
{
 	
try
 
{
 
if
 
(
 
!
 
File
 
.
 
Exists
  
(
  !
summaryPath
! ,
)
, -
)
- .
return
 
true
 
;
  
var
 !
summaryLastModified
 '
=
( )
File
* .
.
. /
GetLastWriteTime
/ ?
(
? @
summaryPath
@ K
)
K L
;
L M
if
 
(
 
!
 
	Directory
 
.
 
Exists
 %
(
% &

moduleName
& 0
)
0 1
)
1 2
return
 
false
  
;
  !
var
 
moduleFiles
 
=
  !
	Directory
" +
.
 
GetFiles
 
(
 

moduleName
 (
,
( )
$str
* /
,
/ 0
SearchOption
1 =
.
= >
AllDirectories
> L
)
L M
.
 
Where
 
(
 
f
 
=>
 !
MonitoredExtensions
  3
.
3 4
Contains
4 <
(
< =
Path
= A
.
A B
GetExtension
B N
(
N O
f
O P
)
P Q
)
Q R
)
R S
;
S T
foreach
 
(
 
var
 
file
 !
in
" $
moduleFiles
% 0
)
0 1
{
 
if
 
(
 
File
 
.
 
GetLastWriteTime
 -
(
- .
file
. 2
)
2 3
>
4 5!
summaryLastModified
6 I
)
I J
{
 
return
 
true
 #
;
# $
}
 
}
 
return
 
false
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
public
งง 
static
งง 
void
งง 
QueueFileChange
งง *
(
งง* +
string
งง+ 1
filePath
งง2 :
)
งง: ;
{
จจ 	
lock
ฉฉ 
(
ฉฉ 
_lockObject
ฉฉ 
)
ฉฉ 
{
ชช 
_pendingChanges
ซซ 
.
ซซ  
Add
ซซ  #
(
ซซ# $
filePath
ซซ$ ,
)
ซซ, -
;
ซซ- .
_debounceTimer
ฎฎ 
?
ฎฎ 
.
ฎฎ  
Dispose
ฎฎ  '
(
ฎฎ' (
)
ฎฎ( )
;
ฎฎ) *
_debounceTimer
ฏฏ 
=
ฏฏ  
new
ฏฏ! $
Timer
ฏฏ% *
(
ฏฏ* +#
ProcessPendingChanges
ฐฐ )
,
ฐฐ) *
null
ฑฑ 
,
ฑฑ 
TimeSpan
ฒฒ 
.
ฒฒ 
FromSeconds
ฒฒ (
(
ฒฒ( )
$num
ฒฒ) *
)
ฒฒ* +
,
ฒฒ+ ,
Timeout
ณณ 
.
ณณ 
InfiniteTimeSpan
ณณ ,
)
ดด 
;
ดด 
}
ตต 
}
ถถ 	
private
ผผ 
static
ผผ 
void
ผผ #
ProcessPendingChanges
ผผ 1
(
ผผ1 2
object
ผผ2 8
state
ผผ9 >
)
ผผ> ?
{
ฝฝ 	
List
พพ 
<
พพ 
string
พพ 
>
พพ 
changesToProcess
พพ )
;
พพ) *
lock
ภภ 
(
ภภ 
_lockObject
ภภ 
)
ภภ 
{
มม 
changesToProcess
ยย  
=
ยย! "
_pendingChanges
ยย# 2
.
ยย2 3
ToList
ยย3 9
(
ยย9 :
)
ยย: ;
;
ยย; <
_pendingChanges
รร 
.
รร  
Clear
รร  %
(
รร% &
)
รร& '
;
รร' (
}
ฤฤ 
if
ฦฦ 
(
ฦฦ 
changesToProcess
ฦฦ  
.
ฦฦ  !
Any
ฦฦ! $
(
ฦฦ$ %
)
ฦฦ% &
)
ฦฦ& '
{
วว  
ProcessFileChanges
ศศ "
(
ศศ" #
changesToProcess
ศศ# 3
)
ศศ3 4
;
ศศ4 5
}
ษษ 
}
สส 	
public
ิิ 
static
ิิ '
ModuleUpdateServiceStatus
ิิ /
GetServiceStatus
ิิ0 @
(
ิิ@ A
)
ิิA B
{
ีี 	
lock
ึึ 
(
ึึ 
_lockObject
ึึ 
)
ึึ 
{
ืื 
return
ุุ 
new
ุุ '
ModuleUpdateServiceStatus
ุุ 4
{
ูู  
TrackedModuleCount
ฺฺ &
=
ฺฺ' (
TrackedModules
ฺฺ) 7
.
ฺฺ7 8
Count
ฺฺ8 =
,
ฺฺ= >
PendingChanges
 "
=
# $
_pendingChanges
% 4
.
4 5
Count
5 :
,
: ;
IsDebounceActive
 $
=
% &
_debounceTimer
' 5
!=
6 8
null
9 =
,
= >
LastProcessedAt
 #
=
$ %
DateTime
& .
.
. /
Now
/ 2
,
2 3
TrackedModules
 "
=
# $
TrackedModules
% 3
.
3 4
Keys
4 8
.
8 9
ToList
9 ?
(
? @
)
@ A
,
A B
}
฿฿ 
;
฿฿ 
}
เเ 
}
แแ 	
public
ๆๆ 
static
ๆๆ 
void
ๆๆ !
ClearPendingChanges
ๆๆ .
(
ๆๆ. /
)
ๆๆ/ 0
{
็็ 	
lock
่่ 
(
่่ 
_lockObject
่่ 
)
่่ 
{
้้ 
_pendingChanges
๊๊ 
.
๊๊  
Clear
๊๊  %
(
๊๊% &
)
๊๊& '
;
๊๊' (
_debounceTimer
๋๋ 
?
๋๋ 
.
๋๋  
Dispose
๋๋  '
(
๋๋' (
)
๋๋( )
;
๋๋) *
_debounceTimer
์์ 
=
์์  
null
์์! %
;
์์% &
}
ํํ 
}
๎๎ 	
}
๑๑ 
public
๘๘ 

class
๘๘  
ModuleUpdateResult
๘๘ #
{
๙๙ 
public
๚๚ 
DateTime
๚๚ 
ProcessedAt
๚๚ #
{
๚๚$ %
get
๚๚& )
;
๚๚) *
set
๚๚+ .
;
๚๚. /
}
๚๚0 1
public
๛๛ 
List
๛๛ 
<
๛๛ 
string
๛๛ 
>
๛๛ 
FilesProcessed
๛๛ *
{
๛๛+ ,
get
๛๛- 0
;
๛๛0 1
set
๛๛2 5
;
๛๛5 6
}
๛๛7 8
=
๛๛9 :
new
๛๛; >
List
๛๛? C
<
๛๛C D
string
๛๛D J
>
๛๛J K
(
๛๛K L
)
๛๛L M
;
๛๛M N
public
 
List
 
<
 
string
 
>
 
RelevantFiles
 )
{
* +
get
, /
;
/ 0
set
1 4
;
4 5
}
6 7
=
8 9
new
: =
List
> B
<
B C
string
C I
>
I J
(
J K
)
K L
;
L M
public
 
List
 
<
 
string
 
>
 
UpdatedModules
 *
{
+ ,
get
- 0
;
0 1
set
2 5
;
5 6
}
7 8
=
9 :
new
; >
List
? C
<
C D
string
D J
>
J K
(
K L
)
L M
;
M N
public
 
int
 
UpdatedCount
 
{
  !
get
" %
;
% &
set
' *
;
* +
}
, -
public
 
List
 
<
 (
ModuleUpdateRecommendation
 .
>
. /
Recommendations
0 ?
{
@ A
get
B E
;
E F
set
G J
;
J K
}
L M
=
N O
new
 
List
 
<
 (
ModuleUpdateRecommendation
 /
>
/ 0
(
0 1
)
1 2
;
2 3
public
 
List
 
<
 
string
 
>
 
Errors
 "
{
# $
get
% (
;
( )
set
* -
;
- .
}
/ 0
=
1 2
new
3 6
List
7 ;
<
; <
string
< B
>
B C
(
C D
)
D E
;
E F
public
 
string
 
Message
 
{
 
get
  #
;
# $
set
% (
;
( )
}
* +
public
 
string
 

GetSummary
  
(
  !
)
! "
{
 	
if
 
(
 
Errors
 
.
 
Any
 
(
 
)
 
)
 
{
 
return
 
$"
 
$str
 /
{
/ 0
string
0 6
.
6 7
Join
7 ;
(
; <
$str
< @
,
@ A
Errors
B H
)
H I
}
I J
"
J K
;
K L
}
 
return
 
$"
 
$str
 
{
  
FilesProcessed
  .
.
. /
Count
/ 4
}
4 5
$str
5 E
{
E F
UpdatedCount
F R
}
R S
$str
S d
"
d e
;
e f
}
 	
}
 
public
 

class
 
ModuleScanResult
 !
{
 
public
 
DateTime
 
ScanDate
  
{
! "
get
# &
;
& '
set
( +
;
+ ,
}
- .
public
 
List
 
<
 
string
 
>
 
ScannedModules
 *
{
+ ,
get
- 0
;
0 1
set
2 5
;
5 6
}
7 8
=
9 :
new
; >
List
? C
<
C D
string
D J
>
J K
(
K L
)
L M
;
M N
public
 
List
 
<
 
string
 
>
 "
MissingDocumentation
 0
{
1 2
get
3 6
;
6 7
set
8 ;
;
; <
}
= >
=
? @
new
A D
List
E I
<
I J
string
J P
>
P Q
(
Q R
)
R S
;
S T
public
 
List
 
<
 
string
 
>
 #
OutdatedDocumentation
 1
{
2 3
get
4 7
;
7 8
set
9 <
;
< =
}
> ?
=
@ A
new
B E
List
F J
<
J K
string
K Q
>
Q R
(
R S
)
S T
;
T U
public
 
List
 
<
 
string
 
>
 
Recommendations
 +
{
, -
get
. 1
;
1 2
set
3 6
;
6 7
}
8 9
=
: ;
new
< ?
List
@ D
<
D E
string
E K
>
K L
(
L M
)
M N
;
N O
public
 
bool
 
	IsHealthy
 
{
 
get
  #
;
# $
set
% (
;
( )
}
* +
public
 
string
 
	ScanError
 
{
  !
get
" %
;
% &
set
' *
;
* +
}
, -
public
ขข 
string
ขข 

GetSummary
ขข  
(
ขข  !
)
ขข! "
{
ฃฃ 	
if
คค 
(
คค 
!
คค 
string
คค 
.
คค 
IsNullOrEmpty
คค %
(
คค% &
	ScanError
คค& /
)
คค/ 0
)
คค0 1
{
ฅฅ 
return
ฆฆ 
$"
ฆฆ 
$str
ฆฆ &
{
ฆฆ& '
	ScanError
ฆฆ' 0
}
ฆฆ0 1
"
ฆฆ1 2
;
ฆฆ2 3
}
งง 
if
ฉฉ 
(
ฉฉ 
	IsHealthy
ฉฉ 
)
ฉฉ 
{
ชช 
return
ซซ 
$"
ซซ 
$str
ซซ 
{
ซซ 
ScannedModules
ซซ ,
.
ซซ, -
Count
ซซ- 2
}
ซซ2 3
$str
ซซ3 V
"
ซซV W
;
ซซW X
}
ฌฌ 
return
ฎฎ 
$"
ฎฎ 
$str
ฎฎ #
{
ฎฎ# $"
MissingDocumentation
ฎฎ$ 8
.
ฎฎ8 9
Count
ฎฎ9 >
}
ฎฎ> ?
$str
ฎฎ? I
{
ฎฎI J#
OutdatedDocumentation
ฎฎJ _
.
ฎฎ_ `
Count
ฎฎ` e
}
ฎฎe f
$str
ฎฎf o
"
ฎฎo p
;
ฎฎp q
}
ฏฏ 	
}
ฐฐ 
public
ตต 

class
ตต '
ModuleUpdateServiceStatus
ตต *
{
ถถ 
public
ทท 
int
ทท  
TrackedModuleCount
ทท %
{
ทท& '
get
ทท( +
;
ทท+ ,
set
ทท- 0
;
ทท0 1
}
ทท2 3
public
ธธ 
int
ธธ 
PendingChanges
ธธ !
{
ธธ" #
get
ธธ$ '
;
ธธ' (
set
ธธ) ,
;
ธธ, -
}
ธธ. /
public
นน 
bool
นน 
IsDebounceActive
นน $
{
นน% &
get
นน' *
;
นน* +
set
นน, /
;
นน/ 0
}
นน1 2
public
บบ 
DateTime
บบ 
LastProcessedAt
บบ '
{
บบ( )
get
บบ* -
;
บบ- .
set
บบ/ 2
;
บบ2 3
}
บบ4 5
public
ปป 
List
ปป 
<
ปป 
string
ปป 
>
ปป 
TrackedModules
ปป *
{
ปป+ ,
get
ปป- 0
;
ปป0 1
set
ปป2 5
;
ปป5 6
}
ปป7 8
=
ปป9 :
new
ปป; >
List
ปป? C
<
ปปC D
string
ปปD J
>
ปปJ K
(
ปปK L
)
ปปL M
;
ปปM N
}
ผผ 
}ฟฟ พ
@C:\Playnite\_github\OstPlayer\source\DevTools\ProjectAnalyzer.cs
	namespacebb 	
	OstPlayerbb
 
.bb 
DevToolsbb 
{bb 
publicff 

classff 
ReadmeUpdateTriggerff $
{ff% &
publicgg 

ReadmeTypegg 

ReadmeTypegg $
{gg% &
getgg' *
;gg* +
setgg, /
;gg/ 0
}gg1 2
publichh 
stringhh 
TriggerPatternhh $
{hh% &
gethh' *
;hh* +
sethh, /
;hh/ 0
}hh1 2
publicii 
stringii 
Descriptionii !
{ii" #
getii$ '
;ii' (
setii) ,
;ii, -
}ii. /
publicjj 
Funcjj 
<jj 
stringjj 
,jj 
stringjj "
,jj" #
booljj$ (
>jj( )
ShouldTriggerjj* 7
{jj8 9
getjj: =
;jj= >
setjj? B
;jjB C
}jjD E
}kk 
publicpp 

staticpp 
classpp 
ProjectAnalyzerpp '
{pp( )
privaterr 
staticrr 
readonlyrr 
stringrr  &
[rr& '
]rr' (
SourceFilePatternsrr) ;
=rr< =
{rr> ?
$strrr@ F
,rrF G
$strrrH P
}rrQ R
;rrR S
privatess 
staticss 
readonlyss 
stringss  &
[ss& '
]ss' (%
DocumentationFilePatternsss) B
=ssC D
{ssE F
$strssG M
}ssN O
;ssO P
privatett 
statictt 
readonlytt 
stringtt  &
[tt& '
]tt' (
ScriptFilePatternstt) ;
=tt< =
{tt> ?
$strtt@ G
,ttG H
$strttI P
,ttP Q
$strttR Y
}ttZ [
;tt[ \
privateww 
staticww 
readonlyww 
Regexww  %
UsingDirectiveRegexww& 9
=ww: ;
newww< ?
Regexww@ E
(wwE F
$strwwF Y
,wwY Z
RegexOptionsww[ g
.wwg h
Compiledwwh p
)wwp q
;wwq r
privatexx 
staticxx 
readonlyxx 
Regexxx  %
NamespaceRegexxx& 4
=xx5 6
newxx7 :
Regexxx; @
(xx@ A
$strxxA Y
,xxY Z
RegexOptionsxx[ g
.xxg h
Compiledxxh p
)xxp q
;xxq r
privateyy 
staticyy 
readonlyyy 
Regexyy  %

ClassRegexyy& 0
=yy1 2
newyy3 6
Regexyy7 <
(yy< =
$stryy= i
,yyi j
RegexOptionsyyk w
.yyw x
Compiled	yyx 
)
yy 
;
yy 
privatezz 
staticzz 
readonlyzz 
Regexzz  %"
DocumentationLinkRegexzz& <
=zz= >
newzz? B
RegexzzC H
(zzH I
$strzzI c
,zzc d
RegexOptionszze q
.zzq r
Compiledzzr z
)zzz {
;zz{ |
private{{ 
static{{ 
readonly{{ 
Regex{{  % 
ModuleReferenceRegex{{& :
={{; <
new{{= @
Regex{{A F
({{F G
$str	{{G 
,
{{ 
RegexOptions
{{ 
.
{{ 
Compiled
{{ 
)
{{ 
;
{{ 
private~~ 
static~~ 
readonly~~ 
Regex~~  %'
ReadmeStructuralChangeRegex~~& A
=~~B C
new~~D G
Regex~~H M
(~~M N
$str~~N u
,~~u v
RegexOptions	~~w 
.
~~ 
Compiled
~~ 
|
~~ 
RegexOptions
~~ 
.
~~ 

IgnoreCase
~~ ฆ
)
~~ฆ ง
;
~~ง จ
private 
static 
readonly 
Regex  %!
ModuleFileChangeRegex& ;
=< =
new> A
RegexB G
(G H
$str	H 
,
 
RegexOptions
 จ
.
จ ฉ
Compiled
ฉ ฑ
|
ฒ ณ
RegexOptions
ด ภ
.
ภ ม

IgnoreCase
ม ห
)
ห ฬ
;
ฬ อ
private
 
static
 

Dictionary
 !
<
! "
string
" (
,
( )
HashSet
* 1
<
1 2
string
2 8
>
8 9
>
9 :
_dependencyCache
; K
=
L M
new
N Q

Dictionary
R \
<
\ ]
string
] c
,
c d
HashSet
e l
<
l m
string
m s
>
s t
>
t u
(
u v
)
v w
;
w x
private
 
static
 

Dictionary
 !
<
! "
string
" (
,
( )

ReadmeType
* 4
>
4 5
_readmeTypeCache
6 F
=
G H
new
I L

Dictionary
M W
<
W X
string
X ^
,
^ _

ReadmeType
` j
>
j k
(
k l
)
l m
;
m n
private
 
static
 
DateTime
 
_cacheLastUpdated
  1
=
2 3
DateTime
4 <
.
< =
MinValue
= E
;
E F
private
 
static
 
readonly
 
List
  $
<
$ %!
ReadmeUpdateTrigger
% 8
>
8 9"
ReadmeUpdateTriggers
: N
=
O P
new
Q T
List
U Y
<
Y Z!
ReadmeUpdateTrigger
Z m
>
m n
{
 	
new
 !
ReadmeUpdateTrigger
 #
{
 

ReadmeType
 
=
 

ReadmeType
 '
.
' (

Navigation
( 2
,
2 3
TriggerPattern
 
=
  
$str
! \
,
\ ]
Description
 
=
 
$str
 8
,
8 9
ShouldTrigger
 
=
 
(
  !
changedFile
! ,
,
, -

readmePath
. 8
)
8 9
=>
: <

readmePath
= G
.
G H
Contains
H P
(
P Q
$str
Q d
)
d e
}
 
,
 
new
 !
ReadmeUpdateTrigger
 #
{
 

ReadmeType
 
=
 

ReadmeType
 '
.
' (
	Technical
( 1
,
1 2
TriggerPattern
 
=
  
$str
! U
,
U V
Description
 
=
 
$str
 9
,
9 :
ShouldTrigger
 
=
 
(
  !
changedFile
! ,
,
, -

readmePath
. 8
)
8 9
=>
: <
{
 
var
 
moduleMatch
 #
=
$ %#
ModuleFileChangeRegex
& ;
.
; <
Match
< A
(
A B
changedFile
B M
)
M N
;
N O
return
 
moduleMatch
 &
.
& '
Success
' .
&&
/ 1

readmePath
2 <
.
< =

StartsWith
= G
(
G H
moduleMatch
H S
.
S T
Groups
T Z
[
Z [
$num
[ \
]
\ ]
.
] ^
Value
^ c
)
c d
;
d e
}
 
}
 
,
 
new
 !
ReadmeUpdateTrigger
 #
{
 

ReadmeType
 
=
 

ReadmeType
 '
.
' (
Category
( 0
,
0 1
TriggerPattern
 
=
  
$str
! d
,
d e
Description
 
=
 
$str
 8
,
8 9
ShouldTrigger
 
=
 
(
  !
changedFile
! ,
,
, -

readmePath
. 8
)
8 9
=>
: <
{
กก 
var
ขข 
	pathParts
ขข !
=
ขข" #
changedFile
ขข$ /
.
ขข/ 0
Split
ขข0 5
(
ขข5 6
$char
ขข6 9
,
ขข9 :
$char
ขข; ?
)
ขข? @
;
ขข@ A
return
ฃฃ 
	pathParts
ฃฃ $
.
ฃฃ$ %
Length
ฃฃ% +
>=
ฃฃ, .
$num
ฃฃ/ 0
&&
ฃฃ1 3

readmePath
ฃฃ4 >
.
ฃฃ> ?
Contains
ฃฃ? G
(
ฃฃG H
$"
ฃฃH J
{
ฃฃJ K
	pathParts
ฃฃK T
[
ฃฃT U
$num
ฃฃU V
]
ฃฃV W
}
ฃฃW X
$str
ฃฃX b
"
ฃฃb c
)
ฃฃc d
;
ฃฃd e
}
คค 
}
ฅฅ 
,
ฅฅ 
new
ฆฆ !
ReadmeUpdateTrigger
ฆฆ #
{
งง 

ReadmeType
จจ 
=
จจ 

ReadmeType
จจ '
.
จจ' (
Root
จจ( ,
,
จจ, -
TriggerPattern
ฉฉ 
=
ฉฉ  
$str
ฉฉ! H
,
ฉฉH I
Description
ชช 
=
ชช 
$str
ชช ?
,
ชช? @
ShouldTrigger
ซซ 
=
ซซ 
(
ซซ  !
changedFile
ซซ! ,
,
ซซ, -

readmePath
ซซ. 8
)
ซซ8 9
=>
ซซ: <

readmePath
ฌฌ 
==
ฌฌ !
$str
ฌฌ" ;
&&
ฌฌ< >)
ReadmeStructuralChangeRegex
ฌฌ? Z
.
ฌฌZ [
IsMatch
ฌฌ[ b
(
ฌฌb c
changedFile
ฌฌc n
)
ฌฌn o
}
ญญ 
}
ฎฎ 	
;
ฎฎ	 

public
ทท 
static
ทท 
List
ทท 
<
ทท 
string
ทท !
>
ทท! "+
GetAffectedDocumentationFiles
ทท# @
(
ทท@ A
string
ททA G
[
ททG H
]
ททH I
changedFiles
ททJ V
)
ททV W
{
ททX Y
try
ธธ 
{
ธธ 
var
นน 
affectedDocs
นน  
=
นน! "
new
นน# &
HashSet
นน' .
<
นน. /
string
นน/ 5
>
นน5 6
(
นน6 7
)
นน7 8
;
นน8 9
var
บบ 
moduleChanges
บบ !
=
บบ" #
new
บบ$ '

Dictionary
บบ( 2
<
บบ2 3
string
บบ3 9
,
บบ9 :
List
บบ; ?
<
บบ? @
string
บบ@ F
>
บบF G
>
บบG H
(
บบH I
)
บบI J
;
บบJ K
foreach
ฝฝ 
(
ฝฝ 
var
ฝฝ 
file
ฝฝ !
in
ฝฝ" $
changedFiles
ฝฝ% 1
)
ฝฝ1 2
{
ฝฝ3 4
var
พพ 
module
พพ 
=
พพ  #
GetModuleFromFilePath
พพ! 6
(
พพ6 7
file
พพ7 ;
)
พพ; <
;
พพ< =
if
ฟฟ 
(
ฟฟ 
module
ฟฟ 
!=
ฟฟ !
null
ฟฟ" &
)
ฟฟ& '
{
ฟฟ( )
if
ภภ 
(
ภภ 
!
ภภ 
moduleChanges
ภภ *
.
ภภ* +
ContainsKey
ภภ+ 6
(
ภภ6 7
module
ภภ7 =
)
ภภ= >
)
ภภ> ?
{
ภภ@ A
moduleChanges
มม )
[
มม) *
module
มม* 0
]
มม0 1
=
มม2 3
new
มม4 7
List
มม8 <
<
มม< =
string
มม= C
>
มมC D
(
มมD E
)
มมE F
;
มมF G
}
ยย 
moduleChanges
รร %
[
รร% &
module
รร& ,
]
รร, -
.
รร- .
Add
รร. 1
(
รร1 2
file
รร2 6
)
รร6 7
;
รร7 8
}
ฤฤ 
affectedDocs
วว  
.
วว  !
	UnionWith
วว! *
(
วว* +0
"GetDirectDocumentationDependencies
วว+ M
(
ววM N
file
ววN R
)
ววR S
)
ววS T
;
ววT U
}
ศศ 
foreach
หห 
(
หห 
var
หห 
module
หห #
in
หห$ &
moduleChanges
หห' 4
.
หห4 5
Keys
หห5 9
)
หห9 :
{
หห; <
affectedDocs
ฬฬ  
.
ฬฬ  !
	UnionWith
ฬฬ! *
(
ฬฬ* +)
GetModuleDocumentationFiles
ฬฬ+ F
(
ฬฬF G
module
ฬฬG M
)
ฬฬM N
)
ฬฬN O
;
ฬฬO P
}
ออ 
affectedDocs
ะะ 
.
ะะ 
	UnionWith
ะะ &
(
ะะ& '$
GetAffectedReadmeFiles
ะะ' =
(
ะะ= >
changedFiles
ะะ> J
)
ะะJ K
)
ะะK L
;
ะะL M
if
ำำ 
(
ำำ 
changedFiles
ำำ  
.
ำำ  !
Any
ำำ! $
(
ำำ$ %
f
ำำ% &
=>
ำำ' )
IsSourceFile
ำำ* 6
(
ำำ6 7
f
ำำ7 8
)
ำำ8 9
)
ำำ9 :
)
ำำ: ;
{
ำำ< =
affectedDocs
ิิ  
.
ิิ  !
Add
ิิ! $
(
ิิ$ %
$str
ิิ% F
)
ิิF G
;
ิิG H
}
ีี 
return
ืื 
affectedDocs
ืื #
.
ืื# $
ToList
ืื$ *
(
ืื* +
)
ืื+ ,
;
ืื, -
}
ุุ 
catch
ูู 
(
ูู 
	Exception
ูู 
)
ูู 
{
ูู 
return
ฺฺ 
new
ฺฺ 
List
ฺฺ 
<
ฺฺ  
string
ฺฺ  &
>
ฺฺ& '
(
ฺฺ' (
)
ฺฺ( )
;
ฺฺ) *
}
 
}
 	
public
ใใ 
static
ใใ 
List
ใใ 
<
ใใ 
string
ใใ !
>
ใใ! "$
GetAffectedReadmeFiles
ใใ# 9
(
ใใ9 :
string
ใใ: @
[
ใใ@ A
]
ใใA B
changedFiles
ใใC O
)
ใใO P
{
ใใQ R
try
ไไ 
{
ไไ 
var
ๅๅ 
affectedReadmes
ๅๅ #
=
ๅๅ$ %
new
ๅๅ& )
HashSet
ๅๅ* 1
<
ๅๅ1 2
string
ๅๅ2 8
>
ๅๅ8 9
(
ๅๅ9 :
)
ๅๅ: ;
;
ๅๅ; <
var
ๆๆ 

allReadmes
ๆๆ 
=
ๆๆ  "
DocumentationManager
ๆๆ! 5
.
ๆๆ5 6
GetAllReadmeFiles
ๆๆ6 G
(
ๆๆG H
)
ๆๆH I
;
ๆๆI J
foreach
่่ 
(
่่ 
var
่่ 
changedFile
่่ (
in
่่) +
changedFiles
่่, 8
)
่่8 9
{
่่: ;
foreach
้้ 
(
้้ 
var
้้  

readmePath
้้! +
in
้้, .

allReadmes
้้/ 9
)
้้9 :
{
้้; <
if
๊๊ 
(
๊๊  
ShouldUpdateReadme
๊๊ .
(
๊๊. /

readmePath
๊๊/ 9
,
๊๊9 :
new
๊๊; >
[
๊๊> ?
]
๊๊? @
{
๊๊A B
changedFile
๊๊C N
}
๊๊O P
)
๊๊P Q
)
๊๊Q R
{
๊๊S T
affectedReadmes
๋๋ +
.
๋๋+ ,
Add
๋๋, /
(
๋๋/ 0

readmePath
๋๋0 :
)
๋๋: ;
;
๋๋; <
}
์์ 
}
ํํ 
}
๎๎ 
return
๐๐ 
affectedReadmes
๐๐ &
.
๐๐& '
ToList
๐๐' -
(
๐๐- .
)
๐๐. /
;
๐๐/ 0
}
๑๑ 
catch
๒๒ 
(
๒๒ 
	Exception
๒๒ 
)
๒๒ 
{
๒๒ 
return
๓๓ 
new
๓๓ 
List
๓๓ 
<
๓๓  
string
๓๓  &
>
๓๓& '
(
๓๓' (
)
๓๓( )
;
๓๓) *
}
๔๔ 
}
๕๕ 	
public
 
static
 
bool
  
ShouldUpdateReadme
 -
(
- .
string
. 4

readmePath
5 ?
,
? @
string
A G
[
G H
]
H I
changedFiles
J V
)
V W
{
X Y
try
 
{
 
var
 

readmeType
 
=
  "
DocumentationManager
! 5
.
5 6
GetReadmeType
6 C
(
C D

readmePath
D N
)
N O
;
O P
foreach
 
(
 
var
 
changedFile
 (
in
) +
changedFiles
, 8
)
8 9
{
: ;
foreach
 
(
 
var
  
trigger
! (
in
) +"
ReadmeUpdateTriggers
, @
)
@ A
{
B C
if
 
(
 
trigger
 #
.
# $

ReadmeType
$ .
==
/ 1

readmeType
2 <
&&
= ?
Regex
 !
.
! "
IsMatch
" )
(
) *
changedFile
* 5
,
5 6
trigger
7 >
.
> ?
TriggerPattern
? M
,
M N
RegexOptions
O [
.
[ \

IgnoreCase
\ f
)
f g
&&
h j
trigger
 #
.
# $
ShouldTrigger
$ 1
(
1 2
changedFile
2 =
,
= >

readmePath
? I
)
I J
)
J K
{
L M
return
 "
true
# '
;
' (
}
 
}
 
if
 
(
 3
%ShouldUpdateReadmeForSpecificScenario
 =
(
= >

readmePath
> H
,
H I
changedFile
J U
,
U V

readmeType
W a
)
a b
)
b c
{
d e
return
 
true
 #
;
# $
}
 
}
 
return
 
false
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
public
 
static
 

Dictionary
  
<
  !
string
! '
,
' (
string
) /
[
/ 0
]
0 1
>
1 2%
GetReadmeUpdateTriggers
3 J
(
J K
)
K L
{
M N
var
 
triggers
 
=
 
new
 

Dictionary
 )
<
) *
string
* 0
,
0 1
string
2 8
[
8 9
]
9 :
>
: ;
(
; <
)
< =
;
= >
foreach
 
(
 
var
 

readmeType
 #
in
$ &
Enum
' +
.
+ ,
	GetValues
, 5
(
5 6
typeof
6 <
(
< =

ReadmeType
= G
)
G H
)
H I
.
I J
Cast
J N
<
N O

ReadmeType
O Y
>
Y Z
(
Z [
)
[ \
)
\ ]
{
^ _
var
 
triggerPatterns
 #
=
$ %"
ReadmeUpdateTriggers
& :
.
กก 
Where
กก 
(
กก 
t
กก 
=>
กก 
t
กก  !
.
กก! "

ReadmeType
กก" ,
==
กก- /

readmeType
กก0 :
)
กก: ;
.
ขข 
Select
ขข 
(
ขข 
t
ขข 
=>
ขข  
t
ขข! "
.
ขข" #
TriggerPattern
ขข# 1
)
ขข1 2
.
ฃฃ 
ToArray
ฃฃ 
(
ฃฃ 
)
ฃฃ 
;
ฃฃ 
triggers
ฅฅ 
[
ฅฅ 

readmeType
ฅฅ #
.
ฅฅ# $
ToString
ฅฅ$ ,
(
ฅฅ, -
)
ฅฅ- .
]
ฅฅ. /
=
ฅฅ0 1
triggerPatterns
ฅฅ2 A
;
ฅฅA B
}
ฆฆ 
return
จจ 
triggers
จจ 
;
จจ 
}
ฉฉ 	
private
ฒฒ 
static
ฒฒ 
bool
ฒฒ 3
%ShouldUpdateReadmeForSpecificScenario
ฒฒ A
(
ฒฒA B
string
ฒฒB H

readmePath
ฒฒI S
,
ฒฒS T
string
ฒฒU [
changedFile
ฒฒ\ g
,
ฒฒg h

ReadmeType
ฒฒi s

readmeType
ฒฒt ~
)
ฒฒ~ 
{ฒฒ 
switch
ณณ 
(
ณณ 

readmeType
ณณ 
)
ณณ 
{
ณณ  !
case
ดด 

ReadmeType
ดด 
.
ดด  

Navigation
ดด  *
:
ดด* +
return
ตต  
IsStructuralChange
ตต -
(
ตต- .
changedFile
ตต. 9
)
ตต9 :
&&
ตต; ='
IsRelatedNavigationReadme
ตต> W
(
ตตW X

readmePath
ตตX b
,
ตตb c
changedFile
ตตd o
)
ตตo p
;
ตตp q
case
ทท 

ReadmeType
ทท 
.
ทท  
	Technical
ทท  )
:
ทท) *
return
ธธ  
IsModuleFileChange
ธธ -
(
ธธ- .
changedFile
ธธ. 9
,
ธธ9 :

readmePath
ธธ; E
)
ธธE F
;
ธธF G
case
บบ 

ReadmeType
บบ 
.
บบ  
Category
บบ  (
:
บบ( )
return
ปป %
IsCategoryContentChange
ปป 2
(
ปป2 3
changedFile
ปป3 >
,
ปป> ?

readmePath
ปป@ J
)
ปปJ K
;
ปปK L
case
ฝฝ 

ReadmeType
ฝฝ 
.
ฝฝ  
Root
ฝฝ  $
:
ฝฝ$ %
return
พพ %
IsGlobalStructureChange
พพ 2
(
พพ2 3
changedFile
พพ3 >
)
พพ> ?
;
พพ? @
default
ภภ 
:
ภภ 
return
มม 
false
มม  
;
มม  !
}
ยย 
}
รร 	
private
สส 
static
สส 
bool
สส  
IsStructuralChange
สส .
(
สส. /
string
สส/ 5
changedFile
สส6 A
)
สสA B
{
สสC D
return
หห 
changedFile
หห 
.
หห 
Contains
หห '
(
หห' (
$str
หห( @
)
หห@ A
||
หหB D
changedFile
ฬฬ 
.
ฬฬ 
Contains
ฬฬ '
(
ฬฬ' (
$str
ฬฬ( 4
)
ฬฬ4 5
||
ฬฬ6 8
changedFile
ออ 
.
ออ 
EndsWith
ออ '
(
ออ' (
$str
ออ( 4
)
ออ4 5
||
ออ6 8
changedFile
ฮฮ 
.
ฮฮ 
Contains
ฮฮ '
(
ฮฮ' (
$str
ฮฮ( 3
)
ฮฮ3 4
||
ฮฮ5 7
Regex
ฯฯ 
.
ฯฯ 
IsMatch
ฯฯ  
(
ฯฯ  !
changedFile
ฯฯ! ,
,
ฯฯ, -
$str
ฯฯ. Q
)
ฯฯQ R
;
ฯฯR S
}
ะะ 	
private
ุุ 
static
ุุ 
bool
ุุ  
IsModuleFileChange
ุุ .
(
ุุ. /
string
ุุ/ 5
changedFile
ุุ6 A
,
ุุA B
string
ุุC I

readmePath
ุุJ T
)
ุุT U
{
ุุV W
var
ูู 
moduleMatch
ูู 
=
ูู #
ModuleFileChangeRegex
ูู 3
.
ูู3 4
Match
ูู4 9
(
ูู9 :
changedFile
ูู: E
)
ููE F
;
ููF G
if
ฺฺ 
(
ฺฺ 
moduleMatch
ฺฺ 
.
ฺฺ 
Success
ฺฺ #
)
ฺฺ# $
{
ฺฺ% &
var
 

moduleName
 
=
  
moduleMatch
! ,
.
, -
Groups
- 3
[
3 4
$num
4 5
]
5 6
.
6 7
Value
7 <
;
< =
return
 

readmePath
 !
.
! "

StartsWith
" ,
(
, -
$"
- /
{
/ 0

moduleName
0 :
}
: ;
$str
; E
"
E F
)
F G
;
G H
}
 
return
 
false
 
;
 
}
฿฿ 	
private
็็ 
static
็็ 
bool
็็ %
IsCategoryContentChange
็็ 3
(
็็3 4
string
็็4 :
changedFile
็็; F
,
็็F G
string
็็H N

readmePath
็็O Y
)
็็Y Z
{
็็[ \
if
่่ 
(
่่ 
changedFile
่่ 
.
่่ 

StartsWith
่่ &
(
่่& '
$str
่่' 7
)
่่7 8
)
่่8 9
{
่่: ;
var
้้ 
	pathParts
้้ 
=
้้ 
changedFile
้้  +
.
้้+ ,
Split
้้, 1
(
้้1 2
$char
้้2 5
,
้้5 6
$char
้้7 ;
)
้้; <
;
้้< =
if
๊๊ 
(
๊๊ 
	pathParts
๊๊ 
.
๊๊ 
Length
๊๊ $
>=
๊๊% '
$num
๊๊( )
)
๊๊) *
{
๊๊+ ,
var
๋๋ 
category
๋๋  
=
๋๋! "
	pathParts
๋๋# ,
[
๋๋, -
$num
๋๋- .
]
๋๋. /
;
๋๋/ 0
return
์์ 

readmePath
์์ %
.
์์% &
Contains
์์& .
(
์์. /
$"
์์/ 1
$str
์์1 ?
{
์์? @
category
์์@ H
}
์์H I
$str
์์I S
"
์์S T
)
์์T U
;
์์U V
}
ํํ 
}
๎๎ 
return
๏๏ 
false
๏๏ 
;
๏๏ 
}
๐๐ 	
private
๗๗ 
static
๗๗ 
bool
๗๗ %
IsGlobalStructureChange
๗๗ 3
(
๗๗3 4
string
๗๗4 :
changedFile
๗๗; F
)
๗๗F G
{
๗๗H I
return
๘๘ 
changedFile
๘๘ 
.
๘๘ 
Contains
๘๘ '
(
๘๘' (
$str
๘๘( 8
)
๘๘8 9
&&
๘๘: <
(
๙๙ 
changedFile
๙๙ 
.
๙๙  
Contains
๙๙  (
(
๙๙( )
$str
๙๙) 5
)
๙๙5 6
||
๙๙7 9
changedFile
๙๙: E
.
๙๙E F
Contains
๙๙F N
(
๙๙N O
$str
๙๙O g
)
๙๙g h
)
๙๙h i
;
๙๙i j
}
๚๚ 	
private
 
static
 
bool
 '
IsRelatedNavigationReadme
 5
(
5 6
string
6 <

readmePath
= G
,
G H
string
I O
changedFile
P [
)
[ \
{
] ^
if
 
(
 

readmePath
 
==
 
$str
 7
)
7 8
return
 
true
 
;
 
if
 
(
 

readmePath
 
==
 
$str
 ?
)
? @
return
 
changedFile
 "
.
" #
Contains
# +
(
+ ,
$str
, D
)
D E
;
E F
if
 
(
 

readmePath
 
.
 

StartsWith
 %
(
% &
$str
& 6
)
6 7
)
7 8
{
9 :
var
 
readmeCategory
 "
=
# $

readmePath
% /
.
/ 0
Split
0 5
(
5 6
$char
6 9
)
9 :
[
: ;
$num
; <
]
< =
;
= >
return
 
changedFile
 "
.
" #
Contains
# +
(
+ ,
$"
, .
$str
. <
{
< =
readmeCategory
= K
}
K L
$str
L M
"
M N
)
N O
;
O P
}
 
return
 
false
 
;
 
}
 	
private
 
static
 
string
 #
GetModuleFromFilePath
 3
(
3 4
string
4 :
filePath
; C
)
C D
{
E F
var
 
normalizedPath
 
=
  
filePath
! )
.
) *
Replace
* 1
(
1 2
$char
2 6
,
6 7
$char
8 ;
)
; <
;
< =
var
 
	pathParts
 
=
 
normalizedPath
 *
.
* +
Split
+ 0
(
0 1
$char
1 4
)
4 5
;
5 6
foreach
 
(
 
var
 
part
 
in
  
	pathParts
! *
)
* +
{
, -
if
 
(
 
IsModuleName
  
(
  !
part
! %
)
% &
)
& '
{
( )
return
 
part
 
;
  
}
 
}
 
return
 
null
 
;
 
}
กก 	
private
จจ 
static
จจ 
bool
จจ 
IsModuleName
จจ (
(
จจ( )
string
จจ) /
name
จจ0 4
)
จจ4 5
{
จจ6 7
var
ฉฉ 
modules
ฉฉ 
=
ฉฉ 
new
ฉฉ 
[
ฉฉ 
]
ฉฉ 
{
ฉฉ  !
$str
ฉฉ" .
,
ฉฉ. /
$str
ฉฉ0 8
,
ฉฉ8 9
$str
ฉฉ: A
,
ฉฉA B
$str
ฉฉC M
,
ฉฉM N
$str
ฉฉO X
,
ฉฉX Y
$str
ฉฉZ a
,
ฉฉa b
$str
ฉฉc o
,
ฉฉo p
$str
ฉฉq z
,
ฉฉz {
$strฉฉ| 
}ฉฉ 
;ฉฉ 
return
ชช 
modules
ชช 
.
ชช 
Contains
ชช #
(
ชช# $
name
ชช$ (
,
ชช( )
StringComparer
ชช* 8
.
ชช8 9
OrdinalIgnoreCase
ชช9 J
)
ชชJ K
;
ชชK L
}
ซซ 	
private
ฒฒ 
static
ฒฒ 
HashSet
ฒฒ 
<
ฒฒ 
string
ฒฒ %
>
ฒฒ% &0
"GetDirectDocumentationDependencies
ฒฒ' I
(
ฒฒI J
string
ฒฒJ P
filePath
ฒฒQ Y
)
ฒฒY Z
{
ฒฒ[ \
var
ณณ 
dependencies
ณณ 
=
ณณ 
new
ณณ "
HashSet
ณณ# *
<
ณณ* +
string
ณณ+ 1
>
ณณ1 2
(
ณณ2 3
)
ณณ3 4
;
ณณ4 5
var
ดด 
fileName
ดด 
=
ดด 
Path
ดด 
.
ดด  
GetFileName
ดด  +
(
ดด+ ,
filePath
ดด, 4
)
ดด4 5
;
ดด5 6
try
ถถ 
{
ถถ 
var
ทท  
documentationFiles
ทท &
=
ทท' ("
DocumentationManager
ทท) =
.
ทท= >#
GetDocumentationFiles
ทท> S
(
ททS T
)
ททT U
;
ททU V
foreach
นน 
(
นน 
var
นน 
docFile
นน $
in
นน% ' 
documentationFiles
นน( :
)
นน: ;
{
นน< =
var
บบ 
content
บบ 
=
บบ  !
File
บบ" &
.
บบ& '
ReadAllText
บบ' 2
(
บบ2 3
docFile
บบ3 :
,
บบ: ;
Encoding
บบ< D
.
บบD E
UTF8
บบE I
)
บบI J
;
บบJ K
if
ปป 
(
ปป 
content
ปป 
.
ปป  
Contains
ปป  (
(
ปป( )
fileName
ปป) 1
)
ปป1 2
||
ปป3 5
content
ปป6 =
.
ปป= >
Contains
ปป> F
(
ปปF G
filePath
ปปG O
.
ปปO P
Replace
ปปP W
(
ปปW X
$char
ปปX \
,
ปป\ ]
$char
ปป^ a
)
ปปa b
)
ปปb c
)
ปปc d
{
ปปe f
dependencies
ผผ $
.
ผผ$ %
Add
ผผ% (
(
ผผ( )
docFile
ผผ) 0
)
ผผ0 1
;
ผผ1 2
}
ฝฝ 
}
พพ 
}
ฟฟ 
catch
ภภ 
(
ภภ 
	Exception
ภภ 
)
ภภ 
{
ภภ 
}
ยย 
return
ฤฤ 
dependencies
ฤฤ 
;
ฤฤ  
}
ลล 	
private
ฬฬ 
static
ฬฬ 
HashSet
ฬฬ 
<
ฬฬ 
string
ฬฬ %
>
ฬฬ% &)
GetModuleDocumentationFiles
ฬฬ' B
(
ฬฬB C
string
ฬฬC I

moduleName
ฬฬJ T
)
ฬฬT U
{
ฬฬV W
var
ออ 
files
ออ 
=
ออ 
new
ออ 
HashSet
ออ #
<
ออ# $
string
ออ$ *
>
ออ* +
(
ออ+ ,
)
ออ, -
;
ออ- .
try
ฯฯ 
{
ฯฯ 
var
ัั 
patterns
ัั 
=
ัั 
new
ัั "
[
ัั" #
]
ัั# $
{
าา 
$"
ำำ 
$str
ำำ ,
{
ำำ, -

moduleName
ำำ- 7
}
ำำ7 8
$str
ำำ8 N
"
ำำN O
,
ำำO P
$"
ิิ 
$str
ิิ $
{
ิิ$ %

moduleName
ิิ% /
}
ิิ/ 0
$str
ิิ0 F
"
ิิF G
,
ิิG H
$"
ีี 
$str
ีี $
{
ีี$ %

moduleName
ีี% /
}
ีี/ 0
$str
ีี0 @
"
ีี@ A
,
ีีA B
$"
ึึ 
{
ึึ 

moduleName
ึึ !
}
ึึ! "
$str
ึึ" ,
"
ึึ, -
,
ึึ- .
$"
ืื 
$str
ืื $
{
ืื$ %

moduleName
ืื% /
}
ืื/ 0
$str
ืื0 :
"
ืื: ;
}
ุุ 
;
ุุ 
foreach
ฺฺ 
(
ฺฺ 
var
ฺฺ 
pattern
ฺฺ $
in
ฺฺ% '
patterns
ฺฺ( 0
)
ฺฺ0 1
{
ฺฺ2 3
if
 
(
 
File
 
.
 
Exists
 #
(
# $
pattern
$ +
)
+ ,
)
, -
{
. /
files
 
.
 
Add
 !
(
! "
pattern
" )
)
) *
;
* +
}
 
}
 
}
฿฿ 
catch
เเ 
(
เเ 
	Exception
เเ 
)
เเ 
{
เเ 
}
โโ 
return
ไไ 
files
ไไ 
;
ไไ 
}
ๅๅ 	
public
๐๐ 
static
๐๐ 
bool
๐๐ #
UpdateCrossReferences
๐๐ 0
(
๐๐0 1
string
๐๐1 7
[
๐๐7 8
]
๐๐8 9
changedFiles
๐๐: F
)
๐๐F G
{
๐๐H I
try
๑๑ 
{
๑๑ 
var
๒๒ 
success
๒๒ 
=
๒๒ 
true
๒๒ "
;
๒๒" #
var
๓๓ 
pathMappings
๓๓  
=
๓๓! "
DetectPathChanges
๓๓# 4
(
๓๓4 5
changedFiles
๓๓5 A
)
๓๓A B
;
๓๓B C
if
๕๕ 
(
๕๕ 
pathMappings
๕๕  
.
๕๕  !
Any
๕๕! $
(
๕๕$ %
)
๕๕% &
)
๕๕& '
{
๕๕( )
success
๖๖ 
&=
๖๖ "
DocumentationManager
๖๖ 3
.
๖๖3 4&
UpdateDocumentationPaths
๖๖4 L
(
๖๖L M
pathMappings
๖๖M Y
)
๖๖Y Z
;
๖๖Z [
}
๗๗ 
var
๚๚ 
affectedDocs
๚๚  
=
๚๚! "+
GetAffectedDocumentationFiles
๚๚# @
(
๚๚@ A
changedFiles
๚๚A M
)
๚๚M N
;
๚๚N O
foreach
๛๛ 
(
๛๛ 
var
๛๛ 
docFile
๛๛ $
in
๛๛% '
affectedDocs
๛๛( 4
)
๛๛4 5
{
๛๛6 7
success
 
&=
 +
UpdateDocumentationReferences
 <
(
< =
docFile
= D
,
D E
changedFiles
F R
)
R S
;
S T
}
 
success
 
&=
 "
DocumentationManager
 /
.
/ 0.
 SynchronizeReadmeCrossReferences
0 P
(
P Q
)
Q R
;
R S
return
 
success
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
private
 
static
 

Dictionary
 !
<
! "
string
" (
,
( )
string
* 0
>
0 1
DetectPathChanges
2 C
(
C D
string
D J
[
J K
]
K L
changedFiles
M Y
)
Y Z
{
[ \
var
 
pathMappings
 
=
 
new
 "

Dictionary
# -
<
- .
string
. 4
,
4 5
string
6 <
>
< =
(
= >
)
> ?
;
? @
pathMappings
 
[
 
$str
 .
]
. /
=
0 1
$str
2 J
;
J K
pathMappings
 
[
 
$str
 8
]
8 9
=
: ;
$str
< ^
;
^ _
pathMappings
 
[
 
$str
 3
]
3 4
=
5 6
$str
7 T
;
T U
pathMappings
 
[
 
$str
 5
]
5 6
=
7 8
$str
9 X
;
X Y
pathMappings
 
[
 
$str
 ?
]
? @
=
A B
$str
C l
;
l m
pathMappings
 
[
 
$str
 :
]
: ;
=
< =
$str
> b
;
b c
pathMappings
 
[
 
$str
 7
]
7 8
=
9 :
$str
; j
;
j k
pathMappings
 
[
 
$str
 :
]
: ;
=
< =
$str
> q
;
q r
return
 
pathMappings
 
;
  
}
 	
private
คค 
static
คค 
bool
คค +
UpdateDocumentationReferences
คค 9
(
คค9 :
string
คค: @
documentationFile
คคA R
,
คคR S
string
คคT Z
[
คคZ [
]
คค[ \
changedFiles
คค] i
)
คคi j
{
คคk l
try
ฅฅ 
{
ฅฅ 
if
ฆฆ 
(
ฆฆ 
!
ฆฆ 
File
ฆฆ 
.
ฆฆ 
Exists
ฆฆ  
(
ฆฆ  !
documentationFile
ฆฆ! 2
)
ฆฆ2 3
)
ฆฆ3 4
{
ฆฆ5 6
return
งง 
false
งง  
;
งง  !
}
จจ 
var
ชช 
content
ชช 
=
ชช 
File
ชช "
.
ชช" #
ReadAllText
ชช# .
(
ชช. /
documentationFile
ชช/ @
,
ชช@ A
Encoding
ชชB J
.
ชชJ K
UTF8
ชชK O
)
ชชO P
;
ชชP Q
var
ซซ 
originalContent
ซซ #
=
ซซ$ %
content
ซซ& -
;
ซซ- .
foreach
ฎฎ 
(
ฎฎ 
var
ฎฎ 
changedFile
ฎฎ (
in
ฎฎ) +
changedFiles
ฎฎ, 8
)
ฎฎ8 9
{
ฎฎ: ;
var
ฏฏ 
fileName
ฏฏ  
=
ฏฏ! "
Path
ฏฏ# '
.
ฏฏ' (
GetFileName
ฏฏ( 3
(
ฏฏ3 4
changedFile
ฏฏ4 ?
)
ฏฏ? @
;
ฏฏ@ A
var
ฐฐ 
relativePath
ฐฐ $
=
ฐฐ% &
changedFile
ฐฐ' 2
.
ฐฐ2 3
Replace
ฐฐ3 :
(
ฐฐ: ;
$char
ฐฐ; ?
,
ฐฐ? @
$char
ฐฐA D
)
ฐฐD E
;
ฐฐE F
content
ณณ 
=
ณณ "
UpdateFileReferences
ณณ 2
(
ณณ2 3
content
ณณ3 :
,
ณณ: ;
fileName
ณณ< D
,
ณณD E
relativePath
ณณF R
)
ณณR S
;
ณณS T
}
ดด 
if
ทท 
(
ทท 
documentationFile
ทท %
.
ทท% &
Contains
ทท& .
(
ทท. /
$str
ทท/ D
)
ททD E
||
ททF H
documentationFile
ธธ %
.
ธธ% &
Contains
ธธ& .
(
ธธ. /
$str
ธธ/ 7
)
ธธ7 8
)
ธธ8 9
{
ธธ: ;
content
นน 
=
นน %
UpdateVersionReferences
นน 5
(
นน5 6
content
นน6 =
,
นน= >
changedFiles
นน? K
)
นนK L
;
นนL M
}
บบ 
if
ผผ 
(
ผผ 
content
ผผ 
!=
ผผ 
originalContent
ผผ .
)
ผผ. /
{
ผผ0 1
File
ฝฝ 
.
ฝฝ 
WriteAllText
ฝฝ %
(
ฝฝ% &
documentationFile
ฝฝ& 7
,
ฝฝ7 8
content
ฝฝ9 @
,
ฝฝ@ A
Encoding
ฝฝB J
.
ฝฝJ K
UTF8
ฝฝK O
)
ฝฝO P
;
ฝฝP Q
}
พพ 
return
ภภ 
true
ภภ 
;
ภภ 
}
มม 
catch
ยย 
(
ยย 
	Exception
ยย 
)
ยย 
{
ยย 
return
รร 
false
รร 
;
รร 
}
ฤฤ 
}
ลล 	
private
ฮฮ 
static
ฮฮ 
string
ฮฮ "
UpdateFileReferences
ฮฮ 2
(
ฮฮ2 3
string
ฮฮ3 9
content
ฮฮ: A
,
ฮฮA B
string
ฮฮC I
fileName
ฮฮJ R
,
ฮฮR S
string
ฮฮT Z
relativePath
ฮฮ[ g
)
ฮฮg h
{
ฮฮi j
return
ัั 
content
ัั 
;
ัั 
}
าา 	
private
ฺฺ 
static
ฺฺ 
string
ฺฺ %
UpdateVersionReferences
ฺฺ 5
(
ฺฺ5 6
string
ฺฺ6 <
content
ฺฺ= D
,
ฺฺD E
string
ฺฺF L
[
ฺฺL M
]
ฺฺM N
changedFiles
ฺฺO [
)
ฺฺ[ \
{
ฺฺ] ^
foreach
 
(
 
var
 
file
 
in
  
changedFiles
! -
)
- .
{
/ 0
var
 
version
 
=
 

DateHelper
 (
.
( )
GetFileVersion
) 7
(
7 8
file
8 <
)
< =
;
= >
if
 
(
 
version
 
!=
 
null
 #
)
# $
{
% &
var
 
fileName
  
=
! "
Path
# '
.
' (
GetFileName
( 3
(
3 4
file
4 8
)
8 9
;
9 :
var
เเ 
versionPattern
เเ &
=
เเ' (
new
เเ) ,
Regex
เเ- 2
(
เเ2 3
$@"
เเ3 6
{
เเ6 7
Regex
เเ7 <
.
เเ< =
Escape
เเ= C
(
เเC D
fileName
เเD L
)
เเL M
}
เเM N
$str
เเN f
"
เเf g
,
เเg h
RegexOptions
เเi u
.
เเu v

IgnoreCaseเเv 
)เเ 
;เเ 
content
แแ 
=
แแ 
versionPattern
แแ ,
.
แแ, -
Replace
แแ- 4
(
แแ4 5
content
แแ5 <
,
แแ< =
$"
แแ> @
{
แแ@ A
fileName
แแA I
}
แแI J
$str
แแJ M
{
แแM N
version
แแN U
}
แแU V
$str
แแV W
"
แแW X
)
แแX Y
;
แแY Z
}
โโ 
}
ใใ 
return
ๅๅ 
content
ๅๅ 
;
ๅๅ 
}
ๆๆ 	
public
๑๑ 
static
๑๑ 
bool
๑๑ (
ValidateProjectConsistency
๑๑ 5
(
๑๑5 6
string
๑๑6 <
projectPath
๑๑= H
=
๑๑I J
$str
๑๑K N
)
๑๑N O
{
๑๑P Q
try
๒๒ 
{
๒๒ 
var
๓๓ 
issues
๓๓ 
=
๓๓ 
new
๓๓  
List
๓๓! %
<
๓๓% &
string
๓๓& ,
>
๓๓, -
(
๓๓- .
)
๓๓. /
;
๓๓/ 0+
ValidateSourceFileConsistency
๕๕ -
(
๕๕- .
projectPath
๕๕. 9
,
๕๕9 :
issues
๕๕; A
)
๕๕A B
;
๕๕B C.
 ValidateDocumentationConsistency
๖๖ 0
(
๖๖0 1
issues
๖๖1 7
)
๖๖7 8
;
๖๖8 9%
ValidateModuleStructure
๗๗ '
(
๗๗' (
projectPath
๗๗( 3
,
๗๗3 4
issues
๗๗5 ;
)
๗๗; <
;
๗๗< ="
ValidateDependencies
๘๘ $
(
๘๘$ %
projectPath
๘๘% 0
,
๘๘0 1
issues
๘๘2 8
)
๘๘8 9
;
๘๘9 :'
ValidateReadmeConsistency
๙๙ )
(
๙๙) *
issues
๙๙* 0
)
๙๙0 1
;
๙๙1 2
return
๛๛ 
issues
๛๛ 
.
๛๛ 
Count
๛๛ #
==
๛๛$ &
$num
๛๛' (
;
๛๛( )
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
private
 
static
 
void
 '
ValidateReadmeConsistency
 5
(
5 6
List
6 :
<
: ;
string
; A
>
A B
issues
C I
)
I J
{
K L
try
 
{
 
if
 
(
 
!
 "
DocumentationManager
 )
.
) *%
ValidateReadmeHierarchy
* A
(
A B
)
B C
)
C D
{
E F
issues
 
.
 
Add
 
(
 
$str
 C
)
C D
;
D E
}
 
var
 
expectedReadmes
 #
=
$ %
new
& )
[
) *
]
* +
{
 
$str
 -
,
- .
$str
 5
,
5 6
$str
 9
,
9 :
$str
 (
}
 
;
 
foreach
 
(
 
var
 
expectedReadme
 +
in
, .
expectedReadmes
/ >
)
> ?
{
@ A
if
 
(
 
!
 
File
 
.
 
Exists
 $
(
$ %
expectedReadme
% 3
)
3 4
)
4 5
{
6 7
issues
 
.
 
Add
 "
(
" #
$"
# %
$str
% C
{
C D
expectedReadme
D R
}
R S
"
S T
)
T U
;
U V
}
 
}
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
! "
issues
 
.
 
Add
 
(
 
$"
 
$str
 B
{
B C
ex
C E
.
E F
Message
F M
}
M N
"
N O
)
O P
;
P Q
}
 
}
 	
private
ฅฅ 
static
ฅฅ 
void
ฅฅ +
ValidateSourceFileConsistency
ฅฅ 9
(
ฅฅ9 :
string
ฅฅ: @
projectPath
ฅฅA L
,
ฅฅL M
List
ฅฅN R
<
ฅฅR S
string
ฅฅS Y
>
ฅฅY Z
issues
ฅฅ[ a
)
ฅฅa b
{
ฅฅc d
try
ฆฆ 
{
ฆฆ 
var
งง 
sourceFiles
งง 
=
งง  !
GetSourceFiles
งง" 0
(
งง0 1
projectPath
งง1 <
)
งง< =
;
งง= >
foreach
ฉฉ 
(
ฉฉ 
var
ฉฉ 
file
ฉฉ !
in
ฉฉ" $
sourceFiles
ฉฉ% 0
)
ฉฉ0 1
{
ฉฉ2 3
if
ชช 
(
ชช 
!
ชช 

DateHelper
ชช #
.
ชช# $
HasValidHeader
ชช$ 2
(
ชช2 3
file
ชช3 7
)
ชช7 8
)
ชช8 9
{
ชช: ;
issues
ซซ 
.
ซซ 
Add
ซซ "
(
ซซ" #
$"
ซซ# %
$str
ซซ% A
{
ซซA B
file
ซซB F
}
ซซF G
"
ซซG H
)
ซซH I
;
ซซI J
}
ฌฌ 
var
ฎฎ 
version
ฎฎ 
=
ฎฎ  !

DateHelper
ฎฎ" ,
.
ฎฎ, -
GetFileVersion
ฎฎ- ;
(
ฎฎ; <
file
ฎฎ< @
)
ฎฎ@ A
;
ฎฎA B
if
ฏฏ 
(
ฏฏ 
string
ฏฏ 
.
ฏฏ 
IsNullOrEmpty
ฏฏ ,
(
ฏฏ, -
version
ฏฏ- 4
)
ฏฏ4 5
)
ฏฏ5 6
{
ฏฏ7 8
issues
ฐฐ 
.
ฐฐ 
Add
ฐฐ "
(
ฐฐ" #
$"
ฐฐ# %
$str
ฐฐ% G
{
ฐฐG H
file
ฐฐH L
}
ฐฐL M
"
ฐฐM N
)
ฐฐN O
;
ฐฐO P
}
ฑฑ 
}
ฒฒ 
}
ณณ 
catch
ดด 
(
ดด 
	Exception
ดด 
ex
ดด 
)
ดด  
{
ดด! "
issues
ตต 
.
ตต 
Add
ตต 
(
ตต 
$"
ตต 
$str
ตต <
{
ตต< =
ex
ตต= ?
.
ตต? @
Message
ตต@ G
}
ตตG H
"
ตตH I
)
ตตI J
;
ตตJ K
}
ถถ 
}
ทท 	
private
ฝฝ 
static
ฝฝ 
void
ฝฝ .
 ValidateDocumentationConsistency
ฝฝ <
(
ฝฝ< =
List
ฝฝ= A
<
ฝฝA B
string
ฝฝB H
>
ฝฝH I
issues
ฝฝJ P
)
ฝฝP Q
{
ฝฝR S
try
พพ 
{
พพ 
if
ฟฟ 
(
ฟฟ 
!
ฟฟ "
DocumentationManager
ฟฟ )
.
ฟฟ) *.
 ValidateDocumentationConsistency
ฟฟ* J
(
ฟฟJ K
)
ฟฟK L
)
ฟฟL M
{
ฟฟN O
issues
ภภ 
.
ภภ 
Add
ภภ 
(
ภภ 
$str
ภภ L
)
ภภL M
;
ภภM N
}
มม 
if
รร 
(
รร 
!
รร "
DocumentationManager
รร )
.
รร) *+
IsDocumentationStructureValid
รร* G
(
รรG H
)
รรH I
)
รรI J
{
รรK L
issues
ฤฤ 
.
ฤฤ 
Add
ฤฤ 
(
ฤฤ 
$str
ฤฤ C
)
ฤฤC D
;
ฤฤD E
}
ลล 
}
ฦฦ 
catch
วว 
(
วว 
	Exception
วว 
ex
วว 
)
วว  
{
วว! "
issues
ศศ 
.
ศศ 
Add
ศศ 
(
ศศ 
$"
ศศ 
$str
ศศ =
{
ศศ= >
ex
ศศ> @
.
ศศ@ A
Message
ศศA H
}
ศศH I
"
ศศI J
)
ศศJ K
;
ศศK L
}
ษษ 
}
สส 	
private
ัั 
static
ัั 
void
ัั %
ValidateModuleStructure
ัั 3
(
ัั3 4
string
ัั4 :
projectPath
ัั; F
,
ััF G
List
ััH L
<
ััL M
string
ััM S
>
ััS T
issues
ััU [
)
ัั[ \
{
ัั] ^
try
าา 
{
าา 
var
ำำ 
expectedModules
ำำ #
=
ำำ$ %
new
ำำ& )
[
ำำ) *
]
ำำ* +
{
ำำ, -
$str
ำำ. :
,
ำำ: ;
$str
ำำ< D
,
ำำD E
$str
ำำF M
,
ำำM N
$str
ำำO Y
,
ำำY Z
$str
ำำ[ b
,
ำำb c
$str
ำำd n
}
ำำo p
;
ำำp q
foreach
ีี 
(
ีี 
var
ีี 
module
ีี #
in
ีี$ &
expectedModules
ีี' 6
)
ีี6 7
{
ีี8 9
var
ึึ 

modulePath
ึึ "
=
ึึ# $
Path
ึึ% )
.
ึึ) *
Combine
ึึ* 1
(
ึึ1 2
projectPath
ึึ2 =
,
ึึ= >
module
ึึ? E
)
ึึE F
;
ึึF G
if
ืื 
(
ืื 
!
ืื 
	Directory
ืื "
.
ืื" #
Exists
ืื# )
(
ืื) *

modulePath
ืื* 4
)
ืื4 5
)
ืื5 6
{
ืื7 8
issues
ุุ 
.
ุุ 
Add
ุุ "
(
ุุ" #
$"
ุุ# %
$str
ุุ% H
{
ุุH I
module
ุุI O
}
ุุO P
"
ุุP Q
)
ุุQ R
;
ุุR S
}
ูู 
}
ฺฺ 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
! "
issues
 
.
 
Add
 
(
 
$"
 
$str
 @
{
@ A
ex
A C
.
C D
Message
D K
}
K L
"
L M
)
M N
;
N O
}
 
}
฿฿ 	
private
ๆๆ 
static
ๆๆ 
void
ๆๆ "
ValidateDependencies
ๆๆ 0
(
ๆๆ0 1
string
ๆๆ1 7
projectPath
ๆๆ8 C
,
ๆๆC D
List
ๆๆE I
<
ๆๆI J
string
ๆๆJ P
>
ๆๆP Q
issues
ๆๆR X
)
ๆๆX Y
{
ๆๆZ [
try
็็ 
{
็็ 
var
่่ 
sourceFiles
่่ 
=
่่  !
GetSourceFiles
่่" 0
(
่่0 1
projectPath
่่1 <
)
่่< =
;
่่= >
var
้้ "
circularDependencies
้้ (
=
้้) *(
DetectCircularDependencies
้้+ E
(
้้E F
sourceFiles
้้F Q
)
้้Q R
;
้้R S
foreach
๋๋ 
(
๋๋ 
var
๋๋ 

dependency
๋๋ '
in
๋๋( *"
circularDependencies
๋๋+ ?
)
๋๋? @
{
๋๋A B
issues
์์ 
.
์์ 
Add
์์ 
(
์์ 
$"
์์ !
$str
์์! ?
{
์์? @

dependency
์์@ J
}
์์J K
"
์์K L
)
์์L M
;
์์M N
}
ํํ 
}
๎๎ 
catch
๏๏ 
(
๏๏ 
	Exception
๏๏ 
ex
๏๏ 
)
๏๏  
{
๏๏! "
issues
๐๐ 
.
๐๐ 
Add
๐๐ 
(
๐๐ 
$"
๐๐ 
$str
๐๐ <
{
๐๐< =
ex
๐๐= ?
.
๐๐? @
Message
๐๐@ G
}
๐๐G H
"
๐๐H I
)
๐๐I J
;
๐๐J K
}
๑๑ 
}
๒๒ 	
private
๙๙ 
static
๙๙ 
List
๙๙ 
<
๙๙ 
string
๙๙ "
>
๙๙" #
GetSourceFiles
๙๙$ 2
(
๙๙2 3
string
๙๙3 9
projectPath
๙๙: E
)
๙๙E F
{
๙๙G H
var
๚๚ 
sourceFiles
๚๚ 
=
๚๚ 
new
๚๚ !
List
๚๚" &
<
๚๚& '
string
๚๚' -
>
๚๚- .
(
๚๚. /
)
๚๚/ 0
;
๚๚0 1
try
 
{
 
foreach
 
(
 
var
 
pattern
 $
in
% ' 
SourceFilePatterns
( :
)
: ;
{
< =
sourceFiles
 
.
  
AddRange
  (
(
( )
	Directory
) 2
.
2 3
GetFiles
3 ;
(
; <
projectPath
< G
,
G H
pattern
I P
,
P Q
SearchOption
R ^
.
^ _
AllDirectories
_ m
)
m n
)
n o
;
o p
}
 
sourceFiles
 
=
 
sourceFiles
 )
.
) *
Where
* /
(
/ 0
f
0 1
=>
2 4
!
 
f
 
.
 
Contains
 
(
  
$str
  (
)
( )
&&
* ,
!
 
f
 
.
 
Contains
 
(
  
$str
  (
)
( )
&&
* ,
!
 
f
 
.
 
Contains
 
(
  
$str
  -
)
- .
)
 
.
 
ToList
 
(
 
)
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
}
 
return
 
sourceFiles
 
;
 
}
 	
private
 
static
 
bool
 
IsSourceFile
 (
(
( )
string
) /
filePath
0 8
)
8 9
{
: ;
var
 
	extension
 
=
 
Path
  
.
  !
GetExtension
! -
(
- .
filePath
. 6
)
6 7
;
7 8
return
 
	extension
 
==
 
$str
  %
||
& (
	extension
) 2
==
3 5
$str
6 =
;
= >
}
 	
private
 
static
 
List
 
<
 
string
 "
>
" #(
DetectCircularDependencies
$ >
(
> ?
List
? C
<
C D
string
D J
>
J K
sourceFiles
L W
)
W X
{
Y Z
var
 
circularDeps
 
=
 
new
 "
List
# '
<
' (
string
( .
>
. /
(
/ 0
)
0 1
;
1 2
try
กก 
{
กก 
var
ขข 
dependencies
ขข  
=
ขข! "
new
ขข# &

Dictionary
ขข' 1
<
ขข1 2
string
ขข2 8
,
ขข8 9
HashSet
ขข: A
<
ขขA B
string
ขขB H
>
ขขH I
>
ขขI J
(
ขขJ K
)
ขขK L
;
ขขL M
foreach
ฅฅ 
(
ฅฅ 
var
ฅฅ 
file
ฅฅ !
in
ฅฅ" $
sourceFiles
ฅฅ% 0
)
ฅฅ0 1
{
ฅฅ2 3
var
ฆฆ 
fileDeps
ฆฆ  
=
ฆฆ! "!
ExtractDependencies
ฆฆ# 6
(
ฆฆ6 7
file
ฆฆ7 ;
)
ฆฆ; <
;
ฆฆ< =
dependencies
งง  
[
งง  !
file
งง! %
]
งง% &
=
งง' (
fileDeps
งง) 1
;
งง1 2
}
จจ 
foreach
ซซ 
(
ซซ 
var
ซซ 
file
ซซ !
in
ซซ" $
dependencies
ซซ% 1
.
ซซ1 2
Keys
ซซ2 6
)
ซซ6 7
{
ซซ8 9
if
ฌฌ 
(
ฌฌ "
HasCircularReference
ฌฌ ,
(
ฌฌ, -
file
ฌฌ- 1
,
ฌฌ1 2
dependencies
ฌฌ3 ?
,
ฌฌ? @
new
ฌฌA D
HashSet
ฌฌE L
<
ฌฌL M
string
ฌฌM S
>
ฌฌS T
(
ฌฌT U
)
ฌฌU V
)
ฌฌV W
)
ฌฌW X
{
ฌฌY Z
circularDeps
ญญ $
.
ญญ$ %
Add
ญญ% (
(
ญญ( )
$"
ญญ) +
$str
ญญ+ I
{
ญญI J
Path
ญญJ N
.
ญญN O
GetFileName
ญญO Z
(
ญญZ [
file
ญญ[ _
)
ญญ_ `
}
ญญ` a
"
ญญa b
)
ญญb c
;
ญญc d
}
ฎฎ 
}
ฏฏ 
}
ฐฐ 
catch
ฑฑ 
(
ฑฑ 
	Exception
ฑฑ 
)
ฑฑ 
{
ฑฑ 
}
ณณ 
return
ตต 
circularDeps
ตต 
;
ตต  
}
ถถ 	
private
ฝฝ 
static
ฝฝ 
HashSet
ฝฝ 
<
ฝฝ 
string
ฝฝ %
>
ฝฝ% &!
ExtractDependencies
ฝฝ' :
(
ฝฝ: ;
string
ฝฝ; A
filePath
ฝฝB J
)
ฝฝJ K
{
ฝฝL M
var
พพ 
dependencies
พพ 
=
พพ 
new
พพ "
HashSet
พพ# *
<
พพ* +
string
พพ+ 1
>
พพ1 2
(
พพ2 3
)
พพ3 4
;
พพ4 5
try
ภภ 
{
ภภ 
var
มม 
content
มม 
=
มม 
File
มม "
.
มม" #
ReadAllText
มม# .
(
มม. /
filePath
มม/ 7
)
มม7 8
;
มม8 9
var
ยย 
usingMatches
ยย  
=
ยย! "!
UsingDirectiveRegex
ยย# 6
.
ยย6 7
Matches
ยย7 >
(
ยย> ?
content
ยย? F
)
ยยF G
;
ยยG H
foreach
ฤฤ 
(
ฤฤ 
Match
ฤฤ 
match
ฤฤ $
in
ฤฤ% '
usingMatches
ฤฤ( 4
)
ฤฤ4 5
{
ฤฤ6 7
dependencies
ลล  
.
ลล  !
Add
ลล! $
(
ลล$ %
match
ลล% *
.
ลล* +
Groups
ลล+ 1
[
ลล1 2
$num
ลล2 3
]
ลล3 4
.
ลล4 5
Value
ลล5 :
.
ลล: ;
Trim
ลล; ?
(
ลล? @
)
ลล@ A
)
ลลA B
;
ลลB C
}
ฦฦ 
}
วว 
catch
ศศ 
(
ศศ 
	Exception
ศศ 
)
ศศ 
{
ศศ 
}
สส 
return
ฬฬ 
dependencies
ฬฬ 
;
ฬฬ  
}
ออ 	
private
ึึ 
static
ึึ 
bool
ึึ "
HasCircularReference
ึึ 0
(
ึึ0 1
string
ึึ1 7
currentFile
ึึ8 C
,
ึึC D

Dictionary
ึึE O
<
ึึO P
string
ึึP V
,
ึึV W
HashSet
ึึX _
<
ึึ_ `
string
ึึ` f
>
ึึf g
>
ึึg h
dependencies
ึึi u
,
ึึu v
HashSet
ึึw ~
<
ึึ~ 
stringึึ 
>ึึ 
visitedึึ 
)ึึ 
{ึึ 
if
ืื 
(
ืื 
visited
ืื 
.
ืื 
Contains
ืื  
(
ืื  !
currentFile
ืื! ,
)
ืื, -
)
ืื- .
{
ืื/ 0
return
ุุ 
true
ุุ 
;
ุุ 
}
ูู 
visited
 
.
 
Add
 
(
 
currentFile
 #
)
# $
;
$ %
if
 
(
 
dependencies
 
.
 
ContainsKey
 (
(
( )
currentFile
) 4
)
4 5
)
5 6
{
7 8
foreach
 
(
 
var
 

dependency
 '
in
( *
dependencies
+ 7
[
7 8
currentFile
8 C
]
C D
)
D E
{
F G
if
฿฿ 
(
฿฿ "
HasCircularReference
฿฿ ,
(
฿฿, -

dependency
฿฿- 7
,
฿฿7 8
dependencies
฿฿9 E
,
฿฿E F
new
฿฿G J
HashSet
฿฿K R
<
฿฿R S
string
฿฿S Y
>
฿฿Y Z
(
฿฿Z [
visited
฿฿[ b
)
฿฿b c
)
฿฿c d
)
฿฿d e
{
฿฿f g
return
เเ 
true
เเ #
;
เเ# $
}
แแ 
}
โโ 
}
ใใ 
return
ๅๅ 
false
ๅๅ 
;
ๅๅ 
}
ๆๆ 	
public
๒๒ 
static
๒๒ 

Dictionary
๒๒  
<
๒๒  !
string
๒๒! '
,
๒๒' (
List
๒๒) -
<
๒๒- .
string
๒๒. 4
>
๒๒4 5
>
๒๒5 6!
DetectModuleChanges
๒๒7 J
(
๒๒J K
IEnumerable
๒๒K V
<
๒๒V W
string
๒๒W ]
>
๒๒] ^
changedFiles
๒๒_ k
)
๒๒k l
{
๒๒m n
var
๓๓ 
moduleChanges
๓๓ 
=
๓๓ 
new
๓๓  #

Dictionary
๓๓$ .
<
๓๓. /
string
๓๓/ 5
,
๓๓5 6
List
๓๓7 ;
<
๓๓; <
string
๓๓< B
>
๓๓B C
>
๓๓C D
(
๓๓D E
)
๓๓E F
;
๓๓F G
foreach
๕๕ 
(
๕๕ 
var
๕๕ 
file
๕๕ 
in
๕๕  
changedFiles
๕๕! -
)
๕๕- .
{
๕๕/ 0
var
๖๖ 

moduleName
๖๖ 
=
๖๖  
ExtractModuleName
๖๖! 2
(
๖๖2 3
file
๖๖3 7
)
๖๖7 8
;
๖๖8 9
if
๗๗ 
(
๗๗ 
!
๗๗ 
string
๗๗ 
.
๗๗ 
IsNullOrEmpty
๗๗ )
(
๗๗) *

moduleName
๗๗* 4
)
๗๗4 5
)
๗๗5 6
{
๗๗7 8
if
๘๘ 
(
๘๘ 
!
๘๘ 
moduleChanges
๘๘ &
.
๘๘& '
ContainsKey
๘๘' 2
(
๘๘2 3

moduleName
๘๘3 =
)
๘๘= >
)
๘๘> ?
{
๘๘@ A
moduleChanges
๙๙ %
[
๙๙% &

moduleName
๙๙& 0
]
๙๙0 1
=
๙๙2 3
new
๙๙4 7
List
๙๙8 <
<
๙๙< =
string
๙๙= C
>
๙๙C D
(
๙๙D E
)
๙๙E F
;
๙๙F G
}
๚๚ 
var
 
changeDescription
 )
=
* +'
GenerateChangeDescription
, E
(
E F
file
F J
)
J K
;
K L
moduleChanges
 !
[
! "

moduleName
" ,
]
, -
.
- .
Add
. 1
(
1 2
changeDescription
2 C
)
C D
;
D E
}
 
}
 
return
 
moduleChanges
  
;
  !
}
 	
public
 
static
 
string
 
ExtractModuleName
 .
(
. /
string
/ 5
filePath
6 >
)
> ?
{
@ A
if
 
(
 
string
 
.
 
IsNullOrEmpty
 $
(
$ %
filePath
% -
)
- .
)
. /
return
 
null
 
;
 
var
 
normalizedPath
 
=
  
filePath
! )
.
) *
Replace
* 1
(
1 2
$char
2 6
,
6 7
$char
8 ;
)
; <
;
< =
var
 
modulePatterns
 
=
  
new
! $
[
$ %
]
% &
{
 
new
 
{
 
Pattern
 
=
 
$str
  -
,
- .
Module
/ 5
=
6 7
$str
8 B
}
C D
,
D E
new
 
{
 
Pattern
 
=
 
$str
  ,
,
, -
Module
. 4
=
5 6
$str
7 @
}
A B
,
B C
new
 
{
 
Pattern
 
=
 
$str
  -
,
- .
Module
/ 5
=
6 7
$str
8 B
}
C D
,
D E
new
 
{
 
Pattern
 
=
 
$str
  *
,
* +
Module
, 2
=
3 4
$str
5 <
}
= >
,
> ?
new
 
{
 
Pattern
 
=
 
$str
  +
,
+ ,
Module
- 3
=
4 5
$str
6 >
}
? @
,
@ A
new
 
{
 
Pattern
 
=
 
$str
  /
,
/ 0
Module
1 7
=
8 9
$str
: F
}
G H
,
H I
new
 
{
 
Pattern
 
=
 
$str
  *
,
* +
Module
, 2
=
3 4
$str
5 <
}
= >
,
> ?
new
 
{
 
Pattern
 
=
 
$str
  /
,
/ 0
Module
1 7
=
8 9
$str
: F
}
G H
}
 
;
 
foreach
 
(
 
var
 
pattern
  
in
! #
modulePatterns
$ 2
)
2 3
{
4 5
if
 
(
 
Regex
 
.
 
IsMatch
 !
(
! "
normalizedPath
" 0
,
0 1
pattern
2 9
.
9 :
Pattern
: A
,
A B
RegexOptions
C O
.
O P

IgnoreCase
P Z
)
Z [
)
[ \
{
] ^
return
 
pattern
 "
.
" #
Module
# )
;
) *
}
 
}
กก 
return
ฃฃ 
null
ฃฃ 
;
ฃฃ 
}
คค 	
private
ฌฌ 
static
ฌฌ 
string
ฌฌ '
GenerateChangeDescription
ฌฌ 7
(
ฌฌ7 8
string
ฌฌ8 >
filePath
ฌฌ? G
)
ฌฌG H
{
ฌฌI J
var
ญญ 
fileName
ญญ 
=
ญญ 
Path
ญญ 
.
ญญ  
GetFileName
ญญ  +
(
ญญ+ ,
filePath
ญญ, 4
)
ญญ4 5
;
ญญ5 6
var
ฎฎ 
	extension
ฎฎ 
=
ฎฎ 
Path
ฎฎ  
.
ฎฎ  !
GetExtension
ฎฎ! -
(
ฎฎ- .
filePath
ฎฎ. 6
)
ฎฎ6 7
.
ฎฎ7 8
ToLower
ฎฎ8 ?
(
ฎฎ? @
)
ฎฎ@ A
;
ฎฎA B
var
ฏฏ 
	directory
ฏฏ 
=
ฏฏ 
Path
ฏฏ  
.
ฏฏ  !
GetDirectoryName
ฏฏ! 1
(
ฏฏ1 2
filePath
ฏฏ2 :
)
ฏฏ: ;
?
ฏฏ; <
.
ฏฏ< =
Replace
ฏฏ= D
(
ฏฏD E
$char
ฏฏE I
,
ฏฏI J
$char
ฏฏK N
)
ฏฏN O
;
ฏฏO P
var
ฒฒ 
exists
ฒฒ 
=
ฒฒ 
File
ฒฒ 
.
ฒฒ 
Exists
ฒฒ $
(
ฒฒ$ %
filePath
ฒฒ% -
)
ฒฒ- .
;
ฒฒ. /
var
ณณ 
action
ณณ 
=
ณณ 
exists
ณณ 
?
ณณ  !
$str
ณณ" ,
:
ณณ- .
$str
ณณ/ 6
;
ณณ6 7
switch
ถถ 
(
ถถ 
	extension
ถถ 
)
ถถ 
{
ถถ  
case
ทท 
$str
ทท 
:
ทท 
return
ธธ 
$"
ธธ 
{
ธธ 
action
ธธ $
}
ธธ$ %
$str
ธธ% 0
{
ธธ0 1
fileName
ธธ1 9
}
ธธ9 :
"
ธธ: ;
;
ธธ; <
case
นน 
$str
นน 
:
นน 
return
บบ 
$"
บบ 
{
บบ 
action
บบ $
}
บบ$ %
$str
บบ% 1
{
บบ1 2
fileName
บบ2 :
}
บบ: ;
"
บบ; <
;
บบ< =
case
ปป 
$str
ปป 
:
ปป 
return
ผผ 
$"
ผผ 
{
ผผ 
action
ผผ $
}
ผผ$ %
$str
ผผ% 5
{
ผผ5 6
fileName
ผผ6 >
}
ผผ> ?
"
ผผ? @
;
ผผ@ A
case
ฝฝ 
$str
ฝฝ 
:
ฝฝ 
return
พพ 
$"
พพ 
{
พพ 
action
พพ $
}
พพ$ %
$str
พพ% 9
{
พพ9 :
fileName
พพ: B
}
พพB C
"
พพC D
;
พพD E
default
ฟฟ 
:
ฟฟ 
return
ภภ 
$"
ภภ 
{
ภภ 
action
ภภ $
}
ภภ$ %
$str
ภภ% ,
{
ภภ, -
fileName
ภภ- 5
}
ภภ5 6
"
ภภ6 7
;
ภภ7 8
}
มม 
}
ยย 	
public
สส 
static
สส 
string
สส "
GetModuleSummaryPath
สส 1
(
สส1 2
string
สส2 8

moduleName
สส9 C
)
สสC D
{
สสE F
return
หห 
$"
หห 
$str
หห +
{
หห+ ,

moduleName
หห, 6
}
หห6 7
$str
หห7 M
"
หหM N
;
หหN O
}
ฬฬ 	
public
ิิ 
static
ิิ 
bool
ิิ !
ModuleSummaryExists
ิิ .
(
ิิ. /
string
ิิ/ 5

moduleName
ิิ6 @
)
ิิ@ A
{
ิิB C
var
ีี 
summaryPath
ีี 
=
ีี "
GetModuleSummaryPath
ีี 2
(
ีี2 3

moduleName
ีี3 =
)
ีี= >
;
ีี> ?
return
ึึ 
File
ึึ 
.
ึึ 
Exists
ึึ 
(
ึึ 
summaryPath
ึึ *
)
ึึ* +
;
ึึ+ ,
}
ืื 	
public
฿฿ 
static
฿฿ 
List
฿฿ 
<
฿฿ (
ModuleUpdateRecommendation
฿฿ 5
>
฿฿5 6#
AnalyzeModuleActivity
฿฿7 L
(
฿฿L M

Dictionary
฿฿M W
<
฿฿W X
string
฿฿X ^
,
฿฿^ _
List
฿฿` d
<
฿฿d e
string
฿฿e k
>
฿฿k l
>
฿฿l m
moduleChanges
฿฿n {
)
฿฿{ |
{
฿฿} ~
var
เเ 
recommendations
เเ 
=
เเ  !
new
เเ" %
List
เเ& *
<
เเ* +(
ModuleUpdateRecommendation
เเ+ E
>
เเE F
(
เเF G
)
เเG H
;
เเH I
foreach
โโ 
(
โโ 
var
โโ 
moduleChange
โโ %
in
โโ& (
moduleChanges
โโ) 6
)
โโ6 7
{
โโ8 9
var
ใใ 

moduleName
ใใ 
=
ใใ  
moduleChange
ใใ! -
.
ใใ- .
Key
ใใ. 1
;
ใใ1 2
var
ไไ 
changes
ไไ 
=
ไไ 
moduleChange
ไไ *
.
ไไ* +
Value
ไไ+ 0
;
ไไ0 1
var
ๆๆ 
recommendation
ๆๆ "
=
ๆๆ# $
new
ๆๆ% ((
ModuleUpdateRecommendation
ๆๆ) C
{
ๆๆD E

ModuleName
็็ 
=
็็  

moduleName
็็! +
,
็็+ ,
SummaryPath
่่ 
=
่่  !"
GetModuleSummaryPath
่่" 6
(
่่6 7

moduleName
่่7 A
)
่่A B
,
่่B C
ChangeCount
้้ 
=
้้  !
changes
้้" )
.
้้) *
Count
้้* /
,
้้/ 0
Changes
๊๊ 
=
๊๊ 
changes
๊๊ %
,
๊๊% &
Priority
๋๋ 
=
๋๋ %
DetermineUpdatePriority
๋๋ 6
(
๋๋6 7
changes
๋๋7 >
)
๋๋> ?
,
๋๋? @
SummaryExists
์์ !
=
์์" #!
ModuleSummaryExists
์์$ 7
(
์์7 8

moduleName
์์8 B
)
์์B C
,
์์C D
RecommendedAction
ํํ %
=
ํํ& '(
DetermineRecommendedAction
ํํ( B
(
ํํB C

moduleName
ํํC M
,
ํํM N
changes
ํํO V
)
ํํV W
}
๎๎ 
;
๎๎ 
recommendations
๐๐ 
.
๐๐  
Add
๐๐  #
(
๐๐# $
recommendation
๐๐$ 2
)
๐๐2 3
;
๐๐3 4
}
๑๑ 
return
๓๓ 
recommendations
๓๓ "
.
๓๓" #
OrderByDescending
๓๓# 4
(
๓๓4 5
r
๓๓5 6
=>
๓๓7 9
r
๓๓: ;
.
๓๓; <
Priority
๓๓< D
)
๓๓D E
.
๓๓E F
ToList
๓๓F L
(
๓๓L M
)
๓๓M N
;
๓๓N O
}
๔๔ 	
private
 
static
 
int
 %
DetermineUpdatePriority
 2
(
2 3
List
3 7
<
7 8
string
8 >
>
> ?
changes
@ G
)
G H
{
I J
var
 
priority
 
=
 
$num
 
;
 
if
 
(
 
changes
 
.
 
Count
 
>=
  
$num
! "
)
" #
priority
$ ,
+=
- /
$num
0 1
;
1 2
else
 
if
 
(
 
changes
 
.
 
Count
 "
>=
# %
$num
& '
)
' (
priority
) 1
+=
2 4
$num
5 6
;
6 7
var
 
newFiles
 
=
 
changes
 "
.
" #
Count
# (
(
( )
c
) *
=>
+ -
c
. /
.
/ 0
Contains
0 8
(
8 9
$str
9 @
)
@ A
)
A B
;
B C
if
 
(
 
newFiles
 
>
 
$num
 
)
 
priority
 &
+=
' )
$num
* +
;
+ ,
var
 "
hasCoreFunctionality
 $
=
% &
changes
' .
.
. /
Any
/ 2
(
2 3
c
3 4
=>
5 7
c
 
.
 
Contains
 
(
 
$str
 $
)
$ %
||
& (
c
 
.
 
Contains
 
(
 
$str
 $
)
$ %
||
& (
c
 
.
 
Contains
 
(
 
$str
 #
)
# $
||
% '
c
 
.
 
Contains
 
(
 
$str
 #
)
# $
)
$ %
;
% &
if
 
(
 "
hasCoreFunctionality
 $
)
$ %
priority
& .
+=
/ 1
$num
2 3
;
3 4
return
 
Math
 
.
 
Min
 
(
 
priority
 $
,
$ %
$num
& '
)
' (
;
( )
}
 	
private
 
static
 
string
 (
DetermineRecommendedAction
 8
(
8 9
string
9 ?

moduleName
@ J
,
J K
List
L P
<
P Q
string
Q W
>
W X
changes
Y `
)
` a
{
b c
if
 
(
 
!
 !
ModuleSummaryExists
 $
(
$ %

moduleName
% /
)
/ 0
)
0 1
{
2 3
return
 
$"
 
$str
 $
{
$ %

moduleName
% /
}
/ 0
$str
0 K
"
K L
;
L M
}
 
var
 
newFiles
 
=
 
changes
 "
.
" #
Count
# (
(
( )
c
) *
=>
+ -
c
. /
.
/ 0
Contains
0 8
(
8 9
$str
9 @
)
@ A
)
A B
;
B C
var
 
modifiedFiles
 
=
 
changes
  '
.
' (
Count
( -
(
- .
c
. /
=>
0 2
c
3 4
.
4 5
Contains
5 =
(
= >
$str
> H
)
H I
)
I J
;
J K
if
กก 
(
กก 
newFiles
กก 
>
กก 
$num
กก 
&&
กก 
modifiedFiles
กก  -
>
กก. /
$num
กก0 1
)
กก1 2
{
กก3 4
return
ขข 
$"
ขข 
$str
ขข -
{
ขข- .
newFiles
ขข. 6
}
ขข6 7
$str
ขข7 F
{
ขขF G
modifiedFiles
ขขG T
}
ขขT U
$str
ขขU c
"
ขขc d
;
ขขd e
}
ฃฃ 
else
คค 
if
คค 
(
คค 
newFiles
คค 
>
คค 
$num
คค  !
)
คค! "
{
คค# $
return
ฅฅ 
$"
ฅฅ 
$str
ฅฅ "
{
ฅฅ" #
newFiles
ฅฅ# +
}
ฅฅ+ ,
$str
ฅฅ, @
"
ฅฅ@ A
;
ฅฅA B
}
ฆฆ 
else
งง 
if
งง 
(
งง 
modifiedFiles
งง "
>
งง# $
$num
งง% &
)
งง& '
{
งง( )
return
จจ 
$"
จจ 
$str
จจ -
{
จจ- .
modifiedFiles
จจ. ;
}
จจ; <
$str
จจ< O
"
จจO P
;
จจP Q
}
ฉฉ 
return
ซซ 
$str
ซซ ?
;
ซซ? @
}
ฌฌ 	
}
ฏฏ 
public
ถถ 

class
ถถ (
ModuleUpdateRecommendation
ถถ +
{
ถถ, -
public
ทท 
string
ทท 

ModuleName
ทท  
{
ทท! "
get
ทท# &
;
ทท& '
set
ทท( +
;
ทท+ ,
}
ทท- .
public
ธธ 
string
ธธ 
SummaryPath
ธธ !
{
ธธ" #
get
ธธ$ '
;
ธธ' (
set
ธธ) ,
;
ธธ, -
}
ธธ. /
public
นน 
int
นน 
ChangeCount
นน 
{
นน  
get
นน! $
;
นน$ %
set
นน& )
;
นน) *
}
นน+ ,
public
บบ 
List
บบ 
<
บบ 
string
บบ 
>
บบ 
Changes
บบ #
{
บบ$ %
get
บบ& )
;
บบ) *
set
บบ+ .
;
บบ. /
}
บบ0 1
=
บบ2 3
new
บบ4 7
List
บบ8 <
<
บบ< =
string
บบ= C
>
บบC D
(
บบD E
)
บบE F
;
บบF G
public
ปป 
int
ปป 
Priority
ปป 
{
ปป 
get
ปป !
;
ปป! "
set
ปป# &
;
ปป& '
}
ปป( )
public
ผผ 
bool
ผผ 
SummaryExists
ผผ !
{
ผผ" #
get
ผผ$ '
;
ผผ' (
set
ผผ) ,
;
ผผ, -
}
ผผ. /
public
ฝฝ 
string
ฝฝ 
RecommendedAction
ฝฝ '
{
ฝฝ( )
get
ฝฝ* -
;
ฝฝ- .
set
ฝฝ/ 2
;
ฝฝ2 3
}
ฝฝ4 5
public
ยย 
string
ยย 

GetSummary
ยย  
(
ยย  !
)
ยย! "
{
ยย# $
var
รร 
status
รร 
=
รร 
SummaryExists
รร &
?
รร' (
$str
รร) 1
:
รร2 3
$str
รร4 <
;
รร< =
return
ฤฤ 
$"
ฤฤ 
{
ฤฤ 
status
ฤฤ 
}
ฤฤ 
$str
ฤฤ 
{
ฤฤ 

ModuleName
ฤฤ )
}
ฤฤ) *
$str
ฤฤ* E
{
ฤฤE F
Priority
ฤฤF N
}
ฤฤN O
$str
ฤฤO S
{
ฤฤS T
ChangeCount
ฤฤT _
}
ฤฤ_ `
$str
ฤฤ` q
"
ฤฤq r
;
ฤฤr s
}
ลล 	
}
ฦฦ 
}วว ช๊
HC:\Playnite\_github\OstPlayer\source\DevTools\HeaderProtectionService.cs
	namespaceNN 	
	OstPlayerNN
 
.NN 
DevToolsNN 
{OO 
publicTT 

staticTT 
classTT #
HeaderProtectionServiceTT /
{UU 
private\\ 
static\\ 
readonly\\ 

Dictionary\\  *
<\\* +
string\\+ 1
,\\1 2
string\\3 9
[\\9 :
]\\: ;
>\\; <
CriticalSections\\= M
=\\N O
new\\P S

Dictionary\\T ^
<\\^ _
string]] 
,]] 
string^^ 
[^^ 
]^^ 
>__ 	
{`` 	
{aa 
$strbb 
,bb 
newcc 
[cc 
]cc 
{cc 
$strcc )
,cc) *
$strcc+ >
,cc> ?
$strcc@ ^
}cc_ `
}dd 
,dd 
{ee 
$strff $
,ff$ %
newgg 
[gg 
]gg 
{gg 
$strgg 0
,gg0 1
$strgg2 L
,ggL M
$strggN Z
}gg[ \
}hh 
,hh 
{ii 
$strii 
,ii 
newii 
[ii 
]ii 
{ii  
$strii! .
,ii. /
$strii0 ?
,ii? @
$striiA V
}iiW X
}iiY Z
,iiZ [
{jj 
$strkk 
,kk  
newll 
[ll 
]ll 
{ll 
$strll +
,ll+ ,
$strll- B
,llB C
$strllD Y
}llZ [
}mm 
,mm 
{nn 
$stroo  
,oo  !
newpp 
[pp 
]pp 
{pp 
$strpp &
,pp& '
$strpp( 8
,pp8 9
$strpp: \
}pp] ^
}qq 
,qq 
{rr 
$strrr 
,rr 
newrr 
[rr  
]rr  !
{rr" #
$strrr$ .
,rr. /
$strrr0 <
,rr< =
$strrr> Y
}rrZ [
}rr\ ]
,rr] ^
}ss 	
;ss	 

privateyy 
staticyy 
readonlyyy 

Dictionaryyy  *
<yy* +
stringyy+ 1
,yy1 2
HeaderBackupyy3 ?
>yy? @
_headerBackupsyyA O
=yyP Q
newzz 

Dictionaryzz 
<zz 
stringzz !
,zz! "
HeaderBackupzz# /
>zz/ 0
(zz0 1
)zz1 2
;zz2 3
private 
static 
readonly 
object  &
_backupLock' 2
=3 4
new5 8
object9 ?
(? @
)@ A
;A B
public
 
static
 
bool
 !
BackupHeaderContent
 .
(
. /
string
/ 5
filePath
6 >
)
> ?
{
 	
if
 
(
 
string
 
.
 
IsNullOrEmpty
 $
(
$ %
filePath
% -
)
- .
||
/ 1
!
2 3
File
3 7
.
7 8
Exists
8 >
(
> ?
filePath
? G
)
G H
)
H I
{
 
return
 
false
 
;
 
}
 
try
 
{
 
lock
 
(
 
_backupLock
 !
)
! "
{
 
var
 
content
 
=
  !
File
" &
.
& '
ReadAllText
' 2
(
2 3
filePath
3 ;
,
; <
Encoding
= E
.
E F
UTF8
F J
)
J K
;
K L
var
 
criticalSections
 (
=
) *%
ExtractCriticalSections
+ B
(
B C
content
C J
)
J K
;
K L
var
 
contentHash
 #
=
$ %"
CalculateContentHash
& :
(
: ;
content
; B
)
B C
;
C D
var
 
backup
 
=
  
new
! $
HeaderBackup
% 1
{
 
FilePath
  
=
! "
filePath
# +
,
+ ,

BackupTime
 "
=
# $
DateTime
% -
.
- .
Now
. 1
,
1 2!
OriginalContentHash
 +
=
, -
contentHash
. 9
,
9 :
CriticalSections
 (
=
) *
criticalSections
+ ;
,
; <
FullContent
 #
=
$ %
content
& -
,
- .
}
กก 
;
กก 
_headerBackups
ฃฃ "
[
ฃฃ" #
filePath
ฃฃ# +
]
ฃฃ+ ,
=
ฃฃ- .
backup
ฃฃ/ 5
;
ฃฃ5 6
return
คค 
true
คค 
;
คค  
}
ฅฅ 
}
ฆฆ 
catch
งง 
(
งง 
	Exception
งง 
)
งง 
{
จจ 
return
ฉฉ 
false
ฉฉ 
;
ฉฉ 
}
ชช 
}
ซซ 	
public
ณณ 
static
ณณ $
HeaderProtectionResult
ณณ ,&
ValidateAndRestoreHeader
ณณ- E
(
ณณE F
string
ณณF L
filePath
ณณM U
)
ณณU V
{
ดด 	
var
ตต 
result
ตต 
=
ตต 
new
ตต $
HeaderProtectionResult
ตต 3
{
ถถ 
FilePath
ทท 
=
ทท 
filePath
ทท #
,
ทท# $
ValidationTime
ธธ 
=
ธธ  
DateTime
ธธ! )
.
ธธ) *
Now
ธธ* -
,
ธธ- .
IsValid
นน 
=
นน 
true
นน 
,
นน 
RestoredSections
บบ  
=
บบ! "
new
บบ# &
List
บบ' +
<
บบ+ ,
string
บบ, 2
>
บบ2 3
(
บบ3 4
)
บบ4 5
,
บบ5 6
DeletedSections
ปป 
=
ปป  !
new
ปป" %
List
ปป& *
<
ปป* +
string
ปป+ 1
>
ปป1 2
(
ปป2 3
)
ปป3 4
,
ปป4 5
}
ผผ 
;
ผผ 
if
พพ 
(
พพ 
string
พพ 
.
พพ 
IsNullOrEmpty
พพ $
(
พพ$ %
filePath
พพ% -
)
พพ- .
||
พพ/ 1
!
พพ2 3
File
พพ3 7
.
พพ7 8
Exists
พพ8 >
(
พพ> ?
filePath
พพ? G
)
พพG H
)
พพH I
{
ฟฟ 
result
ภภ 
.
ภภ 
IsValid
ภภ 
=
ภภ  
false
ภภ! &
;
ภภ& '
result
มม 
.
มม 
ErrorMessage
มม #
=
มม$ %
$str
มม& G
;
มมG H
return
ยย 
result
ยย 
;
ยย 
}
รร 
try
ลล 
{
ฦฦ 
lock
วว 
(
วว 
_backupLock
วว !
)
วว! "
{
ศศ 
if
สส 
(
สส 
!
สส 
_headerBackups
สส '
.
สส' (
ContainsKey
สส( 3
(
สส3 4
filePath
สส4 <
)
สส< =
)
สส= >
{
หห 
result
ฬฬ 
.
ฬฬ 
IsValid
ฬฬ &
=
ฬฬ' (
false
ฬฬ) .
;
ฬฬ. /
result
ออ 
.
ออ 
ErrorMessage
ออ +
=
ออ, -
$str
ออ. R
;
ออR S
return
ฮฮ 
result
ฮฮ %
;
ฮฮ% &
}
ฯฯ 
var
ัั 
backup
ัั 
=
ัั  
_headerBackups
ัั! /
[
ัั/ 0
filePath
ัั0 8
]
ัั8 9
;
ัั9 :
var
าา 
currentContent
าา &
=
าา' (
File
าา) -
.
าา- .
ReadAllText
าา. 9
(
าา9 :
filePath
าา: B
,
าาB C
Encoding
าาD L
.
าาL M
UTF8
าาM Q
)
าาQ R
;
าาR S
var
ำำ 
currentSections
ำำ '
=
ำำ( )%
ExtractCriticalSections
ำำ* A
(
ำำA B
currentContent
ำำB P
)
ำำP Q
;
ำำQ R
foreach
ึึ 
(
ึึ 
var
ึึ  
originalSection
ึึ! 0
in
ึึ1 3
backup
ึึ4 :
.
ึึ: ;
CriticalSections
ึึ; K
)
ึึK L
{
ืื 
if
ุุ 
(
ุุ 
!
ุุ 
currentSections
ุุ ,
.
ุุ, -
ContainsKey
ุุ- 8
(
ุุ8 9
originalSection
ุุ9 H
.
ุุH I
Key
ุุI L
)
ุุL M
)
ุุM N
{
ูู 
result
ฺฺ "
.
ฺฺ" #
DeletedSections
ฺฺ# 2
.
ฺฺ2 3
Add
ฺฺ3 6
(
ฺฺ6 7
originalSection
ฺฺ7 F
.
ฺฺF G
Key
ฺฺG J
)
ฺฺJ K
;
ฺฺK L
result
 "
.
" #
IsValid
# *
=
+ ,
false
- 2
;
2 3
}
 
}
 
if
เเ 
(
เเ 
result
เเ 
.
เเ 
DeletedSections
เเ .
.
เเ. /
Count
เเ/ 4
>
เเ5 6
$num
เเ7 8
)
เเ8 9
{
แแ 
var
โโ 
restoredContent
โโ +
=
โโ, -$
RestoreMissingSections
โโ. D
(
โโD E
currentContent
ใใ *
,
ใใ* +
backup
ไไ "
,
ไไ" #
result
ๅๅ "
.
ๅๅ" #
DeletedSections
ๅๅ# 2
)
ๆๆ 
;
ๆๆ 
File
็็ 
.
็็ 
WriteAllText
็็ )
(
็็) *
filePath
็็* 2
,
็็2 3
restoredContent
็็4 C
,
็็C D
Encoding
็็E M
.
็็M N
UTF8
็็N R
)
็็R S
;
็็S T
result
่่ 
.
่่ 
RestoredSections
่่ /
.
่่/ 0
AddRange
่่0 8
(
่่8 9
result
่่9 ?
.
่่? @
DeletedSections
่่@ O
)
่่O P
;
่่P Q
result
้้ 
.
้้ 
WasRestored
้้ *
=
้้+ ,
true
้้- 1
;
้้1 2
}
๊๊ 
return
์์ 
result
์์ !
;
์์! "
}
ํํ 
}
๎๎ 
catch
๏๏ 
(
๏๏ 
	Exception
๏๏ 
ex
๏๏ 
)
๏๏  
{
๐๐ 
result
๑๑ 
.
๑๑ 
IsValid
๑๑ 
=
๑๑  
false
๑๑! &
;
๑๑& '
result
๒๒ 
.
๒๒ 
ErrorMessage
๒๒ #
=
๒๒$ %
$"
๒๒& (
$str
๒๒( :
{
๒๒: ;
ex
๒๒; =
.
๒๒= >
Message
๒๒> E
}
๒๒E F
"
๒๒F G
;
๒๒G H
return
๓๓ 
result
๓๓ 
;
๓๓ 
}
๔๔ 
}
๕๕ 	
public
 
static
 
bool
 *
QuickValidateHeaderIntegrity
 7
(
7 8
string
8 >
filePath
? G
)
G H
{
 	
if
 
(
 
string
 
.
 
IsNullOrEmpty
 $
(
$ %
filePath
% -
)
- .
||
/ 1
!
2 3
File
3 7
.
7 8
Exists
8 >
(
> ?
filePath
? G
)
G H
)
H I
{
 
return
 
false
 
;
 
}
 
try
 
{
 
var
 
content
 
=
 
File
 "
.
" #
ReadAllText
# .
(
. /
filePath
/ 7
,
7 8
Encoding
9 A
.
A B
UTF8
B F
)
F G
;
G H
foreach
 
(
 
var
 
sectionGroup
 )
in
* ,
CriticalSections
- =
)
= >
{
 
bool
 
sectionFound
 %
=
& '
false
( -
;
- .
foreach
 
(
 
var
  
marker
! '
in
( *
sectionGroup
+ 7
.
7 8
Value
8 =
)
= >
{
 
if
 
(
 
content
 #
.
# $
Contains
$ ,
(
, -
marker
- 3
)
3 4
)
4 5
{
 
sectionFound
 (
=
) *
true
+ /
;
/ 0
break
 !
;
! "
}
 
}
 
if
 
(
 
!
 
sectionFound
 %
)
% &
{
 
return
 
false
 $
;
$ %
}
 
}
 
return
 
true
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
กก 	
public
ฉฉ 
static
ฉฉ 
List
ฉฉ 
<
ฉฉ 
string
ฉฉ !
>
ฉฉ! "0
"ScanProjectForMissingDocumentation
ฉฉ# E
(
ฉฉE F
string
ฉฉF L
projectPath
ฉฉM X
=
ฉฉY Z
$str
ฉฉ[ ^
)
ฉฉ^ _
{
ชช 	
var
ซซ 
problematicFiles
ซซ  
=
ซซ! "
new
ซซ# &
List
ซซ' +
<
ซซ+ ,
string
ซซ, 2
>
ซซ2 3
(
ซซ3 4
)
ซซ4 5
;
ซซ5 6
try
ญญ 
{
ฎฎ 
var
ฏฏ 
filesToScan
ฏฏ 
=
ฏฏ  !
GetFilesToScan
ฏฏ" 0
(
ฏฏ0 1
projectPath
ฏฏ1 <
)
ฏฏ< =
;
ฏฏ= >
foreach
ฑฑ 
(
ฑฑ 
var
ฑฑ 
file
ฑฑ !
in
ฑฑ" $
filesToScan
ฑฑ% 0
)
ฑฑ0 1
{
ฒฒ 
if
ณณ 
(
ณณ 
!
ณณ *
QuickValidateHeaderIntegrity
ณณ 5
(
ณณ5 6
file
ณณ6 :
)
ณณ: ;
)
ณณ; <
{
ดด 
problematicFiles
ตต (
.
ตต( )
Add
ตต) ,
(
ตต, -
file
ตต- 1
)
ตต1 2
;
ตต2 3
}
ถถ 
}
ทท 
}
ธธ 
catch
นน 
(
นน 
	Exception
นน 
)
นน 
{
บบ 
}
ผผ 
return
พพ 
problematicFiles
พพ #
;
พพ# $
}
ฟฟ 	
private
สส 
static
สส 

Dictionary
สส !
<
สส! "
string
สส" (
,
สส( )
string
สส* 0
>
สส0 1%
ExtractCriticalSections
สส2 I
(
สสI J
string
สสJ P
content
สสQ X
)
สสX Y
{
หห 	
var
ฬฬ 
sections
ฬฬ 
=
ฬฬ 
new
ฬฬ 

Dictionary
ฬฬ )
<
ฬฬ) *
string
ฬฬ* 0
,
ฬฬ0 1
string
ฬฬ2 8
>
ฬฬ8 9
(
ฬฬ9 :
)
ฬฬ: ;
;
ฬฬ; <
foreach
ฮฮ 
(
ฮฮ 
var
ฮฮ 
sectionGroup
ฮฮ %
in
ฮฮ& (
CriticalSections
ฮฮ) 9
)
ฮฮ9 :
{
ฯฯ 
var
ะะ 
sectionName
ะะ 
=
ะะ  !
sectionGroup
ะะ" .
.
ะะ. /
Key
ะะ/ 2
;
ะะ2 3
var
ัั 
markers
ัั 
=
ัั 
sectionGroup
ัั *
.
ัั* +
Value
ัั+ 0
;
ัั0 1
foreach
ิิ 
(
ิิ 
var
ิิ 
marker
ิิ #
in
ิิ$ &
markers
ิิ' .
)
ิิ. /
{
ีี 
var
ึึ 

startIndex
ึึ "
=
ึึ# $
content
ึึ% ,
.
ึึ, -
IndexOf
ึึ- 4
(
ึึ4 5
marker
ึึ5 ;
)
ึึ; <
;
ึึ< =
if
ืื 
(
ืื 

startIndex
ืื "
>=
ืื# %
$num
ืื& '
)
ืื' (
{
ุุ 
var
ฺฺ 
endIndex
ฺฺ $
=
ฺฺ% &
FindSectionEnd
ฺฺ' 5
(
ฺฺ5 6
content
ฺฺ6 =
,
ฺฺ= >

startIndex
ฺฺ? I
)
ฺฺI J
;
ฺฺJ K
var
 
sectionContent
 *
=
+ ,
content
- 4
.
4 5
	Substring
5 >
(
> ?

startIndex
? I
,
I J
endIndex
K S
-
T U

startIndex
V `
)
` a
;
a b
sections
  
[
  !
sectionName
! ,
]
, -
=
. /
sectionContent
0 >
;
> ?
break
 
;
 
}
 
}
฿฿ 
}
เเ 
return
โโ 
sections
โโ 
;
โโ 
}
ใใ 	
private
๋๋ 
static
๋๋ 
int
๋๋ 
FindSectionEnd
๋๋ )
(
๋๋) *
string
๋๋* 0
content
๋๋1 8
,
๋๋8 9
int
๋๋: =

startIndex
๋๋> H
)
๋๋H I
{
์์ 	
var
๎๎ !
nextSectionPatterns
๎๎ #
=
๎๎$ %
new
๎๎& )
[
๎๎) *
]
๎๎* +
{
๏๏ 
$str
๐๐ 
,
๐๐  
$str
๑๑ Y
,
๑๑Y Z
$str
๒๒ 
,
๒๒  
$str
๓๓ 
,
๓๓ 
}
๔๔ 
;
๔๔ 
var
๖๖ 
endIndex
๖๖ 
=
๖๖ 
content
๖๖ "
.
๖๖" #
Length
๖๖# )
;
๖๖) *
foreach
๘๘ 
(
๘๘ 
var
๘๘ 
pattern
๘๘  
in
๘๘! #!
nextSectionPatterns
๘๘$ 7
)
๘๘7 8
{
๙๙ 
var
๚๚ 
	nextIndex
๚๚ 
=
๚๚ 
content
๚๚  '
.
๚๚' (
IndexOf
๚๚( /
(
๚๚/ 0
pattern
๚๚0 7
,
๚๚7 8

startIndex
๚๚9 C
+
๚๚D E
$num
๚๚F G
)
๚๚G H
;
๚๚H I
if
๛๛ 
(
๛๛ 
	nextIndex
๛๛ 
>
๛๛ 

startIndex
๛๛  *
&&
๛๛+ -
	nextIndex
๛๛. 7
<
๛๛8 9
endIndex
๛๛: B
)
๛๛B C
{
 
endIndex
 
=
 
	nextIndex
 (
;
( )
}
 
}
 
return
 
endIndex
 
;
 
}
 	
private
 
static
 
string
 $
RestoreMissingSections
 4
(
4 5
string
 
currentContent
 !
,
! "
HeaderBackup
 
backup
 
,
  
List
 
<
 
string
 
>
 
missingSections
 (
)
 	
{
 	
var
 
restoredContent
 
=
  !
currentContent
" 0
;
0 1
var
 
insertionPoint
 
=
  
restoredContent
! 0
.
0 1
IndexOf
1 8
(
8 9
$str
9 H
)
H I
;
I J
if
 
(
 
insertionPoint
 
<
  
$num
! "
)
" #
{
 
insertionPoint
 
=
  
restoredContent
! 0
.
0 1
IndexOf
1 8
(
8 9
$str
 ]
,
] ^
$num
 
)
 
;
 
}
 
if
 
(
 
insertionPoint
 
>
  
$num
! "
)
" #
{
 
var
 
sectionsToRestore
 %
=
& '
new
( +
StringBuilder
, 9
(
9 :
)
: ;
;
; <
foreach
กก 
(
กก 
var
กก 
sectionName
กก (
in
กก) +
missingSections
กก, ;
)
กก; <
{
ขข 
if
ฃฃ 
(
ฃฃ 
backup
ฃฃ 
.
ฃฃ 
CriticalSections
ฃฃ /
.
ฃฃ/ 0
ContainsKey
ฃฃ0 ;
(
ฃฃ; <
sectionName
ฃฃ< G
)
ฃฃG H
)
ฃฃH I
{
คค 
sectionsToRestore
ฅฅ )
.
ฅฅ) *

AppendLine
ฅฅ* 4
(
ฅฅ4 5
backup
ฅฅ5 ;
.
ฅฅ; <
CriticalSections
ฅฅ< L
[
ฅฅL M
sectionName
ฅฅM X
]
ฅฅX Y
)
ฅฅY Z
;
ฅฅZ [
sectionsToRestore
ฆฆ )
.
ฆฆ) *

AppendLine
ฆฆ* 4
(
ฆฆ4 5
$str
ฆฆ5 9
)
ฆฆ9 :
;
ฆฆ: ;
}
งง 
}
จจ 
if
ชช 
(
ชช 
sectionsToRestore
ชช %
.
ชช% &
Length
ชช& ,
>
ชช- .
$num
ชช/ 0
)
ชช0 1
{
ซซ 
restoredContent
ฌฌ #
=
ฌฌ$ %
restoredContent
ฌฌ& 5
.
ฌฌ5 6
Insert
ฌฌ6 <
(
ฌฌ< =
insertionPoint
ญญ &
,
ญญ& '
sectionsToRestore
ฎฎ )
.
ฎฎ) *
ToString
ฎฎ* 2
(
ฎฎ2 3
)
ฎฎ3 4
)
ฏฏ 
;
ฏฏ 
}
ฐฐ 
}
ฑฑ 
return
ณณ 
restoredContent
ณณ "
;
ณณ" #
}
ดด 	
private
ปป 
static
ปป 
string
ปป "
CalculateContentHash
ปป 2
(
ปป2 3
string
ปป3 9
content
ปป: A
)
ปปA B
{
ผผ 	
using
ฝฝ 
(
ฝฝ 
var
ฝฝ 
sha256
ฝฝ 
=
ฝฝ 
SHA256
ฝฝ  &
.
ฝฝ& '
Create
ฝฝ' -
(
ฝฝ- .
)
ฝฝ. /
)
ฝฝ/ 0
{
พพ 
var
ฟฟ 
bytes
ฟฟ 
=
ฟฟ 
Encoding
ฟฟ $
.
ฟฟ$ %
UTF8
ฟฟ% )
.
ฟฟ) *
GetBytes
ฟฟ* 2
(
ฟฟ2 3
content
ฟฟ3 :
)
ฟฟ: ;
;
ฟฟ; <
var
ภภ 
hash
ภภ 
=
ภภ 
sha256
ภภ !
.
ภภ! "
ComputeHash
ภภ" -
(
ภภ- .
bytes
ภภ. 3
)
ภภ3 4
;
ภภ4 5
return
มม 
Convert
มม 
.
มม 
ToBase64String
มม -
(
มม- .
hash
มม. 2
)
มม2 3
;
มม3 4
}
ยย 
}
รร 	
private
สส 
static
สส 
List
สส 
<
สส 
string
สส "
>
สส" #
GetFilesToScan
สส$ 2
(
สส2 3
string
สส3 9
projectPath
สส: E
)
สสE F
{
หห 	
var
ฬฬ 
files
ฬฬ 
=
ฬฬ 
new
ฬฬ 
List
ฬฬ  
<
ฬฬ  !
string
ฬฬ! '
>
ฬฬ' (
(
ฬฬ( )
)
ฬฬ) *
;
ฬฬ* +
try
ฮฮ 
{
ฯฯ 
files
ัั 
.
ัั 
AddRange
ัั 
(
ัั 
	Directory
าา 
.
าา 
GetFiles
าา &
(
าา& '
projectPath
าา' 2
,
าา2 3
$str
าา4 :
,
าา: ;
SearchOption
าา< H
.
าาH I
AllDirectories
าาI W
)
าาW X
)
ำำ 
;
ำำ 
files
ึึ 
=
ึึ 
files
ึึ 
.
ืื 
Where
ืื 
(
ืื 
f
ืื 
=>
ืื 
!
ุุ 
f
ุุ 
.
ุุ 
Contains
ุุ #
(
ุุ# $
$str
ุุ$ ,
)
ุุ, -
&&
ูู 
!
ูู 
f
ูู 
.
ูู 
Contains
ูู &
(
ูู& '
$str
ูู' /
)
ูู/ 0
&&
ฺฺ 
!
ฺฺ 
f
ฺฺ 
.
ฺฺ 
Contains
ฺฺ &
(
ฺฺ& '
$str
ฺฺ' 4
)
ฺฺ4 5
&&
 
!
 
f
 
.
 
Contains
 &
(
& '
$str
' 0
)
0 1
)
 
.
 
ToList
 
(
 
)
 
;
 
}
 
catch
฿฿ 
(
฿฿ 
	Exception
฿฿ 
)
฿฿ 
{
เเ 
files
โโ 
.
โโ 
Clear
โโ 
(
โโ 
)
โโ 
;
โโ 
}
ใใ 
return
ๅๅ 
files
ๅๅ 
;
ๅๅ 
}
ๆๆ 	
public
๏๏ 
static
๏๏ 
void
๏๏ 
ClearAllBackups
๏๏ *
(
๏๏* +
)
๏๏+ ,
{
๐๐ 	
lock
๑๑ 
(
๑๑ 
_backupLock
๑๑ 
)
๑๑ 
{
๒๒ 
_headerBackups
๓๓ 
.
๓๓ 
Clear
๓๓ $
(
๓๓$ %
)
๓๓% &
;
๓๓& '
}
๔๔ 
}
๕๕ 	
public
๛๛ 
static
๛๛ 
int
๛๛ 
GetBackupCount
๛๛ (
(
๛๛( )
)
๛๛) *
{
 	
lock
 
(
 
_backupLock
 
)
 
{
 
return
 
_headerBackups
 %
.
% &
Count
& +
;
+ ,
}
 
}
 	
public
 
static
 
bool
 
	HasBackup
 $
(
$ %
string
% +
filePath
, 4
)
4 5
{
 	
lock
 
(
 
_backupLock
 
)
 
{
 
return
 
_headerBackups
 %
.
% &
ContainsKey
& 1
(
1 2
filePath
2 :
)
: ;
;
; <
}
 
}
 	
}
 
public
 

class
 
HeaderBackup
 
{
 
public
 
string
 
FilePath
 
{
  
get
! $
;
$ %
set
& )
;
) *
}
+ ,
public
 
DateTime
 

BackupTime
 "
{
# $
get
% (
;
( )
set
* -
;
- .
}
/ 0
public
 
string
 !
OriginalContentHash
 )
{
* +
get
, /
;
/ 0
set
1 4
;
4 5
}
6 7
public
 

Dictionary
 
<
 
string
  
,
  !
string
" (
>
( )
CriticalSections
* :
{
; <
get
= @
;
@ A
set
B E
;
E F
}
G H
public
 
string
 
FullContent
 !
{
" #
get
$ '
;
' (
set
) ,
;
, -
}
. /
}
 
public
คค 

class
คค $
HeaderProtectionResult
คค '
{
ฅฅ 
public
ฆฆ 
string
ฆฆ 
FilePath
ฆฆ 
{
ฆฆ  
get
ฆฆ! $
;
ฆฆ$ %
set
ฆฆ& )
;
ฆฆ) *
}
ฆฆ+ ,
public
งง 
DateTime
งง 
ValidationTime
งง &
{
งง' (
get
งง) ,
;
งง, -
set
งง. 1
;
งง1 2
}
งง3 4
public
จจ 
bool
จจ 
IsValid
จจ 
{
จจ 
get
จจ !
;
จจ! "
set
จจ# &
;
จจ& '
}
จจ( )
public
ฉฉ 
bool
ฉฉ 
WasRestored
ฉฉ 
{
ฉฉ  !
get
ฉฉ" %
;
ฉฉ% &
set
ฉฉ' *
;
ฉฉ* +
}
ฉฉ, -
public
ชช 
List
ชช 
<
ชช 
string
ชช 
>
ชช 
DeletedSections
ชช +
{
ชช, -
get
ชช. 1
;
ชช1 2
set
ชช3 6
;
ชช6 7
}
ชช8 9
=
ชช: ;
new
ชช< ?
List
ชช@ D
<
ชชD E
string
ชชE K
>
ชชK L
(
ชชL M
)
ชชM N
;
ชชN O
public
ซซ 
List
ซซ 
<
ซซ 
string
ซซ 
>
ซซ 
RestoredSections
ซซ ,
{
ซซ- .
get
ซซ/ 2
;
ซซ2 3
set
ซซ4 7
;
ซซ7 8
}
ซซ9 :
=
ซซ; <
new
ซซ= @
List
ซซA E
<
ซซE F
string
ซซF L
>
ซซL M
(
ซซM N
)
ซซN O
;
ซซO P
public
ฌฌ 
string
ฌฌ 
ErrorMessage
ฌฌ "
{
ฌฌ# $
get
ฌฌ% (
;
ฌฌ( )
set
ฌฌ* -
;
ฌฌ- .
}
ฌฌ/ 0
public
ฑฑ 
string
ฑฑ 

GetSummary
ฑฑ  
(
ฑฑ  !
)
ฑฑ! "
{
ฒฒ 	
if
ณณ 
(
ณณ 
IsValid
ณณ 
&&
ณณ 
DeletedSections
ณณ *
.
ณณ* +
Count
ณณ+ 0
==
ณณ1 3
$num
ณณ4 5
)
ณณ5 6
{
ดด 
return
ตต 
$str
ตต ?
;
ตต? @
}
ถถ 
if
ธธ 
(
ธธ 
WasRestored
ธธ 
)
ธธ 
{
นน 
return
บบ 
$"
บบ 
$str
บบ 5
{
บบ5 6
RestoredSections
บบ6 F
.
บบF G
Count
บบG L
}
บบL M
$str
บบM ^
"
บบ^ _
;
บบ_ `
}
ปป 
if
ฝฝ 
(
ฝฝ 
!
ฝฝ 
string
ฝฝ 
.
ฝฝ 
IsNullOrEmpty
ฝฝ %
(
ฝฝ% &
ErrorMessage
ฝฝ& 2
)
ฝฝ2 3
)
ฝฝ3 4
{
พพ 
return
ฟฟ 
$"
ฟฟ 
$str
ฟฟ 2
{
ฟฟ2 3
ErrorMessage
ฟฟ3 ?
}
ฟฟ? @
"
ฟฟ@ A
;
ฟฟA B
}
ภภ 
return
ยย 
$"
ยย 
$str
ยย (
{
ยย( )
DeletedSections
ยย) 8
.
ยย8 9
Count
ยย9 >
}
ยย> ?
$str
ยย? P
"
ยยP Q
;
ยยQ R
}
รร 	
}
ฤฤ 
}วว ฺฦ
EC:\Playnite\_github\OstPlayer\source\DevTools\DocumentationManager.cs
	namespaceWW 	
	OstPlayerWW
 
.WW 
DevToolsWW 
{WW 
public[[ 

enum[[ 

ReadmeType[[ 
{[[ 

Navigation\\ 
,\\ 
	Technical]] 
,]] 
Category^^ 
,^^ 
Root__ 
}`` 
publicee 

staticee 
classee  
DocumentationManageree ,
{ee- .
privategg 
constgg 
stringgg 
DocumentationFoldergg 0
=gg1 2
$strgg3 B
;ggB C
privatehh 
consthh 
stringhh 
ChangelogFilehh *
=hh+ ,
$strhh- N
;hhN O
privateii 
constii 
stringii 
TemplatesFileii *
=ii+ ,
$strii- S
;iiS T
privatell 
staticll 
readonlyll 

Dictionaryll  *
<ll* +

ReadmeTypell+ 5
,ll5 6
stringll7 =
[ll= >
]ll> ?
>ll? @
ReadmePatternsllA O
=llP Q
newllR U

DictionaryllV `
<ll` a

ReadmeTypella k
,llk l
stringllm s
[lls t
]llt u
>llu v
{llw x
[mm 

ReadmeTypemm 
.mm 
Rootmm 
]mm 
=mm 
newmm  #
[mm# $
]mm$ %
{mm& '
$strmm( A
}mmB C
,mmC D
[nn 

ReadmeTypenn 
.nn 

Navigationnn "
]nn" #
=nn$ %
newnn& )
[nn) *
]nn* +
{oo 
$strpp +
,pp+ ,
$strqq 1
,qq1 2
$strrr 5
,rr5 6
$strss 6
,ss6 7
$strtt 1
}uu 
,uu 
[vv 

ReadmeTypevv 
.vv 
	Technicalvv !
]vv! "
=vv# $
newvv% (
[vv( )
]vv) *
{ww 
$strxx &
,xx& '
$stryy $
,yy$ %
$strzz !
,zz! "
$str{{ $
,{{$ %
$str|| "
}}} 
,}} 
[~~ 

ReadmeType~~ 
.~~ 
Category~~  
]~~  !
=~~" #
new~~$ '
[~~' (
]~~( )
{ 
$str
 7
,
7 8
$str
 3
}
 
}
 	
;
	 

private
 
static
 
readonly
 
Regex
  % 
VersionHeaderRegex
& 8
=
9 :
new
; >
Regex
? D
(
D E
$str
E m
,
m n
RegexOptions
o {
.
{ |
Compiled| 
) 
; 
private
 
static
 
readonly
 
Regex
  % 
ModuleSummaryRegex
& 8
=
9 :
new
; >
Regex
? D
(
D E
$str
E U
,
U V
RegexOptions
W c
.
c d
Compiled
d l
)
l m
;
m n
private
 
static
 
readonly
 
Regex
  %!
ReadmeQuickNavRegex
& 9
=
: ;
new
< ?
Regex
@ E
(
E F
$str
F t
,
t u
RegexOptionsv 
. 
Compiled 
) 
; 
public
 
static
 
bool
 !
UpdateModuleSummary
 .
(
. /
string
/ 5

moduleName
6 @
,
@ A
string
B H
changes
I P
)
P Q
{
R S
try
 
{
 
var
 
summaryFile
 
=
  !#
FindModuleSummaryFile
" 7
(
7 8

moduleName
8 B
)
B C
;
C D
if
 
(
 
summaryFile
 
==
  "
null
# '
)
' (
{
) *
var
 
success
 
=
  !!
CreateModuleSummary
" 5
(
5 6

moduleName
6 @
,
@ A
changes
B I
)
I J
;
J K
if
 
(
 
success
 
)
  
{
! "$
UpdateNavigationReadme
 .
(
. /
$str
/ 8
,
8 9
$"
: <
$str
< B
{
B C

moduleName
C M
}
M N
$str
N d
"
d e
)
e f
;
f g
}
 
return
 
success
 "
;
" #
}
 
return
 #
AppendToModuleSummary
 ,
(
, -
summaryFile
- 8
,
8 9
changes
: A
)
A B
;
B C
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
กก 
false
กก 
;
กก 
}
ขข 
}
ฃฃ 	
private
ชช 
static
ชช 
string
ชช #
FindModuleSummaryFile
ชช 3
(
ชช3 4
string
ชช4 :

moduleName
ชช; E
)
ชชE F
{
ชชG H
var
ซซ 
patterns
ซซ 
=
ซซ 
new
ซซ 
[
ซซ 
]
ซซ  
{
ฌฌ 
$"
ญญ 
$str
ญญ (
{
ญญ( )

moduleName
ญญ) 3
}
ญญ3 4
$str
ญญ4 J
"
ญญJ K
,
ญญK L
$"
ฎฎ 
$str
ฎฎ  
{
ฎฎ  !

moduleName
ฎฎ! +
}
ฎฎ+ ,
$str
ฎฎ, B
"
ฎฎB C
,
ฎฎC D
$"
ฏฏ 
$str
ฏฏ  
{
ฏฏ  !

moduleName
ฏฏ! +
}
ฏฏ+ ,
$str
ฏฏ, <
"
ฏฏ< =
,
ฏฏ= >
$"
ฐฐ 
{
ฐฐ 

moduleName
ฐฐ 
}
ฐฐ 
$str
ฐฐ (
"
ฐฐ( )
,
ฐฐ) *
$"
ฑฑ 
$str
ฑฑ  
{
ฑฑ  !

moduleName
ฑฑ! +
}
ฑฑ+ ,
$str
ฑฑ, 6
"
ฑฑ6 7
}
ฒฒ 
;
ฒฒ 
return
ดด 
patterns
ดด 
.
ดด 
FirstOrDefault
ดด *
(
ดด* +
File
ดด+ /
.
ดด/ 0
Exists
ดด0 6
)
ดด6 7
;
ดด7 8
}
ตต 	
private
ฝฝ 
static
ฝฝ 
bool
ฝฝ !
CreateModuleSummary
ฝฝ /
(
ฝฝ/ 0
string
ฝฝ0 6

moduleName
ฝฝ7 A
,
ฝฝA B
string
ฝฝC I
changes
ฝฝJ Q
)
ฝฝQ R
{
ฝฝS T
try
พพ 
{
พพ 
var
ฟฟ 
summaryPath
ฟฟ 
=
ฟฟ  !
$"
ฟฟ" $
$str
ฟฟ$ :
{
ฟฟ: ;

moduleName
ฟฟ; E
}
ฟฟE F
$str
ฟฟF \
"
ฟฟ\ ]
;
ฟฟ] ^
var
ภภ 
currentDate
ภภ 
=
ภภ  !

DateHelper
ภภ" ,
.
ภภ, -"
GetCurrentDateString
ภภ- A
(
ภภA B
)
ภภB C
;
ภภC D
var
ยย 
content
ยย 
=
ยย 
$@"
ยย !
$str
ยย! -
{
ยย- .

moduleName
ยย. 8
}
ยย8 9
$str
ยฦ9 0
{
ฦฦ0 1

moduleName
ฦฦ1 ;
}
ฦฦ; <
$str
ฦส< 
{
สส 
currentDate
สส 
}
สส 
$str
สห 
{
หห 
changes
หห 

}
หห
 
$str
หฯ 
{
ฯฯ 
currentDate
ฯฯ  
}
ฯฯ  !
$strฯึ!
"ึึ 
;
ึึ 
	Directory
ุุ 
.
ุุ 
CreateDirectory
ุุ )
(
ุุ) *
Path
ุุ* .
.
ุุ. /
GetDirectoryName
ุุ/ ?
(
ุุ? @
summaryPath
ุุ@ K
)
ุุK L
)
ุุL M
;
ุุM N
File
ูู 
.
ูู 
WriteAllText
ูู !
(
ูู! "
summaryPath
ูู" -
,
ูู- .
content
ูู/ 6
,
ูู6 7
Encoding
ูู8 @
.
ูู@ A
UTF8
ููA E
)
ููE F
;
ููF G
return
ฺฺ 
true
ฺฺ 
;
ฺฺ 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
฿฿ 	
private
็็ 
static
็็ 
bool
็็ #
AppendToModuleSummary
็็ 1
(
็็1 2
string
็็2 8
summaryFile
็็9 D
,
็็D E
string
็็F L
changes
็็M T
)
็็T U
{
็็V W
try
่่ 
{
่่ 
var
้้ 
content
้้ 
=
้้ 
File
้้ "
.
้้" #
ReadAllText
้้# .
(
้้. /
summaryFile
้้/ :
,
้้: ;
Encoding
้้< D
.
้้D E
UTF8
้้E I
)
้้I J
;
้้J K
var
๊๊ 
currentDate
๊๊ 
=
๊๊  !

DateHelper
๊๊" ,
.
๊๊, -"
GetCurrentDateString
๊๊- A
(
๊๊A B
)
๊๊B C
;
๊๊C D
var
๋๋ 
newEntry
๋๋ 
=
๋๋ 
$"
๋๋ !
$str
๋๋! '
{
๋๋' (
currentDate
๋๋( 3
}
๋๋3 4
$str
๋๋4 8
{
๋๋8 9
changes
๋๋9 @
}
๋๋@ A
$str
๋๋A C
"
๋๋C D
;
๋๋D E
var
๎๎  
recentUpdatesIndex
๎๎ &
=
๎๎' (
content
๎๎) 0
.
๎๎0 1
IndexOf
๎๎1 8
(
๎๎8 9
$str
๎๎9 O
)
๎๎O P
;
๎๎P Q
if
๏๏ 
(
๏๏  
recentUpdatesIndex
๏๏ &
==
๏๏' )
-
๏๏* +
$num
๏๏+ ,
)
๏๏, -
{
๏๏. / 
recentUpdatesIndex
๐๐ &
=
๐๐' (
content
๐๐) 0
.
๐๐0 1
IndexOf
๐๐1 8
(
๐๐8 9
$str
๐๐9 O
)
๐๐O P
;
๐๐P Q
}
๑๑ 
if
๓๓ 
(
๓๓  
recentUpdatesIndex
๓๓ &
!=
๓๓' )
-
๓๓* +
$num
๓๓+ ,
)
๓๓, -
{
๓๓. /
var
๔๔ 
insertIndex
๔๔ #
=
๔๔$ %
content
๔๔& -
.
๔๔- .
IndexOf
๔๔. 5
(
๔๔5 6
$char
๔๔6 :
,
๔๔: ; 
recentUpdatesIndex
๔๔< N
)
๔๔N O
+
๔๔P Q
$num
๔๔R S
;
๔๔S T
content
๕๕ 
=
๕๕ 
content
๕๕ %
.
๕๕% &
Insert
๕๕& ,
(
๕๕, -
insertIndex
๕๕- 8
,
๕๕8 9
newEntry
๕๕: B
)
๕๕B C
;
๕๕C D
File
๗๗ 
.
๗๗ 
WriteAllText
๗๗ %
(
๗๗% &
summaryFile
๗๗& 1
,
๗๗1 2
content
๗๗3 :
,
๗๗: ;
Encoding
๗๗< D
.
๗๗D E
UTF8
๗๗E I
)
๗๗I J
;
๗๗J K
return
๘๘ 
true
๘๘ 
;
๘๘  
}
๙๙ 
return
๛๛ 
false
๛๛ 
;
๛๛ 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
public
 
static
 
bool
 $
UpdateNavigationReadme
 1
(
1 2
string
2 8
category
9 A
,
A B
string
C I
changes
J Q
)
Q R
{
S T
try
 
{
 
var
 

readmePath
 
=
  
$"
! #
$str
# 1
{
1 2
category
2 :
}
: ;
$str
; E
"
E F
;
F G
if
 
(
 
!
 
File
 
.
 
Exists
  
(
  !

readmePath
! +
)
+ ,
)
, -
{
. /
return
 $
CreateNavigationReadme
 1
(
1 2
category
2 :
,
: ;
changes
< C
)
C D
;
D E
}
 
return
 %
UpdateReadmeWithChanges
 .
(
. /

readmePath
/ 9
,
9 :
changes
; B
,
B C

ReadmeType
D N
.
N O

Navigation
O Y
)
Y Z
;
Z [
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
public
กก 
static
กก 
bool
กก #
UpdateTechnicalReadme
กก 0
(
กก0 1
string
กก1 7

moduleName
กก8 B
,
กกB C
string
กกD J
[
กกJ K
]
กกK L
newFiles
กกM U
)
กกU V
{
กกW X
try
ขข 
{
ขข 
var
ฃฃ 

readmePath
ฃฃ 
=
ฃฃ  
$"
ฃฃ! #
{
ฃฃ# $

moduleName
ฃฃ$ .
}
ฃฃ. /
$str
ฃฃ/ 9
"
ฃฃ9 :
;
ฃฃ: ;
if
ฅฅ 
(
ฅฅ 
!
ฅฅ 
File
ฅฅ 
.
ฅฅ 
Exists
ฅฅ  
(
ฅฅ  !

readmePath
ฅฅ! +
)
ฅฅ+ ,
)
ฅฅ, -
{
ฅฅ. /
return
ฆฆ #
CreateTechnicalReadme
ฆฆ 0
(
ฆฆ0 1

moduleName
ฆฆ1 ;
,
ฆฆ; <
newFiles
ฆฆ= E
)
ฆฆE F
;
ฆฆF G
}
งง 
return
ฉฉ '
AddFilesToTechnicalReadme
ฉฉ 0
(
ฉฉ0 1

readmePath
ฉฉ1 ;
,
ฉฉ; <
newFiles
ฉฉ= E
)
ฉฉE F
;
ฉฉF G
}
ชช 
catch
ซซ 
(
ซซ 
	Exception
ซซ 
)
ซซ 
{
ซซ 
return
ฌฌ 
false
ฌฌ 
;
ฌฌ 
}
ญญ 
}
ฎฎ 	
public
ถถ 
static
ถถ 
bool
ถถ "
UpdateCategoryReadme
ถถ /
(
ถถ/ 0
string
ถถ0 6
category
ถถ7 ?
,
ถถ? @
string
ถถA G
[
ถถG H
]
ถถH I
newDocuments
ถถJ V
)
ถถV W
{
ถถX Y
try
ทท 
{
ทท 
var
ธธ 

readmePath
ธธ 
=
ธธ  
$"
ธธ! #
$str
ธธ# 1
{
ธธ1 2
category
ธธ2 :
}
ธธ: ;
$str
ธธ; E
"
ธธE F
;
ธธF G
if
บบ 
(
บบ 
!
บบ 
File
บบ 
.
บบ 
Exists
บบ  
(
บบ  !

readmePath
บบ! +
)
บบ+ ,
)
บบ, -
{
บบ. /
return
ปป "
CreateCategoryReadme
ปป /
(
ปป/ 0
category
ปป0 8
,
ปป8 9
newDocuments
ปป: F
)
ปปF G
;
ปปG H
}
ผผ 
return
พพ *
AddDocumentsToCategoryReadme
พพ 3
(
พพ3 4

readmePath
พพ4 >
,
พพ> ?
newDocuments
พพ@ L
)
พพL M
;
พพM N
}
ฟฟ 
catch
ภภ 
(
ภภ 
	Exception
ภภ 
)
ภภ 
{
ภภ 
return
มม 
false
มม 
;
มม 
}
ยย 
}
รร 	
public
ษษ 
static
ษษ 
List
ษษ 
<
ษษ 
string
ษษ !
>
ษษ! "
GetAllReadmeFiles
ษษ# 4
(
ษษ4 5
)
ษษ5 6
{
ษษ7 8
var
สส 
readmeFiles
สส 
=
สส 
new
สส !
List
สส" &
<
สส& '
string
สส' -
>
สส- .
(
สส. /
)
สส/ 0
;
สส0 1
try
ฬฬ 
{
ฬฬ 
var
ฮฮ 

allReadmes
ฮฮ 
=
ฮฮ  
	Directory
ฮฮ! *
.
ฮฮ* +
GetFiles
ฮฮ+ 3
(
ฮฮ3 4
$str
ฮฮ4 7
,
ฮฮ7 8
$str
ฮฮ9 D
,
ฮฮD E
SearchOption
ฮฮF R
.
ฮฮR S
AllDirectories
ฮฮS a
)
ฮฮa b
.
ฯฯ 
Where
ฯฯ 
(
ฯฯ 
f
ฯฯ 
=>
ฯฯ 
!
ฯฯ  !
f
ฯฯ! "
.
ฯฯ" #
Contains
ฯฯ# +
(
ฯฯ+ ,
$str
ฯฯ, 6
)
ฯฯ6 7
)
ฯฯ7 8
.
ะะ 
Where
ะะ 
(
ะะ 
f
ะะ 
=>
ะะ 
!
ะะ  !
f
ะะ! "
.
ะะ" #
Contains
ะะ# +
(
ะะ+ ,
$str
ะะ, 5
)
ะะ5 6
)
ะะ6 7
.
ัั 
Where
ัั 
(
ัั 
f
ัั 
=>
ัั 
!
ัั  !
f
ัั! "
.
ัั" #
Contains
ัั# +
(
ัั+ ,
$str
ัั, 5
)
ัั5 6
)
ัั6 7
.
าา 
ToList
าา 
(
าา 
)
าา 
;
าา 
readmeFiles
ิิ 
.
ิิ 
AddRange
ิิ $
(
ิิ$ %

allReadmes
ิิ% /
)
ิิ/ 0
;
ิิ0 1
}
ีี 
catch
ึึ 
(
ึึ 
	Exception
ึึ 
)
ึึ 
{
ึึ 
}
ุุ 
return
ฺฺ 
readmeFiles
ฺฺ 
;
ฺฺ 
}
 	
public
แแ 
static
แแ 
bool
แแ %
ValidateReadmeHierarchy
แแ 2
(
แแ2 3
)
แแ3 4
{
แแ5 6
try
โโ 
{
โโ 
var
ใใ 
issues
ใใ 
=
ใใ 
new
ใใ  
List
ใใ! %
<
ใใ% &
string
ใใ& ,
>
ใใ, -
(
ใใ- .
)
ใใ. /
;
ใใ/ 0
var
ไไ 
readmeFiles
ไไ 
=
ไไ  !
GetAllReadmeFiles
ไไ" 3
(
ไไ3 4
)
ไไ4 5
;
ไไ5 6
foreach
ๆๆ 
(
ๆๆ 
var
ๆๆ 

readmeFile
ๆๆ '
in
ๆๆ( *
readmeFiles
ๆๆ+ 6
)
ๆๆ6 7
{
ๆๆ8 9
var
็็ 

readmeType
็็ "
=
็็# $
GetReadmeType
็็% 2
(
็็2 3

readmeFile
็็3 =
)
็็= >
;
็็> ?%
ValidateReadmeStructure
่่ +
(
่่+ ,

readmeFile
่่, 6
,
่่6 7

readmeType
่่8 B
,
่่B C
issues
่่D J
)
่่J K
;
่่K L+
ValidateReadmeCrossReferences
้้ 1
(
้้1 2

readmeFile
้้2 <
,
้้< =
issues
้้> D
)
้้D E
;
้้E F
}
๊๊ 
return
์์ 
issues
์์ 
.
์์ 
Count
์์ #
==
์์$ &
$num
์์' (
;
์์( )
}
ํํ 
catch
๎๎ 
(
๎๎ 
	Exception
๎๎ 
)
๎๎ 
{
๎๎ 
return
๏๏ 
false
๏๏ 
;
๏๏ 
}
๐๐ 
}
๑๑ 	
public
๗๗ 
static
๗๗ 
bool
๗๗ .
 SynchronizeReadmeCrossReferences
๗๗ ;
(
๗๗; <
)
๗๗< =
{
๗๗> ?
try
๘๘ 
{
๘๘ 
var
๙๙ 
readmeFiles
๙๙ 
=
๙๙  !
GetAllReadmeFiles
๙๙" 3
(
๙๙3 4
)
๙๙4 5
;
๙๙5 6
var
๚๚ 
success
๚๚ 
=
๚๚ 
true
๚๚ "
;
๚๚" #
foreach
 
(
 
var
 

readmeFile
 '
in
( *
readmeFiles
+ 6
)
6 7
{
8 9
success
 
&=
 )
UpdateReadmeCrossReferences
 :
(
: ;

readmeFile
; E
)
E F
;
F G
}
 
return
 
success
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
public
 
static
 

ReadmeType
  
GetReadmeType
! .
(
. /
string
/ 5

readmePath
6 @
)
@ A
{
B C
var
 
normalizedPath
 
=
  

readmePath
! +
.
+ ,
Replace
, 3
(
3 4
$char
4 8
,
8 9
$char
: =
)
= >
;
> ?
if
 
(
 
normalizedPath
 
==
 !
$str
" ;
)
; <
return
 

ReadmeType
 !
.
! "
Root
" &
;
& '
if
 
(
 
normalizedPath
 
.
 

StartsWith
 )
(
) *
$str
* :
)
: ;
&&
< >
normalizedPath
? M
.
M N
EndsWith
N V
(
V W
$str
W c
)
c d
)
d e
return
 

ReadmeType
 !
.
! "

Navigation
" ,
;
, -
if
 
(
 
Regex
 
.
 
IsMatch
 
(
 
normalizedPath
 ,
,
, -
$str. 
) 
) 
return
 

ReadmeType
 !
.
! "
	Technical
" +
;
+ ,
return
 

ReadmeType
 
.
 
Category
 &
;
& '
}
 	
private
กก 
static
กก 
bool
กก $
CreateNavigationReadme
กก 2
(
กก2 3
string
กก3 9
category
กก: B
,
กกB C
string
กกD J
changes
กกK R
)
กกR S
{
กกT U
try
ขข 
{
ขข 
var
ฃฃ 

readmePath
ฃฃ 
=
ฃฃ  
$"
ฃฃ! #
$str
ฃฃ# 1
{
ฃฃ1 2
category
ฃฃ2 :
}
ฃฃ: ;
$str
ฃฃ; E
"
ฃฃE F
;
ฃฃF G
var
คค 
currentDate
คค 
=
คค  !

DateHelper
คค" ,
.
คค, -"
GetCurrentDateString
คค- A
(
คคA B
)
คคB C
;
คคC D
var
ฆฆ 
content
ฆฆ 
=
ฆฆ 
$@"
ฆฆ !
$str
ฆฆ! &
{
ฆฆ& '
category
ฆฆ' /
}
ฆฆ/ 0
$str
ฆช0 
{
ชช 
category
ชช 
.
ชช 
ToLower
ชช &
(
ชช& '
)
ชช' (
}
ชช( )
$str
ชฏ) 
{
ฏฏ 
changes
ฏฏ 

}
ฏฏ
 
$str
ฏฏ 
{
ฏฏ 
currentDate
ฏฏ 
}
ฏฏ  
$str
ฏฟ  
{
ฟฟ 
category
ฟฟ 
}
ฟฟ 
$str
ฟม 
{
มม 
currentDate
มม 
}
มม 
$strมย
"ยย 
;
ยย 
	Directory
ฤฤ 
.
ฤฤ 
CreateDirectory
ฤฤ )
(
ฤฤ) *
Path
ฤฤ* .
.
ฤฤ. /
GetDirectoryName
ฤฤ/ ?
(
ฤฤ? @

readmePath
ฤฤ@ J
)
ฤฤJ K
)
ฤฤK L
;
ฤฤL M
File
ลล 
.
ลล 
WriteAllText
ลล !
(
ลล! "

readmePath
ลล" ,
,
ลล, -
content
ลล. 5
,
ลล5 6
Encoding
ลล7 ?
.
ลล? @
UTF8
ลล@ D
)
ลลD E
;
ลลE F
return
ฦฦ 
true
ฦฦ 
;
ฦฦ 
}
วว 
catch
ศศ 
(
ศศ 
	Exception
ศศ 
)
ศศ 
{
ศศ 
return
ษษ 
false
ษษ 
;
ษษ 
}
สส 
}
หห 	
private
ำำ 
static
ำำ 
bool
ำำ #
CreateTechnicalReadme
ำำ 1
(
ำำ1 2
string
ำำ2 8

moduleName
ำำ9 C
,
ำำC D
string
ำำE K
[
ำำK L
]
ำำL M
newFiles
ำำN V
)
ำำV W
{
ำำX Y
try
ิิ 
{
ิิ 
var
ีี 

readmePath
ีี 
=
ีี  
$"
ีี! #
{
ีี# $

moduleName
ีี$ .
}
ีี. /
$str
ีี/ 9
"
ีี9 :
;
ีี: ;
var
ึึ 
currentDate
ึึ 
=
ึึ  !

DateHelper
ึึ" ,
.
ึึ, -"
GetCurrentDateString
ึึ- A
(
ึึA B
)
ึึB C
;
ึึC D
var
ุุ 
content
ุุ 
=
ุุ 
$@"
ุุ !
$str
ุุ! #
{
ุุ# $

moduleName
ุุ$ .
}
ุุ. /
$str
ุ/ 
{
 

moduleName
 
}
 
$str
 
{
 

moduleName
 
}
 
$strเ
"เเ 
;
เเ 
foreach
แแ 
(
แแ 
var
แแ 
file
แแ !
in
แแ" $
newFiles
แแ% -
)
แแ- .
{
แแ/ 0
var
โโ 
fileName
โโ  
=
โโ! "
Path
โโ# '
.
โโ' (
GetFileName
โโ( 3
(
โโ3 4
file
โโ4 8
)
โโ8 9
;
โโ9 :
content
ใใ 
+=
ใใ 
$"
ใใ !
$str
ใใ! '
{
ใใ' (
fileName
ใใ( 0
}
ใใ0 1
$str
ใใ1 5
"
ใใ5 6
;
ใใ6 7
content
ไไ 
+=
ไไ 
$"
ไไ !
$str
ไไ! 5
{
ไไ5 6

moduleName
ไไ6 @
.
ไไ@ A
ToLower
ไไA H
(
ไไH I
)
ไไI J
}
ไไJ K
$str
ไไK [
"
ไไ[ \
;
ไไ\ ]
content
ๅๅ 
+=
ๅๅ 
$"
ๅๅ !
$str
ๅๅ! ;
"
ๅๅ; <
;
ๅๅ< =
}
ๆๆ 
content
่่ 
+=
่่ 
$@"
่่ 
$str
่๒ 
{
๒๒ 
currentDate
๒๒ 
}
๒๒ 
$str๒๔
"๔๔ 
;
๔๔ 
File
๖๖ 
.
๖๖ 
WriteAllText
๖๖ !
(
๖๖! "

readmePath
๖๖" ,
,
๖๖, -
content
๖๖. 5
,
๖๖5 6
Encoding
๖๖7 ?
.
๖๖? @
UTF8
๖๖@ D
)
๖๖D E
;
๖๖E F
return
๗๗ 
true
๗๗ 
;
๗๗ 
}
๘๘ 
catch
๙๙ 
(
๙๙ 
	Exception
๙๙ 
)
๙๙ 
{
๙๙ 
return
๚๚ 
false
๚๚ 
;
๚๚ 
}
๛๛ 
}
 	
private
 
static
 
bool
 "
CreateCategoryReadme
 0
(
0 1
string
1 7
category
8 @
,
@ A
string
B H
[
H I
]
I J
newDocuments
K W
)
W X
{
Y Z
try
 
{
 
var
 

readmePath
 
=
  
$"
! #
$str
# 1
{
1 2
category
2 :
}
: ;
$str
; E
"
E F
;
F G
var
 
currentDate
 
=
  !

DateHelper
" ,
.
, -"
GetCurrentDateString
- A
(
A B
)
B C
;
C D
var
 
content
 
=
 
$@"
 !
$str
! &
{
& '
category
' /
}
/ 0
$str
0 
{
 
category
 
.
 
ToLower
 &
(
& '
)
' (
}
( )
$str)
" 
;
 
foreach
 
(
 
var
 
doc
  
in
! #
newDocuments
$ 0
)
0 1
{
2 3
var
 
docName
 
=
  !
Path
" &
.
& ')
GetFileNameWithoutExtension
' B
(
B C
doc
C F
)
F G
;
G H
content
 
+=
 
$"
 !
$str
! %
{
% &
docName
& -
}
- .
$str
. L
"
L M
;
M N
}
 
content
 
+=
 
$@"
 
$str
 
{
 
category
 
}
 
$str
ก 
{
กก 
currentDate
กก 
}
กก 
$strกข
"ขข 
;
ขข 
	Directory
คค 
.
คค 
CreateDirectory
คค )
(
คค) *
Path
คค* .
.
คค. /
GetDirectoryName
คค/ ?
(
คค? @

readmePath
คค@ J
)
คคJ K
)
คคK L
;
คคL M
File
ฅฅ 
.
ฅฅ 
WriteAllText
ฅฅ !
(
ฅฅ! "

readmePath
ฅฅ" ,
,
ฅฅ, -
content
ฅฅ. 5
,
ฅฅ5 6
Encoding
ฅฅ7 ?
.
ฅฅ? @
UTF8
ฅฅ@ D
)
ฅฅD E
;
ฅฅE F
return
ฆฆ 
true
ฆฆ 
;
ฆฆ 
}
งง 
catch
จจ 
(
จจ 
	Exception
จจ 
)
จจ 
{
จจ 
return
ฉฉ 
false
ฉฉ 
;
ฉฉ 
}
ชช 
}
ซซ 	
private
ดด 
static
ดด 
bool
ดด %
UpdateReadmeWithChanges
ดด 3
(
ดด3 4
string
ดด4 :

readmePath
ดด; E
,
ดดE F
string
ดดG M
changes
ดดN U
,
ดดU V

ReadmeType
ดดW a

readmeType
ดดb l
)
ดดl m
{
ดดn o
try
ตต 
{
ตต 
var
ถถ 
content
ถถ 
=
ถถ 
File
ถถ "
.
ถถ" #
ReadAllText
ถถ# .
(
ถถ. /

readmePath
ถถ/ 9
,
ถถ9 :
Encoding
ถถ; C
.
ถถC D
UTF8
ถถD H
)
ถถH I
;
ถถI J
var
ทท 
currentDate
ทท 
=
ทท  !

DateHelper
ทท" ,
.
ทท, -"
GetCurrentDateString
ทท- A
(
ททA B
)
ททB C
;
ททC D
content
บบ 
=
บบ 
Regex
บบ 
.
บบ  
Replace
บบ  '
(
บบ' (
content
บบ( /
,
บบ/ 0
$str
บบ1 [
,
บบ[ \
$"
บบ] _
$str
บบ_ q
{
บบq r
currentDate
บบr }
}
บบ} ~
"
บบ~ 
)บบ 
;บบ 
if
ฝฝ 
(
ฝฝ 

readmeType
ฝฝ 
==
ฝฝ !

ReadmeType
ฝฝ" ,
.
ฝฝ, -

Navigation
ฝฝ- 7
)
ฝฝ7 8
{
ฝฝ9 :
var
พพ "
recentAdditionsIndex
พพ ,
=
พพ- .
content
พพ/ 6
.
พพ6 7
IndexOf
พพ7 >
(
พพ> ?
$str
พพ? Y
)
พพY Z
;
พพZ [
if
ฟฟ 
(
ฟฟ "
recentAdditionsIndex
ฟฟ ,
!=
ฟฟ- /
-
ฟฟ0 1
$num
ฟฟ1 2
)
ฟฟ2 3
{
ฟฟ4 5
var
ภภ 
insertIndex
ภภ '
=
ภภ( )
content
ภภ* 1
.
ภภ1 2
IndexOf
ภภ2 9
(
ภภ9 :
$char
ภภ: >
,
ภภ> ?"
recentAdditionsIndex
ภภ@ T
)
ภภT U
+
ภภV W
$num
ภภX Y
;
ภภY Z
content
มม 
=
มม  !
content
มม" )
.
มม) *
Insert
มม* 0
(
มม0 1
insertIndex
มม1 <
,
มม< =
$"
มม> @
$str
มม@ B
{
มมB C
changes
มมC J
}
มมJ K
$str
มมK S
{
มมS T
currentDate
มมT _
}
มม_ `
$str
มม` c
"
มมc d
)
มมd e
;
มมe f
}
ยย 
}
รร 
File
ลล 
.
ลล 
WriteAllText
ลล !
(
ลล! "

readmePath
ลล" ,
,
ลล, -
content
ลล. 5
,
ลล5 6
Encoding
ลล7 ?
.
ลล? @
UTF8
ลล@ D
)
ลลD E
;
ลลE F
return
ฦฦ 
true
ฦฦ 
;
ฦฦ 
}
วว 
catch
ศศ 
(
ศศ 
	Exception
ศศ 
)
ศศ 
{
ศศ 
return
ษษ 
false
ษษ 
;
ษษ 
}
สส 
}
หห 	
private
ำำ 
static
ำำ 
bool
ำำ '
AddFilesToTechnicalReadme
ำำ 5
(
ำำ5 6
string
ำำ6 <

readmePath
ำำ= G
,
ำำG H
string
ำำI O
[
ำำO P
]
ำำP Q
newFiles
ำำR Z
)
ำำZ [
{
ำำ\ ]
try
ิิ 
{
ิิ 
var
ีี 
content
ีี 
=
ีี 
File
ีี "
.
ีี" #
ReadAllText
ีี# .
(
ีี. /

readmePath
ีี/ 9
,
ีี9 :
Encoding
ีี; C
.
ีีC D
UTF8
ีีD H
)
ีีH I
;
ีีI J
var
ึึ 
currentDate
ึึ 
=
ึึ  !

DateHelper
ึึ" ,
.
ึึ, -"
GetCurrentDateString
ึึ- A
(
ึึA B
)
ึึB C
;
ึึC D
var
ูู 
moduleFilesIndex
ูู $
=
ูู% &
content
ูู' .
.
ูู. /
IndexOf
ูู/ 6
(
ูู6 7
$str
ูู7 G
)
ููG H
;
ููH I
if
ฺฺ 
(
ฺฺ 
moduleFilesIndex
ฺฺ $
!=
ฺฺ% '
-
ฺฺ( )
$num
ฺฺ) *
)
ฺฺ* +
{
ฺฺ, -
var
 
insertIndex
 #
=
$ %
content
& -
.
- .
IndexOf
. 5
(
5 6
$str
6 T
,
T U
moduleFilesIndex
V f
)
f g
;
g h
if
 
(
 
insertIndex
 #
==
$ &
-
' (
$num
( )
)
) *
insertIndex
+ 6
=
7 8
content
9 @
.
@ A
Length
A G
;
G H
var
 

newContent
 "
=
# $
$str
% '
;
' (
foreach
฿฿ 
(
฿฿ 
var
฿฿  
file
฿฿! %
in
฿฿& (
newFiles
฿฿) 1
)
฿฿1 2
{
฿฿3 4
var
เเ 
fileName
เเ $
=
เเ% &
Path
เเ' +
.
เเ+ ,
GetFileName
เเ, 7
(
เเ7 8
file
เเ8 <
)
เเ< =
;
เเ= >

newContent
แแ "
+=
แแ# %
$"
แแ& (
$str
แแ( 0
{
แแ0 1
fileName
แแ1 9
}
แแ9 :
$str
แแ: A
"
แแA B
;
แแB C

newContent
โโ "
+=
โโ# %
$"
โโ& (
$str
โโ( O
{
โโO P
currentDate
โโP [
}
โโ[ \
$str
โโ\ ^
"
โโ^ _
;
โโ_ `

newContent
ใใ "
+=
ใใ# %
$"
ใใ& (
$str
ใใ( @
"
ใใ@ A
;
ใใA B
}
ไไ 
content
ๆๆ 
=
ๆๆ 
content
ๆๆ %
.
ๆๆ% &
Insert
ๆๆ& ,
(
ๆๆ, -
insertIndex
ๆๆ- 8
,
ๆๆ8 9

newContent
ๆๆ: D
+
ๆๆE F
$str
ๆๆG K
)
ๆๆK L
;
ๆๆL M
}
็็ 
content
๊๊ 
=
๊๊ 
Regex
๊๊ 
.
๊๊  
Replace
๊๊  '
(
๊๊' (
content
๊๊( /
,
๊๊/ 0
$str
๊๊1 [
,
๊๊[ \
$"
๊๊] _
$str
๊๊_ q
{
๊๊q r
currentDate
๊๊r }
}
๊๊} ~
"
๊๊~ 
)๊๊ 
;๊๊ 
File
์์ 
.
์์ 
WriteAllText
์์ !
(
์์! "

readmePath
์์" ,
,
์์, -
content
์์. 5
,
์์5 6
Encoding
์์7 ?
.
์์? @
UTF8
์์@ D
)
์์D E
;
์์E F
return
ํํ 
true
ํํ 
;
ํํ 
}
๎๎ 
catch
๏๏ 
(
๏๏ 
	Exception
๏๏ 
)
๏๏ 
{
๏๏ 
return
๐๐ 
false
๐๐ 
;
๐๐ 
}
๑๑ 
}
๒๒ 	
private
๚๚ 
static
๚๚ 
bool
๚๚ *
AddDocumentsToCategoryReadme
๚๚ 8
(
๚๚8 9
string
๚๚9 ?

readmePath
๚๚@ J
,
๚๚J K
string
๚๚L R
[
๚๚R S
]
๚๚S T
newDocuments
๚๚U a
)
๚๚a b
{
๚๚c d
try
๛๛ 
{
๛๛ 
var
 
content
 
=
 
File
 "
.
" #
ReadAllText
# .
(
. /

readmePath
/ 9
,
9 :
Encoding
; C
.
C D
UTF8
D H
)
H I
;
I J
var
 
currentDate
 
=
  !

DateHelper
" ,
.
, -"
GetCurrentDateString
- A
(
A B
)
B C
;
C D
var
 
documentsIndex
 "
=
# $
content
% ,
.
, -
IndexOf
- 4
(
4 5
$str
5 [
)
[ \
;
\ ]
if
 
(
 
documentsIndex
 "
!=
# %
-
& '
$num
' (
)
( )
{
* +
var
 
insertIndex
 #
=
$ %
content
& -
.
- .
IndexOf
. 5
(
5 6
$str
6 A
,
A B
documentsIndex
C Q
)
Q R
;
R S
if
 
(
 
insertIndex
 #
==
$ &
-
' (
$num
( )
)
) *
insertIndex
+ 6
=
7 8
content
9 @
.
@ A
Length
A G
;
G H
var
 

newContent
 "
=
# $
$str
% '
;
' (
foreach
 
(
 
var
  
doc
! $
in
% '
newDocuments
( 4
)
4 5
{
6 7
var
 
docName
 #
=
$ %
Path
& *
.
* +)
GetFileNameWithoutExtension
+ F
(
F G
doc
G J
)
J K
;
K L

newContent
 "
+=
# %
$"
& (
$str
( ,
{
, -
docName
- 4
}
4 5
$str
5 M
{
M N
currentDate
N Y
}
Y Z
$str
Z \
"
\ ]
;
] ^
}
 
content
 
=
 
content
 %
.
% &
Insert
& ,
(
, -
insertIndex
- 8
,
8 9

newContent
: D
)
D E
;
E F
}
 
content
 
=
 
Regex
 
.
  
Replace
  '
(
' (
content
( /
,
/ 0
$str
1 [
,
[ \
$"
] _
$str
_ q
{
q r
currentDate
r }
}
} ~
"
~ 
) 
; 
File
 
.
 
WriteAllText
 !
(
! "

readmePath
" ,
,
, -
content
. 5
,
5 6
Encoding
7 ?
.
? @
UTF8
@ D
)
D E
;
E F
return
 
true
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
private
 
static
 
void
 %
ValidateReadmeStructure
 3
(
3 4
string
4 :

readmePath
; E
,
E F

ReadmeType
G Q

readmeType
R \
,
\ ]
List
^ b
<
b c
string
c i
>
i j
issues
k q
)
q r
{
s t
try
 
{
 
var
กก 
content
กก 
=
กก 
File
กก "
.
กก" #
ReadAllText
กก# .
(
กก. /

readmePath
กก/ 9
,
กก9 :
Encoding
กก; C
.
กกC D
UTF8
กกD H
)
กกH I
;
กกI J
switch
คค 
(
คค 

readmeType
คค "
)
คค" #
{
คค$ %
case
ฅฅ 

ReadmeType
ฅฅ #
.
ฅฅ# $
Root
ฅฅ$ (
:
ฅฅ( )
if
ฆฆ 
(
ฆฆ 
!
ฆฆ 
content
ฆฆ $
.
ฆฆ$ %
Contains
ฆฆ% -
(
ฆฆ- .
$str
ฆฆ. Q
)
ฆฆQ R
)
ฆฆR S
issues
งง "
.
งง" #
Add
งง# &
(
งง& '
$"
งง' )
{
งง) *

readmePath
งง* 4
}
งง4 5
$str
งง5 ^
"
งง^ _
)
งง_ `
;
งง` a
break
จจ 
;
จจ 
case
ฉฉ 

ReadmeType
ฉฉ #
.
ฉฉ# $

Navigation
ฉฉ$ .
:
ฉฉ. /
if
ชช 
(
ชช 
!
ชช 
content
ชช $
.
ชช$ %
Contains
ชช% -
(
ชช- .
$str
ชช. A
)
ชชA B
)
ชชB C
issues
ซซ "
.
ซซ" #
Add
ซซ# &
(
ซซ& '
$"
ซซ' )
{
ซซ) *

readmePath
ซซ* 4
}
ซซ4 5
$str
ซซ5 N
"
ซซN O
)
ซซO P
;
ซซP Q
break
ฌฌ 
;
ฌฌ 
case
ญญ 

ReadmeType
ญญ #
.
ญญ# $
	Technical
ญญ$ -
:
ญญ- .
if
ฎฎ 
(
ฎฎ 
!
ฎฎ 
content
ฎฎ $
.
ฎฎ$ %
Contains
ฎฎ% -
(
ฎฎ- .
$str
ฎฎ. E
)
ฎฎE F
)
ฎฎF G
issues
ฏฏ "
.
ฏฏ" #
Add
ฏฏ# &
(
ฏฏ& '
$"
ฏฏ' )
{
ฏฏ) *

readmePath
ฏฏ* 4
}
ฏฏ4 5
$str
ฏฏ5 V
"
ฏฏV W
)
ฏฏW X
;
ฏฏX Y
break
ฐฐ 
;
ฐฐ 
}
ฑฑ 
if
ดด 
(
ดด 
!
ดด 
content
ดด 
.
ดด 
Contains
ดด %
(
ดด% &
$str
ดด& 9
)
ดด9 :
)
ดด: ;
issues
ตต 
.
ตต 
Add
ตต 
(
ตต 
$"
ตต !
{
ตต! "

readmePath
ตต" ,
}
ตต, -
$str
ตต- I
"
ตตI J
)
ตตJ K
;
ตตK L
}
ถถ 
catch
ทท 
(
ทท 
	Exception
ทท 
ex
ทท 
)
ทท  
{
ทท! "
issues
ธธ 
.
ธธ 
Add
ธธ 
(
ธธ 
$"
ธธ 
{
ธธ 

readmePath
ธธ (
}
ธธ( )
$str
ธธ) H
{
ธธH I
ex
ธธI K
.
ธธK L
Message
ธธL S
}
ธธS T
"
ธธT U
)
ธธU V
;
ธธV W
}
นน 
}
บบ 	
private
มม 
static
มม 
void
มม +
ValidateReadmeCrossReferences
มม 9
(
มม9 :
string
มม: @

readmePath
มมA K
,
มมK L
List
มมM Q
<
มมQ R
string
มมR X
>
มมX Y
issues
มมZ `
)
มม` a
{
มมb c
try
ยย 
{
ยย 
var
รร 
content
รร 
=
รร 
File
รร "
.
รร" #
ReadAllText
รร# .
(
รร. /

readmePath
รร/ 9
,
รร9 :
Encoding
รร; C
.
รรC D
UTF8
รรD H
)
รรH I
;
รรI J
var
ฤฤ 
	linkRegex
ฤฤ 
=
ฤฤ 
new
ฤฤ  #
Regex
ฤฤ$ )
(
ฤฤ) *
$str
ฤฤ* D
,
ฤฤD E
RegexOptions
ฤฤF R
.
ฤฤR S
Compiled
ฤฤS [
)
ฤฤ[ \
;
ฤฤ\ ]
var
ลล 
linkMatches
ลล 
=
ลล  !
	linkRegex
ลล" +
.
ลล+ ,
Matches
ลล, 3
(
ลล3 4
content
ลล4 ;
)
ลล; <
;
ลล< =
foreach
วว 
(
วว 
Match
วว 
	linkMatch
วว (
in
วว) +
linkMatches
วว, 7
)
วว7 8
{
วว9 :
var
ศศ 
linkPath
ศศ  
=
ศศ! "
	linkMatch
ศศ# ,
.
ศศ, -
Groups
ศศ- 3
[
ศศ3 4
$num
ศศ4 5
]
ศศ5 6
.
ศศ6 7
Value
ศศ7 <
;
ศศ< =
if
ษษ 
(
ษษ 
linkPath
ษษ  
.
ษษ  !

StartsWith
ษษ! +
(
ษษ+ ,
$str
ษษ, 2
)
ษษ2 3
)
ษษ3 4
continue
ษษ5 =
;
ษษ= >
var
หห 
fullPath
หห  
=
หห! "
Path
หห# '
.
หห' (
Combine
หห( /
(
หห/ 0
Path
หห0 4
.
หห4 5
GetDirectoryName
หห5 E
(
หหE F

readmePath
หหF P
)
หหP Q
,
หหQ R
linkPath
หหS [
)
หห[ \
;
หห\ ]
var
ฬฬ 
normalizedPath
ฬฬ &
=
ฬฬ' (
Path
ฬฬ) -
.
ฬฬ- .
GetFullPath
ฬฬ. 9
(
ฬฬ9 :
fullPath
ฬฬ: B
)
ฬฬB C
;
ฬฬC D
if
ฮฮ 
(
ฮฮ 
!
ฮฮ 
File
ฮฮ 
.
ฮฮ 
Exists
ฮฮ $
(
ฮฮ$ %
normalizedPath
ฮฮ% 3
)
ฮฮ3 4
)
ฮฮ4 5
{
ฮฮ6 7
issues
ฯฯ 
.
ฯฯ 
Add
ฯฯ "
(
ฯฯ" #
$"
ฯฯ# %
{
ฯฯ% &

readmePath
ฯฯ& 0
}
ฯฯ0 1
$str
ฯฯ1 A
{
ฯฯA B
linkPath
ฯฯB J
}
ฯฯJ K
"
ฯฯK L
)
ฯฯL M
;
ฯฯM N
}
ะะ 
}
ัั 
}
าา 
catch
ำำ 
(
ำำ 
	Exception
ำำ 
ex
ำำ 
)
ำำ  
{
ำำ! "
issues
ิิ 
.
ิิ 
Add
ิิ 
(
ิิ 
$"
ิิ 
{
ิิ 

readmePath
ิิ (
}
ิิ( )
$str
ิิ) O
{
ิิO P
ex
ิิP R
.
ิิR S
Message
ิิS Z
}
ิิZ [
"
ิิ[ \
)
ิิ\ ]
;
ิิ] ^
}
ีี 
}
ึึ 	
private
 
static
 
bool
 )
UpdateReadmeCrossReferences
 7
(
7 8
string
8 >

readmePath
? I
)
I J
{
K L
try
 
{
 
var
฿฿ 
content
฿฿ 
=
฿฿ 
File
฿฿ "
.
฿฿" #
ReadAllText
฿฿# .
(
฿฿. /

readmePath
฿฿/ 9
,
฿฿9 :
Encoding
฿฿; C
.
฿฿C D
UTF8
฿฿D H
)
฿฿H I
;
฿฿I J
var
เเ 
originalContent
เเ #
=
เเ$ %
content
เเ& -
;
เเ- .
var
ใใ 
pathMappings
ใใ  
=
ใใ! "
new
ใใ# &

Dictionary
ใใ' 1
<
ใใ1 2
string
ใใ2 8
,
ใใ8 9
string
ใใ: @
>
ใใ@ A
{
ใใB C
[
ไไ 
$str
ไไ *
]
ไไ* +
=
ไไ, -
$str
ไไ. F
,
ไไF G
[
ๅๅ 
$str
ๅๅ 4
]
ๅๅ4 5
=
ๅๅ6 7
$str
ๅๅ8 Z
,
ๅๅZ [
[
ๆๆ 
$str
ๆๆ /
]
ๆๆ/ 0
=
ๆๆ1 2
$str
ๆๆ3 P
,
ๆๆP Q
[
็็ 
$str
็็ 3
]
็็3 4
=
็็5 6
$str
็็7 f
,
็็f g
[
่่ 
$str
่่ 6
]
่่6 7
=
่่8 9
$str
่่: m
}
้้ 
;
้้ 
foreach
๋๋ 
(
๋๋ 
var
๋๋ 
mapping
๋๋ $
in
๋๋% '
pathMappings
๋๋( 4
)
๋๋4 5
{
๋๋6 7
content
์์ 
=
์์ 
content
์์ %
.
์์% &
Replace
์์& -
(
์์- .
mapping
์์. 5
.
์์5 6
Key
์์6 9
,
์์9 :
mapping
์์; B
.
์์B C
Value
์์C H
)
์์H I
;
์์I J
}
ํํ 
if
๏๏ 
(
๏๏ 
content
๏๏ 
!=
๏๏ 
originalContent
๏๏ .
)
๏๏. /
{
๏๏0 1
File
๐๐ 
.
๐๐ 
WriteAllText
๐๐ %
(
๐๐% &

readmePath
๐๐& 0
,
๐๐0 1
content
๐๐2 9
,
๐๐9 :
Encoding
๐๐; C
.
๐๐C D
UTF8
๐๐D H
)
๐๐H I
;
๐๐I J
}
๑๑ 
return
๓๓ 
true
๓๓ 
;
๓๓ 
}
๔๔ 
catch
๕๕ 
(
๕๕ 
	Exception
๕๕ 
)
๕๕ 
{
๕๕ 
return
๖๖ 
false
๖๖ 
;
๖๖ 
}
๗๗ 
}
๘๘ 	
public
 
static
 
bool
 !
UpdateMainChangelog
 .
(
. /
string
/ 5
version
6 =
,
= >
string
? E
changes
F M
)
M N
{
O P
try
 
{
 
if
 
(
 
!
 
File
 
.
 
Exists
  
(
  !
ChangelogFile
! .
)
. /
)
/ 0
{
1 2
return
 !
CreateMainChangelog
 .
(
. /
version
/ 6
,
6 7
changes
8 ?
)
? @
;
@ A
}
 
return
 "
InsertChangelogEntry
 +
(
+ ,
version
, 3
,
3 4
changes
5 <
)
< =
;
= >
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
private
 
static
 
bool
 !
CreateMainChangelog
 /
(
/ 0
string
0 6
version
7 >
,
> ?
string
@ F
changes
G N
)
N O
{
P Q
try
 
{
 
var
 
currentDate
 
=
  !

DateHelper
" ,
.
, -"
GetCurrentDateString
- A
(
A B
)
B C
;
C D
var
 
content
 
=
 
$@"
 !
$str
ฆ! 
{
ฆฆ 
version
ฆฆ 
}
ฆฆ 
$str
ฆฆ 
{
ฆฆ 
currentDate
ฆฆ 
}
ฆฆ 
$str
ฆฉ 
{
ฉฉ 
changes
ฉฉ 

}
ฉฉ
 
$strฉต
"ตต 
;
ตต 
	Directory
ทท 
.
ทท 
CreateDirectory
ทท )
(
ทท) *
Path
ทท* .
.
ทท. /
GetDirectoryName
ทท/ ?
(
ทท? @
ChangelogFile
ทท@ M
)
ททM N
)
ททN O
;
ททO P
File
ธธ 
.
ธธ 
WriteAllText
ธธ !
(
ธธ! "
ChangelogFile
ธธ" /
,
ธธ/ 0
content
ธธ1 8
,
ธธ8 9
Encoding
ธธ: B
.
ธธB C
UTF8
ธธC G
)
ธธG H
;
ธธH I
return
นน 
true
นน 
;
นน 
}
บบ 
catch
ปป 
(
ปป 
	Exception
ปป 
)
ปป 
{
ปป 
return
ผผ 
false
ผผ 
;
ผผ 
}
ฝฝ 
}
พพ 	
private
ฦฦ 
static
ฦฦ 
bool
ฦฦ "
InsertChangelogEntry
ฦฦ 0
(
ฦฦ0 1
string
ฦฦ1 7
version
ฦฦ8 ?
,
ฦฦ? @
string
ฦฦA G
changes
ฦฦH O
)
ฦฦO P
{
ฦฦQ R
try
วว 
{
วว 
var
ศศ 
content
ศศ 
=
ศศ 
File
ศศ "
.
ศศ" #
ReadAllText
ศศ# .
(
ศศ. /
ChangelogFile
ศศ/ <
,
ศศ< =
Encoding
ศศ> F
.
ศศF G
UTF8
ศศG K
)
ศศK L
;
ศศL M
var
ษษ 
currentDate
ษษ 
=
ษษ  !

DateHelper
ษษ" ,
.
ษษ, -"
GetCurrentDateString
ษษ- A
(
ษษA B
)
ษษB C
;
ษษC D
var
หห 
newEntry
หห 
=
หห 
$@"
หห "
$str
หฬ" 
{
ฬฬ 
version
ฬฬ 
}
ฬฬ 
$str
ฬฬ 
{
ฬฬ 
currentDate
ฬฬ 
}
ฬฬ 
$str
ฬฯ 
{
ฯฯ 
changes
ฯฯ 

}
ฯฯ
 
$strฯะ
"ะะ 
;
ะะ 
var
ำำ 
firstVersionMatch
ำำ %
=
ำำ& ' 
VersionHeaderRegex
ำำ( :
.
ำำ: ;
Match
ำำ; @
(
ำำ@ A
content
ำำA H
)
ำำH I
;
ำำI J
if
ิิ 
(
ิิ 
firstVersionMatch
ิิ %
.
ิิ% &
Success
ิิ& -
)
ิิ- .
{
ิิ/ 0
var
ีี 
insertIndex
ีี #
=
ีี$ %
firstVersionMatch
ีี& 7
.
ีี7 8
Index
ีี8 =
;
ีี= >
content
ึึ 
=
ึึ 
content
ึึ %
.
ึึ% &
Insert
ึึ& ,
(
ึึ, -
insertIndex
ึึ- 8
,
ึึ8 9
newEntry
ึึ: B
+
ึึC D
$str
ึึE I
)
ึึI J
;
ึึJ K
File
ุุ 
.
ุุ 
WriteAllText
ุุ %
(
ุุ% &
ChangelogFile
ุุ& 3
,
ุุ3 4
content
ุุ5 <
,
ุุ< =
Encoding
ุุ> F
.
ุุF G
UTF8
ุุG K
)
ุุK L
;
ุุL M
return
ูู 
true
ูู 
;
ูู  
}
ฺฺ 
return
 
false
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
฿฿ 
false
฿฿ 
;
฿฿ 
}
เเ 
}
แแ 	
public
์์ 
static
์์ 
bool
์์ .
 ValidateDocumentationConsistency
์์ ;
(
์์; <
string
์์< B
projectPath
์์C N
=
์์O P
$str
์์Q T
)
์์T U
{
์์V W
try
ํํ 
{
ํํ 
var
๎๎ 
issues
๎๎ 
=
๎๎ 
new
๎๎  
List
๎๎! %
<
๎๎% &
string
๎๎& ,
>
๎๎, -
(
๎๎- .
)
๎๎. /
;
๎๎/ 0*
ValidateChangelogConsistency
๐๐ ,
(
๐๐, -
issues
๐๐- 3
)
๐๐3 4
;
๐๐4 5%
ValidateModuleSummaries
๑๑ '
(
๑๑' (
projectPath
๑๑( 3
,
๑๑3 4
issues
๑๑5 ;
)
๑๑; <
;
๑๑< =%
ValidateCrossReferences
๒๒ '
(
๒๒' (
projectPath
๒๒( 3
,
๒๒3 4
issues
๒๒5 ;
)
๒๒; <
;
๒๒< =%
ValidateReadmeHierarchy
๓๓ '
(
๓๓' (
issues
๓๓( .
)
๓๓. /
;
๓๓/ 0
return
๕๕ 
issues
๕๕ 
.
๕๕ 
Count
๕๕ #
==
๕๕$ &
$num
๕๕' (
;
๕๕( )
}
๖๖ 
catch
๗๗ 
(
๗๗ 
	Exception
๗๗ 
)
๗๗ 
{
๗๗ 
return
๘๘ 
false
๘๘ 
;
๘๘ 
}
๙๙ 
}
๚๚ 	
private
 
static
 
void
 %
ValidateReadmeHierarchy
 3
(
3 4
List
4 8
<
8 9
string
9 ?
>
? @
issues
A G
)
G H
{
I J
try
 
{
 
if
 
(
 
!
 %
ValidateReadmeHierarchy
 ,
(
, -
)
- .
)
. /
{
0 1
issues
 
.
 
Add
 
(
 
$str
 C
)
C D
;
D E
}
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
! "
issues
 
.
 
Add
 
(
 
$"
 
$str
 @
{
@ A
ex
A C
.
C D
Message
D K
}
K L
"
L M
)
M N
;
N O
}
 
}
 	
private
 
static
 
void
 *
ValidateChangelogConsistency
 8
(
8 9
List
9 =
<
= >
string
> D
>
D E
issues
F L
)
L M
{
N O
try
 
{
 
if
 
(
 
!
 
File
 
.
 
Exists
  
(
  !
ChangelogFile
! .
)
. /
)
/ 0
{
1 2
issues
 
.
 
Add
 
(
 
$str
 >
)
> ?
;
? @
return
 
;
 
}
 
var
 
content
 
=
 
File
 "
.
" #
ReadAllText
# .
(
. /
ChangelogFile
/ <
,
< =
Encoding
> F
.
F G
UTF8
G K
)
K L
;
L M
var
 
versionMatches
 "
=
# $ 
VersionHeaderRegex
% 7
.
7 8
Matches
8 ?
(
? @
content
@ G
)
G H
;
H I
var
 
versions
 
=
 
new
 "
List
# '
<
' (
Version
( /
>
/ 0
(
0 1
)
1 2
;
2 3
foreach
 
(
 
Match
 
match
 $
in
% '
versionMatches
( 6
)
6 7
{
8 9
if
 
(
 
Version
 
.
  
TryParse
  (
(
( )
match
) .
.
. /
Groups
/ 5
[
5 6
$num
6 7
]
7 8
.
8 9
Value
9 >
,
> ?
out
@ C
var
D G
version
H O
)
O P
)
P Q
{
R S
versions
  
.
  !
Add
! $
(
$ %
version
% ,
)
, -
;
- .
}
 
}
 
for
กก 
(
กก 
int
กก 
i
กก 
=
กก 
$num
กก 
;
กก 
i
กก  !
<
กก" #
versions
กก$ ,
.
กก, -
Count
กก- 2
-
กก3 4
$num
กก5 6
;
กก6 7
i
กก8 9
++
กก9 ;
)
กก; <
{
กก= >
if
ขข 
(
ขข 
versions
ขข  
[
ขข  !
i
ขข! "
]
ขข" #
<
ขข$ %
versions
ขข& .
[
ขข. /
i
ขข/ 0
+
ขข1 2
$num
ขข3 4
]
ขข4 5
)
ขข5 6
{
ขข7 8
issues
ฃฃ 
.
ฃฃ 
Add
ฃฃ "
(
ฃฃ" #
$"
ฃฃ# %
$str
ฃฃ% Q
{
ฃฃQ R
versions
ฃฃR Z
[
ฃฃZ [
i
ฃฃ[ \
]
ฃฃ\ ]
}
ฃฃ] ^
$str
ฃฃ^ a
{
ฃฃa b
versions
ฃฃb j
[
ฃฃj k
i
ฃฃk l
+
ฃฃm n
$num
ฃฃo p
]
ฃฃp q
}
ฃฃq r
"
ฃฃr s
)
ฃฃs t
;
ฃฃt u
}
คค 
}
ฅฅ 
}
ฆฆ 
catch
งง 
(
งง 
	Exception
งง 
ex
งง 
)
งง  
{
งง! "
issues
จจ 
.
จจ 
Add
จจ 
(
จจ 
$"
จจ 
$str
จจ 9
{
จจ9 :
ex
จจ: <
.
จจ< =
Message
จจ= D
}
จจD E
"
จจE F
)
จจF G
;
จจG H
}
ฉฉ 
}
ชช 	
private
ฑฑ 
static
ฑฑ 
void
ฑฑ %
ValidateModuleSummaries
ฑฑ 3
(
ฑฑ3 4
string
ฑฑ4 :
projectPath
ฑฑ; F
,
ฑฑF G
List
ฑฑH L
<
ฑฑL M
string
ฑฑM S
>
ฑฑS T
issues
ฑฑU [
)
ฑฑ[ \
{
ฑฑ] ^
try
ฒฒ 
{
ฒฒ 
var
ณณ 
moduleDirectories
ณณ %
=
ณณ& '
	Directory
ณณ( 1
.
ณณ1 2
GetDirectories
ณณ2 @
(
ณณ@ A
projectPath
ณณA L
)
ณณL M
.
ดด 
Where
ดด 
(
ดด 
d
ดด 
=>
ดด 
!
ดด  !
Path
ดด! %
.
ดด% &
GetFileName
ดด& 1
(
ดด1 2
d
ดด2 3
)
ดด3 4
.
ดด4 5

StartsWith
ดด5 ?
(
ดด? @
$str
ดด@ C
)
ดดC D
)
ดดD E
.
ตต 
Where
ตต 
(
ตต 
d
ตต 
=>
ตต 
Path
ตต  $
.
ตต$ %
GetFileName
ตต% 0
(
ตต0 1
d
ตต1 2
)
ตต2 3
!=
ตต4 6
$str
ตต7 F
)
ตตF G
.
ถถ 
Where
ถถ 
(
ถถ 
d
ถถ 
=>
ถถ 
Path
ถถ  $
.
ถถ$ %
GetFileName
ถถ% 0
(
ถถ0 1
d
ถถ1 2
)
ถถ2 3
!=
ถถ4 6
$str
ถถ7 A
)
ถถA B
.
ทท 
ToList
ทท 
(
ทท 
)
ทท 
;
ทท 
foreach
นน 
(
นน 
var
นน 
	moduleDir
นน &
in
นน' )
moduleDirectories
นน* ;
)
นน; <
{
นน= >
var
บบ 

moduleName
บบ "
=
บบ# $
Path
บบ% )
.
บบ) *
GetFileName
บบ* 5
(
บบ5 6
	moduleDir
บบ6 ?
)
บบ? @
;
บบ@ A
var
ปป 
summaryFile
ปป #
=
ปป$ %#
FindModuleSummaryFile
ปป& ;
(
ปป; <

moduleName
ปป< F
)
ปปF G
;
ปปG H
if
ฝฝ 
(
ฝฝ 
summaryFile
ฝฝ #
==
ฝฝ$ &
null
ฝฝ' +
)
ฝฝ+ ,
{
ฝฝ- .
issues
พพ 
.
พพ 
Add
พพ "
(
พพ" #
$"
พพ# %
$str
พพ% G
{
พพG H

moduleName
พพH R
}
พพR S
"
พพS T
)
พพT U
;
พพU V
}
ฟฟ 
}
ภภ 
}
มม 
catch
ยย 
(
ยย 
	Exception
ยย 
ex
ยย 
)
ยย  
{
ยย! "
issues
รร 
.
รร 
Add
รร 
(
รร 
$"
รร 
$str
รร @
{
รร@ A
ex
รรA C
.
รรC D
Message
รรD K
}
รรK L
"
รรL M
)
รรM N
;
รรN O
}
ฤฤ 
}
ลล 	
private
ฬฬ 
static
ฬฬ 
void
ฬฬ %
ValidateCrossReferences
ฬฬ 3
(
ฬฬ3 4
string
ฬฬ4 :
projectPath
ฬฬ; F
,
ฬฬF G
List
ฬฬH L
<
ฬฬL M
string
ฬฬM S
>
ฬฬS T
issues
ฬฬU [
)
ฬฬ[ \
{
ฬฬ] ^
try
ออ 
{
ออ 
var
ฮฮ  
documentationFiles
ฮฮ &
=
ฮฮ' (
	Directory
ฮฮ) 2
.
ฮฮ2 3
GetFiles
ฮฮ3 ;
(
ฮฮ; <!
DocumentationFolder
ฮฮ< O
,
ฮฮO P
$str
ฮฮQ W
,
ฮฮW X
SearchOption
ฮฮY e
.
ฮฮe f
AllDirectories
ฮฮf t
)
ฮฮt u
;
ฮฮu v
var
ฯฯ 
	linkRegex
ฯฯ 
=
ฯฯ 
new
ฯฯ  #
Regex
ฯฯ$ )
(
ฯฯ) *
$str
ฯฯ* D
,
ฯฯD E
RegexOptions
ฯฯF R
.
ฯฯR S
Compiled
ฯฯS [
)
ฯฯ[ \
;
ฯฯ\ ]
foreach
ัั 
(
ัั 
var
ัั 
docFile
ัั $
in
ัั% ' 
documentationFiles
ัั( :
)
ัั: ;
{
ัั< =
var
าา 
content
าา 
=
าา  !
File
าา" &
.
าา& '
ReadAllText
าา' 2
(
าา2 3
docFile
าา3 :
,
าา: ;
Encoding
าา< D
.
าาD E
UTF8
าาE I
)
าาI J
;
าาJ K
var
ำำ 
linkMatches
ำำ #
=
ำำ$ %
	linkRegex
ำำ& /
.
ำำ/ 0
Matches
ำำ0 7
(
ำำ7 8
content
ำำ8 ?
)
ำำ? @
;
ำำ@ A
foreach
ีี 
(
ีี 
Match
ีี "
	linkMatch
ีี# ,
in
ีี- /
linkMatches
ีี0 ;
)
ีี; <
{
ีี= >
var
ึึ 
linkPath
ึึ $
=
ึึ% &
	linkMatch
ึึ' 0
.
ึึ0 1
Groups
ึึ1 7
[
ึึ7 8
$num
ึึ8 9
]
ึึ9 :
.
ึึ: ;
Value
ึึ; @
;
ึึ@ A
if
ืื 
(
ืื 
linkPath
ืื $
.
ืื$ %

StartsWith
ืื% /
(
ืื/ 0
$str
ืื0 6
)
ืื6 7
)
ืื7 8
continue
ืื9 A
;
ืืA B
var
ูู 
fullPath
ูู $
=
ูู% &
Path
ูู' +
.
ูู+ ,
Combine
ูู, 3
(
ูู3 4
Path
ูู4 8
.
ูู8 9
GetDirectoryName
ูู9 I
(
ููI J
docFile
ููJ Q
)
ููQ R
,
ููR S
linkPath
ููT \
)
ูู\ ]
;
ูู] ^
if
ฺฺ 
(
ฺฺ 
!
ฺฺ 
File
ฺฺ !
.
ฺฺ! "
Exists
ฺฺ" (
(
ฺฺ( )
fullPath
ฺฺ) 1
)
ฺฺ1 2
)
ฺฺ2 3
{
ฺฺ4 5
issues
 "
.
" #
Add
# &
(
& '
$"
' )
$str
) 8
{
8 9
docFile
9 @
}
@ A
$str
A C
{
C D
linkPath
D L
}
L M
"
M N
)
N O
;
O P
}
 
}
 
}
 
}
฿฿ 
catch
เเ 
(
เเ 
	Exception
เเ 
ex
เเ 
)
เเ  
{
เเ! "
issues
แแ 
.
แแ 
Add
แแ 
(
แแ 
$"
แแ 
$str
แแ @
{
แแ@ A
ex
แแA C
.
แแC D
Message
แแD K
}
แแK L
"
แแL M
)
แแM N
;
แแN O
}
โโ 
}
ใใ 	
public
๎๎ 
static
๎๎ 
bool
๎๎ &
UpdateDocumentationPaths
๎๎ 3
(
๎๎3 4

Dictionary
๎๎4 >
<
๎๎> ?
string
๎๎? E
,
๎๎E F
string
๎๎G M
>
๎๎M N
pathMappings
๎๎O [
)
๎๎[ \
{
๎๎] ^
try
๏๏ 
{
๏๏ 
var
๐๐  
documentationFiles
๐๐ &
=
๐๐' (
	Directory
๐๐) 2
.
๐๐2 3
GetFiles
๐๐3 ;
(
๐๐; <!
DocumentationFolder
๐๐< O
,
๐๐O P
$str
๐๐Q W
,
๐๐W X
SearchOption
๐๐Y e
.
๐๐e f
AllDirectories
๐๐f t
)
๐๐t u
;
๐๐u v
var
๑๑ 
readmeFiles
๑๑ 
=
๑๑  !
GetAllReadmeFiles
๑๑" 3
(
๑๑3 4
)
๑๑4 5
;
๑๑5 6
var
๒๒ 
allFiles
๒๒ 
=
๒๒  
documentationFiles
๒๒ 1
.
๒๒1 2
Concat
๒๒2 8
(
๒๒8 9
readmeFiles
๒๒9 D
)
๒๒D E
.
๒๒E F
Distinct
๒๒F N
(
๒๒N O
)
๒๒O P
.
๒๒P Q
ToArray
๒๒Q X
(
๒๒X Y
)
๒๒Y Z
;
๒๒Z [
var
๔๔ 
success
๔๔ 
=
๔๔ 
true
๔๔ "
;
๔๔" #
foreach
๖๖ 
(
๖๖ 
var
๖๖ 
docFile
๖๖ $
in
๖๖% '
allFiles
๖๖( 0
)
๖๖0 1
{
๖๖2 3
if
๗๗ 
(
๗๗ 
!
๗๗ 
UpdatePathsInFile
๗๗ *
(
๗๗* +
docFile
๗๗+ 2
,
๗๗2 3
pathMappings
๗๗4 @
)
๗๗@ A
)
๗๗A B
{
๗๗C D
success
๘๘ 
=
๘๘  !
false
๘๘" '
;
๘๘' (
}
๙๙ 
}
๚๚ 
return
 
success
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
private
 
static
 
bool
 
UpdatePathsInFile
 -
(
- .
string
. 4
filePath
5 =
,
= >

Dictionary
? I
<
I J
string
J P
,
P Q
string
R X
>
X Y
pathMappings
Z f
)
f g
{
h i
try
 
{
 
var
 
content
 
=
 
File
 "
.
" #
ReadAllText
# .
(
. /
filePath
/ 7
,
7 8
Encoding
9 A
.
A B
UTF8
B F
)
F G
;
G H
var
 
originalContent
 #
=
$ %
content
& -
;
- .
foreach
 
(
 
var
 
mapping
 $
in
% '
pathMappings
( 4
)
4 5
{
6 7
content
 
=
 
content
 %
.
% &
Replace
& -
(
- .
mapping
. 5
.
5 6
Key
6 9
,
9 :
mapping
; B
.
B C
Value
C H
)
H I
;
I J
}
 
if
 
(
 
content
 
!=
 
originalContent
 .
)
. /
{
0 1
File
 
.
 
WriteAllText
 %
(
% &
filePath
& .
,
. /
content
0 7
,
7 8
Encoding
9 A
.
A B
UTF8
B F
)
F G
;
G H
}
 
return
 
true
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
public
ฆฆ 
static
ฆฆ 
List
ฆฆ 
<
ฆฆ 
string
ฆฆ !
>
ฆฆ! "#
GetDocumentationFiles
ฆฆ# 8
(
ฆฆ8 9
string
ฆฆ9 ?
projectPath
ฆฆ@ K
=
ฆฆL M
$str
ฆฆN Q
)
ฆฆQ R
{
ฆฆS T
var
งง 
files
งง 
=
งง 
new
งง 
List
งง  
<
งง  !
string
งง! '
>
งง' (
(
งง( )
)
งง) *
;
งง* +
if
ฉฉ 
(
ฉฉ 
	Directory
ฉฉ 
.
ฉฉ 
Exists
ฉฉ  
(
ฉฉ  !!
DocumentationFolder
ฉฉ! 4
)
ฉฉ4 5
)
ฉฉ5 6
{
ฉฉ7 8
files
ชช 
.
ชช 
AddRange
ชช 
(
ชช 
	Directory
ชช (
.
ชช( )
GetFiles
ชช) 1
(
ชช1 2!
DocumentationFolder
ชช2 E
,
ชชE F
$str
ชชG M
,
ชชM N
SearchOption
ชชO [
.
ชช[ \
AllDirectories
ชช\ j
)
ชชj k
)
ชชk l
;
ชชl m
}
ซซ 
var
ฎฎ 
moduleDirectories
ฎฎ !
=
ฎฎ" #
	Directory
ฎฎ$ -
.
ฎฎ- .
GetDirectories
ฎฎ. <
(
ฎฎ< =
projectPath
ฎฎ= H
)
ฎฎH I
.
ฏฏ 
Where
ฏฏ 
(
ฏฏ 
d
ฏฏ 
=>
ฏฏ 
!
ฏฏ 
Path
ฏฏ !
.
ฏฏ! "
GetFileName
ฏฏ" -
(
ฏฏ- .
d
ฏฏ. /
)
ฏฏ/ 0
.
ฏฏ0 1

StartsWith
ฏฏ1 ;
(
ฏฏ; <
$str
ฏฏ< ?
)
ฏฏ? @
)
ฏฏ@ A
.
ฐฐ 
Where
ฐฐ 
(
ฐฐ 
d
ฐฐ 
=>
ฐฐ 
Path
ฐฐ  
.
ฐฐ  !
GetFileName
ฐฐ! ,
(
ฐฐ, -
d
ฐฐ- .
)
ฐฐ. /
!=
ฐฐ0 2
$str
ฐฐ3 B
)
ฐฐB C
.
ฑฑ 
Where
ฑฑ 
(
ฑฑ 
d
ฑฑ 
=>
ฑฑ 
Path
ฑฑ  
.
ฑฑ  !
GetFileName
ฑฑ! ,
(
ฑฑ, -
d
ฑฑ- .
)
ฑฑ. /
!=
ฑฑ0 2
$str
ฑฑ3 =
)
ฑฑ= >
;
ฑฑ> ?
foreach
ณณ 
(
ณณ 
var
ณณ 
	moduleDir
ณณ "
in
ณณ# %
moduleDirectories
ณณ& 7
)
ณณ7 8
{
ณณ9 :
files
ดด 
.
ดด 
AddRange
ดด 
(
ดด 
	Directory
ดด (
.
ดด( )
GetFiles
ดด) 1
(
ดด1 2
	moduleDir
ดด2 ;
,
ดด; <
$str
ดด= C
,
ดดC D
SearchOption
ดดE Q
.
ดดQ R
TopDirectoryOnly
ดดR b
)
ดดb c
)
ดดc d
;
ดดd e
}
ตต 
return
ทท 
files
ทท 
;
ทท 
}
ธธ 	
public
ฟฟ 
static
ฟฟ 
bool
ฟฟ +
IsDocumentationStructureValid
ฟฟ 8
(
ฟฟ8 9
string
ฟฟ9 ?
projectPath
ฟฟ@ K
=
ฟฟL M
$str
ฟฟN Q
)
ฟฟQ R
{
ฟฟS T
return
ภภ 
	Directory
ภภ 
.
ภภ 
Exists
ภภ #
(
ภภ# $!
DocumentationFolder
ภภ$ 7
)
ภภ7 8
&&
ภภ9 ;
File
มม 
.
มม 
Exists
มม 
(
มม 
ChangelogFile
มม ,
)
มม, -
&&
มม. 0%
ValidateReadmeHierarchy
ยย *
(
ยย* +
)
ยย+ ,
;
ยย, -
}
รร 	
public
ฯฯ 
static
ฯฯ 
int
ฯฯ .
 UpdateModuleSummariesFromChanges
ฯฯ :
(
ฯฯ: ;
IEnumerable
ฯฯ; F
<
ฯฯF G
string
ฯฯG M
>
ฯฯM N
changedFiles
ฯฯO [
)
ฯฯ[ \
{
ฯฯ] ^
try
ะะ 
{
ะะ 
var
ัั 
moduleChanges
ัั !
=
ัั" #
ProjectAnalyzer
ัั$ 3
.
ัั3 4!
DetectModuleChanges
ัั4 G
(
ััG H
changedFiles
ััH T
)
ััT U
;
ััU V
var
าา 
updatedCount
าา  
=
าา! "
$num
าา# $
;
าา$ %
foreach
ิิ 
(
ิิ 
var
ิิ 
moduleChange
ิิ )
in
ิิ* ,
moduleChanges
ิิ- :
)
ิิ: ;
{
ิิ< =
var
ีี 

moduleName
ีี "
=
ีี# $
moduleChange
ีี% 1
.
ีี1 2
Key
ีี2 5
;
ีี5 6
var
ึึ 
changes
ึึ 
=
ึึ  !
moduleChange
ึึ" .
.
ึึ. /
Value
ึึ/ 4
;
ึึ4 5
var
ุุ 
changeDescription
ุุ )
=
ุุ* +
string
ุุ, 2
.
ุุ2 3
Join
ุุ3 7
(
ุุ7 8
$str
ุุ8 <
,
ุุ< =
changes
ุุ> E
)
ุุE F
;
ุุF G
var
ูู 
success
ูู 
=
ูู  !!
UpdateModuleSummary
ูู" 5
(
ูู5 6

moduleName
ูู6 @
,
ูู@ A
changeDescription
ููB S
)
ููS T
;
ููT U
if
 
(
 
success
 
)
  
{
! "
updatedCount
 $
++
$ &
;
& '
}
 
}
 
return
เเ 
updatedCount
เเ #
;
เเ# $
}
แแ 
catch
โโ 
(
โโ 
	Exception
โโ 
)
โโ 
{
โโ 
return
ใใ 
$num
ใใ 
;
ใใ 
}
ไไ 
}
ๅๅ 	
public
๏๏ 
static
๏๏ 
bool
๏๏ )
UpdateModuleSummaryEnhanced
๏๏ 6
(
๏๏6 7
string
๏๏7 =

moduleName
๏๏> H
,
๏๏H I
string
๏๏J P
changes
๏๏Q X
,
๏๏X Y
string
๏๏Z `

changeType
๏๏a k
=
๏๏l m
$str
๏๏n x
)
๏๏x y
{
๏๏z {
try
๐๐ 
{
๐๐ 
var
๑๑ 
summaryFile
๑๑ 
=
๑๑  !#
FindModuleSummaryFile
๑๑" 7
(
๑๑7 8

moduleName
๑๑8 B
)
๑๑B C
;
๑๑C D
if
๓๓ 
(
๓๓ 
summaryFile
๓๓ 
==
๓๓  "
null
๓๓# '
)
๓๓' (
{
๓๓) *
return
๕๕ !
CreateModuleSummary
๕๕ .
(
๕๕. /

moduleName
๕๕/ 9
,
๕๕9 :
$"
๕๕; =
{
๕๕= >

changeType
๕๕> H
}
๕๕H I
$str
๕๕I K
{
๕๕K L
changes
๕๕L S
}
๕๕S T
"
๕๕T U
)
๕๕U V
;
๕๕V W
}
๖๖ 
return
๘๘ +
AppendToModuleSummaryEnhanced
๘๘ 4
(
๘๘4 5
summaryFile
๘๘5 @
,
๘๘@ A
changes
๘๘B I
,
๘๘I J

changeType
๘๘K U
)
๘๘U V
;
๘๘V W
}
๙๙ 
catch
๚๚ 
(
๚๚ 
	Exception
๚๚ 
)
๚๚ 
{
๚๚ 
return
๛๛ 
false
๛๛ 
;
๛๛ 
}
 
}
 	
private
		 
static
		 
bool
		 )
CreateModuleSummaryEnhanced
		 7
(
		7 8
string
		8 >

moduleName
		? I
,
		I J
string
		K Q
initialChanges
		R `
)
		` a
{
		b c
try
		 
{
		 
var
		 
summaryPath
		 
=
		  !
$"
		" $
$str
		$ :
{
		: ;

moduleName
		; E
}
		E F
$str
		F \
"
		\ ]
;
		] ^
var
		 
currentDate
		 
=
		  !

DateHelper
		" ,
.
		, -"
GetCurrentDateString
		- A
(
		A B
)
		B C
;
		C D
var
		 
content
		 
=
		 
$@"
		 !
$str
		! -
{
		- .

moduleName
		. 8
}
		8 9
$str
		9 
{
		 

moduleName
		 
}
		 
$str
		 
{
		 
currentDate
		 
}
		 
$str
		 
{
		 
initialChanges
		 
}
		 
$str
	ฃ	 
{
ฃ	ฃ	 
currentDate
ฃ	ฃ	 %
}
ฃ	ฃ	% &
$str
ฃ	ล	& 
{
ล	ล	 
currentDate
ล	ล	 
}
ล	ล	 
$strล	ห	
"ห	ห	 
;
ห	ห	 
	Directory
อ	อ	 
.
อ	อ	 
CreateDirectory
อ	อ	 )
(
อ	อ	) *
Path
อ	อ	* .
.
อ	อ	. /
GetDirectoryName
อ	อ	/ ?
(
อ	อ	? @
summaryPath
อ	อ	@ K
)
อ	อ	K L
)
อ	อ	L M
;
อ	อ	M N
File
ฮ	ฮ	 
.
ฮ	ฮ	 
WriteAllText
ฮ	ฮ	 !
(
ฮ	ฮ	! "
summaryPath
ฮ	ฮ	" -
,
ฮ	ฮ	- .
content
ฮ	ฮ	/ 6
,
ฮ	ฮ	6 7
Encoding
ฮ	ฮ	8 @
.
ฮ	ฮ	@ A
UTF8
ฮ	ฮ	A E
)
ฮ	ฮ	E F
;
ฮ	ฮ	F G
return
ฯ	ฯ	 
true
ฯ	ฯ	 
;
ฯ	ฯ	 
}
ะ	ะ	 
catch
ั	ั	 
(
ั	ั	 
	Exception
ั	ั	 
)
ั	ั	 
{
ั	ั	 
return
า	า	 
false
า	า	 
;
า	า	 
}
ำ	ำ	 
}
ิ	ิ	 	
private
		 
static
		 
bool
		 +
AppendToModuleSummaryEnhanced
		 9
(
		9 :
string
		: @
summaryFile
		A L
,
		L M
string
		N T
changes
		U \
,
		\ ]
string
		^ d

changeType
		e o
)
		o p
{
		q r
try
฿	฿	 
{
฿	฿	 
var
เ	เ	 
content
เ	เ	 
=
เ	เ	 
File
เ	เ	 "
.
เ	เ	" #
ReadAllText
เ	เ	# .
(
เ	เ	. /
summaryFile
เ	เ	/ :
,
เ	เ	: ;
Encoding
เ	เ	< D
.
เ	เ	D E
UTF8
เ	เ	E I
)
เ	เ	I J
;
เ	เ	J K
var
แ	แ	 
currentDate
แ	แ	 
=
แ	แ	  !

DateHelper
แ	แ	" ,
.
แ	แ	, -"
GetCurrentDateString
แ	แ	- A
(
แ	แ	A B
)
แ	แ	B C
;
แ	แ	C D
var
ไ	ไ	 
emoji
ไ	ไ	 
=
ไ	ไ	  
GetChangeTypeEmoji
ไ	ไ	 .
(
ไ	ไ	. /

changeType
ไ	ไ	/ 9
)
ไ	ไ	9 :
;
ไ	ไ	: ;
var
ๅ	ๅ	 
newEntry
ๅ	ๅ	 
=
ๅ	ๅ	 
$"
ๅ	ๅ	 !
$str
ๅ	ๅ	! '
{
ๅ	ๅ	' (
currentDate
ๅ	ๅ	( 3
}
ๅ	ๅ	3 4
$str
ๅ	ๅ	4 8
{
ๅ	ๅ	8 9
emoji
ๅ	ๅ	9 >
}
ๅ	ๅ	> ?
$str
ๅ	ๅ	? B
{
ๅ	ๅ	B C

changeType
ๅ	ๅ	C M
}
ๅ	ๅ	M N
$str
ๅ	ๅ	N R
{
ๅ	ๅ	R S
changes
ๅ	ๅ	S Z
}
ๅ	ๅ	Z [
$str
ๅ	ๅ	[ ]
"
ๅ	ๅ	] ^
;
ๅ	ๅ	^ _
var
่	่	  
recentUpdatesIndex
่	่	 &
=
่	่	' (
content
่	่	) 0
.
่	่	0 1
IndexOf
่	่	1 8
(
่	่	8 9
$str
่	่	9 S
)
่	่	S T
;
่	่	T U
if
้	้	 
(
้	้	  
recentUpdatesIndex
้	้	 &
==
้	้	' )
-
้	้	* +
$num
้	้	+ ,
)
้	้	, -
{
้	้	. / 
recentUpdatesIndex
๊	๊	 &
=
๊	๊	' (
content
๊	๊	) 0
.
๊	๊	0 1
IndexOf
๊	๊	1 8
(
๊	๊	8 9
$str
๊	๊	9 L
)
๊	๊	L M
;
๊	๊	M N
}
๋	๋	 
if
ํ	ํ	 
(
ํ	ํ	  
recentUpdatesIndex
ํ	ํ	 &
!=
ํ	ํ	' )
-
ํ	ํ	* +
$num
ํ	ํ	+ ,
)
ํ	ํ	, -
{
ํ	ํ	. /
var
๎	๎	 
insertIndex
๎	๎	 #
=
๎	๎	$ %
content
๎	๎	& -
.
๎	๎	- .
IndexOf
๎	๎	. 5
(
๎	๎	5 6
$char
๎	๎	6 :
,
๎	๎	: ; 
recentUpdatesIndex
๎	๎	< N
)
๎	๎	N O
+
๎	๎	P Q
$num
๎	๎	R S
;
๎	๎	S T
content
๏	๏	 
=
๏	๏	 
content
๏	๏	 %
.
๏	๏	% &
Insert
๏	๏	& ,
(
๏	๏	, -
insertIndex
๏	๏	- 8
,
๏	๏	8 9
newEntry
๏	๏	: B
)
๏	๏	B C
;
๏	๏	C D
content
๒	๒	 
=
๒	๒	 (
UpdateLastUpdatedTimestamp
๒	๒	 8
(
๒	๒	8 9
content
๒	๒	9 @
,
๒	๒	@ A
currentDate
๒	๒	B M
)
๒	๒	M N
;
๒	๒	N O
File
๔	๔	 
.
๔	๔	 
WriteAllText
๔	๔	 %
(
๔	๔	% &
summaryFile
๔	๔	& 1
,
๔	๔	1 2
content
๔	๔	3 :
,
๔	๔	: ;
Encoding
๔	๔	< D
.
๔	๔	D E
UTF8
๔	๔	E I
)
๔	๔	I J
;
๔	๔	J K
return
๕	๕	 
true
๕	๕	 
;
๕	๕	  
}
๖	๖	 
return
๘	๘	 
false
๘	๘	 
;
๘	๘	 
}
๙	๙	 
catch
๚	๚	 
(
๚	๚	 
	Exception
๚	๚	 
)
๚	๚	 
{
๚	๚	 
return
๛	๛	 
false
๛	๛	 
;
๛	๛	 
}
		 
}
		 	
private


 
static


 
string


  
GetChangeTypeEmoji


 0
(


0 1
string


1 7

changeType


8 B
)


B C
{


D E
switch


 
(


 

changeType


 
.


 
ToLower


 &
(


& '
)


' (
)


( )
{


* +
case


 
$str


 
:


 
return


 $
$str


% (
;


( )
case


 
$str


 
:


  
return


! '
$str


( ,
;


, -
case


 
$str


 !
:


! "
return


# )
$str


* .
;


. /
case


 
$str


 
:


 
return


 $
$str


% )
;


) *
case


 
$str


 
:


  
return


! '
$str


( +
;


+ ,
case


 
$str


 !
:


! "
return


# )
$str


* .
;


. /
case


 
$str


 
:


 
return


  &
$str


' ,
;


, -
default


 
:


 
return


 
$str


  $
;


$ %
}


 
}


 	
private


 
static


 
string


 (
UpdateLastUpdatedTimestamp


 8
(


8 9
string


9 ?
content


@ G
,


G H
string


I O
newDate


P W
)


W X
{


Y Z
var


 
timestampPattern


  
=


! "
$str


# O
;


O P
var


 
replacement


 
=


 
$"


  
$str


  2
{


2 3
newDate


3 :
}


: ;
"


; <
;


< =
return


 
Regex


 
.


 
Replace


  
(


  !
content


! (
,


( )
timestampPattern


* :
,


: ;
replacement


< G
)


G H
;


H I
}


 	
public
ฆ
ฆ
 
static
ฆ
ฆ
 
List
ฆ
ฆ
 
<
ฆ
ฆ
 (
ModuleUpdateRecommendation
ฆ
ฆ
 5
>
ฆ
ฆ
5 6,
GetModuleUpdateRecommendations
ฆ
ฆ
7 U
(
ฆ
ฆ
U V
IEnumerable
ฆ
ฆ
V a
<
ฆ
ฆ
a b
string
ฆ
ฆ
b h
>
ฆ
ฆ
h i
changedFiles
ฆ
ฆ
j v
)
ฆ
ฆ
v w
{
ฆ
ฆ
x y
try
ง
ง
 
{
ง
ง
 
var
จ
จ
 
moduleChanges
จ
จ
 !
=
จ
จ
" #
ProjectAnalyzer
จ
จ
$ 3
.
จ
จ
3 4!
DetectModuleChanges
จ
จ
4 G
(
จ
จ
G H
changedFiles
จ
จ
H T
)
จ
จ
T U
;
จ
จ
U V
return
ฉ
ฉ
 
ProjectAnalyzer
ฉ
ฉ
 &
.
ฉ
ฉ
& '#
AnalyzeModuleActivity
ฉ
ฉ
' <
(
ฉ
ฉ
< =
moduleChanges
ฉ
ฉ
= J
)
ฉ
ฉ
J K
;
ฉ
ฉ
K L
}
ช
ช
 
catch
ซ
ซ
 
(
ซ
ซ
 
	Exception
ซ
ซ
 
)
ซ
ซ
 
{
ซ
ซ
 
return
ฌ
ฌ
 
new
ฌ
ฌ
 
List
ฌ
ฌ
 
<
ฌ
ฌ
  (
ModuleUpdateRecommendation
ฌ
ฌ
  :
>
ฌ
ฌ
: ;
(
ฌ
ฌ
; <
)
ฌ
ฌ
< =
;
ฌ
ฌ
= >
}
ญ
ญ
 
}
ฎ
ฎ
 	
public
ถ
ถ
 
static
ถ
ถ
 
int
ถ
ถ
 0
"ProcessModuleUpdateRecommendations
ถ
ถ
 <
(
ถ
ถ
< =
List
ถ
ถ
= A
<
ถ
ถ
A B(
ModuleUpdateRecommendation
ถ
ถ
B \
>
ถ
ถ
\ ]
recommendations
ถ
ถ
^ m
)
ถ
ถ
m n
{
ถ
ถ
o p
var
ท
ท
 
processedCount
ท
ท
 
=
ท
ท
  
$num
ท
ท
! "
;
ท
ท
" #
foreach
น
น
 
(
น
น
 
var
น
น
 
recommendation
น
น
 '
in
น
น
( *
recommendations
น
น
+ :
)
น
น
: ;
{
น
น
< =
try
บ
บ
 
{
บ
บ
 
if
ป
ป
 
(
ป
ป
 
!
ป
ป
 
recommendation
ป
ป
 '
.
ป
ป
' (
SummaryExists
ป
ป
( 5
)
ป
ป
5 6
{
ป
ป
7 8
var
ฝ
ฝ
 
initialChanges
ฝ
ฝ
 *
=
ฝ
ฝ
+ ,
string
ฝ
ฝ
- 3
.
ฝ
ฝ
3 4
Join
ฝ
ฝ
4 8
(
ฝ
ฝ
8 9
$str
ฝ
ฝ
9 =
,
ฝ
ฝ
= >
recommendation
ฝ
ฝ
? M
.
ฝ
ฝ
M N
Changes
ฝ
ฝ
N U
)
ฝ
ฝ
U V
;
ฝ
ฝ
V W
var
พ
พ
 
success
พ
พ
 #
=
พ
พ
$ %)
CreateModuleSummaryEnhanced
พ
พ
& A
(
พ
พ
A B
recommendation
พ
พ
B P
.
พ
พ
P Q

ModuleName
พ
พ
Q [
,
พ
พ
[ \
initialChanges
พ
พ
] k
)
พ
พ
k l
;
พ
พ
l m
if
ฟ
ฟ
 
(
ฟ
ฟ
 
success
ฟ
ฟ
 #
)
ฟ
ฟ
# $
processedCount
ฟ
ฟ
% 3
++
ฟ
ฟ
3 5
;
ฟ
ฟ
5 6
}
ภ
ภ
 
else
ม
ม
 
{
ม
ม
 
var
ร
ร
 
changes
ร
ร
 #
=
ร
ร
$ %
string
ร
ร
& ,
.
ร
ร
, -
Join
ร
ร
- 1
(
ร
ร
1 2
$str
ร
ร
2 6
,
ร
ร
6 7
recommendation
ร
ร
8 F
.
ร
ร
F G
Changes
ร
ร
G N
)
ร
ร
N O
;
ร
ร
O P
var
ฤ
ฤ
 

changeType
ฤ
ฤ
 &
=
ฤ
ฤ
' (!
DetermineChangeType
ฤ
ฤ
) <
(
ฤ
ฤ
< =
recommendation
ฤ
ฤ
= K
.
ฤ
ฤ
K L
Changes
ฤ
ฤ
L S
)
ฤ
ฤ
S T
;
ฤ
ฤ
T U
var
ล
ล
 
success
ล
ล
 #
=
ล
ล
$ %)
UpdateModuleSummaryEnhanced
ล
ล
& A
(
ล
ล
A B
recommendation
ล
ล
B P
.
ล
ล
P Q

ModuleName
ล
ล
Q [
,
ล
ล
[ \
changes
ล
ล
] d
,
ล
ล
d e

changeType
ล
ล
f p
)
ล
ล
p q
;
ล
ล
q r
if
ฦ
ฦ
 
(
ฦ
ฦ
 
success
ฦ
ฦ
 #
)
ฦ
ฦ
# $
processedCount
ฦ
ฦ
% 3
++
ฦ
ฦ
3 5
;
ฦ
ฦ
5 6
}
ว
ว
 
}
ศ
ศ
 
catch
ษ
ษ
 
(
ษ
ษ
 
	Exception
ษ
ษ
  
)
ษ
ษ
  !
{
ษ
ษ
" #
continue
ห
ห
 
;
ห
ห
 
}
ฬ
ฬ
 
}
อ
อ
 
return
ฯ
ฯ
 
processedCount
ฯ
ฯ
 !
;
ฯ
ฯ
! "
}
ะ
ะ
 	
private
ุ
ุ
 
static
ุ
ุ
 
string
ุ
ุ
 !
DetermineChangeType
ุ
ุ
 1
(
ุ
ุ
1 2
List
ุ
ุ
2 6
<
ุ
ุ
6 7
string
ุ
ุ
7 =
>
ุ
ุ
= >
changes
ุ
ุ
? F
)
ุ
ุ
F G
{
ุ
ุ
H I
if
ู
ู
 
(
ู
ู
 
changes
ู
ู
 
.
ู
ู
 
Any
ู
ู
 
(
ู
ู
 
c
ู
ู
 
=>
ู
ู
  
c
ู
ู
! "
.
ู
ู
" #
Contains
ู
ู
# +
(
ู
ู
+ ,
$str
ู
ู
, 3
)
ู
ู
3 4
)
ู
ู
4 5
)
ู
ู
5 6
return
ฺ
ฺ
 
$str
ฺ
ฺ
 
;
ฺ
ฺ
 
if


 
(


 
changes


 
.


 
Any


 
(


 
c


 
=>


  
c


! "
.


" #
Contains


# +
(


+ ,
$str


, 6
)


6 7
||


8 :
c


; <
.


< =
Contains


= E
(


E F
$str


F P
)


P Q
)


Q R
)


R S
return


 
$str


 !
;


! "
if


 
(


 
changes


 
.


 
Any


 
(


 
c


 
=>


  
c


! "
.


" #
Contains


# +
(


+ ,
$str


, 3
)


3 4
||


5 7
c


8 9
.


9 :
Contains


: B
(


B C
$str


C N
)


N O
)


O P
)


P Q
return


 
$str


 
;


 
if
฿
฿
 
(
฿
฿
 
changes
฿
฿
 
.
฿
฿
 
Any
฿
฿
 
(
฿
฿
 
c
฿
฿
 
=>
฿
฿
  
c
฿
฿
! "
.
฿
฿
" #
Contains
฿
฿
# +
(
฿
฿
+ ,
$str
฿
฿
, 6
)
฿
฿
6 7
)
฿
฿
7 8
)
฿
฿
8 9
return
เ
เ
 
$str
เ
เ
 #
;
เ
เ
# $
return
โ
โ
 
$str
โ
โ
 
;
โ
โ
 
}
ใ
ใ
 	
}
ๆ
ๆ
 
}็
็
 ญๅ
=C:\Playnite\_github\OstPlayer\source\DevTools\DevToolsDemo.cs
	namespace-- 	
	OstPlayer--
 
.-- 
DevTools-- 
{-- 
public11 

static11 
class11 
DevToolsDemo11 $
{11% &
public55 
static55 
async55 
Task55   
RunComprehensiveDemo55! 5
(555 6
)556 7
{558 9
Console66 
.66 
	WriteLine66 
(66 
$str66 Q
)66Q R
;66R S
Console77 
.77 
	WriteLine77 
(77 
$str77 P
)77P Q
;77Q R
await99 
DemoCodeGeneration99 $
(99$ %
)99% &
;99& '
await:: 
DemoTemplateEngine:: $
(::$ %
)::% &
;::& '
await;;  
DemoAIAssistantHooks;; &
(;;& '
);;' (
;;;( )
DemoConfiguration<< 
(<< 
)<< 
;<<  %
DemoPerformanceBenchmarks== %
(==% &
)==& '
;==' (
Console?? 
.?? 
	WriteLine?? 
(?? 
$str?? R
)??R S
;??S T
}@@ 	
privateEE 
staticEE 
TaskEE 
DemoCodeGenerationEE .
(EE. /
)EE/ 0
{EE1 2
ConsoleFF 
.FF 
	WriteLineFF 
(FF 
$strFF @
)FF@ A
;FFA B
ConsoleGG 
.GG 
	WriteLineGG 
(GG 
$strGG >
)GG> ?
;GG? @
varJJ 
headerJJ 
=JJ 
CodeGeneratorJJ &
.JJ& '
GenerateFileHeaderJJ' 9
(JJ9 :
$strKK  
,KK  !
$strLL 
,LL 
$strMM L
)MML M
;MMM N
ConsoleOO 
.OO 
	WriteLineOO 
(OO 
$strOO 6
)OO6 7
;OO7 8
ConsolePP 
.PP 
	WriteLinePP 
(PP 
headerPP $
.PP$ %
	SubstringPP% .
(PP. /
$numPP/ 0
,PP0 1
MathPP2 6
.PP6 7
MinPP7 :
(PP: ;
$numPP; >
,PP> ?
headerPP@ F
.PPF G
LengthPPG M
)PPM N
)PPN O
+PPP Q
$strPPR W
)PPW X
;PPX Y
varSS 
	methodDocSS 
=SS 
CodeGeneratorSS )
.SS) *'
GenerateMethodDocumentationSS* E
(SSE F
$strTT U
,TTU V
$strUU L
)UUL M
;UUM N
ConsoleWW 
.WW 
	WriteLineWW 
(WW 
$strWW A
)WWA B
;WWB C
ConsoleXX 
.XX 
	WriteLineXX 
(XX 
	methodDocXX '
)XX' (
;XX( )
var[[ 
classDoc[[ 
=[[ 
CodeGenerator[[ (
.[[( )&
GenerateClassDocumentation[[) C
([[C D
$str\\ 
,\\ 
$str]] M
,]]M N
new^^ 
List^^ 
<^^ 
string^^ 
>^^  
{^^! "
$str^^# 7
,^^7 8
$str^^9 F
,^^F G
$str^^H ^
}^^_ `
,^^` a
new__ 
List__ 
<__ 
string__ 
>__  
{__! "
$str__# ;
,__; <
$str__= M
}__N O
)__O P
;__P Q
Consoleaa 
.aa 
	WriteLineaa 
(aa 
$straa >
)aa> ?
;aa? @
Consolebb 
.bb 
	WriteLinebb 
(bb 
classDocbb &
)bb& '
;bb' (
returndd 
Taskdd 
.dd 
CompletedTaskdd %
;dd% &
}ee 	
privatejj 
staticjj 
Taskjj 
DemoTemplateEnginejj .
(jj. /
)jj/ 0
{jj1 2
Consolekk 
.kk 
	WriteLinekk 
(kk 
$strkk A
)kkA B
;kkB C
Consolell 
.ll 
	WriteLinell 
(ll 
$strll ?
)ll? @
;ll@ A
varoo 
	templatesoo 
=oo 
TemplateEngineoo *
.oo* +!
GetAvailableTemplatesoo+ @
(oo@ A
)ooA B
;ooB C
Consolepp 
.pp 
	WriteLinepp 
(pp 
$"pp  
$strpp  5
{pp5 6
	templatespp6 ?
.pp? @
Countpp@ E
}ppE F
"ppF G
)ppG H
;ppH I
foreachrr 
(rr 
varrr 
templaterr !
inrr" $
	templatesrr% .
)rr. /
{rr0 1
Consoless 
.ss 
	WriteLiness !
(ss! "
$"ss" $
$strss$ (
{ss( )
templatess) 1
.ss1 2
Namess2 6
}ss6 7
$strss7 9
{ss9 :
templatess: B
.ssB C
CategoryssC K
}ssK L
$strssL O
{ssO P
templatessP X
.ssX Y
DescriptionssY d
}ssd e
"sse f
)ssf g
;ssg h
}tt 
varww 

parametersww 
=ww 
newww  

Dictionaryww! +
<ww+ ,
stringww, 2
,ww2 3
objectww4 :
>ww: ;
{ww< =
[xx 
$strxx 
]xx 
=xx 
$strxx  /
,xx/ 0
[yy 
$stryy 
]yy 
=yy 
$stryy  ;
,yy; <
[zz 
$strzz '
]zz' (
=zz) *
$strzz+ S
,zzS T
[{{ 
$str{{ 
]{{ 
={{ 
true{{  $
,{{$ %
[|| 
$str||  
]||  !
=||" #
true||$ (
,||( )
[}} 
$str}} 
]}} 
=}}  !
true}}" &
,}}& '
[~~ 
$str~~ 
]~~ 
=~~ 
new~~  
[~~  !
]~~! "
{ 
new
 
{
 
Type
 
=
  
$str
! )
,
) *
Name
+ /
=
0 1
$str
2 9
}
: ;
,
; <
new
 
{
 
Type
 
=
  
$str
! '
,
' (
Name
) -
=
. /
$str
0 ;
}
< =
}
 
,
 
[
 
$str
 
]
 
=
  
new
! $
[
$ %
]
% &
{
 
new
 
{
 
Type
 
=
  
$str
! )
,
) *
Name
+ /
=
0 1
$str
2 9
,
9 :
Description
; F
=
G H
$str
I f
}
g h
,
h i
new
 
{
 
Type
 
=
  
$str
! '
,
' (
Name
) -
=
. /
$str
0 ;
,
; <
Description
= H
=
I J
$str
K g
}
h i
}
 
,
 
[
 
$str
 
]
 
=
 
new
 "
[
" #
]
# $
{
 
new
 
{
 
Name
 
=
  
$str
! '
,
' (
Description
) 4
=
5 6
$str
7 H
,
H I
ExecuteMethod
J W
=
X Y
$str
Z d
}
e f
}
 
}
 
;
 
var
 
generatedCode
 
=
 
TemplateEngine
  .
.
. /"
GenerateFromTemplate
/ C
(
C D
$str
D O
,
O P

parameters
Q [
)
[ \
;
\ ]
if
 
(
 
!
 
string
 
.
 
IsNullOrEmpty
 %
(
% &
generatedCode
& 3
)
3 4
)
4 5
{
6 7
Console
 
.
 
	WriteLine
 !
(
! "
$str
" ?
)
? @
;
@ A
Console
 
.
 
	WriteLine
 !
(
! "
generatedCode
" /
.
/ 0
	Substring
0 9
(
9 :
$num
: ;
,
; <
Math
= A
.
A B
Min
B E
(
E F
$num
F I
,
I J
generatedCode
K X
.
X Y
Length
Y _
)
_ `
)
` a
+
b c
$str
d i
)
i j
;
j k
}
 
var
 
sampleTemplate
 
=
  
$str
! J
;
J K
var
 
isValid
 
=
 
TemplateEngine
 (
.
( )
ValidateTemplate
) 9
(
9 :
sampleTemplate
: H
)
H I
;
I J
Console
 
.
 
	WriteLine
 
(
 
$"
  
$str
  <
{
< =
(
= >
isValid
> E
?
F G
$str
H Q
:
R S
$str
T _
)
_ `
}
` a
"
a b
)
b c
;
c d
return
 
Task
 
.
 
CompletedTask
 %
;
% &
}
 	
private
 
static
 
async
 
Task
 !"
DemoAIAssistantHooks
" 6
(
6 7
)
7 8
{
9 :
Console
กก 
.
กก 
	WriteLine
กก 
(
กก 
$str
กก C
)
กกC D
;
กกD E
Console
ขข 
.
ขข 
	WriteLine
ขข 
(
ขข 
$str
ขข @
)
ขข@ A
;
ขขA B
AIAssistantHooks
ฅฅ 
.
ฅฅ $
RegisterFileChangeHook
ฅฅ 3
(
ฅฅ3 4
$str
ฅฅ4 <
,
ฅฅ< =
async
ฅฅ> C
(
ฅฅD E
filePath
ฅฅE M
)
ฅฅM N
=>
ฅฅO Q
{
ฅฅR S
Console
ฆฆ 
.
ฆฆ 
	WriteLine
ฆฆ !
(
ฆฆ! "
$"
ฆฆ" $
$str
ฆฆ$ ?
{
ฆฆ? @
filePath
ฆฆ@ H
}
ฆฆH I
"
ฆฆI J
)
ฆฆJ K
;
ฆฆK L
await
งง 
Task
งง 
.
งง 
Delay
งง  
(
งง  !
$num
งง! #
)
งง# $
;
งง$ %
}
จจ 
)
จจ 
;
จจ 
AIAssistantHooks
ชช 
.
ชช !
RegisterContextHook
ชช 0
(
ชช0 1
$str
ชช1 7
,
ชช7 8
async
ชช9 >
(
ชช? @
	aiContext
ชช@ I
)
ชชI J
=>
ชชK M
{
ชชN O
Console
ซซ 
.
ซซ 
	WriteLine
ซซ !
(
ซซ! "
$"
ซซ" $
$str
ซซ$ A
{
ซซA B
	aiContext
ซซB K
.
ซซK L
CurrentOperation
ซซL \
}
ซซ\ ]
"
ซซ] ^
)
ซซ^ _
;
ซซ_ `
await
ฌฌ 
Task
ฌฌ 
.
ฌฌ 
Delay
ฌฌ  
(
ฌฌ  !
$num
ฌฌ! #
)
ฌฌ# $
;
ฌฌ$ %
}
ญญ 
)
ญญ 
;
ญญ 
await
ฐฐ 
AIAssistantHooks
ฐฐ "
.
ฐฐ" #(
TriggerDocumentationUpdate
ฐฐ# =
(
ฐฐ= >
$str
ฐฐ> K
,
ฐฐK L
new
ฐฐM P
[
ฐฐP Q
]
ฐฐQ R
{
ฐฐS T
$str
ฐฐU ^
}
ฐฐ_ `
)
ฐฐ` a
;
ฐฐa b
await
ฒฒ 
AIAssistantHooks
ฒฒ "
.
ฒฒ" ##
TriggerCodeGeneration
ฒฒ# 8
(
ฒฒ8 9
$str
ฒฒ9 ?
,
ฒฒ? @
new
ฒฒA D

Dictionary
ฒฒE O
<
ฒฒO P
string
ฒฒP V
,
ฒฒV W
object
ฒฒX ^
>
ฒฒ^ _
{
ฒฒ` a
[
ณณ 
$str
ณณ 
]
ณณ 
=
ณณ 
$str
ณณ "
,
ณณ" #
[
ดด 
$str
ดด 
]
ดด 
=
ดด 
$str
ดด &
}
ตต 
)
ตต 
;
ตต 
var
ธธ 
context
ธธ 
=
ธธ 
AIAssistantHooks
ธธ *
.
ธธ* +
GetCurrentContext
ธธ+ <
(
ธธ< =
)
ธธ= >
;
ธธ> ?
Console
นน 
.
นน 
	WriteLine
นน 
(
นน 
$"
นน  
$str
นน  4
{
นน4 5
context
นน5 <
.
นน< =
CurrentOperation
นน= M
}
นนM N
"
นนN O
)
นนO P
;
นนP Q
Console
บบ 
.
บบ 
	WriteLine
บบ 
(
บบ 
$"
บบ  
$str
บบ  .
{
บบ. /
context
บบ/ 6
.
บบ6 7
LastUpdated
บบ7 B
}
บบB C
"
บบC D
)
บบD E
;
บบE F
Console
ปป 
.
ปป 
	WriteLine
ปป 
(
ปป 
$"
ปป  
$str
ปป  3
{
ปป3 4
context
ปป4 ;
.
ปป; <
OperationHistory
ปป< L
.
ปปL M
Count
ปปM R
}
ปปR S
$str
ปปS [
"
ปป[ \
)
ปป\ ]
;
ปป] ^
var
พพ 
stats
พพ 
=
พพ 
AIAssistantHooks
พพ (
.
พพ( )!
GetActionStatistics
พพ) <
(
พพ< =
)
พพ= >
;
พพ> ?
Console
ฟฟ 
.
ฟฟ 
	WriteLine
ฟฟ 
(
ฟฟ 
$str
ฟฟ 7
)
ฟฟ7 8
;
ฟฟ8 9
foreach
ภภ 
(
ภภ 
var
ภภ 
stat
ภภ 
in
ภภ  
stats
ภภ! &
)
ภภ& '
{
ภภ( )
Console
มม 
.
มม 
	WriteLine
มม !
(
มม! "
$"
มม" $
$str
มม$ &
{
มม& '
stat
มม' +
.
มม+ ,
Key
มม, /
}
มม/ 0
$str
มม0 2
{
มม2 3
stat
มม3 7
.
มม7 8
Value
มม8 =
}
มม= >
"
มม> ?
)
มม? @
;
มม@ A
}
ยย 
}
รร 	
private
ศศ 
static
ศศ 
void
ศศ 
DemoConfiguration
ศศ -
(
ศศ- .
)
ศศ. /
{
ศศ0 1
Console
ษษ 
.
ษษ 
	WriteLine
ษษ 
(
ษษ 
$str
ษษ A
)
ษษA B
;
ษษB C
Console
สส 
.
สส 
	WriteLine
สส 
(
สส 
$str
สส ?
)
สส? @
;
สส@ A
var
ออ 
config
ออ 
=
ออ 
DevToolsConfig
ออ '
.
ออ' (
GetConfiguration
ออ( 8
(
ออ8 9
)
ออ9 :
;
ออ: ;
Console
ฮฮ 
.
ฮฮ 
	WriteLine
ฮฮ 
(
ฮฮ 
$"
ฮฮ  
$str
ฮฮ  ;
{
ฮฮ; <
config
ฮฮ< B
.
ฮฮB C%
AutoUpdateDocumentation
ฮฮC Z
}
ฮฮZ [
"
ฮฮ[ \
)
ฮฮ\ ]
;
ฮฮ] ^
Console
ฯฯ 
.
ฯฯ 
	WriteLine
ฯฯ 
(
ฯฯ 
$"
ฯฯ  
$str
ฯฯ  1
{
ฯฯ1 2
config
ฯฯ2 8
.
ฯฯ8 9
EnableAIHooks
ฯฯ9 F
}
ฯฯF G
"
ฯฯG H
)
ฯฯH I
;
ฯฯI J
Console
ะะ 
.
ะะ 
	WriteLine
ะะ 
(
ะะ 
$"
ะะ  
$str
ะะ  -
{
ะะ- .
config
ะะ. 4
.
ะะ4 5

DateFormat
ะะ5 ?
}
ะะ? @
"
ะะ@ A
)
ะะA B
;
ะะB C
Console
ัั 
.
ัั 
	WriteLine
ัั 
(
ัั 
$"
ัั  
$str
ัั  0
{
ัั0 1
config
ัั1 7
.
ัั7 8
DefaultAuthor
ัั8 E
}
ััE F
"
ััF G
)
ััG H
;
ััH I
var
ิิ 
enableSuggestions
ิิ !
=
ิิ" #
DevToolsConfig
ิิ$ 2
.
ิิ2 3
GetValue
ิิ3 ;
(
ิิ; <
$str
ิิ< X
,
ิิX Y
false
ิิZ _
)
ิิ_ `
;
ิิ` a
Console
ีี 
.
ีี 
	WriteLine
ีี 
(
ีี 
$"
ีี  
$str
ีี  0
{
ีี0 1
enableSuggestions
ีี1 B
}
ีีB C
"
ีีC D
)
ีีD E
;
ีีE F
DevToolsConfig
ุุ 
.
ุุ 
SetValue
ุุ #
(
ุุ# $
$str
ุุ$ 1
,
ุุ1 2
$str
ุุ3 ?
)
ุุ? @
;
ุุ@ A
var
ูู 
	demoValue
ูู 
=
ูู 
DevToolsConfig
ูู *
.
ูู* +
GetValue
ูู+ 3
<
ูู3 4
string
ูู4 :
>
ูู: ;
(
ูู; <
$str
ูู< I
)
ููI J
;
ููJ K
Console
ฺฺ 
.
ฺฺ 
	WriteLine
ฺฺ 
(
ฺฺ 
$"
ฺฺ  
$str
ฺฺ  .
{
ฺฺ. /
	demoValue
ฺฺ/ 8
}
ฺฺ8 9
"
ฺฺ9 :
)
ฺฺ: ;
;
ฺฺ; <
var
 
profiles
 
=
 
DevToolsConfig
 )
.
) *"
GetAvailableProfiles
* >
(
> ?
)
? @
;
@ A
Console
 
.
 
	WriteLine
 
(
 
$"
  
$str
  4
{
4 5
profiles
5 =
.
= >
Count
> C
}
C D
"
D E
)
E F
;
F G
}
฿฿ 	
private
ไไ 
static
ไไ 
void
ไไ '
DemoPerformanceBenchmarks
ไไ 5
(
ไไ5 6
)
ไไ6 7
{
ไไ8 9
Console
ๅๅ 
.
ๅๅ 
	WriteLine
ๅๅ 
(
ๅๅ 
$str
ๅๅ ;
)
ๅๅ; <
;
ๅๅ< =
Console
ๆๆ 
.
ๆๆ 
	WriteLine
ๆๆ 
(
ๆๆ 
$str
ๆๆ 9
)
ๆๆ9 :
;
ๆๆ: ;
var
้้ 
sw
้้ 
=
้้ 
	Stopwatch
้้ 
.
้้ 
StartNew
้้ '
(
้้' (
)
้้( )
;
้้) *
for
๊๊ 
(
๊๊ 
int
๊๊ 
i
๊๊ 
=
๊๊ 
$num
๊๊ 
;
๊๊ 
i
๊๊ 
<
๊๊ 
$num
๊๊  #
;
๊๊# $
i
๊๊% &
++
๊๊& (
)
๊๊( )
{
๊๊* +
CodeGenerator
๋๋ 
.
๋๋  
GenerateFileHeader
๋๋ 0
(
๋๋0 1
$"
๋๋1 3
$str
๋๋3 ;
{
๋๋; <
i
๋๋< =
}
๋๋= >
$str
๋๋> A
"
๋๋A B
,
๋๋B C
$str
๋๋D N
,
๋๋N O
$str
๋๋P ^
)
๋๋^ _
;
๋๋_ `
}
์์ 
sw
ํํ 
.
ํํ 
Stop
ํํ 
(
ํํ 
)
ํํ 
;
ํํ 
Console
๎๎ 
.
๎๎ 
	WriteLine
๎๎ 
(
๎๎ 
$"
๎๎  
$str
๎๎  ?
{
๎๎? @
sw
๎๎@ B
.
๎๎B C!
ElapsedMilliseconds
๎๎C V
}
๎๎V W
$str
๎๎W Y
"
๎๎Y Z
)
๎๎Z [
;
๎๎[ \
sw
๑๑ 
.
๑๑ 
Restart
๑๑ 
(
๑๑ 
)
๑๑ 
;
๑๑ 
var
๒๒ 
templateParams
๒๒ 
=
๒๒  
new
๒๒! $

Dictionary
๒๒% /
<
๒๒/ 0
string
๒๒0 6
,
๒๒6 7
object
๒๒8 >
>
๒๒> ?
{
๒๒@ A
[
๓๓ 
$str
๓๓ 
]
๓๓ 
=
๓๓ 
$str
๓๓  +
,
๓๓+ ,
[
๔๔ 
$str
๔๔ 
]
๔๔ 
=
๔๔ 
$str
๔๔  0
}
๕๕ 
;
๕๕ 
for
๗๗ 
(
๗๗ 
int
๗๗ 
i
๗๗ 
=
๗๗ 
$num
๗๗ 
;
๗๗ 
i
๗๗ 
<
๗๗ 
$num
๗๗  "
;
๗๗" #
i
๗๗$ %
++
๗๗% '
)
๗๗' (
{
๗๗) *
TemplateEngine
๘๘ 
.
๘๘ "
GenerateFromTemplate
๘๘ 3
(
๘๘3 4
$str
๘๘4 A
,
๘๘A B
templateParams
๘๘C Q
)
๘๘Q R
;
๘๘R S
}
๙๙ 
sw
๚๚ 
.
๚๚ 
Stop
๚๚ 
(
๚๚ 
)
๚๚ 
;
๚๚ 
Console
๛๛ 
.
๛๛ 
	WriteLine
๛๛ 
(
๛๛ 
$"
๛๛  
$str
๛๛  ;
{
๛๛; <
sw
๛๛< >
.
๛๛> ?!
ElapsedMilliseconds
๛๛? R
}
๛๛R S
$str
๛๛S U
"
๛๛U V
)
๛๛V W
;
๛๛W X
sw
 
.
 
Restart
 
(
 
)
 
;
 
for
 
(
 
int
 
i
 
=
 
$num
 
;
 
i
 
<
 
$num
  #
;
# $
i
% &
++
& (
)
( )
{
* +
AIAssistantHooks
  
.
  !
UpdateContext
! .
(
. /
$"
/ 1
$str
1 5
{
5 6
i
6 7
}
7 8
"
8 9
,
9 :
new
; >

Dictionary
? I
<
I J
string
J P
,
P Q
object
R X
>
X Y
{
Z [
[
\ ]
$str
] c
]
c d
=
e f
i
g h
}
i j
)
j k
;
k l
}
 
sw
 
.
 
Stop
 
(
 
)
 
;
 
Console
 
.
 
	WriteLine
 
(
 
$"
  
$str
  ;
{
; <
sw
< >
.
> ?!
ElapsedMilliseconds
? R
}
R S
$str
S U
"
U V
)
V W
;
W X
}
 	
public
 
static
 
async
 
Task
  $
DemoAIWorkflowScenario
! 7
(
7 8
)
8 9
{
: ;
Console
 
.
 
	WriteLine
 
(
 
$str
 B
)
B C
;
C D
Console
 
.
 
	WriteLine
 
(
 
$str
 @
)
@ A
;
A B
Console
 
.
 
	WriteLine
 
(
 
$str
 Y
)
Y Z
;
Z [
Console
 
.
 
	WriteLine
 
(
 
$str
 J
)
J K
;
K L
await
 
AIAssistantHooks
 "
.
" ##
TriggerCodeGeneration
# 8
(
8 9
$str
9 B
,
B C
new
D G

Dictionary
H R
<
R S
string
S Y
,
Y Z
object
[ a
>
a b
{
c d
[
 
$str
 
]
 
=
 
$str
  8
,
8 9
[
 
$str
 
]
 
=
 
$str
 '
,
' (
[
 
$str
 
]
 
=
 
$str
 M
}
 
)
 
;
 
Console
 
.
 
	WriteLine
 
(
 
$str
 A
)
A B
;
B C
var
 
serviceParams
 
=
 
new
  #

Dictionary
$ .
<
. /
string
/ 5
,
5 6
object
7 =
>
= >
{
? @
[
 
$str
 
]
 
=
 
$str
  8
,
8 9
[
 
$str
 
]
 
=
 
$str
  4
,
4 5
[
 
$str
 %
]
% &
=
' (
$str
) e
,
e f
[
 
$str
 "
]
" #
=
$ %
true
& *
,
* +
[
 
$str
 
]
 
=
 
true
 #
,
# $
[
 
$str
 
]
  
=
! "
new
# &
[
& '
]
' (
{
กก 
new
ขข 
{
ขข 
Type
ขข 
=
ขข  
$str
ขข! /
,
ขข/ 0
Name
ขข1 5
=
ขข6 7
$str
ขข8 E
}
ขขF G
,
ขขG H
new
ฃฃ 
{
ฃฃ 
Type
ฃฃ 
=
ฃฃ  
$str
ฃฃ! 5
,
ฃฃ5 6
Name
ฃฃ7 ;
=
ฃฃ< =
$str
ฃฃ> Q
}
ฃฃR S
}
คค 
,
คค 
[
ฅฅ 
$str
ฅฅ 
]
ฅฅ 
=
ฅฅ 
new
ฅฅ !
[
ฅฅ! "
]
ฅฅ" #
{
ฆฆ 
new
งง 
{
งง 
Name
จจ 
=
จจ 
$str
จจ 6
,
จจ6 7

ReturnType
ฉฉ "
=
ฉฉ# $
$str
ฉฉ% :
,
ฉฉ: ;
Description
ชช #
=
ชช$ %
$str
ชช& R
,
ชชR S
IsAsync
ซซ 
=
ซซ  !
true
ซซ" &
,
ซซ& '
ParameterList
ฌฌ %
=
ฌฌ& '
$str
ฌฌ( 9
,
ฌฌ9 :
Body
ญญ 
=
ญญ 
$str
ญญ L
}
ฎฎ 
}
ฏฏ 
}
ฐฐ 
;
ฐฐ 
var
ฒฒ 
serviceCode
ฒฒ 
=
ฒฒ 
TemplateEngine
ฒฒ ,
.
ฒฒ, -"
GenerateFromTemplate
ฒฒ- A
(
ฒฒA B
$str
ฒฒB K
,
ฒฒK L
serviceParams
ฒฒM Z
)
ฒฒZ [
;
ฒฒ[ \
if
ณณ 
(
ณณ 
!
ณณ 
string
ณณ 
.
ณณ 
IsNullOrEmpty
ณณ %
(
ณณ% &
serviceCode
ณณ& 1
)
ณณ1 2
)
ณณ2 3
{
ณณ4 5
Console
ดด 
.
ดด 
	WriteLine
ดด !
(
ดด! "
$str
ดด" P
)
ดดP Q
;
ดดQ R
}
ตต 
Console
ธธ 
.
ธธ 
	WriteLine
ธธ 
(
ธธ 
$str
ธธ >
)
ธธ> ?
;
ธธ? @
var
นน 
header
นน 
=
นน 
CodeGenerator
นน &
.
นน& ' 
GenerateFileHeader
นน' 9
(
นน9 :
$str
บบ +
,
บบ+ ,
$str
ปป 
,
ปป 
$str
ผผ e
,
ผผe f
$str
ฝฝ 
,
ฝฝ 
$str
พพ 
)
พพ 
;
พพ 
var
ภภ 
classDoc
ภภ 
=
ภภ 
CodeGenerator
ภภ (
.
ภภ( )(
GenerateClassDocumentation
ภภ) C
(
ภภC D
$str
มม (
,
มม( )
$str
ยย X
,
ยยX Y
new
รร 
List
รร 
<
รร 
string
รร 
>
รร  
{
รร! "
$str
รร# 4
,
รร4 5
$str
รร6 C
,
รรC D
$str
รรE [
}
รร\ ]
,
รร] ^
new
ฤฤ 
List
ฤฤ 
<
ฤฤ 
string
ฤฤ 
>
ฤฤ  
{
ฤฤ! "
$str
ฤฤ# ;
,
ฤฤ; <
$str
ฤฤ= O
,
ฤฤO P
$str
ฤฤQ ^
}
ฤฤ_ `
)
ฤฤ` a
;
ฤฤa b
Console
ฦฦ 
.
ฦฦ 
	WriteLine
ฦฦ 
(
ฦฦ 
$str
ฦฦ I
)
ฦฦI J
;
ฦฦJ K
Console
ษษ 
.
ษษ 
	WriteLine
ษษ 
(
ษษ 
$str
ษษ D
)
ษษD E
;
ษษE F
await
สส 
AIAssistantHooks
สส "
.
สส" #(
TriggerDocumentationUpdate
สส# =
(
สส= >
$str
หห .
,
หห. /
new
ฬฬ 
[
ฬฬ 
]
ฬฬ 
{
ฬฬ 
$str
ฬฬ <
}
ฬฬ= >
)
ฬฬ> ?
;
ฬฬ? @
Console
ฮฮ 
.
ฮฮ 
	WriteLine
ฮฮ 
(
ฮฮ 
$str
ฮฮ B
)
ฮฮB C
;
ฮฮC D
AIAssistantHooks
ัั 
.
ัั 
LogAIAction
ัั (
(
ัั( )
$str
ัั) ?
,
ัั? @
true
ััA E
,
ััE F
$str
าา Q
)
าาQ R
;
าาR S
Console
ิิ 
.
ิิ 
	WriteLine
ิิ 
(
ิิ 
$str
ิิ Q
)
ิิQ R
;
ิิR S
Console
ีี 
.
ีี 
	WriteLine
ีี 
(
ีี 
$str
ีี 3
)
ีี3 4
;
ีี4 5
Console
ึึ 
.
ึึ 
	WriteLine
ึึ 
(
ึึ 
$str
ึึ B
)
ึึB C
;
ึึC D
Console
ืื 
.
ืื 
	WriteLine
ืื 
(
ืื 
$str
ืื ?
)
ืื? @
;
ืื@ A
Console
ุุ 
.
ุุ 
	WriteLine
ุุ 
(
ุุ 
$str
ุุ =
)
ุุ= >
;
ุุ> ?
Console
ูู 
.
ูู 
	WriteLine
ูู 
(
ูู 
$str
ูู 7
)
ูู7 8
;
ูู8 9
}
ฺฺ 	
}
 
} ฦ
?C:\Playnite\_github\OstPlayer\source\DevTools\DevToolsConfig.cs
	namespaceSS 	
	OstPlayerSS
 
.SS 
DevToolsSS 
{SS 
publicWW 

staticWW 
classWW 
DevToolsConfigWW &
{WW' (
privateYY 
staticYY 
readonlyYY 
stringYY  &
ConfigFilePathYY' 5
=YY6 7
$strYY8 N
;YYN O
private\\ 
static\\ !
DevToolsConfiguration\\ ,
_configuration\\- ;
;\\; <
private]] 
static]] 
readonly]] 
object]]  &
_configLock]]' 2
=]]3 4
new]]5 8
object]]9 ?
(]]? @
)]]@ A
;]]A B
private^^ 
static^^ 
DateTime^^ 
_lastConfigLoad^^  /
=^^0 1
DateTime^^2 :
.^^: ;
MinValue^^; C
;^^C D
publicaa 
staticaa 
eventaa 
Actionaa "
<aa" #!
DevToolsConfigurationaa# 8
>aa8 9 
ConfigurationChangedaa: N
;aaN O
staticcc 
DevToolsConfigcc 
(cc 
)cc 
{cc  !
LoadConfigurationdd 
(dd 
)dd 
;dd  
}ee 	
publickk 
statickk !
DevToolsConfigurationkk +
GetConfigurationkk, <
(kk< =
)kk= >
{kk? @
lockll 
(ll 
_configLockll 
)ll 
{ll  
ifnn 
(nn 
Filenn 
.nn 
Existsnn 
(nn  
ConfigFilePathnn  .
)nn. /
)nn/ 0
{nn1 2
varoo 
	lastWriteoo !
=oo" #
Fileoo$ (
.oo( )
GetLastWriteTimeoo) 9
(oo9 :
ConfigFilePathoo: H
)ooH I
;ooI J
ifpp 
(pp 
	lastWritepp !
>pp" #
_lastConfigLoadpp$ 3
)pp3 4
{pp5 6
LoadConfigurationqq )
(qq) *
)qq* +
;qq+ ,
}rr 
}ss 
returnuu 
_configurationuu %
??uu& (&
CreateDefaultConfigurationuu) C
(uuC D
)uuD E
;uuE F
}vv 
}ww 	
public~~ 
static~~ 
bool~~ 
UpdateConfiguration~~ .
(~~. /!
DevToolsConfiguration~~/ D
newConfiguration~~E U
)~~U V
{~~W X
try 
{ 
lock
 
(
 
_configLock
 !
)
! "
{
# $
if
 
(
 #
ValidateConfiguration
 -
(
- .
newConfiguration
. >
)
> ?
)
? @
{
A B
_configuration
 &
=
' (
newConfiguration
) 9
;
9 :
SaveConfiguration
 )
(
) *
)
* +
;
+ ,"
ConfigurationChanged
 ,
?
, -
.
- .
Invoke
. 4
(
4 5
_configuration
5 C
)
C D
;
D E
return
 
true
 #
;
# $
}
 
}
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
}
 
return
 
false
 
;
 
}
 	
public
 
static
 
T
 
GetValue
  
<
  !
T
! "
>
" #
(
# $
string
$ *
key
+ .
,
. /
T
0 1
defaultValue
2 >
=
? @
default
A H
(
H I
T
I J
)
J K
)
K L
{
M N
var
 
config
 
=
 
GetConfiguration
 )
(
) *
)
* +
;
+ ,
if
 
(
 
config
 
.
 
CustomSettings
 %
.
% &
ContainsKey
& 1
(
1 2
key
2 5
)
5 6
)
6 7
{
8 9
try
 
{
 
var
 
value
 
=
 
config
  &
.
& '
CustomSettings
' 5
[
5 6
key
6 9
]
9 :
;
: ;
if
 
(
 
value
 
is
  
T
! "

typedValue
# -
)
- .
{
/ 0
return
 

typedValue
 )
;
) *
}
 
return
ขข 
(
ขข 
T
ขข 
)
ขข 
Convert
ขข %
.
ขข% &

ChangeType
ขข& 0
(
ขข0 1
value
ขข1 6
,
ขข6 7
typeof
ขข8 >
(
ขข> ?
T
ขข? @
)
ขข@ A
)
ขขA B
;
ขขB C
}
ฃฃ 
catch
คค 
(
คค 
	Exception
คค  
)
คค  !
{
คค" #
return
ฅฅ 
defaultValue
ฅฅ '
;
ฅฅ' (
}
ฆฆ 
}
งง 
return
ฉฉ 
defaultValue
ฉฉ 
;
ฉฉ  
}
ชช 	
public
ฒฒ 
static
ฒฒ 
bool
ฒฒ 
SetValue
ฒฒ #
(
ฒฒ# $
string
ฒฒ$ *
key
ฒฒ+ .
,
ฒฒ. /
object
ฒฒ0 6
value
ฒฒ7 <
)
ฒฒ< =
{
ฒฒ> ?
try
ณณ 
{
ณณ 
var
ดด 
config
ดด 
=
ดด 
GetConfiguration
ดด -
(
ดด- .
)
ดด. /
;
ดด/ 0
config
ตต 
.
ตต 
CustomSettings
ตต %
[
ตต% &
key
ตต& )
]
ตต) *
=
ตต+ ,
value
ตต- 2
;
ตต2 3
return
ถถ !
UpdateConfiguration
ถถ *
(
ถถ* +
config
ถถ+ 1
)
ถถ1 2
;
ถถ2 3
}
ทท 
catch
ธธ 
(
ธธ 
	Exception
ธธ 
)
ธธ 
{
ธธ 
return
นน 
false
นน 
;
นน 
}
บบ 
}
ปป 	
public
มม 
static
มม 
bool
มม 
ResetToDefaults
มม *
(
มม* +
)
มม+ ,
{
มม- .
var
ยย 
defaultConfig
ยย 
=
ยย (
CreateDefaultConfiguration
ยย  :
(
ยย: ;
)
ยย; <
;
ยย< =
return
รร !
UpdateConfiguration
รร &
(
รร& '
defaultConfig
รร' 4
)
รร4 5
;
รร5 6
}
ฤฤ 	
public
หห 
static
หห 
bool
หห !
BackupConfiguration
หห .
(
หห. /
string
หห/ 5

backupPath
หห6 @
=
หหA B
null
หหC G
)
หหG H
{
หหI J
try
ฬฬ 
{
ฬฬ 

backupPath
ออ 
=
ออ 

backupPath
ออ '
??
ออ( *
$"
ออ+ -
$str
ออ- D
{
ออD E
DateTime
ออE M
.
ออM N
Now
ออN Q
:
ออQ R
$str
ออR a
}
ออa b
$str
ออb g
"
ออg h
;
ออh i
var
ฯฯ 
config
ฯฯ 
=
ฯฯ 
GetConfiguration
ฯฯ -
(
ฯฯ- .
)
ฯฯ. /
;
ฯฯ/ 0
var
ะะ 
json
ะะ 
=
ะะ $
SerializeConfiguration
ะะ 1
(
ะะ1 2
config
ะะ2 8
)
ะะ8 9
;
ะะ9 :
var
าา 
	backupDir
าา 
=
าา 
Path
าา  $
.
าา$ %
GetDirectoryName
าา% 5
(
าา5 6

backupPath
าา6 @
)
าา@ A
;
าาA B
if
ำำ 
(
ำำ 
!
ำำ 
string
ำำ 
.
ำำ 
IsNullOrEmpty
ำำ )
(
ำำ) *
	backupDir
ำำ* 3
)
ำำ3 4
&&
ำำ5 7
!
ำำ8 9
	Directory
ำำ9 B
.
ำำB C
Exists
ำำC I
(
ำำI J
	backupDir
ำำJ S
)
ำำS T
)
ำำT U
{
ำำV W
	Directory
ิิ 
.
ิิ 
CreateDirectory
ิิ -
(
ิิ- .
	backupDir
ิิ. 7
)
ิิ7 8
;
ิิ8 9
}
ีี 
File
ืื 
.
ืื 
WriteAllText
ืื !
(
ืื! "

backupPath
ืื" ,
,
ืื, -
json
ืื. 2
,
ืื2 3
Encoding
ืื4 <
.
ืื< =
UTF8
ืื= A
)
ืืA B
;
ืืB C
return
ุุ 
true
ุุ 
;
ุุ 
}
ูู 
catch
ฺฺ 
(
ฺฺ 
	Exception
ฺฺ 
)
ฺฺ 
{
ฺฺ 
return
 
false
 
;
 
}
 
}
 	
public
ไไ 
static
ไไ 
bool
ไไ "
RestoreConfiguration
ไไ /
(
ไไ/ 0
string
ไไ0 6

backupPath
ไไ7 A
)
ไไA B
{
ไไC D
try
ๅๅ 
{
ๅๅ 
if
ๆๆ 
(
ๆๆ 
!
ๆๆ 
File
ๆๆ 
.
ๆๆ 
Exists
ๆๆ  
(
ๆๆ  !

backupPath
ๆๆ! +
)
ๆๆ+ ,
)
ๆๆ, -
{
ๆๆ. /
return
็็ 
false
็็  
;
็็  !
}
่่ 
var
๊๊ 
json
๊๊ 
=
๊๊ 
File
๊๊ 
.
๊๊  
ReadAllText
๊๊  +
(
๊๊+ ,

backupPath
๊๊, 6
,
๊๊6 7
Encoding
๊๊8 @
.
๊๊@ A
UTF8
๊๊A E
)
๊๊E F
;
๊๊F G
var
๋๋ 
config
๋๋ 
=
๋๋ &
DeserializeConfiguration
๋๋ 5
(
๋๋5 6
json
๋๋6 :
)
๋๋: ;
;
๋๋; <
if
ํํ 
(
ํํ 
config
ํํ 
!=
ํํ 
null
ํํ "
&&
ํํ# %#
ValidateConfiguration
ํํ& ;
(
ํํ; <
config
ํํ< B
)
ํํB C
)
ํํC D
{
ํํE F
return
๎๎ !
UpdateConfiguration
๎๎ .
(
๎๎. /
config
๎๎/ 5
)
๎๎5 6
;
๎๎6 7
}
๏๏ 
}
๐๐ 
catch
๑๑ 
(
๑๑ 
	Exception
๑๑ 
)
๑๑ 
{
๑๑ 
}
๓๓ 
return
๕๕ 
false
๕๕ 
;
๕๕ 
}
๖๖ 	
public
 
static
 
bool
 
SaveProfile
 &
(
& '
string
' -
profileName
. 9
)
9 :
{
; <
try
 
{
 
var
 
config
 
=
 
GetConfiguration
 -
(
- .
)
. /
;
/ 0
var
 
profilePath
 
=
  !
$"
" $
$str
$ 6
{
6 7
profileName
7 B
}
B C
$str
C H
"
H I
;
I J
var
 

profileDir
 
=
  
Path
! %
.
% &
GetDirectoryName
& 6
(
6 7
profilePath
7 B
)
B C
;
C D
if
 
(
 
!
 
	Directory
 
.
 
Exists
 %
(
% &

profileDir
& 0
)
0 1
)
1 2
{
3 4
	Directory
 
.
 
CreateDirectory
 -
(
- .

profileDir
. 8
)
8 9
;
9 :
}
 
var
 
json
 
=
 $
SerializeConfiguration
 1
(
1 2
config
2 8
)
8 9
;
9 :
File
 
.
 
WriteAllText
 !
(
! "
profilePath
" -
,
- .
json
/ 3
,
3 4
Encoding
5 =
.
= >
UTF8
> B
)
B C
;
C D
return
 
true
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
public
 
static
 
bool
 
LoadProfile
 &
(
& '
string
' -
profileName
. 9
)
9 :
{
; <
try
 
{
 
var
 
profilePath
 
=
  !
$"
" $
$str
$ 6
{
6 7
profileName
7 B
}
B C
$str
C H
"
H I
;
I J
return
 "
RestoreConfiguration
 +
(
+ ,
profilePath
, 7
)
7 8
;
8 9
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
public
ฃฃ 
static
ฃฃ 
List
ฃฃ 
<
ฃฃ 
string
ฃฃ !
>
ฃฃ! ""
GetAvailableProfiles
ฃฃ# 7
(
ฃฃ7 8
)
ฃฃ8 9
{
ฃฃ: ;
var
คค 
profiles
คค 
=
คค 
new
คค 
List
คค #
<
คค# $
string
คค$ *
>
คค* +
(
คค+ ,
)
คค, -
;
คค- .
try
ฆฆ 
{
ฆฆ 
var
งง 

profileDir
งง 
=
งง  
$str
งง! 5
;
งง5 6
if
จจ 
(
จจ 
	Directory
จจ 
.
จจ 
Exists
จจ $
(
จจ$ %

profileDir
จจ% /
)
จจ/ 0
)
จจ0 1
{
จจ2 3
var
ฉฉ 
profileFiles
ฉฉ $
=
ฉฉ% &
	Directory
ฉฉ' 0
.
ฉฉ0 1
GetFiles
ฉฉ1 9
(
ฉฉ9 :

profileDir
ฉฉ: D
,
ฉฉD E
$str
ฉฉF N
)
ฉฉN O
;
ฉฉO P
foreach
ชช 
(
ชช 
var
ชช  
file
ชช! %
in
ชช& (
profileFiles
ชช) 5
)
ชช5 6
{
ชช7 8
profiles
ซซ  
.
ซซ  !
Add
ซซ! $
(
ซซ$ %
Path
ซซ% )
.
ซซ) *)
GetFileNameWithoutExtension
ซซ* E
(
ซซE F
file
ซซF J
)
ซซJ K
)
ซซK L
;
ซซL M
}
ฌฌ 
}
ญญ 
}
ฎฎ 
catch
ฏฏ 
(
ฏฏ 
	Exception
ฏฏ 
)
ฏฏ 
{
ฏฏ 
}
ฑฑ 
return
ณณ 
profiles
ณณ 
;
ณณ 
}
ดด 	
private
นน 
static
นน 
void
นน 
LoadConfiguration
นน -
(
นน- .
)
นน. /
{
นน0 1
try
บบ 
{
บบ 
if
ปป 
(
ปป 
File
ปป 
.
ปป 
Exists
ปป 
(
ปป  
ConfigFilePath
ปป  .
)
ปป. /
)
ปป/ 0
{
ปป1 2
var
ผผ 
json
ผผ 
=
ผผ 
File
ผผ #
.
ผผ# $
ReadAllText
ผผ$ /
(
ผผ/ 0
ConfigFilePath
ผผ0 >
,
ผผ> ?
Encoding
ผผ@ H
.
ผผH I
UTF8
ผผI M
)
ผผM N
;
ผผN O
_configuration
ฝฝ "
=
ฝฝ# $&
DeserializeConfiguration
ฝฝ% =
(
ฝฝ= >
json
ฝฝ> B
)
ฝฝB C
;
ฝฝC D
_lastConfigLoad
พพ #
=
พพ$ %
DateTime
พพ& .
.
พพ. /
Now
พพ/ 2
;
พพ2 3
}
ฟฟ 
if
มม 
(
มม 
_configuration
มม "
==
มม# %
null
มม& *
)
มม* +
{
มม, -
_configuration
ยย "
=
ยย# $(
CreateDefaultConfiguration
ยย% ?
(
ยย? @
)
ยย@ A
;
ยยA B
SaveConfiguration
รร %
(
รร% &
)
รร& '
;
รร' (
}
ฤฤ 
}
ลล 
catch
ฦฦ 
(
ฦฦ 
	Exception
ฦฦ 
)
ฦฦ 
{
ฦฦ 
_configuration
วว 
=
วว  (
CreateDefaultConfiguration
วว! ;
(
วว; <
)
วว< =
;
วว= >
}
ศศ 
}
ษษ 	
private
ฮฮ 
static
ฮฮ 
void
ฮฮ 
SaveConfiguration
ฮฮ -
(
ฮฮ- .
)
ฮฮ. /
{
ฮฮ0 1
try
ฯฯ 
{
ฯฯ 
var
ะะ 
json
ะะ 
=
ะะ $
SerializeConfiguration
ะะ 1
(
ะะ1 2
_configuration
ะะ2 @
)
ะะ@ A
;
ะะA B
var
าา 
	configDir
าา 
=
าา 
Path
าา  $
.
าา$ %
GetDirectoryName
าา% 5
(
าา5 6
ConfigFilePath
าา6 D
)
าาD E
;
าาE F
if
ำำ 
(
ำำ 
!
ำำ 
string
ำำ 
.
ำำ 
IsNullOrEmpty
ำำ )
(
ำำ) *
	configDir
ำำ* 3
)
ำำ3 4
&&
ำำ5 7
!
ำำ8 9
	Directory
ำำ9 B
.
ำำB C
Exists
ำำC I
(
ำำI J
	configDir
ำำJ S
)
ำำS T
)
ำำT U
{
ำำV W
	Directory
ิิ 
.
ิิ 
CreateDirectory
ิิ -
(
ิิ- .
	configDir
ิิ. 7
)
ิิ7 8
;
ิิ8 9
}
ีี 
File
ืื 
.
ืื 
WriteAllText
ืื !
(
ืื! "
ConfigFilePath
ืื" 0
,
ืื0 1
json
ืื2 6
,
ืื6 7
Encoding
ืื8 @
.
ืื@ A
UTF8
ืืA E
)
ืืE F
;
ืืF G
_lastConfigLoad
ุุ 
=
ุุ  !
DateTime
ุุ" *
.
ุุ* +
Now
ุุ+ .
;
ุุ. /
}
ูู 
catch
ฺฺ 
(
ฺฺ 
	Exception
ฺฺ 
)
ฺฺ 
{
ฺฺ 
}
 
}
 	
private
ใใ 
static
ใใ #
DevToolsConfiguration
ใใ ,(
CreateDefaultConfiguration
ใใ- G
(
ใใG H
)
ใใH I
{
ใใJ K
return
ไไ 
new
ไไ #
DevToolsConfiguration
ไไ ,
{
ไไ- .%
AutoUpdateDocumentation
ๅๅ '
=
ๅๅ( )
true
ๅๅ* .
,
ๅๅ. /%
AutoGenerateFileHeaders
ๆๆ '
=
ๆๆ( )
true
ๆๆ* .
,
ๆๆ. /#
AutoUpdateFileHeaders
็็ %
=
็็& '
true
็็( ,
,
็็, -
EnableAIHooks
่่ 
=
่่ 
true
่่  $
,
่่$ %"
EnableTemplateEngine
้้ $
=
้้% &
true
้้' +
,
้้+ ,

DateFormat
๊๊ 
=
๊๊ 
$str
๊๊ )
,
๊๊) *
DefaultAuthor
๋๋ 
=
๋๋ 
$str
๋๋  *
,
๋๋* +
DefaultFramework
์์  
=
์์! "
$str
์์# 9
,
์์9 :
DefaultLanguage
ํํ 
=
ํํ  !
$str
ํํ" *
,
ํํ* +
MaxLogEntries
๎๎ 
=
๎๎ 
$num
๎๎  $
,
๎๎$ %&
EnablePerformanceLogging
๏๏ (
=
๏๏) *
false
๏๏+ 0
,
๏๏0 1!
ExcludedDirectories
๐๐ #
=
๐๐$ %
new
๐๐& )
List
๐๐* .
<
๐๐. /
string
๐๐/ 5
>
๐๐5 6
{
๐๐7 8
$str
๐๐9 >
,
๐๐> ?
$str
๐๐@ E
,
๐๐E F
$str
๐๐G M
,
๐๐M N
$str
๐๐O T
,
๐๐T U
$str
๐๐V `
}
๐๐a b
,
๐๐b c"
ExcludedFilePatterns
๑๑ $
=
๑๑% &
new
๑๑' *
List
๑๑+ /
<
๑๑/ 0
string
๑๑0 6
>
๑๑6 7
{
๑๑8 9
$str
๑๑: A
,
๑๑A B
$str
๑๑C J
,
๑๑J K
$str
๑๑L U
}
๑๑V W
,
๑๑W X
CustomTemplates
๒๒ 
=
๒๒  !
new
๒๒" %

Dictionary
๒๒& 0
<
๒๒0 1
string
๒๒1 7
,
๒๒7 8
string
๒๒9 ?
>
๒๒? @
(
๒๒@ A
)
๒๒A B
,
๒๒B C
CustomSettings
๓๓ 
=
๓๓  
new
๓๓! $

Dictionary
๓๓% /
<
๓๓/ 0
string
๓๓0 6
,
๓๓6 7
object
๓๓8 >
>
๓๓> ?
(
๓๓? @
)
๓๓@ A
,
๓๓A B!
AIAssistantSettings
๔๔ #
=
๔๔$ %
new
๔๔& )!
AIAssistantSettings
๔๔* =
{
๔๔> ?(
EnableAutomaticSuggestions
๕๕ .
=
๕๕/ 0
true
๕๕1 5
,
๕๕5 6#
EnableContextTracking
๖๖ )
=
๖๖* +
true
๖๖, 0
,
๖๖0 1-
AutoTriggerDocumentationUpdates
๗๗ 3
=
๗๗4 5
true
๗๗6 :
,
๗๗: ;
MaxContextHistory
๘๘ %
=
๘๘& '
$num
๘๘( *
,
๘๘* +!
SuggestionThreshold
๙๙ '
=
๙๙( )
$num
๙๙* -
}
๚๚ 
,
๚๚ $
CodeGenerationSettings
๛๛ &
=
๛๛' (
new
๛๛) ,$
CodeGenerationSettings
๛๛- C
{
๛๛D E!
DefaultCommentStyle
 '
=
( )
CommentStyle
* 6
.
6 7
Explanatory
7 B
,
B C&
GenerateXmlDocumentation
 ,
=
- .
true
/ 3
,
3 4$
GenerateInlineComments
 *
=
+ ,
false
- 2
,
2 3'
UseRegionsForOrganization
 -
=
. /
false
0 5
}
 
}
 
;
 
}
 	
private
 
static
 
bool
 #
ValidateConfiguration
 1
(
1 2#
DevToolsConfiguration
2 G
config
H N
)
N O
{
P Q
if
 
(
 
config
 
==
 
null
 
)
 
{
  !
return
 
false
 
;
 
}
 
if
 
(
 
string
 
.
 
IsNullOrEmpty
 $
(
$ %
config
% +
.
+ ,

DateFormat
, 6
)
6 7
||
8 :
string
 
.
 
IsNullOrEmpty
 $
(
$ %
config
% +
.
+ ,
DefaultAuthor
, 9
)
9 :
||
; =
string
 
.
 
IsNullOrEmpty
 $
(
$ %
config
% +
.
+ ,
DefaultFramework
, <
)
< =
)
= >
{
? @
return
 
false
 
;
 
}
 
try
 
{
 
DateTime
 
.
 
Now
 
.
 
ToString
 %
(
% &
config
& ,
.
, -

DateFormat
- 7
)
7 8
;
8 9
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
if
 
(
 
config
 
.
 
MaxLogEntries
 $
<
% &
$num
' *
||
+ -
config
. 4
.
4 5
MaxLogEntries
5 B
>
C D
$num
E J
)
J K
{
L M
return
 
false
 
;
 
}
 
return
ขข 
true
ขข 
;
ขข 
}
ฃฃ 	
private
ชช 
static
ชช 
string
ชช $
SerializeConfiguration
ชช 4
(
ชช4 5#
DevToolsConfiguration
ชช5 J
config
ชชK Q
)
ชชQ R
{
ชชS T
var
ฌฌ 
json
ฌฌ 
=
ฌฌ 
new
ฌฌ 
StringBuilder
ฌฌ (
(
ฌฌ( )
)
ฌฌ) *
;
ฌฌ* +
json
ญญ 
.
ญญ 

AppendLine
ญญ 
(
ญญ 
$str
ญญ 
)
ญญ  
;
ญญ  !
json
ฎฎ 
.
ฎฎ 

AppendLine
ฎฎ 
(
ฎฎ 
$"
ฎฎ 
$str
ฎฎ =
{
ฎฎ= >
config
ฎฎ> D
.
ฎฎD E%
AutoUpdateDocumentation
ฎฎE \
.
ฎฎ\ ]
ToString
ฎฎ] e
(
ฎฎe f
)
ฎฎf g
.
ฎฎg h
ToLower
ฎฎh o
(
ฎฎo p
)
ฎฎp q
}
ฎฎq r
$str
ฎฎr s
"
ฎฎs t
)
ฎฎt u
;
ฎฎu v
json
ฏฏ 
.
ฏฏ 

AppendLine
ฏฏ 
(
ฏฏ 
$"
ฏฏ 
$str
ฏฏ =
{
ฏฏ= >
config
ฏฏ> D
.
ฏฏD E%
AutoGenerateFileHeaders
ฏฏE \
.
ฏฏ\ ]
ToString
ฏฏ] e
(
ฏฏe f
)
ฏฏf g
.
ฏฏg h
ToLower
ฏฏh o
(
ฏฏo p
)
ฏฏp q
}
ฏฏq r
$str
ฏฏr s
"
ฏฏs t
)
ฏฏt u
;
ฏฏu v
json
ฐฐ 
.
ฐฐ 

AppendLine
ฐฐ 
(
ฐฐ 
$"
ฐฐ 
$str
ฐฐ ;
{
ฐฐ; <
config
ฐฐ< B
.
ฐฐB C#
AutoUpdateFileHeaders
ฐฐC X
.
ฐฐX Y
ToString
ฐฐY a
(
ฐฐa b
)
ฐฐb c
.
ฐฐc d
ToLower
ฐฐd k
(
ฐฐk l
)
ฐฐl m
}
ฐฐm n
$str
ฐฐn o
"
ฐฐo p
)
ฐฐp q
;
ฐฐq r
json
ฑฑ 
.
ฑฑ 

AppendLine
ฑฑ 
(
ฑฑ 
$"
ฑฑ 
$str
ฑฑ 3
{
ฑฑ3 4
config
ฑฑ4 :
.
ฑฑ: ;
EnableAIHooks
ฑฑ; H
.
ฑฑH I
ToString
ฑฑI Q
(
ฑฑQ R
)
ฑฑR S
.
ฑฑS T
ToLower
ฑฑT [
(
ฑฑ[ \
)
ฑฑ\ ]
}
ฑฑ] ^
$str
ฑฑ^ _
"
ฑฑ_ `
)
ฑฑ` a
;
ฑฑa b
json
ฒฒ 
.
ฒฒ 

AppendLine
ฒฒ 
(
ฒฒ 
$"
ฒฒ 
$str
ฒฒ :
{
ฒฒ: ;
config
ฒฒ; A
.
ฒฒA B"
EnableTemplateEngine
ฒฒB V
.
ฒฒV W
ToString
ฒฒW _
(
ฒฒ_ `
)
ฒฒ` a
.
ฒฒa b
ToLower
ฒฒb i
(
ฒฒi j
)
ฒฒj k
}
ฒฒk l
$str
ฒฒl m
"
ฒฒm n
)
ฒฒn o
;
ฒฒo p
json
ณณ 
.
ณณ 

AppendLine
ณณ 
(
ณณ 
$"
ณณ 
$str
ณณ 2
{
ณณ2 3
config
ณณ3 9
.
ณณ9 :

DateFormat
ณณ: D
}
ณณD E
$str
ณณE H
"
ณณH I
)
ณณI J
;
ณณJ K
json
ดด 
.
ดด 

AppendLine
ดด 
(
ดด 
$"
ดด 
$str
ดด 5
{
ดด5 6
config
ดด6 <
.
ดด< =
DefaultAuthor
ดด= J
}
ดดJ K
$str
ดดK N
"
ดดN O
)
ดดO P
;
ดดP Q
json
ตต 
.
ตต 

AppendLine
ตต 
(
ตต 
$"
ตต 
$str
ตต 8
{
ตต8 9
config
ตต9 ?
.
ตต? @
DefaultFramework
ตต@ P
}
ตตP Q
$str
ตตQ T
"
ตตT U
)
ตตU V
;
ตตV W
json
ถถ 
.
ถถ 

AppendLine
ถถ 
(
ถถ 
$"
ถถ 
$str
ถถ 7
{
ถถ7 8
config
ถถ8 >
.
ถถ> ?
DefaultLanguage
ถถ? N
}
ถถN O
$str
ถถO R
"
ถถR S
)
ถถS T
;
ถถT U
json
ทท 
.
ทท 

AppendLine
ทท 
(
ทท 
$"
ทท 
$str
ทท 3
{
ทท3 4
config
ทท4 :
.
ทท: ;
MaxLogEntries
ทท; H
}
ททH I
$str
ททI J
"
ททJ K
)
ททK L
;
ททL M
json
ธธ 
.
ธธ 

AppendLine
ธธ 
(
ธธ 
$"
ธธ 
$str
ธธ >
{
ธธ> ?
config
ธธ? E
.
ธธE F&
EnablePerformanceLogging
ธธF ^
.
ธธ^ _
ToString
ธธ_ g
(
ธธg h
)
ธธh i
.
ธธi j
ToLower
ธธj q
(
ธธq r
)
ธธr s
}
ธธs t
"
ธธt u
)
ธธu v
;
ธธv w
json
นน 
.
นน 

AppendLine
นน 
(
นน 
$str
นน 
)
นน  
;
นน  !
return
ปป 
json
ปป 
.
ปป 
ToString
ปป  
(
ปป  !
)
ปป! "
;
ปป" #
}
ผผ 	
private
รร 
static
รร #
DevToolsConfiguration
รร ,&
DeserializeConfiguration
รร- E
(
รรE F
string
รรF L
json
รรM Q
)
รรQ R
{
รรS T
try
ฤฤ 
{
ฤฤ 
var
ฦฦ 
config
ฦฦ 
=
ฦฦ (
CreateDefaultConfiguration
ฦฦ 7
(
ฦฦ7 8
)
ฦฦ8 9
;
ฦฦ9 :
var
ษษ 
lines
ษษ 
=
ษษ 
json
ษษ  
.
ษษ  !
Split
ษษ! &
(
ษษ& '
$char
ษษ' +
)
ษษ+ ,
;
ษษ, -
foreach
สส 
(
สส 
var
สส 
line
สส !
in
สส" $
lines
สส% *
)
สส* +
{
สส, -
var
หห 
trimmed
หห 
=
หห  !
line
หห" &
.
หห& '
Trim
หห' +
(
หห+ ,
)
หห, -
;
หห- .
if
ฬฬ 
(
ฬฬ 
trimmed
ฬฬ 
.
ฬฬ  
Contains
ฬฬ  (
(
ฬฬ( )
$str
ฬฬ) ,
)
ฬฬ, -
)
ฬฬ- .
{
ฬฬ/ 0
var
ออ 
parts
ออ !
=
ออ" #
trimmed
ออ$ +
.
ออ+ ,
Split
ออ, 1
(
ออ1 2
$char
ออ2 5
)
ออ5 6
;
ออ6 7
if
ฮฮ 
(
ฮฮ 
parts
ฮฮ !
.
ฮฮ! "
Length
ฮฮ" (
==
ฮฮ) +
$num
ฮฮ, -
)
ฮฮ- .
{
ฮฮ/ 0
var
ฯฯ 
key
ฯฯ  #
=
ฯฯ$ %
parts
ฯฯ& +
[
ฯฯ+ ,
$num
ฯฯ, -
]
ฯฯ- .
.
ฯฯ. /
Trim
ฯฯ/ 3
(
ฯฯ3 4
)
ฯฯ4 5
.
ฯฯ5 6
Trim
ฯฯ6 :
(
ฯฯ: ;
$char
ฯฯ; >
)
ฯฯ> ?
;
ฯฯ? @
var
ะะ 
value
ะะ  %
=
ะะ& '
parts
ะะ( -
[
ะะ- .
$num
ะะ. /
]
ะะ/ 0
.
ะะ0 1
Trim
ะะ1 5
(
ะะ5 6
)
ะะ6 7
.
ะะ7 8
TrimEnd
ะะ8 ?
(
ะะ? @
$char
ะะ@ C
)
ะะC D
.
ะะD E
Trim
ะะE I
(
ะะI J
$char
ะะJ M
)
ะะM N
;
ะะN O
switch
าา "
(
าา# $
key
าา$ '
)
าา' (
{
าา) *
case
ำำ  $
$str
ำำ% >
:
ำำ> ?
config
ิิ$ *
.
ิิ* +%
AutoUpdateDocumentation
ิิ+ B
=
ิิC D
bool
ิิE I
.
ิิI J
Parse
ิิJ O
(
ิิO P
value
ิิP U
)
ิิU V
;
ิิV W
break
ีี$ )
;
ีี) *
case
ึึ  $
$str
ึึ% >
:
ึึ> ?
config
ืื$ *
.
ืื* +%
AutoGenerateFileHeaders
ืื+ B
=
ืืC D
bool
ืืE I
.
ืืI J
Parse
ืืJ O
(
ืืO P
value
ืืP U
)
ืืU V
;
ืืV W
break
ุุ$ )
;
ุุ) *
case
ูู  $
$str
ูู% <
:
ูู< =
config
ฺฺ$ *
.
ฺฺ* +#
AutoUpdateFileHeaders
ฺฺ+ @
=
ฺฺA B
bool
ฺฺC G
.
ฺฺG H
Parse
ฺฺH M
(
ฺฺM N
value
ฺฺN S
)
ฺฺS T
;
ฺฺT U
break
$ )
;
) *
case
  $
$str
% 4
:
4 5
config
$ *
.
* +
EnableAIHooks
+ 8
=
9 :
bool
; ?
.
? @
Parse
@ E
(
E F
value
F K
)
K L
;
L M
break
$ )
;
) *
case
฿฿  $
$str
฿฿% ;
:
฿฿; <
config
เเ$ *
.
เเ* +"
EnableTemplateEngine
เเ+ ?
=
เเ@ A
bool
เเB F
.
เเF G
Parse
เเG L
(
เเL M
value
เเM R
)
เเR S
;
เเS T
break
แแ$ )
;
แแ) *
case
โโ  $
$str
โโ% 1
:
โโ1 2
config
ใใ$ *
.
ใใ* +

DateFormat
ใใ+ 5
=
ใใ6 7
value
ใใ8 =
;
ใใ= >
break
ไไ$ )
;
ไไ) *
case
ๅๅ  $
$str
ๅๅ% 4
:
ๅๅ4 5
config
ๆๆ$ *
.
ๆๆ* +
DefaultAuthor
ๆๆ+ 8
=
ๆๆ9 :
value
ๆๆ; @
;
ๆๆ@ A
break
็็$ )
;
็็) *
case
่่  $
$str
่่% 7
:
่่7 8
config
้้$ *
.
้้* +
DefaultFramework
้้+ ;
=
้้< =
value
้้> C
;
้้C D
break
๊๊$ )
;
๊๊) *
case
๋๋  $
$str
๋๋% 6
:
๋๋6 7
config
์์$ *
.
์์* +
DefaultLanguage
์์+ :
=
์์; <
value
์์= B
;
์์B C
break
ํํ$ )
;
ํํ) *
case
๎๎  $
$str
๎๎% 4
:
๎๎4 5
config
๏๏$ *
.
๏๏* +
MaxLogEntries
๏๏+ 8
=
๏๏9 :
int
๏๏; >
.
๏๏> ?
Parse
๏๏? D
(
๏๏D E
value
๏๏E J
)
๏๏J K
;
๏๏K L
break
๐๐$ )
;
๐๐) *
case
๑๑  $
$str
๑๑% ?
:
๑๑? @
config
๒๒$ *
.
๒๒* +&
EnablePerformanceLogging
๒๒+ C
=
๒๒D E
bool
๒๒F J
.
๒๒J K
Parse
๒๒K P
(
๒๒P Q
value
๒๒Q V
)
๒๒V W
;
๒๒W X
break
๓๓$ )
;
๓๓) *
}
๔๔ 
}
๕๕ 
}
๖๖ 
}
๗๗ 
return
๙๙ 
config
๙๙ 
;
๙๙ 
}
๚๚ 
catch
๛๛ 
(
๛๛ 
	Exception
๛๛ 
)
๛๛ 
{
๛๛ 
return
 
null
 
;
 
}
 
}
 	
}
 
public
 

class
 #
DevToolsConfiguration
 &
{
' (
public
 
bool
 %
AutoUpdateDocumentation
 +
{
, -
get
. 1
;
1 2
set
3 6
;
6 7
}
8 9
=
: ;
true
< @
;
@ A
public
 
bool
 %
AutoGenerateFileHeaders
 +
{
, -
get
. 1
;
1 2
set
3 6
;
6 7
}
8 9
=
: ;
true
< @
;
@ A
public
 
bool
 #
AutoUpdateFileHeaders
 )
{
* +
get
, /
;
/ 0
set
1 4
;
4 5
}
6 7
=
8 9
true
: >
;
> ?
public
 
bool
 
EnableAIHooks
 !
{
" #
get
$ '
;
' (
set
) ,
;
, -
}
. /
=
0 1
true
2 6
;
6 7
public
 
bool
 "
EnableTemplateEngine
 (
{
) *
get
+ .
;
. /
set
0 3
;
3 4
}
5 6
=
7 8
true
9 =
;
= >
public
กก 
string
กก 

DateFormat
กก  
{
กก! "
get
กก# &
;
กก& '
set
กก( +
;
กก+ ,
}
กก- .
=
กก/ 0
$str
กก1 =
;
กก= >
public
ฆฆ 
string
ฆฆ 
DefaultAuthor
ฆฆ #
{
ฆฆ$ %
get
ฆฆ& )
;
ฆฆ) *
set
ฆฆ+ .
;
ฆฆ. /
}
ฆฆ0 1
=
ฆฆ2 3
$str
ฆฆ4 >
;
ฆฆ> ?
public
ซซ 
string
ซซ 
DefaultFramework
ซซ &
{
ซซ' (
get
ซซ) ,
;
ซซ, -
set
ซซ. 1
;
ซซ1 2
}
ซซ3 4
=
ซซ5 6
$str
ซซ7 M
;
ซซM N
public
ฐฐ 
string
ฐฐ 
DefaultLanguage
ฐฐ %
{
ฐฐ& '
get
ฐฐ( +
;
ฐฐ+ ,
set
ฐฐ- 0
;
ฐฐ0 1
}
ฐฐ2 3
=
ฐฐ4 5
$str
ฐฐ6 >
;
ฐฐ> ?
public
ตต 
int
ตต 
MaxLogEntries
ตต  
{
ตต! "
get
ตต# &
;
ตต& '
set
ตต( +
;
ตต+ ,
}
ตต- .
=
ตต/ 0
$num
ตต1 5
;
ตต5 6
public
บบ 
bool
บบ &
EnablePerformanceLogging
บบ ,
{
บบ- .
get
บบ/ 2
;
บบ2 3
set
บบ4 7
;
บบ7 8
}
บบ9 :
=
บบ; <
false
บบ= B
;
บบB C
public
ฟฟ 
List
ฟฟ 
<
ฟฟ 
string
ฟฟ 
>
ฟฟ !
ExcludedDirectories
ฟฟ /
{
ฟฟ0 1
get
ฟฟ2 5
;
ฟฟ5 6
set
ฟฟ7 :
;
ฟฟ: ;
}
ฟฟ< =
=
ฟฟ> ?
new
ฟฟ@ C
List
ฟฟD H
<
ฟฟH I
string
ฟฟI O
>
ฟฟO P
(
ฟฟP Q
)
ฟฟQ R
;
ฟฟR S
public
ฤฤ 
List
ฤฤ 
<
ฤฤ 
string
ฤฤ 
>
ฤฤ "
ExcludedFilePatterns
ฤฤ 0
{
ฤฤ1 2
get
ฤฤ3 6
;
ฤฤ6 7
set
ฤฤ8 ;
;
ฤฤ; <
}
ฤฤ= >
=
ฤฤ? @
new
ฤฤA D
List
ฤฤE I
<
ฤฤI J
string
ฤฤJ P
>
ฤฤP Q
(
ฤฤQ R
)
ฤฤR S
;
ฤฤS T
public
ษษ 

Dictionary
ษษ 
<
ษษ 
string
ษษ  
,
ษษ  !
string
ษษ" (
>
ษษ( )
CustomTemplates
ษษ* 9
{
ษษ: ;
get
ษษ< ?
;
ษษ? @
set
ษษA D
;
ษษD E
}
ษษF G
=
ษษH I
new
ษษJ M

Dictionary
ษษN X
<
ษษX Y
string
ษษY _
,
ษษ_ `
string
ษษa g
>
ษษg h
(
ษษh i
)
ษษi j
;
ษษj k
public
ฮฮ 

Dictionary
ฮฮ 
<
ฮฮ 
string
ฮฮ  
,
ฮฮ  !
object
ฮฮ" (
>
ฮฮ( )
CustomSettings
ฮฮ* 8
{
ฮฮ9 :
get
ฮฮ; >
;
ฮฮ> ?
set
ฮฮ@ C
;
ฮฮC D
}
ฮฮE F
=
ฮฮG H
new
ฮฮI L

Dictionary
ฮฮM W
<
ฮฮW X
string
ฮฮX ^
,
ฮฮ^ _
object
ฮฮ` f
>
ฮฮf g
(
ฮฮg h
)
ฮฮh i
;
ฮฮi j
public
ำำ !
AIAssistantSettings
ำำ "!
AIAssistantSettings
ำำ# 6
{
ำำ7 8
get
ำำ9 <
;
ำำ< =
set
ำำ> A
;
ำำA B
}
ำำC D
=
ำำE F
new
ำำG J!
AIAssistantSettings
ำำK ^
(
ำำ^ _
)
ำำ_ `
;
ำำ` a
public
ุุ $
CodeGenerationSettings
ุุ %$
CodeGenerationSettings
ุุ& <
{
ุุ= >
get
ุุ? B
;
ุุB C
set
ุุD G
;
ุุG H
}
ุุI J
=
ุุK L
new
ุุM P$
CodeGenerationSettings
ุุQ g
(
ุุg h
)
ุุh i
;
ุุi j
}
ูู 
public
 

class
 !
AIAssistantSettings
 $
{
% &
public
โโ 
bool
โโ (
EnableAutomaticSuggestions
โโ .
{
โโ/ 0
get
โโ1 4
;
โโ4 5
set
โโ6 9
;
โโ9 :
}
โโ; <
=
โโ= >
true
โโ? C
;
โโC D
public
็็ 
bool
็็ #
EnableContextTracking
็็ )
{
็็* +
get
็็, /
;
็็/ 0
set
็็1 4
;
็็4 5
}
็็6 7
=
็็8 9
true
็็: >
;
็็> ?
public
์์ 
bool
์์ -
AutoTriggerDocumentationUpdates
์์ 3
{
์์4 5
get
์์6 9
;
์์9 :
set
์์; >
;
์์> ?
}
์์@ A
=
์์B C
true
์์D H
;
์์H I
public
๑๑ 
int
๑๑ 
MaxContextHistory
๑๑ $
{
๑๑% &
get
๑๑' *
;
๑๑* +
set
๑๑, /
;
๑๑/ 0
}
๑๑1 2
=
๑๑3 4
$num
๑๑5 7
;
๑๑7 8
public
๖๖ 
double
๖๖ !
SuggestionThreshold
๖๖ )
{
๖๖* +
get
๖๖, /
;
๖๖/ 0
set
๖๖1 4
;
๖๖4 5
}
๖๖6 7
=
๖๖8 9
$num
๖๖: =
;
๖๖= >
}
๗๗ 
public
 

class
 $
CodeGenerationSettings
 '
{
( )
public
 
CommentStyle
 !
DefaultCommentStyle
 /
{
0 1
get
2 5
;
5 6
set
7 :
;
: ;
}
< =
=
> ?
CommentStyle
@ L
.
L M
Explanatory
M X
;
X Y
public
 
bool
 &
GenerateXmlDocumentation
 ,
{
- .
get
/ 2
;
2 3
set
4 7
;
7 8
}
9 :
=
; <
true
= A
;
A B
public
 
bool
 $
GenerateInlineComments
 *
{
+ ,
get
- 0
;
0 1
set
2 5
;
5 6
}
7 8
=
9 :
false
; @
;
@ A
public
 
bool
 '
UseRegionsForOrganization
 -
{
. /
get
0 3
;
3 4
set
5 8
;
8 9
}
: ;
=
< =
false
> C
;
C D
}
 
} ๊็
FC:\Playnite\_github\OstPlayer\source\DevTools\DateValidationService.cs
	namespaceNN 	
	OstPlayerNN
 
.NN 
DevToolsNN 
{OO 
publicTT 

staticTT 
classTT !
DateValidationServiceTT -
{UU 
private\\ 
static\\ 
readonly\\ 
HashSet\\  '
<\\' (
string\\( .
>\\. /
BlacklistedDates\\0 @
=\\A B
new\\C F
HashSet\\G N
<\\N O
string\\O U
>\\U V
{]] 	
$str^^ 
,^^ 
$str__ 
,__ 
$str`` 
,`` 
$straa 
,aa 
$strbb 
,bb 
$strcc 
,cc 
$strdd 
,dd 
}ee 	
;ee	 

privatejj 
staticjj 
readonlyjj 
Regexjj  %
DatePatternjj& 1
=jj2 3
newjj4 7
Regexjj8 =
(jj= >
$strkk *
,kk* +
RegexOptionsll 
.ll 
Compiledll !
|ll" #
RegexOptionsll$ 0
.ll0 1

IgnoreCasell1 ;
)mm 	
;mm	 

privaterr 
constrr 
intrr 
MaxFutureDaysrr '
=rr( )
$numrr* +
;rr+ ,
privateww 
constww 
intww 
MaxPastDaysww %
=ww& '
$numww( )
;ww) *
public
 
static
 "
DateValidationResult
 *
ValidateDate
+ 7
(
7 8
string
8 >

dateString
? I
,
I J
string
K Q
context
R Y
=
Z [
$str
\ ^
)
^ _
{
 	
if
 
(
 
string
 
.
 
IsNullOrEmpty
 $
(
$ %

dateString
% /
)
/ 0
)
0 1
{
 
return
 
new
 "
DateValidationResult
 /
{
 
IsValid
 
=
 
false
 #
,
# $
ErrorMessage
  
=
! "
$str
# A
,
A B
SuggestedDate
 !
=
" #

DateHelper
$ .
.
. /"
GetCurrentDateString
/ C
(
C D
)
D E
,
E F
RecommendedAction
 %
=
& '"
DateValidationAction
( <
.
< =
UseSystemDate
= J
,
J K
}
 
;
 
}
 
if
 
(
 
IsBlacklistedDate
 !
(
! "

dateString
" ,
)
, -
)
- .
{
 
return
 
new
 "
DateValidationResult
 /
{
 
IsValid
 
=
 
false
 #
,
# $
ErrorMessage
  
=
! "
$"
 
$str
  
{
  !

dateString
! +
}
+ ,
$str
, |
"
| }
,
} ~
SuggestedDate
 !
=
" #

DateHelper
$ .
.
. /"
GetCurrentDateString
/ C
(
C D
)
D E
,
E F
RecommendedAction
 %
=
& '"
DateValidationAction
( <
.
< =
UseSystemDate
= J
,
J K
ValidationFlags
 #
=
$ %!
DateValidationFlags
& 9
.
9 :
BlacklistedDate
: I
,
I J
}
 
;
 
}
 
if
 
(
 
!
กก 
DateTime
กก 
.
กก 
TryParseExact
กก '
(
กก' (

dateString
ขข 
,
ขข 
$str
ฃฃ  
,
ฃฃ  !
null
คค 
,
คค 
System
ฅฅ 
.
ฅฅ 
Globalization
ฅฅ (
.
ฅฅ( )
DateTimeStyles
ฅฅ) 7
.
ฅฅ7 8
None
ฅฅ8 <
,
ฅฅ< =
out
ฆฆ 
DateTime
ฆฆ  

parsedDate
ฆฆ! +
)
งง 
)
จจ 
{
ฉฉ 
return
ชช 
new
ชช "
DateValidationResult
ชช /
{
ซซ 
IsValid
ฌฌ 
=
ฌฌ 
false
ฌฌ #
,
ฌฌ# $
ErrorMessage
ญญ  
=
ญญ! "
$"
ฎฎ 
$str
ฎฎ 0
{
ฎฎ0 1

dateString
ฎฎ1 ;
}
ฎฎ; <
$str
ฎฎ< Y
"
ฎฎY Z
,
ฎฎZ [
SuggestedDate
ฏฏ !
=
ฏฏ" #

DateHelper
ฏฏ$ .
.
ฏฏ. /"
GetCurrentDateString
ฏฏ/ C
(
ฏฏC D
)
ฏฏD E
,
ฏฏE F
RecommendedAction
ฐฐ %
=
ฐฐ& '"
DateValidationAction
ฐฐ( <
.
ฐฐ< =
UseSystemDate
ฐฐ= J
,
ฐฐJ K
ValidationFlags
ฑฑ #
=
ฑฑ$ %!
DateValidationFlags
ฑฑ& 9
.
ฑฑ9 :
InvalidFormat
ฑฑ: G
,
ฑฑG H
}
ฒฒ 
;
ฒฒ 
}
ณณ 
var
ถถ 
now
ถถ 
=
ถถ 
DateTime
ถถ 
.
ถถ 
Now
ถถ "
;
ถถ" #
var
ทท 
daysDifference
ทท 
=
ทท  
(
ทท! "

parsedDate
ทท" ,
-
ทท- .
now
ทท/ 2
.
ทท2 3
Date
ทท3 7
)
ทท7 8
.
ทท8 9
	TotalDays
ทท9 B
;
ททB C
if
นน 
(
นน 
daysDifference
นน 
>
นน  
MaxFutureDays
นน! .
)
นน. /
{
บบ 
return
ปป 
new
ปป "
DateValidationResult
ปป /
{
ผผ 
IsValid
ฝฝ 
=
ฝฝ 
false
ฝฝ #
,
ฝฝ# $
ErrorMessage
พพ  
=
พพ! "
$"
ฟฟ 
$str
ฟฟ  
{
ฟฟ  !

dateString
ฟฟ! +
}
ฟฟ+ ,
$str
ฟฟ, H
{
ฟฟH I
daysDifference
ฟฟI W
:
ฟฟW X
$str
ฟฟX Z
}
ฟฟZ [
$str
ฟฟ[ j
"
ฟฟj k
,
ฟฟk l
SuggestedDate
ภภ !
=
ภภ" #

DateHelper
ภภ$ .
.
ภภ. /"
GetCurrentDateString
ภภ/ C
(
ภภC D
)
ภภD E
,
ภภE F
RecommendedAction
มม %
=
มม& '"
DateValidationAction
มม( <
.
มม< =
UseSystemDate
มม= J
,
มมJ K
ValidationFlags
ยย #
=
ยย$ %!
DateValidationFlags
ยย& 9
.
ยย9 :
TooFarInFuture
ยย: H
,
ยยH I
}
รร 
;
รร 
}
ฤฤ 
if
ฦฦ 
(
ฦฦ 
daysDifference
ฦฦ 
<
ฦฦ  
-
ฦฦ! "
MaxPastDays
ฦฦ" -
)
ฦฦ- .
{
วว 
return
ศศ 
new
ศศ "
DateValidationResult
ศศ /
{
ษษ 
IsValid
สส 
=
สส 
false
สส #
,
สส# $
ErrorMessage
หห  
=
หห! "
$"
ฬฬ 
$str
ฬฬ  
{
ฬฬ  !

dateString
ฬฬ! +
}
ฬฬ+ ,
$str
ฬฬ, F
{
ฬฬF G
Math
ฬฬG K
.
ฬฬK L
Abs
ฬฬL O
(
ฬฬO P
daysDifference
ฬฬP ^
)
ฬฬ^ _
:
ฬฬ_ `
$str
ฬฬ` b
}
ฬฬb c
$str
ฬฬc }
"
ฬฬ} ~
,
ฬฬ~ 
SuggestedDate
ออ !
=
ออ" #

DateHelper
ออ$ .
.
ออ. /"
GetCurrentDateString
ออ/ C
(
ออC D
)
ออD E
,
ออE F
RecommendedAction
ฮฮ %
=
ฮฮ& '"
DateValidationAction
ฮฮ( <
.
ฮฮ< =
ConfirmWithUser
ฮฮ= L
,
ฮฮL M
ValidationFlags
ฯฯ #
=
ฯฯ$ %!
DateValidationFlags
ฯฯ& 9
.
ฯฯ9 :
TooFarInPast
ฯฯ: F
,
ฯฯF G
}
ะะ 
;
ะะ 
}
ัั 
return
ิิ 
new
ิิ "
DateValidationResult
ิิ +
{
ีี 
IsValid
ึึ 
=
ึึ 
true
ึึ 
,
ึึ 
ErrorMessage
ืื 
=
ืื 
null
ืื #
,
ืื# $
SuggestedDate
ุุ 
=
ุุ 

dateString
ุุ  *
,
ุุ* +
RecommendedAction
ูู !
=
ูู" #"
DateValidationAction
ูู$ 8
.
ูู8 9
UseAsIs
ูู9 @
,
ูู@ A
ValidationFlags
ฺฺ 
=
ฺฺ  !!
DateValidationFlags
ฺฺ" 5
.
ฺฺ5 6
Valid
ฺฺ6 ;
,
ฺฺ; <
}
 
;
 
}
 	
public
ไไ 
static
ไไ 
List
ไไ 
<
ไไ "
DateValidationResult
ไไ /
>
ไไ/ 0#
ValidateMultipleDates
ไไ1 F
(
ไไF G

Dictionary
ๅๅ 
<
ๅๅ 
string
ๅๅ 
,
ๅๅ 
string
ๅๅ %
>
ๅๅ% &
dates
ๅๅ' ,
)
ๆๆ 	
{
็็ 	
var
่่ 
problems
่่ 
=
่่ 
new
่่ 
List
่่ #
<
่่# $"
DateValidationResult
่่$ 8
>
่่8 9
(
่่9 :
)
่่: ;
;
่่; <
foreach
๊๊ 
(
๊๊ 
var
๊๊ 
kvp
๊๊ 
in
๊๊ 
dates
๊๊  %
)
๊๊% &
{
๋๋ 
var
์์ 
result
์์ 
=
์์ 
ValidateDate
์์ )
(
์์) *
kvp
์์* -
.
์์- .
Value
์์. 3
,
์์3 4
kvp
์์5 8
.
์์8 9
Key
์์9 <
)
์์< =
;
์์= >
if
ํํ 
(
ํํ 
!
ํํ 
result
ํํ 
.
ํํ 
IsValid
ํํ #
)
ํํ# $
{
๎๎ 
result
๏๏ 
.
๏๏ 
Context
๏๏ "
=
๏๏# $
kvp
๏๏% (
.
๏๏( )
Key
๏๏) ,
;
๏๏, -
problems
๐๐ 
.
๐๐ 
Add
๐๐  
(
๐๐  !
result
๐๐! '
)
๐๐' (
;
๐๐( )
}
๑๑ 
}
๒๒ 
return
๔๔ 
problems
๔๔ 
;
๔๔ 
}
๕๕ 	
public
 
static
 
List
 
<
 "
ProblematicDateFound
 /
>
/ 0)
ScanFileForProblematicDates
1 L
(
L M
string
M S
filePath
T \
)
\ ]
{
 	
var
 
problems
 
=
 
new
 
List
 #
<
# $"
ProblematicDateFound
$ 8
>
8 9
(
9 :
)
: ;
;
; <
try
 
{
 
if
 
(
 
!
 
File
 
.
 
Exists
  
(
  !
filePath
! )
)
) *
)
* +
{
 
return
 
problems
 #
;
# $
}
 
var
 
content
 
=
 
File
 "
.
" #
ReadAllText
# .
(
. /
filePath
/ 7
)
7 8
;
8 9
var
 
matches
 
=
 
DatePattern
 )
.
) *
Matches
* 1
(
1 2
content
2 9
)
9 :
;
: ;
foreach
 
(
 
Match
 
match
 $
in
% '
matches
( /
)
/ 0
{
 
var
 

dateString
 "
=
# $
match
% *
.
* +
Value
+ 0
;
0 1
var
 

validation
 "
=
# $
ValidateDate
% 1
(
1 2

dateString
2 <
,
< =
filePath
> F
)
F G
;
G H
if
 
(
 
!
 

validation
 #
.
# $
IsValid
$ +
)
+ ,
{
 
problems
  
.
  !
Add
! $
(
$ %
new
 "
ProblematicDateFound
  4
{
 
FilePath
  (
=
) *
filePath
+ 3
,
3 4
	DateFound
  )
=
* +

dateString
, 6
,
6 7

LineNumber
  *
=
+ ,
GetLineNumber
- :
(
: ;
content
; B
,
B C
match
D I
.
I J
Index
J O
)
O P
,
P Q
ValidationResult
  0
=
1 2

validation
3 =
,
= >
}
 
)
 
;
 
}
 
}
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
problems
กก 
.
กก 
Add
กก 
(
กก 
new
ขข "
ProblematicDateFound
ขข ,
{
ฃฃ 
FilePath
คค  
=
คค! "
filePath
คค# +
,
คค+ ,
	DateFound
ฅฅ !
=
ฅฅ" #
$str
ฅฅ$ 0
,
ฅฅ0 1

LineNumber
ฆฆ "
=
ฆฆ# $
$num
ฆฆ% &
,
ฆฆ& '
ValidationResult
งง (
=
งง) *
new
งง+ ."
DateValidationResult
งง/ C
{
จจ 
IsValid
ฉฉ #
=
ฉฉ$ %
false
ฉฉ& +
,
ฉฉ+ ,
ErrorMessage
ชช (
=
ชช) *
$"
ชช+ -
$str
ชช- B
{
ชชB C
ex
ชชC E
.
ชชE F
Message
ชชF M
}
ชชM N
"
ชชN O
,
ชชO P
RecommendedAction
ซซ -
=
ซซ. /"
DateValidationAction
ซซ0 D
.
ซซD E
ManualReview
ซซE Q
,
ซซQ R
}
ฌฌ 
,
ฌฌ 
}
ญญ 
)
ฎฎ 
;
ฎฎ 
}
ฏฏ 
return
ฑฑ 
problems
ฑฑ 
;
ฑฑ 
}
ฒฒ 	
public
บบ 
static
บบ )
ProjectDateValidationReport
บบ 1
ScanProject
บบ2 =
(
บบ= >
string
บบ> D
projectPath
บบE P
=
บบQ R
$str
บบS V
)
บบV W
{
ปป 	
var
ผผ 
report
ผผ 
=
ผผ 
new
ผผ )
ProjectDateValidationReport
ผผ 8
{
ฝฝ 
ScanDate
พพ 
=
พพ 
DateTime
พพ #
.
พพ# $
Now
พพ$ '
,
พพ' (
ProjectPath
ฟฟ 
=
ฟฟ 
projectPath
ฟฟ )
,
ฟฟ) *
ProblematicFiles
ภภ  
=
ภภ! "
new
ภภ# &
List
ภภ' +
<
ภภ+ ,"
ProblematicDateFound
ภภ, @
>
ภภ@ A
(
ภภA B
)
ภภB C
,
ภภC D
}
มม 
;
มม 
try
รร 
{
ฤฤ 
var
ฦฦ 
filesToScan
ฦฦ 
=
ฦฦ  !
GetFilesToScan
ฦฦ" 0
(
ฦฦ0 1
projectPath
ฦฦ1 <
)
ฦฦ< =
;
ฦฦ= >
report
วว 
.
วว 
TotalFilesScanned
วว (
=
วว) *
filesToScan
วว+ 6
.
วว6 7
Count
วว7 <
;
วว< =
foreach
ษษ 
(
ษษ 
var
ษษ 
file
ษษ !
in
ษษ" $
filesToScan
ษษ% 0
)
ษษ0 1
{
สส 
var
หห 
problems
หห  
=
หห! ")
ScanFileForProblematicDates
หห# >
(
หห> ?
file
หห? C
)
หหC D
;
หหD E
report
ฬฬ 
.
ฬฬ 
ProblematicFiles
ฬฬ +
.
ฬฬ+ ,
AddRange
ฬฬ, 4
(
ฬฬ4 5
problems
ฬฬ5 =
)
ฬฬ= >
;
ฬฬ> ?
}
ออ 
report
ะะ 
.
ะะ  
TotalProblemsFound
ะะ )
=
ะะ* +
report
ะะ, 2
.
ะะ2 3
ProblematicFiles
ะะ3 C
.
ะะC D
Count
ะะD I
;
ะะI J
report
ัั 
.
ัั 
FilesWithProblems
ัั (
=
ัั) *
report
ัั+ 1
.
าา 
ProblematicFiles
าา %
.
าา% &
Select
าา& ,
(
าา, -
p
าา- .
=>
าา/ 1
p
าา2 3
.
าา3 4
FilePath
าา4 <
)
าา< =
.
ำำ 
Distinct
ำำ 
(
ำำ 
)
ำำ 
.
ิิ 
Count
ิิ 
(
ิิ 
)
ิิ 
;
ิิ 
report
ีี 
.
ีี #
BlacklistedDatesFound
ีี ,
=
ีี- .
report
ีี/ 5
.
ีี5 6
ProblematicFiles
ีี6 F
.
ีีF G
Count
ีีG L
(
ีีL M
p
ีีM N
=>
ีีO Q
p
ึึ 
.
ึึ 
ValidationResult
ึึ &
.
ึึ& '
ValidationFlags
ึึ' 6
.
ึึ6 7
HasFlag
ึึ7 >
(
ึึ> ?!
DateValidationFlags
ึึ? R
.
ึึR S
BlacklistedDate
ึึS b
)
ึึb c
)
ืื 
;
ืื 
}
ุุ 
catch
ูู 
(
ูู 
	Exception
ูู 
ex
ูู 
)
ูู  
{
ฺฺ 
report
 
.
 
	ScanError
  
=
! "
ex
# %
.
% &
Message
& -
;
- .
}
 
return
 
report
 
;
 
}
฿฿ 	
private
๋๋ 
static
๋๋ 
bool
๋๋ 
IsBlacklistedDate
๋๋ -
(
๋๋- .
string
๋๋. 4

dateString
๋๋5 ?
)
๋๋? @
{
์์ 	
return
ํํ 
BlacklistedDates
ํํ #
.
ํํ# $
Contains
ํํ$ ,
(
ํํ, -

dateString
ํํ- 7
)
ํํ7 8
;
ํํ8 9
}
๎๎ 	
private
๖๖ 
static
๖๖ 
int
๖๖ 
GetLineNumber
๖๖ (
(
๖๖( )
string
๖๖) /
text
๖๖0 4
,
๖๖4 5
int
๖๖6 9
position
๖๖: B
)
๖๖B C
{
๗๗ 	
if
๘๘ 
(
๘๘ 
position
๘๘ 
>=
๘๘ 
text
๘๘  
.
๘๘  !
Length
๘๘! '
)
๘๘' (
return
๙๙ 
$num
๙๙ 
;
๙๙ 
return
๛๛ 
text
๛๛ 
.
๛๛ 
	Substring
๛๛ !
(
๛๛! "
$num
๛๛" #
,
๛๛# $
position
๛๛% -
)
๛๛- .
.
๛๛. /
Count
๛๛/ 4
(
๛๛4 5
c
๛๛5 6
=>
๛๛7 9
c
๛๛: ;
==
๛๛< >
$char
๛๛? C
)
๛๛C D
+
๛๛E F
$num
๛๛G H
;
๛๛H I
}
 	
private
 
static
 
List
 
<
 
string
 "
>
" #
GetFilesToScan
$ 2
(
2 3
string
3 9
projectPath
: E
)
E F
{
 	
var
 
files
 
=
 
new
 
List
  
<
  !
string
! '
>
' (
(
( )
)
) *
;
* +
try
 
{
 
files
 
.
 
AddRange
 
(
 
	Directory
 
.
 
GetFiles
 &
(
& '
projectPath
' 2
,
2 3
$str
4 :
,
: ;
SearchOption
< H
.
H I
AllDirectories
I W
)
W X
)
 
;
 
files
 
.
 
AddRange
 
(
 
	Directory
 
.
 
GetFiles
 &
(
& '
projectPath
' 2
,
2 3
$str
4 :
,
: ;
SearchOption
< H
.
H I
AllDirectories
I W
)
W X
)
 
;
 
files
 
.
 
AddRange
 
(
 
	Directory
 
.
 
GetFiles
 &
(
& '
projectPath
' 2
,
2 3
$str
4 ;
,
; <
SearchOption
= I
.
I J
AllDirectories
J X
)
X Y
)
 
;
 
files
 
=
 
files
 
.
 
Where
 
(
 
f
 
=>
 
!
 
f
 
.
 
Contains
 #
(
# $
$str
$ ,
)
, -
&&
 
!
 
f
 
.
 
Contains
 &
(
& '
$str
' /
)
/ 0
&&
 
!
 
f
 
.
 
Contains
 &
(
& '
$str
' 4
)
4 5
&&
 
!
 
f
 
.
 
Contains
 &
(
& '
$str
' 0
)
0 1
)
 
.
 
ToList
 
(
 
)
 
;
 
}
กก 
catch
ขข 
(
ขข 
	Exception
ขข 
)
ขข 
{
ฃฃ 
files
ฅฅ 
.
ฅฅ 
Clear
ฅฅ 
(
ฅฅ 
)
ฅฅ 
;
ฅฅ 
}
ฆฆ 
return
จจ 
files
จจ 
;
จจ 
}
ฉฉ 	
public
ถถ 
static
ถถ "
DateValidationResult
ถถ *
ValidateForAI
ถถ+ 8
(
ถถ8 9
string
ทท 
proposedDate
ทท 
,
ทท  
AIOperationType
ธธ 
operationType
ธธ )
)
นน 	
{
บบ 	
var
ปป 
result
ปป 
=
ปป 
ValidateDate
ปป %
(
ปป% &
proposedDate
ปป& 2
,
ปป2 3
operationType
ปป4 A
.
ปปA B
ToString
ปปB J
(
ปปJ K
)
ปปK L
)
ปปL M
;
ปปM N
if
พพ 
(
พพ 
!
พพ 
result
พพ 
.
พพ 
IsValid
พพ 
&&
พพ  "
operationType
พพ# 0
==
พพ1 3
AIOperationType
พพ4 C
.
พพC D
RoutineUpdate
พพD Q
)
พพQ R
{
ฟฟ 
result
ภภ 
.
ภภ 
RecommendedAction
ภภ (
=
ภภ) *"
DateValidationAction
ภภ+ ?
.
ภภ? @
UseSystemDate
ภภ@ M
;
ภภM N
result
มม 
.
มม 
ErrorMessage
มม #
+=
มม$ &
$str
มม' ^
;
มม^ _
}
ยย 
else
รร 
if
รร 
(
รร 
!
รร 
result
รร 
.
รร 
IsValid
รร $
&&
รร% '
operationType
รร( 5
==
รร6 8
AIOperationType
รร9 H
.
รรH I
VersionRelease
รรI W
)
รรW X
{
ฤฤ 
result
ลล 
.
ลล 
RecommendedAction
ลล (
=
ลล) *"
DateValidationAction
ลล+ ?
.
ลล? @
ConfirmWithUser
ลล@ O
;
ลลO P
result
ฦฦ 
.
ฦฦ 
ErrorMessage
ฦฦ #
+=
ฦฦ$ &
$str
ฦฦ' W
;
ฦฦW X
}
วว 
return
ษษ 
result
ษษ 
;
ษษ 
}
สส 	
public
ัั 
static
ัั 
string
ัั %
GetValidatedCurrentDate
ัั 4
(
ัั4 5
)
ัั5 6
{
าา 	
var
ำำ 
currentDate
ำำ 
=
ำำ 

DateHelper
ำำ (
.
ำำ( )"
GetCurrentDateString
ำำ) =
(
ำำ= >
)
ำำ> ?
;
ำำ? @
var
ิิ 

validation
ิิ 
=
ิิ 
ValidateDate
ิิ )
(
ิิ) *
currentDate
ิิ* 5
,
ิิ5 6
$str
ิิ7 D
)
ิิD E
;
ิิE F
if
ึึ 
(
ึึ 

validation
ึึ 
.
ึึ 
IsValid
ึึ "
)
ึึ" #
{
ืื 
return
ุุ 
currentDate
ุุ "
;
ุุ" #
}
ูู 
var
 
now
 
=
 
DateTime
 
.
 
Now
 "
;
" #
return
 
$"
 
{
 
now
 
.
 
Year
 
:
 
$str
 !
}
! "
$str
" #
{
# $
now
$ '
.
' (
Month
( -
:
- .
$str
. 0
}
0 1
$str
1 2
{
2 3
now
3 6
.
6 7
Day
7 :
:
: ;
$str
; =
}
= >
"
> ?
;
? @
}
 	
}
แแ 
public
่่ 

class
่่ "
DateValidationResult
่่ %
{
้้ 
public
๊๊ 
bool
๊๊ 
IsValid
๊๊ 
{
๊๊ 
get
๊๊ !
;
๊๊! "
set
๊๊# &
;
๊๊& '
}
๊๊( )
public
๋๋ 
string
๋๋ 
ErrorMessage
๋๋ "
{
๋๋# $
get
๋๋% (
;
๋๋( )
set
๋๋* -
;
๋๋- .
}
๋๋/ 0
public
์์ 
string
์์ 
SuggestedDate
์์ #
{
์์$ %
get
์์& )
;
์์) *
set
์์+ .
;
์์. /
}
์์0 1
public
ํํ "
DateValidationAction
ํํ #
RecommendedAction
ํํ$ 5
{
ํํ6 7
get
ํํ8 ;
;
ํํ; <
set
ํํ= @
;
ํํ@ A
}
ํํB C
public
๎๎ !
DateValidationFlags
๎๎ "
ValidationFlags
๎๎# 2
{
๎๎3 4
get
๎๎5 8
;
๎๎8 9
set
๎๎: =
;
๎๎= >
}
๎๎? @
public
๏๏ 
string
๏๏ 
Context
๏๏ 
{
๏๏ 
get
๏๏  #
;
๏๏# $
set
๏๏% (
;
๏๏( )
}
๏๏* +
}
๐๐ 
public
๕๕ 

class
๕๕ "
ProblematicDateFound
๕๕ %
{
๖๖ 
public
๗๗ 
string
๗๗ 
FilePath
๗๗ 
{
๗๗  
get
๗๗! $
;
๗๗$ %
set
๗๗& )
;
๗๗) *
}
๗๗+ ,
public
๘๘ 
string
๘๘ 
	DateFound
๘๘ 
{
๘๘  !
get
๘๘" %
;
๘๘% &
set
๘๘' *
;
๘๘* +
}
๘๘, -
public
๙๙ 
int
๙๙ 

LineNumber
๙๙ 
{
๙๙ 
get
๙๙  #
;
๙๙# $
set
๙๙% (
;
๙๙( )
}
๙๙* +
public
๚๚ "
DateValidationResult
๚๚ #
ValidationResult
๚๚$ 4
{
๚๚5 6
get
๚๚7 :
;
๚๚: ;
set
๚๚< ?
;
๚๚? @
}
๚๚A B
}
๛๛ 
public
 

class
 )
ProjectDateValidationReport
 ,
{
 
public
 
DateTime
 
ScanDate
  
{
! "
get
# &
;
& '
set
( +
;
+ ,
}
- .
public
 
string
 
ProjectPath
 !
{
" #
get
$ '
;
' (
set
) ,
;
, -
}
. /
public
 
int
 
TotalFilesScanned
 $
{
% &
get
' *
;
* +
set
, /
;
/ 0
}
1 2
public
 
int
  
TotalProblemsFound
 %
{
& '
get
( +
;
+ ,
set
- 0
;
0 1
}
2 3
public
 
int
 
FilesWithProblems
 $
{
% &
get
' *
;
* +
set
, /
;
/ 0
}
1 2
public
 
int
 #
BlacklistedDatesFound
 (
{
) *
get
+ .
;
. /
set
0 3
;
3 4
}
5 6
public
 
List
 
<
 "
ProblematicDateFound
 (
>
( )
ProblematicFiles
* :
{
; <
get
= @
;
@ A
set
B E
;
E F
}
G H
public
 
string
 
	ScanError
 
{
  !
get
" %
;
% &
set
' *
;
* +
}
, -
}
 
public
 

enum
 "
DateValidationAction
 $
{
 
UseAsIs
 
,
 
UseSystemDate
 
,
 
ConfirmWithUser
 
,
 
ManualReview
 
,
 
}
 
[
 
Flags
 

]

 
public
 

enum
 !
DateValidationFlags
 #
{
 
Valid
 
=
 
$num
 
,
 
BlacklistedDate
 
=
 
$num
 
,
 
InvalidFormat
 
=
 
$num
 
,
 
TooFarInFuture
 
=
 
$num
 
,
 
TooFarInPast
กก 
=
กก 
$num
กก 
,
กก 
SuspiciousPattern
ขข 
=
ขข 
$num
ขข 
,
ขข 
}
ฃฃ 
public
จจ 

enum
จจ 
AIOperationType
จจ 
{
ฉฉ 
RoutineUpdate
ชช 
,
ชช 
VersionRelease
ซซ 
,
ซซ !
DocumentationUpdate
ฌฌ 
,
ฌฌ "
HistoricalCorrection
ญญ 
,
ญญ 
NewFileCreation
ฎฎ 
,
ฎฎ 
}
ฏฏ 
}ฒฒ พ
;C:\Playnite\_github\OstPlayer\source\DevTools\DateHelper.cs
	namespaceQQ 	
	OstPlayerQQ
 
.QQ 
DevToolsQQ 
{RR 
publicVV 

staticVV 
classVV 

DateHelperVV "
{WW 
privateYY 
staticYY 
readonlyYY 
RegexYY  %
UpdatedDateRegexYY& 6
=YY7 8
newYY9 <
RegexYY= B
(YYB C
$strZZ .
,ZZ. /
RegexOptions[[ 
.[[ 
Compiled[[ !
)\\ 	
;\\	 

private]] 
static]] 
readonly]] 
Regex]]  %
ChangelogRegex]]& 4
=]]5 6
new]]7 :
Regex]]; @
(]]@ A
$str^^ 
,^^ 
RegexOptions__ 
.__ 
Compiled__ !
)`` 	
;``	 

privateaa 
staticaa 
readonlyaa 
Regexaa  %
VersionRegexaa& 2
=aa3 4
newaa5 8
Regexaa9 >
(aa> ?
$strbb 
,bb  
RegexOptionscc 
.cc 
Compiledcc !
)dd 	
;dd	 

publicll 
staticll 
stringll  
GetCurrentDateStringll 1
(ll1 2
)ll2 3
{mm 	
returnnn 
DateTimenn 
.nn 
Nownn 
.nn  
ToStringnn  (
(nn( )
$strnn) 5
)nn5 6
;nn6 7
}oo 	
publicuu 
staticuu 
stringuu #
GetCurrentDateForHeaderuu 4
(uu4 5
)uu5 6
{vv 	
returnww 
$"ww 
$strww !
{ww! " 
GetCurrentDateStringww" 6
(ww6 7
)ww7 8
}ww8 9
"ww9 :
;ww: ;
}xx 	
public 
static 
string 
GetChangelogHeader /
(/ 0
string0 6
version7 >
)> ?
{
 	
return
 
$"
 
$str
 
{
 
version
 !
}
! "
$str
" &
{
& '"
GetCurrentDateString
' ;
(
; <
)
< =
}
= >
"
> ?
;
? @
}
 	
public
 
static
 
string
 
GetChangelogEntry
 .
(
. /
string
/ 5
version
6 =
,
= >
string
? E
description
F Q
)
Q R
{
 	
return
 
$"
 
{
 "
GetCurrentDateString
 *
(
* +
)
+ ,
}
, -
$str
- /
{
/ 0
version
0 7
}
7 8
$str
8 ;
{
; <
description
< G
}
G H
"
H I
;
I J
}
 	
public
 
static
 
bool
 
UpdateFileHeader
 +
(
+ ,
string
, 2
filePath
3 ;
)
; <
{
 	
try
 
{
 
if
 
(
 
!
 
File
 
.
 
Exists
  
(
  !
filePath
! )
)
) *
)
* +
{
 
return
 
false
  
;
  !
}
 
var
กก 
content
กก 
=
กก 
File
กก "
.
กก" #
ReadAllText
กก# .
(
กก. /
filePath
กก/ 7
,
กก7 8
Encoding
กก9 A
.
กกA B
UTF8
กกB F
)
กกF G
;
กกG H
var
ขข 
updatedContent
ขข "
=
ขข# $
UpdatedDateRegex
ขข% 5
.
ขข5 6
Replace
ขข6 =
(
ขข= >
content
ขข> E
,
ขขE F%
GetCurrentDateForHeader
ขขG ^
(
ขข^ _
)
ขข_ `
)
ขข` a
;
ขขa b
if
คค 
(
คค 
content
คค 
!=
คค 
updatedContent
คค -
)
คค- .
{
ฅฅ 
File
ฆฆ 
.
ฆฆ 
WriteAllText
ฆฆ %
(
ฆฆ% &
filePath
ฆฆ& .
,
ฆฆ. /
updatedContent
ฆฆ0 >
,
ฆฆ> ?
Encoding
ฆฆ@ H
.
ฆฆH I
UTF8
ฆฆI M
)
ฆฆM N
;
ฆฆN O
return
งง 
true
งง 
;
งง  
}
จจ 
return
ชช 
false
ชช 
;
ชช 
}
ซซ 
catch
ฌฌ 
(
ฌฌ 
	Exception
ฌฌ 
)
ฌฌ 
{
ญญ 
return
ฎฎ 
false
ฎฎ 
;
ฎฎ 
}
ฏฏ 
}
ฐฐ 	
public
นน 
static
นน 
bool
นน 
AddChangelogEntry
นน ,
(
นน, -
string
นน- 3
filePath
นน4 <
,
นน< =
string
นน> D
version
นนE L
,
นนL M
string
นนN T
description
นนU `
)
นน` a
{
บบ 	
try
ปป 
{
ผผ 
if
ฝฝ 
(
ฝฝ 
!
ฝฝ 
File
ฝฝ 
.
ฝฝ 
Exists
ฝฝ  
(
ฝฝ  !
filePath
ฝฝ! )
)
ฝฝ) *
)
ฝฝ* +
{
พพ 
return
ฟฟ 
false
ฟฟ  
;
ฟฟ  !
}
ภภ 
var
ยย 
content
ยย 
=
ยย 
File
ยย "
.
ยย" #
ReadAllText
ยย# .
(
ยย. /
filePath
ยย/ 7
,
ยย7 8
Encoding
ยย9 A
.
ยยA B
UTF8
ยยB F
)
ยยF G
;
ยยG H
var
รร 
changelogEntry
รร "
=
รร# $
GetChangelogEntry
รร% 6
(
รร6 7
version
รร7 >
,
รร> ?
description
รร@ K
)
รรK L
;
รรL M
var
ลล 
changelogMatch
ลล "
=
ลล# $
ChangelogRegex
ลล% 3
.
ลล3 4
Match
ลล4 9
(
ลล9 :
content
ลล: A
)
ลลA B
;
ลลB C
if
ฦฦ 
(
ฦฦ 
changelogMatch
ฦฦ "
.
ฦฦ" #
Success
ฦฦ# *
)
ฦฦ* +
{
วว 
var
ศศ 
insertIndex
ศศ #
=
ศศ$ %
changelogMatch
ศศ& 4
.
ศศ4 5
Index
ศศ5 :
+
ศศ; <
changelogMatch
ศศ= K
.
ศศK L
Length
ศศL R
;
ศศR S
var
ษษ 
updatedContent
ษษ &
=
ษษ' (
content
ษษ) 0
.
ษษ0 1
Insert
ษษ1 7
(
ษษ7 8
insertIndex
ษษ8 C
,
ษษC D
$"
ษษE G
$str
ษษG I
{
ษษI J
changelogEntry
ษษJ X
}
ษษX Y
"
ษษY Z
)
ษษZ [
;
ษษ[ \
File
หห 
.
หห 
WriteAllText
หห %
(
หห% &
filePath
หห& .
,
หห. /
updatedContent
หห0 >
,
หห> ?
Encoding
หห@ H
.
หหH I
UTF8
หหI M
)
หหM N
;
หหN O
return
ฬฬ 
true
ฬฬ 
;
ฬฬ  
}
ออ 
return
ฯฯ 
false
ฯฯ 
;
ฯฯ 
}
ะะ 
catch
ัั 
(
ัั 
	Exception
ัั 
)
ัั 
{
าา 
return
ำำ 
false
ำำ 
;
ำำ 
}
ิิ 
}
ีี 	
public
เเ 
static
เเ 
bool
เเ '
ValidateAllDatesInProject
เเ 4
(
เเ4 5
string
เเ5 ;
projectPath
เเ< G
=
เเH I
$str
เเJ M
)
เเM N
{
แแ 	
try
โโ 
{
ใใ 
var
ไไ 
issues
ไไ 
=
ไไ 
new
ไไ  
List
ไไ! %
<
ไไ% &
string
ไไ& ,
>
ไไ, -
(
ไไ- .
)
ไไ. /
;
ไไ/ 0
var
ๅๅ 
files
ๅๅ 
=
ๅๅ 
GetProjectFiles
ๅๅ +
(
ๅๅ+ ,
projectPath
ๅๅ, 7
)
ๅๅ7 8
;
ๅๅ8 9
foreach
็็ 
(
็็ 
var
็็ 
file
็็ !
in
็็" $
files
็็% *
)
็็* +
{
่่ 
ValidateFileDate
้้ $
(
้้$ %
file
้้% )
,
้้) *
issues
้้+ 1
)
้้1 2
;
้้2 3
}
๊๊ 
return
์์ 
issues
์์ 
.
์์ 
Count
์์ #
==
์์$ &
$num
์์' (
;
์์( )
}
ํํ 
catch
๎๎ 
(
๎๎ 
	Exception
๎๎ 
)
๎๎ 
{
๏๏ 
return
๐๐ 
false
๐๐ 
;
๐๐ 
}
๑๑ 
}
๒๒ 	
private
๙๙ 
static
๙๙ 
List
๙๙ 
<
๙๙ 
string
๙๙ "
>
๙๙" #
GetProjectFiles
๙๙$ 3
(
๙๙3 4
string
๙๙4 :
projectPath
๙๙; F
)
๙๙F G
{
๚๚ 	
var
๛๛ 
files
๛๛ 
=
๛๛ 
new
๛๛ 
List
๛๛  
<
๛๛  !
string
๛๛! '
>
๛๛' (
(
๛๛( )
)
๛๛) *
;
๛๛* +
files
 
.
 
AddRange
 
(
 
	Directory
 $
.
$ %
GetFiles
% -
(
- .
projectPath
. 9
,
9 :
$str
; A
,
A B
SearchOption
C O
.
O P
AllDirectories
P ^
)
^ _
)
_ `
;
` a
files
 
.
 
AddRange
 
(
 
	Directory
 $
.
$ %
GetFiles
% -
(
- .
projectPath
. 9
,
9 :
$str
; A
,
A B
SearchOption
C O
.
O P
AllDirectories
P ^
)
^ _
)
_ `
;
` a
files
 
.
 
AddRange
 
(
 
	Directory
 $
.
$ %
GetFiles
% -
(
- .
projectPath
. 9
,
9 :
$str
; B
,
B C
SearchOption
D P
.
P Q
AllDirectories
Q _
)
_ `
)
` a
;
a b
return
 
files
 
;
 
}
 	
private
 
static
 
void
 
ValidateFileDate
 ,
(
, -
string
- 3
filePath
4 <
,
< =
List
> B
<
B C
string
C I
>
I J
issues
K Q
)
Q R
{
 	
try
 
{
 
var
 
content
 
=
 
File
 "
.
" #
ReadAllText
# .
(
. /
filePath
/ 7
,
7 8
Encoding
9 A
.
A B
UTF8
B F
)
F G
;
G H
var
 
updatedMatch
  
=
! "
UpdatedDateRegex
# 3
.
3 4
Match
4 9
(
9 :
content
: A
)
A B
;
B C
if
 
(
 
updatedMatch
  
.
  !
Success
! (
)
( )
{
 
var
 

dateString
 "
=
# $
updatedMatch
% 1
.
1 2
Groups
2 8
[
8 9
$num
9 :
]
: ;
.
; <
Value
< A
;
A B
if
 
(
 
!
 
IsValidDateFormat
 *
(
* +

dateString
+ 5
)
5 6
)
6 7
{
 
issues
 
.
 
Add
 "
(
" #
$"
 
{
 
filePath
 '
}
' (
$str
( P
{
P Q

dateString
Q [
}
[ \
"
\ ]
)
 
;
 
}
 
}
 
}
 
catch
กก 
(
กก 
	Exception
กก 
ex
กก 
)
กก  
{
ขข 
issues
ฃฃ 
.
ฃฃ 
Add
ฃฃ 
(
ฃฃ 
$"
ฃฃ 
{
ฃฃ 
filePath
ฃฃ &
}
ฃฃ& '
$str
ฃฃ' A
{
ฃฃA B
ex
ฃฃB D
.
ฃฃD E
Message
ฃฃE L
}
ฃฃL M
"
ฃฃM N
)
ฃฃN O
;
ฃฃO P
}
คค 
}
ฅฅ 	
private
ฌฌ 
static
ฌฌ 
bool
ฌฌ 
IsValidDateFormat
ฌฌ -
(
ฌฌ- .
string
ฌฌ. 4

dateString
ฌฌ5 ?
)
ฌฌ? @
{
ญญ 	
return
ฎฎ 
DateTime
ฎฎ 
.
ฎฎ 
TryParseExact
ฎฎ )
(
ฎฎ) *

dateString
ฏฏ 
,
ฏฏ 
$str
ฐฐ 
,
ฐฐ 
null
ฑฑ 
,
ฑฑ 
System
ฒฒ 
.
ฒฒ 
Globalization
ฒฒ $
.
ฒฒ$ %
DateTimeStyles
ฒฒ% 3
.
ฒฒ3 4
None
ฒฒ4 8
,
ฒฒ8 9
out
ณณ 
_
ณณ 
)
ดด 
;
ดด 
}
ตต 	
public
ภภ 
static
ภภ 
string
ภภ +
GetValidatedCurrentDateString
ภภ :
(
ภภ: ;
)
ภภ; <
{
มม 	
return
ยย #
DateValidationService
ยย (
.
ยย( )%
GetValidatedCurrentDate
ยย) @
(
ยย@ A
)
ยยA B
;
ยยB C
}
รร 	
public
ฬฬ 
static
ฬฬ 
bool
ฬฬ ,
UpdateFileHeaderWithValidation
ฬฬ 9
(
ฬฬ9 :
string
ออ 
filePath
ออ 
,
ออ 
AIOperationType
ฮฮ 
operationType
ฮฮ )
=
ฮฮ* +
AIOperationType
ฮฮ, ;
.
ฮฮ; <
RoutineUpdate
ฮฮ< I
)
ฯฯ 	
{
ะะ 	
try
ัั 
{
าา 
if
ำำ 
(
ำำ 
!
ำำ 
File
ำำ 
.
ำำ 
Exists
ำำ  
(
ำำ  !
filePath
ำำ! )
)
ำำ) *
)
ำำ* +
{
ิิ 
return
ีี 
false
ีี  
;
ีี  !
}
ึึ 
var
ูู 
validatedDate
ูู !
=
ูู" ##
DateValidationService
ูู$ 9
.
ูู9 :%
GetValidatedCurrentDate
ูู: Q
(
ููQ R
)
ููR S
;
ููS T
var
ฺฺ 
validationResult
ฺฺ $
=
ฺฺ% &#
DateValidationService
ฺฺ' <
.
ฺฺ< =
ValidateForAI
ฺฺ= J
(
ฺฺJ K
validatedDate
 !
,
! "
operationType
 !
)
 
;
 
if
฿฿ 
(
฿฿ 
!
฿฿ 
validationResult
฿฿ %
.
฿฿% &
IsValid
฿฿& -
)
฿฿- .
{
เเ 
return
โโ 
false
โโ  
;
โโ  !
}
ใใ 
var
ๅๅ 
content
ๅๅ 
=
ๅๅ 
File
ๅๅ "
.
ๅๅ" #
ReadAllText
ๅๅ# .
(
ๅๅ. /
filePath
ๅๅ/ 7
,
ๅๅ7 8
Encoding
ๅๅ9 A
.
ๅๅA B
UTF8
ๅๅB F
)
ๅๅF G
;
ๅๅG H
var
ๆๆ 
updatedContent
ๆๆ "
=
ๆๆ# $
UpdatedDateRegex
ๆๆ% 5
.
ๆๆ5 6
Replace
ๆๆ6 =
(
ๆๆ= >
content
็็ 
,
็็ 
$"
่่ 
$str
่่ "
{
่่" #
validatedDate
่่# 0
}
่่0 1
"
่่1 2
)
้้ 
;
้้ 
if
๋๋ 
(
๋๋ 
content
๋๋ 
!=
๋๋ 
updatedContent
๋๋ -
)
๋๋- .
{
์์ 
File
ํํ 
.
ํํ 
WriteAllText
ํํ %
(
ํํ% &
filePath
ํํ& .
,
ํํ. /
updatedContent
ํํ0 >
,
ํํ> ?
Encoding
ํํ@ H
.
ํํH I
UTF8
ํํI M
)
ํํM N
;
ํํN O
return
๎๎ 
true
๎๎ 
;
๎๎  
}
๏๏ 
return
๑๑ 
false
๑๑ 
;
๑๑ 
}
๒๒ 
catch
๓๓ 
(
๓๓ 
	Exception
๓๓ 
)
๓๓ 
{
๔๔ 
return
๕๕ 
false
๕๕ 
;
๕๕ 
}
๖๖ 
}
๗๗ 	
public
 
static
 
bool
 (
AddValidatedChangelogEntry
 5
(
5 6
string
 
filePath
 
,
 
string
 
version
 
,
 
string
 
description
 
,
 
AIOperationType
 
operationType
 )
=
* +
AIOperationType
, ;
.
; <
VersionRelease
< J
)
 	
{
 	
try
 
{
 
if
 
(
 
!
 
File
 
.
 
Exists
  
(
  !
filePath
! )
)
) *
)
* +
{
 
return
 
false
  
;
  !
}
 
var
 
validatedDate
 !
=
" ##
DateValidationService
$ 9
.
9 :%
GetValidatedCurrentDate
: Q
(
Q R
)
R S
;
S T
var
 
validationResult
 $
=
% &#
DateValidationService
' <
.
< =
ValidateForAI
= J
(
J K
validatedDate
 !
,
! "
operationType
 !
)
 
;
 
if
 
(
 
!
 
validationResult
 %
.
% &
IsValid
& -
)
- .
{
 
return
 
false
  
;
  !
}
 
var
 
content
 
=
 
File
 "
.
" #
ReadAllText
# .
(
. /
filePath
/ 7
,
7 8
Encoding
9 A
.
A B
UTF8
B F
)
F G
;
G H
var
 
changelogEntry
 "
=
# $
$"
% '
{
' (
validatedDate
( 5
}
5 6
$str
6 8
{
8 9
version
9 @
}
@ A
$str
A D
{
D E
description
E P
}
P Q
"
Q R
;
R S
var
 
changelogMatch
 "
=
# $
ChangelogRegex
% 3
.
3 4
Match
4 9
(
9 :
content
: A
)
A B
;
B C
if
 
(
 
changelogMatch
 "
.
" #
Success
# *
)
* +
{
กก 
var
ขข 
insertIndex
ขข #
=
ขข$ %
changelogMatch
ขข& 4
.
ขข4 5
Index
ขข5 :
+
ขข; <
changelogMatch
ขข= K
.
ขขK L
Length
ขขL R
;
ขขR S
var
ฃฃ 
updatedContent
ฃฃ &
=
ฃฃ' (
content
ฃฃ) 0
.
ฃฃ0 1
Insert
ฃฃ1 7
(
ฃฃ7 8
insertIndex
ฃฃ8 C
,
ฃฃC D
$"
ฃฃE G
$str
ฃฃG I
{
ฃฃI J
changelogEntry
ฃฃJ X
}
ฃฃX Y
"
ฃฃY Z
)
ฃฃZ [
;
ฃฃ[ \
File
ฅฅ 
.
ฅฅ 
WriteAllText
ฅฅ %
(
ฅฅ% &
filePath
ฅฅ& .
,
ฅฅ. /
updatedContent
ฅฅ0 >
,
ฅฅ> ?
Encoding
ฅฅ@ H
.
ฅฅH I
UTF8
ฅฅI M
)
ฅฅM N
;
ฅฅN O
return
ฆฆ 
true
ฆฆ 
;
ฆฆ  
}
งง 
return
ฉฉ 
false
ฉฉ 
;
ฉฉ 
}
ชช 
catch
ซซ 
(
ซซ 
	Exception
ซซ 
)
ซซ 
{
ฌฌ 
return
ญญ 
false
ญญ 
;
ญญ 
}
ฎฎ 
}
ฏฏ 	
public
ฝฝ 
static
ฝฝ 
bool
ฝฝ $
UpdateOnlyDateInHeader
ฝฝ 1
(
ฝฝ1 2
string
ฝฝ2 8
filePath
ฝฝ9 A
,
ฝฝA B
string
ฝฝC I

targetDate
ฝฝJ T
=
ฝฝU V
null
ฝฝW [
)
ฝฝ[ \
{
พพ 	
try
ฟฟ 
{
ภภ 
if
มม 
(
มม 
!
มม 
File
มม 
.
มม 
Exists
มม  
(
มม  !
filePath
มม! )
)
มม) *
)
มม* +
{
ยย 
return
รร 
false
รร  
;
รร  !
}
ฤฤ 
var
ฦฦ 
content
ฦฦ 
=
ฦฦ 
File
ฦฦ "
.
ฦฦ" #
ReadAllText
ฦฦ# .
(
ฦฦ. /
filePath
ฦฦ/ 7
,
ฦฦ7 8
Encoding
ฦฦ9 A
.
ฦฦA B
UTF8
ฦฦB F
)
ฦฦF G
;
ฦฦG H
var
วว 
originalContent
วว #
=
วว$ %
content
วว& -
;
วว- .
var
สส 
	dateToUse
สส 
=
สส 

targetDate
สส  *
??
สส+ -#
DateValidationService
สส. C
.
สสC D%
GetValidatedCurrentDate
สสD [
(
สส[ \
)
สส\ ]
;
สส] ^
var
ออ 
updatedLine
ออ 
=
ออ  !
$"
ออ" $
$str
ออ$ 0
{
ออ0 1
	dateToUse
ออ1 :
}
ออ: ;
"
ออ; <
;
ออ< =
var
ฮฮ 

newContent
ฮฮ 
=
ฮฮ  
UpdatedDateRegex
ฮฮ! 1
.
ฮฮ1 2
Replace
ฮฮ2 9
(
ฮฮ9 :
content
ฮฮ: A
,
ฮฮA B
updatedLine
ฮฮC N
)
ฮฮN O
;
ฮฮO P
if
ัั 
(
ัั 

newContent
ัั 
!=
ัั !
originalContent
ัั" 1
)
ัั1 2
{
าา 
File
ำำ 
.
ำำ 
WriteAllText
ำำ %
(
ำำ% &
filePath
ำำ& .
,
ำำ. /

newContent
ำำ0 :
,
ำำ: ;
Encoding
ำำ< D
.
ำำD E
UTF8
ำำE I
)
ำำI J
;
ำำJ K
return
ิิ 
true
ิิ 
;
ิิ  
}
ีี 
return
ืื 
false
ืื 
;
ืื 
}
ุุ 
catch
ูู 
(
ูู 
	Exception
ูู 
)
ูู 
{
ฺฺ 
return
 
false
 
;
 
}
 
}
 	
public
้้ 
static
้้ 
bool
้้ %
SafelyAddChangelogEntry
้้ 2
(
้้2 3
string
๊๊ 
filePath
๊๊ 
,
๊๊ 
string
๋๋ 
version
๋๋ 
,
๋๋ 
string
์์ 
description
์์ 
,
์์ 
string
ํํ 

targetDate
ํํ 
=
ํํ 
null
ํํ  $
)
๎๎ 	
{
๏๏ 	
try
๐๐ 
{
๑๑ 
if
๒๒ 
(
๒๒ 
!
๒๒ 
File
๒๒ 
.
๒๒ 
Exists
๒๒  
(
๒๒  !
filePath
๒๒! )
)
๒๒) *
)
๒๒* +
{
๓๓ 
return
๔๔ 
false
๔๔  
;
๔๔  !
}
๕๕ 
var
๗๗ 
content
๗๗ 
=
๗๗ 
File
๗๗ "
.
๗๗" #
ReadAllText
๗๗# .
(
๗๗. /
filePath
๗๗/ 7
,
๗๗7 8
Encoding
๗๗9 A
.
๗๗A B
UTF8
๗๗B F
)
๗๗F G
;
๗๗G H
var
๚๚ 
	dateToUse
๚๚ 
=
๚๚ 

targetDate
๚๚  *
??
๚๚+ -#
DateValidationService
๚๚. C
.
๚๚C D%
GetValidatedCurrentDate
๚๚D [
(
๚๚[ \
)
๚๚\ ]
;
๚๚] ^
var
๛๛ 
changelogEntry
๛๛ "
=
๛๛# $
$"
๛๛% '
{
๛๛' (
	dateToUse
๛๛( 1
}
๛๛1 2
$str
๛๛2 4
{
๛๛4 5
version
๛๛5 <
}
๛๛< =
$str
๛๛= @
{
๛๛@ A
description
๛๛A L
}
๛๛L M
"
๛๛M N
;
๛๛N O
var
 
changelogMatch
 "
=
# $
ChangelogRegex
% 3
.
3 4
Match
4 9
(
9 :
content
: A
)
A B
;
B C
if
 
(
 
changelogMatch
 "
.
" #
Success
# *
)
* +
{
 
var
 
insertIndex
 #
=
$ %
changelogMatch
& 4
.
4 5
Index
5 :
+
; <
changelogMatch
= K
.
K L
Length
L R
;
R S
var
 
updatedContent
 &
=
' (
content
) 0
.
0 1
Insert
1 7
(
7 8
insertIndex
8 C
,
C D
$"
E G
$str
G I
{
I J
changelogEntry
J X
}
X Y
"
Y Z
)
Z [
;
[ \
File
 
.
 
WriteAllText
 %
(
% &
filePath
& .
,
. /
updatedContent
0 >
,
> ?
Encoding
@ H
.
H I
UTF8
I M
)
M N
;
N O
return
 
true
 
;
  
}
 
return
 
false
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
public
 
static
 $
HeaderValidationResult
 ,%
ValidateHeaderIntegrity
- D
(
D E
string
E K
filePath
L T
)
T U
{
 	
var
 
result
 
=
 
new
 $
HeaderValidationResult
 3
{
 
FilePath
 
=
 
filePath
 #
,
# $
IsValid
 
=
 
true
 
,
 
MissingSections
 
=
  !
new
" %
List
& *
<
* +
string
+ 1
>
1 2
(
2 3
)
3 4
,
4 5
}
 
;
 
try
 
{
 
if
กก 
(
กก 
!
กก 
File
กก 
.
กก 
Exists
กก  
(
กก  !
filePath
กก! )
)
กก) *
)
กก* +
{
ขข 
result
ฃฃ 
.
ฃฃ 
IsValid
ฃฃ "
=
ฃฃ# $
false
ฃฃ% *
;
ฃฃ* +
result
คค 
.
คค 
MissingSections
คค *
.
คค* +
Add
คค+ .
(
คค. /
$str
คค/ ?
)
คค? @
;
คค@ A
return
ฅฅ 
result
ฅฅ !
;
ฅฅ! "
}
ฆฆ 
var
จจ 
content
จจ 
=
จจ 
File
จจ "
.
จจ" #
ReadAllText
จจ# .
(
จจ. /
filePath
จจ/ 7
,
จจ7 8
Encoding
จจ9 A
.
จจA B
UTF8
จจB F
)
จจF G
;
จจG H
var
ซซ 
requiredSections
ซซ $
=
ซซ% &
new
ซซ' *

Dictionary
ซซ+ 5
<
ซซ5 6
string
ซซ6 <
,
ซซ< =
string
ซซ> D
>
ซซD E
{
ฌฌ 
{
ญญ 
$str
ญญ #
,
ญญ# $
$str
ญญ% 6
}
ญญ7 8
,
ญญ8 9
{
ฎฎ 
$str
ฎฎ *
,
ฎฎ* +
$str
ฎฎ, D
}
ฎฎE F
,
ฎฎF G
{
ฏฏ 
$str
ฏฏ $
,
ฏฏ$ %
$str
ฏฏ& 2
}
ฏฏ3 4
,
ฏฏ4 5
{
ฐฐ 
$str
ฐฐ 
,
ฐฐ  
$str
ฐฐ! .
}
ฐฐ/ 0
,
ฐฐ0 1
{
ฑฑ 
$str
ฑฑ %
,
ฑฑ% &
$str
ฑฑ' :
}
ฑฑ; <
,
ฑฑ< =
{
ฒฒ 
$str
ฒฒ &
,
ฒฒ& '
$str
ฒฒ( 6
}
ฒฒ7 8
,
ฒฒ8 9
{
ณณ 
$str
ณณ "
,
ณณ" #
$str
ณณ$ .
}
ณณ/ 0
,
ณณ0 1
}
ดด 
;
ดด 
foreach
ถถ 
(
ถถ 
var
ถถ 
section
ถถ $
in
ถถ% '
requiredSections
ถถ( 8
)
ถถ8 9
{
ทท 
if
ธธ 
(
ธธ 
!
ธธ 
content
ธธ  
.
ธธ  !
Contains
ธธ! )
(
ธธ) *
section
ธธ* 1
.
ธธ1 2
Value
ธธ2 7
)
ธธ7 8
)
ธธ8 9
{
นน 
result
บบ 
.
บบ 
MissingSections
บบ .
.
บบ. /
Add
บบ/ 2
(
บบ2 3
section
บบ3 :
.
บบ: ;
Key
บบ; >
)
บบ> ?
;
บบ? @
result
ปป 
.
ปป 
IsValid
ปป &
=
ปป' (
false
ปป) .
;
ปป. /
}
ผผ 
}
ฝฝ 
return
ฟฟ 
result
ฟฟ 
;
ฟฟ 
}
ภภ 
catch
มม 
(
มม 
	Exception
มม 
ex
มม 
)
มม  
{
ยย 
result
รร 
.
รร 
IsValid
รร 
=
รร  
false
รร! &
;
รร& '
result
ฤฤ 
.
ฤฤ 
MissingSections
ฤฤ &
.
ฤฤ& '
Add
ฤฤ' *
(
ฤฤ* +
$"
ฤฤ+ -
$str
ฤฤ- ?
{
ฤฤ? @
ex
ฤฤ@ B
.
ฤฤB C
Message
ฤฤC J
}
ฤฤJ K
"
ฤฤK L
)
ฤฤL M
;
ฤฤM N
return
ลล 
result
ลล 
;
ลล 
}
ฦฦ 
}
วว 	
public
าา 
static
าา 
string
าา 
GetFileVersion
าา +
(
าา+ ,
string
าา, 2
filePath
าา3 ;
)
าา; <
{
ำำ 	
try
ิิ 
{
ีี 
if
ึึ 
(
ึึ 
!
ึึ 
File
ึึ 
.
ึึ 
Exists
ึึ  
(
ึึ  !
filePath
ึึ! )
)
ึึ) *
)
ึึ* +
{
ืื 
return
ุุ 
null
ุุ 
;
ุุ  
}
ูู 
var
 
content
 
=
 
File
 "
.
" #
ReadAllText
# .
(
. /
filePath
/ 7
,
7 8
Encoding
9 A
.
A B
UTF8
B F
)
F G
;
G H
var
 
versionMatch
  
=
! "
VersionRegex
# /
.
/ 0
Match
0 5
(
5 6
content
6 =
)
= >
;
> ?
return
 
versionMatch
 #
.
# $
Success
$ +
?
, -
versionMatch
. :
.
: ;
Groups
; A
[
A B
$num
B C
]
C D
.
D E
Value
E J
.
J K
Trim
K O
(
O P
)
P Q
:
R S
null
T X
;
X Y
}
฿฿ 
catch
เเ 
(
เเ 
	Exception
เเ 
)
เเ 
{
แแ 
return
โโ 
null
โโ 
;
โโ 
}
ใใ 
}
ไไ 	
public
๋๋ 
static
๋๋ 
bool
๋๋ 
HasValidHeader
๋๋ )
(
๋๋) *
string
๋๋* 0
filePath
๋๋1 9
)
๋๋9 :
{
์์ 	
try
ํํ 
{
๎๎ 
if
๏๏ 
(
๏๏ 
!
๏๏ 
File
๏๏ 
.
๏๏ 
Exists
๏๏  
(
๏๏  !
filePath
๏๏! )
)
๏๏) *
)
๏๏* +
{
๐๐ 
return
๑๑ 
false
๑๑  
;
๑๑  !
}
๒๒ 
var
๔๔ 
content
๔๔ 
=
๔๔ 
File
๔๔ "
.
๔๔" #
ReadAllText
๔๔# .
(
๔๔. /
filePath
๔๔/ 7
,
๔๔7 8
Encoding
๔๔9 A
.
๔๔A B
UTF8
๔๔B F
)
๔๔F G
;
๔๔G H
return
๗๗ 
content
๗๗ 
.
๗๗ 
Contains
๗๗ '
(
๗๗' (
$str
๗๗( 2
)
๗๗2 3
&&
๘๘ 
content
๘๘ 
.
๘๘ 
Contains
๘๘ '
(
๘๘' (
$str
๘๘( 5
)
๘๘5 6
&&
๙๙ 
content
๙๙ 
.
๙๙ 
Contains
๙๙ '
(
๙๙' (
$str
๙๙( 5
)
๙๙5 6
&&
๚๚ 
content
๚๚ 
.
๚๚ 
Contains
๚๚ '
(
๚๚' (
$str
๚๚( 5
)
๚๚5 6
;
๚๚6 7
}
๛๛ 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
}
 
} 
public 
class
 $
HeaderValidationResult
 #
{ 
public
 

string
 
FilePath
 
{
 
get
  
;
  !
set
" %
;
% &
}
' (
public
 

bool
 
IsValid
 
{
 
get
 
;
 
set
 "
;
" #
}
$ %
public
 

List
 
<
 
string
 
>
 
MissingSections
 '
{
( )
get
* -
;
- .
set
/ 2
;
2 3
}
4 5
=
6 7
new
8 ;
List
< @
<
@ A
string
A G
>
G H
(
H I
)
I J
;
J K
public
 

string
 "
GetValidationSummary
 &
(
& '
)
' (
{
 
if
 

(
 
IsValid
 
)
 
{
 	
return
 
$str
 F
;
F G
}
 	
return
 
$"
 
$str
 >
{
> ?
string
? E
.
E F
Join
F J
(
J K
$str
K O
,
O P
MissingSections
Q `
)
` a
}
a b
"
b c
;
c d
}
 
} ใ
>C:\Playnite\_github\OstPlayer\source\DevTools\CodeGenerator.cs
	namespace`` 	
	OstPlayer``
 
.`` 
DevTools`` 
{aa 
publicee 

staticee 
classee 
CodeGeneratoree %
{ff 
privatehh 
statichh 
readonlyhh 

Dictionaryhh  *
<hh* +
stringhh+ 1
,hh1 2
stringhh3 9
>hh9 :
	Templateshh; D
=hhE F
newii 

Dictionaryii 
<ii 
stringii !
,ii! "
stringii# )
>ii) *
(ii* +
)ii+ ,
;ii, -
privatell 
staticll 
readonlyll 
Regexll  % 
MethodSignatureRegexll& :
=ll; <
newll= @
RegexllA F
(llF G
$strmm y
,mmy z
RegexOptionsnn 
.nn 
Compilednn !
)oo 	
;oo	 

privatepp 
staticpp 
readonlypp 
Regexpp  %
PropertyRegexpp& 3
=pp4 5
newpp6 9
Regexpp: ?
(pp? @
$strqq Z
,qqZ [
RegexOptionsrr 
.rr 
Compiledrr !
)ss 	
;ss	 

privatett 
statictt 
readonlytt 
Regextt  %

ClassRegextt& 0
=tt1 2
newtt3 6
Regextt7 <
(tt< =
$struu [
,uu[ \
RegexOptionsvv 
.vv 
Compiledvv !
)ww 	
;ww	 

staticyy 
CodeGeneratoryy 
(yy 
)yy 
{zz 	
InitializeTemplates{{ 
({{  
){{  !
;{{! "
}|| 	
public
 
static
 
string
  
GenerateFileHeader
 /
(
/ 0
string
 
fileName
 
,
 
string
 
module
 
,
 
string
 
purpose
 
,
 
string
 
location
 
=
 
null
 "
,
" #
string
 
version
 
=
 
$str
 $
)
 	
{
 	
var
 
currentDate
 
=
 

DateHelper
 (
.
( )"
GetCurrentDateString
) =
(
= >
)
> ?
;
? @
location
 
=
 
location
 
??
  "
$"
# %
{
% &
module
& ,
}
, -
$str
- .
"
. /
;
/ 0
var
 
header
 
=
 
new
 
StringBuilder
 *
(
* +
)
+ ,
;
, -
header
 
.
 

AppendLine
 
(
 
$str
 Y
)
 
;
 
header
 
.
 

AppendLine
 
(
 
$"
  
$str
  )
{
) *
fileName
* 2
}
2 3
"
3 4
)
4 5
;
5 6
header
 
.
 

AppendLine
 
(
 
$str
 X
)
 
;
 
header
 
.
 

AppendLine
 
(
 
$"
  
$str
  +
{
+ ,
module
, 2
}
2 3
"
3 4
)
4 5
;
5 6
header
 
.
 

AppendLine
 
(
 
$"
  
$str
  -
{
- .
location
. 6
}
6 7
"
7 8
)
8 9
;
9 :
header
 
.
 

AppendLine
 
(
 
$"
  
$str
  ,
{
, -
version
- 4
}
4 5
"
5 6
)
6 7
;
7 8
header
 
.
 

AppendLine
 
(
 
$"
  
$str
  ,
{
, -
currentDate
- 8
}
8 9
"
9 :
)
: ;
;
; <
header
 
.
 

AppendLine
 
(
 
$"
  
$str
  ,
{
, -
currentDate
- 8
}
8 9
"
9 :
)
: ;
;
; <
header
 
.
 

AppendLine
 
(
 
$str
 3
)
3 4
;
4 5
header
 
.
 

AppendLine
 
(
 
$str
กก Y
)
ขข 
;
ขข 
header
ฃฃ 
.
ฃฃ 

AppendLine
ฃฃ 
(
ฃฃ 
$str
ฃฃ "
)
ฃฃ" #
;
ฃฃ# $
header
คค 
.
คค 

AppendLine
คค 
(
คค 
$str
คค +
)
คค+ ,
;
คค, -
header
ฅฅ 
.
ฅฅ 

AppendLine
ฅฅ 
(
ฅฅ 
$"
ฅฅ  
$str
ฅฅ  #
{
ฅฅ# $
purpose
ฅฅ$ +
}
ฅฅ+ ,
"
ฅฅ, -
)
ฅฅ- .
;
ฅฅ. /
header
ฆฆ 
.
ฆฆ 

AppendLine
ฆฆ 
(
ฆฆ 
$str
ฆฆ "
)
ฆฆ" #
;
ฆฆ# $'
AddModuleSpecificSections
ฉฉ %
(
ฉฉ% &
header
ฉฉ& ,
,
ฉฉ, -
module
ฉฉ. 4
)
ฉฉ4 5
;
ฉฉ5 6
header
ซซ 
.
ซซ 

AppendLine
ซซ 
(
ซซ 
$str
ซซ 1
)
ซซ1 2
;
ซซ2 3
header
ฌฌ 
.
ฌฌ 

AppendLine
ฌฌ 
(
ฌฌ 
$str
ฌฌ 9
)
ฌฌ9 :
;
ฌฌ: ;
header
ญญ 
.
ญญ 

AppendLine
ญญ 
(
ญญ 
$str
ญญ +
)
ญญ+ ,
;
ญญ, -
header
ฎฎ 
.
ฎฎ 

AppendLine
ฎฎ 
(
ฎฎ 
$str
ฎฎ "
)
ฎฎ" #
;
ฎฎ# $
header
ฏฏ 
.
ฏฏ 

AppendLine
ฏฏ 
(
ฏฏ 
$str
ฏฏ -
)
ฏฏ- .
;
ฏฏ. /
header
ฐฐ 
.
ฐฐ 

AppendLine
ฐฐ 
(
ฐฐ 
$"
ฐฐ  
$str
ฐฐ  #
{
ฐฐ# $
currentDate
ฐฐ$ /
}
ฐฐ/ 0
$str
ฐฐ0 2
{
ฐฐ2 3
version
ฐฐ3 :
}
ฐฐ: ;
$str
ฐฐ; T
"
ฐฐT U
)
ฐฐU V
;
ฐฐV W
header
ฑฑ 
.
ฑฑ 

AppendLine
ฑฑ 
(
ฑฑ 
$str
ฒฒ Y
)
ณณ 
;
ณณ 
return
ตต 
header
ตต 
.
ตต 
ToString
ตต "
(
ตต" #
)
ตต# $
;
ตต$ %
}
ถถ 	
private
ฝฝ 
static
ฝฝ 
void
ฝฝ '
AddModuleSpecificSections
ฝฝ 5
(
ฝฝ5 6
StringBuilder
ฝฝ6 C
header
ฝฝD J
,
ฝฝJ K
string
ฝฝL R
module
ฝฝS Y
)
ฝฝY Z
{
พพ 	
switch
ฟฟ 
(
ฟฟ 
module
ฟฟ 
.
ฟฟ 
ToLowerInvariant
ฟฟ +
(
ฟฟ+ ,
)
ฟฟ, -
)
ฟฟ- .
{
ภภ 
case
มม 
$str
มม !
:
มม! "
header
ยย 
.
ยย 

AppendLine
ยย %
(
ยย% &
$str
ยย& ;
)
ยย; <
;
ยย< =
header
รร 
.
รร 

AppendLine
รร %
(
รร% &
$str
รร& H
)
รรH I
;
รรI J
header
ฤฤ 
.
ฤฤ 

AppendLine
ฤฤ %
(
ฤฤ% &
$str
ฤฤ& M
)
ฤฤM N
;
ฤฤN O
header
ลล 
.
ลล 

AppendLine
ลล %
(
ลล% &
$str
ลล& V
)
ลลV W
;
ลลW X
header
ฦฦ 
.
ฦฦ 

AppendLine
ฦฦ %
(
ฦฦ% &
$str
ฦฦ& *
)
ฦฦ* +
;
ฦฦ+ ,
header
วว 
.
วว 

AppendLine
วว %
(
วว% &
$str
วว& =
)
วว= >
;
วว> ?
header
ศศ 
.
ศศ 

AppendLine
ศศ %
(
ศศ% &
$str
ศศ& M
)
ศศM N
;
ศศN O
header
ษษ 
.
ษษ 

AppendLine
ษษ %
(
ษษ% &
$str
ษษ& G
)
ษษG H
;
ษษH I
header
สส 
.
สส 

AppendLine
สส %
(
สส% &
$str
สส& B
)
สสB C
;
สสC D
header
หห 
.
หห 

AppendLine
หห %
(
หห% &
$str
หห& *
)
หห* +
;
หห+ ,
break
ฬฬ 
;
ฬฬ 
case
ฮฮ 
$str
ฮฮ 
:
ฮฮ  
header
ฯฯ 
.
ฯฯ 

AppendLine
ฯฯ %
(
ฯฯ% &
$str
ฯฯ& D
)
ฯฯD E
;
ฯฯE F
header
ะะ 
.
ะะ 

AppendLine
ะะ %
(
ะะ% &
$str
ะะ& T
)
ะะT U
;
ะะU V
header
ัั 
.
ัั 

AppendLine
ัั %
(
ัั% &
$str
ัั& B
)
ััB C
;
ััC D
header
าา 
.
าา 

AppendLine
าา %
(
าา% &
$str
าา& B
)
าาB C
;
าาC D
header
ำำ 
.
ำำ 

AppendLine
ำำ %
(
ำำ% &
$str
ำำ& *
)
ำำ* +
;
ำำ+ ,
header
ิิ 
.
ิิ 

AppendLine
ิิ %
(
ิิ% &
$str
ิิ& 9
)
ิิ9 :
;
ิิ: ;
header
ีี 
.
ีี 

AppendLine
ีี %
(
ีี% &
$str
ีี& G
)
ีีG H
;
ีีH I
header
ึึ 
.
ึึ 

AppendLine
ึึ %
(
ึึ% &
$str
ึึ& G
)
ึึG H
;
ึึH I
header
ืื 
.
ืื 

AppendLine
ืื %
(
ืื% &
$str
ืื& >
)
ืื> ?
;
ืื? @
header
ุุ 
.
ุุ 

AppendLine
ุุ %
(
ุุ% &
$str
ุุ& *
)
ุุ* +
;
ุุ+ ,
break
ูู 
;
ูู 
case
 
$str
 
:
 
header
 
.
 

AppendLine
 %
(
% &
$str
& =
)
= >
;
> ?
header
 
.
 

AppendLine
 %
(
% &
$str
& Q
)
Q R
;
R S
header
 
.
 

AppendLine
 %
(
% &
$str
& >
)
> ?
;
? @
header
฿฿ 
.
฿฿ 

AppendLine
฿฿ %
(
฿฿% &
$str
฿฿& R
)
฿฿R S
;
฿฿S T
header
เเ 
.
เเ 

AppendLine
เเ %
(
เเ% &
$str
เเ& *
)
เเ* +
;
เเ+ ,
header
แแ 
.
แแ 

AppendLine
แแ %
(
แแ% &
$str
แแ& =
)
แแ= >
;
แแ> ?
header
โโ 
.
โโ 

AppendLine
โโ %
(
โโ% &
$str
โโ& A
)
โโA B
;
โโB C
header
ใใ 
.
ใใ 

AppendLine
ใใ %
(
ใใ% &
$str
ใใ& G
)
ใใG H
;
ใใH I
header
ไไ 
.
ไไ 

AppendLine
ไไ %
(
ไไ% &
$str
ไไ& G
)
ไไG H
;
ไไH I
header
ๅๅ 
.
ๅๅ 

AppendLine
ๅๅ %
(
ๅๅ% &
$str
ๅๅ& *
)
ๅๅ* +
;
ๅๅ+ ,
break
ๆๆ 
;
ๆๆ 
case
่่ 
$str
่่ 
:
่่ 
header
้้ 
.
้้ 

AppendLine
้้ %
(
้้% &
$str
้้& :
)
้้: ;
;
้้; <
header
๊๊ 
.
๊๊ 

AppendLine
๊๊ %
(
๊๊% &
$str
๊๊& T
)
๊๊T U
;
๊๊U V
header
๋๋ 
.
๋๋ 

AppendLine
๋๋ %
(
๋๋% &
$str
๋๋& B
)
๋๋B C
;
๋๋C D
header
์์ 
.
์์ 

AppendLine
์์ %
(
์์% &
$str
์์& H
)
์์H I
;
์์I J
header
ํํ 
.
ํํ 

AppendLine
ํํ %
(
ํํ% &
$str
ํํ& *
)
ํํ* +
;
ํํ+ ,
header
๎๎ 
.
๎๎ 

AppendLine
๎๎ %
(
๎๎% &
$str
๎๎& 9
)
๎๎9 :
;
๎๎: ;
header
๏๏ 
.
๏๏ 

AppendLine
๏๏ %
(
๏๏% &
$str
๏๏& I
)
๏๏I J
;
๏๏J K
header
๐๐ 
.
๐๐ 

AppendLine
๐๐ %
(
๐๐% &
$str
๐๐& A
)
๐๐A B
;
๐๐B C
header
๑๑ 
.
๑๑ 

AppendLine
๑๑ %
(
๑๑% &
$str
๑๑& >
)
๑๑> ?
;
๑๑? @
header
๒๒ 
.
๒๒ 

AppendLine
๒๒ %
(
๒๒% &
$str
๒๒& *
)
๒๒* +
;
๒๒+ ,
break
๓๓ 
;
๓๓ 
case
๕๕ 
$str
๕๕ 
:
๕๕ 
header
๖๖ 
.
๖๖ 

AppendLine
๖๖ %
(
๖๖% &
$str
๖๖& ;
)
๖๖; <
;
๖๖< =
header
๗๗ 
.
๗๗ 

AppendLine
๗๗ %
(
๗๗% &
$str
๗๗& E
)
๗๗E F
;
๗๗F G
header
๘๘ 
.
๘๘ 

AppendLine
๘๘ %
(
๘๘% &
$str
๘๘& C
)
๘๘C D
;
๘๘D E
header
๙๙ 
.
๙๙ 

AppendLine
๙๙ %
(
๙๙% &
$str
๙๙& J
)
๙๙J K
;
๙๙K L
header
๚๚ 
.
๚๚ 

AppendLine
๚๚ %
(
๚๚% &
$str
๚๚& *
)
๚๚* +
;
๚๚+ ,
header
๛๛ 
.
๛๛ 

AppendLine
๛๛ %
(
๛๛% &
$str
๛๛& <
)
๛๛< =
;
๛๛= >
header
 
.
 

AppendLine
 %
(
% &
$str
& ?
)
? @
;
@ A
header
 
.
 

AppendLine
 %
(
% &
$str
& @
)
@ A
;
A B
header
 
.
 

AppendLine
 %
(
% &
$str
& ;
)
; <
;
< =
header
 
.
 

AppendLine
 %
(
% &
$str
& *
)
* +
;
+ ,
break
 
;
 
case
 
$str
 
:
 
header
 
.
 

AppendLine
 %
(
% &
$str
& ?
)
? @
;
@ A
header
 
.
 

AppendLine
 %
(
% &
$str
& F
)
F G
;
G H
header
 
.
 

AppendLine
 %
(
% &
$str
& J
)
J K
;
K L
header
 
.
 

AppendLine
 %
(
% &
$str
& K
)
K L
;
L M
header
 
.
 

AppendLine
 %
(
% &
$str
& *
)
* +
;
+ ,
header
 
.
 

AppendLine
 %
(
% &
$str
& ;
)
; <
;
< =
header
 
.
 

AppendLine
 %
(
% &
$str
& I
)
I J
;
J K
header
 
.
 

AppendLine
 %
(
% &
$str
& H
)
H I
;
I J
header
 
.
 

AppendLine
 %
(
% &
$str
& E
)
E F
;
F G
header
 
.
 

AppendLine
 %
(
% &
$str
& *
)
* +
;
+ ,
break
 
;
 
case
 
$str
 !
:
! "
header
 
.
 

AppendLine
 %
(
% &
$str
& ;
)
; <
;
< =
header
 
.
 

AppendLine
 %
(
% &
$str
& X
)
X Y
;
Y Z
header
 
.
 

AppendLine
 %
(
% &
$str
& I
)
I J
;
J K
header
 
.
 

AppendLine
 %
(
% &
$str
& H
)
H I
;
I J
header
 
.
 

AppendLine
 %
(
% &
$str
& *
)
* +
;
+ ,
header
 
.
 

AppendLine
 %
(
% &
$str
& 6
)
6 7
;
7 8
header
 
.
 

AppendLine
 %
(
% &
$str
& O
)
O P
;
P Q
header
 
.
 

AppendLine
 %
(
% &
$str
& K
)
K L
;
L M
header
 
.
 

AppendLine
 %
(
% &
$str
& E
)
E F
;
F G
header
 
.
 

AppendLine
 %
(
% &
$str
& *
)
* +
;
+ ,
break
 
;
 
case
 
$str
 
:
  
header
 
.
 

AppendLine
 %
(
% &
$str
& ?
)
? @
;
@ A
header
 
.
 

AppendLine
 %
(
% &
$str
& E
)
E F
;
F G
header
 
.
 

AppendLine
 %
(
% &
$str
& C
)
C D
;
D E
header
 
.
 

AppendLine
 %
(
% &
$str
& F
)
F G
;
G H
header
กก 
.
กก 

AppendLine
กก %
(
กก% &
$str
กก& *
)
กก* +
;
กก+ ,
header
ขข 
.
ขข 

AppendLine
ขข %
(
ขข% &
$str
ขข& :
)
ขข: ;
;
ขข; <
header
ฃฃ 
.
ฃฃ 

AppendLine
ฃฃ %
(
ฃฃ% &
$str
ฃฃ& H
)
ฃฃH I
;
ฃฃI J
header
คค 
.
คค 

AppendLine
คค %
(
คค% &
$str
คค& E
)
คคE F
;
คคF G
header
ฅฅ 
.
ฅฅ 

AppendLine
ฅฅ %
(
ฅฅ% &
$str
ฅฅ& G
)
ฅฅG H
;
ฅฅH I
header
ฆฆ 
.
ฆฆ 

AppendLine
ฆฆ %
(
ฆฆ% &
$str
ฆฆ& *
)
ฆฆ* +
;
ฆฆ+ ,
break
งง 
;
งง 
}
จจ 
header
ชช 
.
ชช 

AppendLine
ชช 
(
ชช 
$str
ชช 6
)
ชช6 7
;
ชช7 8
header
ซซ 
.
ซซ 

AppendLine
ซซ 
(
ซซ 
$str
ซซ S
)
ซซS T
;
ซซT U
header
ฌฌ 
.
ฌฌ 

AppendLine
ฌฌ 
(
ฌฌ 
$str
ฌฌ O
)
ฌฌO P
;
ฌฌP Q
header
ญญ 
.
ญญ 

AppendLine
ญญ 
(
ญญ 
$str
ญญ "
)
ญญ" #
;
ญญ# $
}
ฎฎ 	
public
ทท 
static
ทท 
string
ทท )
GenerateMethodDocumentation
ทท 8
(
ทท8 9
string
ธธ 
methodSignature
ธธ "
,
ธธ" #
string
นน 
purpose
นน 
,
นน 
string
บบ 
additionalNotes
บบ "
=
บบ# $
null
บบ% )
)
ปป 	
{
ผผ 	
var
ฝฝ 
match
ฝฝ 
=
ฝฝ "
MethodSignatureRegex
ฝฝ ,
.
ฝฝ, -
Match
ฝฝ- 2
(
ฝฝ2 3
methodSignature
ฝฝ3 B
)
ฝฝB C
;
ฝฝC D
if
พพ 
(
พพ 
!
พพ 
match
พพ 
.
พพ 
Success
พพ 
)
พพ 
{
ฟฟ 
return
ภภ .
 GenerateBasicMethodDocumentation
ภภ 7
(
ภภ7 8
purpose
ภภ8 ?
,
ภภ? @
additionalNotes
ภภA P
)
ภภP Q
;
ภภQ R
}
มม 
var
รร 

returnType
รร 
=
รร 
match
รร "
.
รร" #
Groups
รร# )
[
รร) *
$num
รร* +
]
รร+ ,
.
รร, -
Value
รร- 2
;
รร2 3
var
ฤฤ 

methodName
ฤฤ 
=
ฤฤ 
match
ฤฤ "
.
ฤฤ" #
Groups
ฤฤ# )
[
ฤฤ) *
$num
ฤฤ* +
]
ฤฤ+ ,
.
ฤฤ, -
Value
ฤฤ- 2
;
ฤฤ2 3
var
ลล 

parameters
ลล 
=
ลล 
match
ลล "
.
ลล" #
Groups
ลล# )
[
ลล) *
$num
ลล* +
]
ลล+ ,
.
ลล, -
Value
ลล- 2
;
ลล2 3
var
วว 
doc
วว 
=
วว 
new
วว 
StringBuilder
วว '
(
วว' (
)
วว( )
;
วว) *
doc
ศศ 
.
ศศ 

AppendLine
ศศ 
(
ศศ 
$str
ศศ *
)
ศศ* +
;
ศศ+ ,
doc
ษษ 
.
ษษ 

AppendLine
ษษ 
(
ษษ 
$"
ษษ 
$str
ษษ !
{
ษษ! "
purpose
ษษ" )
}
ษษ) *
"
ษษ* +
)
ษษ+ ,
;
ษษ, -
doc
สส 
.
สส 

AppendLine
สส 
(
สส 
$str
สส +
)
สส+ ,
;
สส, -
if
ออ 
(
ออ 
!
ออ 
string
ออ 
.
ออ  
IsNullOrWhiteSpace
ออ *
(
ออ* +

parameters
ออ+ 5
)
ออ5 6
)
ออ6 7
{
ฮฮ 
var
ฯฯ 
	paramList
ฯฯ 
=
ฯฯ 
ParseParameters
ฯฯ  /
(
ฯฯ/ 0

parameters
ฯฯ0 :
)
ฯฯ: ;
;
ฯฯ; <
foreach
ะะ 
(
ะะ 
var
ะะ 
param
ะะ "
in
ะะ# %
	paramList
ะะ& /
)
ะะ/ 0
{
ัั 
doc
าา 
.
าา 

AppendLine
าา "
(
าา" #
$"
ำำ 
$str
ำำ ,
{
ำำ, -
param
ำำ- 2
.
ำำ2 3
Name
ำำ3 7
}
ำำ7 8
$str
ำำ8 ;
{
ำำ; <*
GenerateParameterDescription
ำำ< X
(
ำำX Y
param
ำำY ^
)
ำำ^ _
}
ำำ_ `
$str
ำำ` h
"
ำำh i
)
ิิ 
;
ิิ 
}
ีี 
}
ึึ 
if
ูู 
(
ูู 

returnType
ูู 
!=
ูู 
$str
ูู $
&&
ูู% '
!
ูู( )

returnType
ูู) 3
.
ูู3 4

StartsWith
ูู4 >
(
ูู> ?
$str
ูู? E
)
ููE F
&&
ููG I

returnType
ููJ T
!=
ููU W
$str
ููX ^
)
ูู^ _
{
ฺฺ 
doc
 
.
 

AppendLine
 
(
 
$"
 
$str
 #
{
# $'
GenerateReturnDescription
$ =
(
= >

returnType
> H
,
H I

methodName
J T
)
T U
}
U V
$str
V `
"
` a
)
 
;
 
}
 
if
แแ 
(
แแ 
!
แแ 
string
แแ 
.
แแ  
IsNullOrWhiteSpace
แแ *
(
แแ* +
additionalNotes
แแ+ :
)
แแ: ;
)
แแ; <
{
โโ 
doc
ใใ 
.
ใใ 

AppendLine
ใใ 
(
ใใ 
$str
ใใ .
)
ใใ. /
;
ใใ/ 0
doc
ไไ 
.
ไไ 

AppendLine
ไไ 
(
ไไ 
$"
ไไ !
$str
ไไ! %
{
ไไ% &
additionalNotes
ไไ& 5
}
ไไ5 6
"
ไไ6 7
)
ไไ7 8
;
ไไ8 9
doc
ๅๅ 
.
ๅๅ 

AppendLine
ๅๅ 
(
ๅๅ 
$str
ๅๅ /
)
ๅๅ/ 0
;
ๅๅ0 1
}
ๆๆ 
return
่่ 
doc
่่ 
.
่่ 
ToString
่่ 
(
่่  
)
่่  !
;
่่! "
}
้้ 	
private
๑๑ 
static
๑๑ 
string
๑๑ .
 GenerateBasicMethodDocumentation
๑๑ >
(
๑๑> ?
string
๒๒ 
purpose
๒๒ 
,
๒๒ 
string
๓๓ 
additionalNotes
๓๓ "
)
๔๔ 	
{
๕๕ 	
var
๖๖ 
doc
๖๖ 
=
๖๖ 
new
๖๖ 
StringBuilder
๖๖ '
(
๖๖' (
)
๖๖( )
;
๖๖) *
doc
๗๗ 
.
๗๗ 

AppendLine
๗๗ 
(
๗๗ 
$str
๗๗ *
)
๗๗* +
;
๗๗+ ,
doc
๘๘ 
.
๘๘ 

AppendLine
๘๘ 
(
๘๘ 
$"
๘๘ 
$str
๘๘ !
{
๘๘! "
purpose
๘๘" )
}
๘๘) *
"
๘๘* +
)
๘๘+ ,
;
๘๘, -
doc
๙๙ 
.
๙๙ 

AppendLine
๙๙ 
(
๙๙ 
$str
๙๙ +
)
๙๙+ ,
;
๙๙, -
if
๛๛ 
(
๛๛ 
!
๛๛ 
string
๛๛ 
.
๛๛  
IsNullOrWhiteSpace
๛๛ *
(
๛๛* +
additionalNotes
๛๛+ :
)
๛๛: ;
)
๛๛; <
{
 
doc
 
.
 

AppendLine
 
(
 
$str
 .
)
. /
;
/ 0
doc
 
.
 

AppendLine
 
(
 
$"
 !
$str
! %
{
% &
additionalNotes
& 5
}
5 6
"
6 7
)
7 8
;
8 9
doc
 
.
 

AppendLine
 
(
 
$str
 /
)
/ 0
;
0 1
}
 
return
 
doc
 
.
 
ToString
 
(
  
)
  !
;
! "
}
 	
public
 
static
 
string
 +
GeneratePropertyDocumentation
 :
(
: ;
string
 
propertyName
 
,
  
string
 
type
 
,
 
string
 
description
 
,
 
bool
 

isReadOnly
 
=
 
false
 #
)
 	
{
 	
var
 
doc
 
=
 
new
 
StringBuilder
 '
(
' (
)
( )
;
) *
doc
 
.
 

AppendLine
 
(
 
$str
 *
)
* +
;
+ ,
doc
 
.
 

AppendLine
 
(
 
$"
 
$str
 !
{
! "
description
" -
}
- .
"
. /
)
/ 0
;
0 1
doc
 
.
 

AppendLine
 
(
 
$str
 +
)
+ ,
;
, -
if
 
(
 

isReadOnly
 
)
 
{
 
doc
 
.
 

AppendLine
 
(
 
$str
 .
)
. /
;
/ 0
doc
 
.
 

AppendLine
 
(
 
$str
 @
)
@ A
;
A B
doc
 
.
 

AppendLine
 
(
 
$str
 /
)
/ 0
;
0 1
}
 
if
กก 
(
กก 
type
กก 
.
กก 
Contains
กก 
(
กก 
$str
กก *
)
กก* +
||
กก, .
type
กก/ 3
.
กก3 4
Contains
กก4 <
(
กก< =
$str
กก= C
)
กกC D
||
กกE G
type
กกH L
.
กกL M
Contains
กกM U
(
กกU V
$str
กกV ]
)
กก] ^
)
กก^ _
{
ขข 
doc
ฃฃ 
.
ฃฃ 

AppendLine
ฃฃ 
(
ฃฃ 
$"
คค 
$str
คค /
{
คค/ 0 
ExtractGenericType
คค0 B
(
คคB C
type
คคC G
)
คคG H
}
คคH I
$str
คคI W
"
คคW X
)
ฅฅ 
;
ฅฅ 
}
ฆฆ 
else
งง 
if
งง 
(
งง 
type
งง 
==
งง 
$str
งง #
||
งง$ &
type
งง' +
==
งง, .
$str
งง/ 8
)
งง8 9
{
จจ 
doc
ฉฉ 
.
ฉฉ 

AppendLine
ฉฉ 
(
ฉฉ 
$"
ชช 
$str
ชช )
{
ชช) *(
GenerateBooleanDescription
ชช* D
(
ชชD E
propertyName
ชชE Q
)
ชชQ R
}
ชชR S
$str
ชชS l
"
ชชl m
)
ซซ 
;
ซซ 
}
ฌฌ 
else
ญญ 
{
ฎฎ 
doc
ฏฏ 
.
ฏฏ 

AppendLine
ฏฏ 
(
ฏฏ 
$"
ฐฐ 
$str
ฐฐ !
{
ฐฐ! "&
GenerateValueDescription
ฐฐ" :
(
ฐฐ: ;
type
ฐฐ; ?
,
ฐฐ? @
propertyName
ฐฐA M
)
ฐฐM N
}
ฐฐN O
$str
ฐฐO W
"
ฐฐW X
)
ฑฑ 
;
ฑฑ 
}
ฒฒ 
return
ดด 
doc
ดด 
.
ดด 
ToString
ดด 
(
ดด  
)
ดด  !
;
ดด! "
}
ตต 	
public
ฟฟ 
static
ฟฟ 
string
ฟฟ (
GenerateClassDocumentation
ฟฟ 7
(
ฟฟ7 8
string
ภภ 
	className
ภภ 
,
ภภ 
string
มม 
purpose
มม 
,
มม 
List
ยย 
<
ยย 
string
ยย 
>
ยย 
designPatterns
ยย '
=
ยย( )
null
ยย* .
,
ยย. /
List
รร 
<
รร 
string
รร 
>
รร 
dependencies
รร %
=
รร& '
null
รร( ,
)
ฤฤ 	
{
ลล 	
var
ฦฦ 
doc
ฦฦ 
=
ฦฦ 
new
ฦฦ 
StringBuilder
ฦฦ '
(
ฦฦ' (
)
ฦฦ( )
;
ฦฦ) *
doc
วว 
.
วว 

AppendLine
วว 
(
วว 
$str
วว *
)
วว* +
;
วว+ ,
doc
ศศ 
.
ศศ 

AppendLine
ศศ 
(
ศศ 
$"
ศศ 
$str
ศศ !
{
ศศ! "
purpose
ศศ" )
}
ศศ) *
"
ศศ* +
)
ศศ+ ,
;
ศศ, -
doc
ษษ 
.
ษษ 

AppendLine
ษษ 
(
ษษ 
$str
ษษ +
)
ษษ+ ,
;
ษษ, -
if
หห 
(
หห 
designPatterns
หห 
!=
หห !
null
หห" &
&&
หห' )
designPatterns
หห* 8
.
หห8 9
Any
หห9 <
(
หห< =
)
หห= >
)
หห> ?
{
ฬฬ 
doc
ออ 
.
ออ 

AppendLine
ออ 
(
ออ 
$str
ออ .
)
ออ. /
;
ออ/ 0
doc
ฮฮ 
.
ฮฮ 

AppendLine
ฮฮ 
(
ฮฮ 
$str
ฮฮ B
)
ฮฮB C
;
ฮฮC D
doc
ฯฯ 
.
ฯฯ 

AppendLine
ฯฯ 
(
ฯฯ 
$str
ฯฯ ;
)
ฯฯ; <
;
ฯฯ< =
foreach
ะะ 
(
ะะ 
var
ะะ 
pattern
ะะ $
in
ะะ% '
designPatterns
ะะ( 6
)
ะะ6 7
{
ัั 
doc
าา 
.
าา 

AppendLine
าา "
(
าา" #
$"
าา# %
$str
าา% /
{
าา/ 0
pattern
าา0 7
}
าา7 8
$str
าา8 ?
"
าา? @
)
าา@ A
;
าาA B
}
ำำ 
doc
ิิ 
.
ิิ 

AppendLine
ิิ 
(
ิิ 
$str
ิิ ,
)
ิิ, -
;
ิิ- .
doc
ีี 
.
ีี 

AppendLine
ีี 
(
ีี 
$str
ีี /
)
ีี/ 0
;
ีี0 1
}
ึึ 
if
ุุ 
(
ุุ 
dependencies
ุุ 
!=
ุุ 
null
ุุ  $
&&
ุุ% '
dependencies
ุุ( 4
.
ุุ4 5
Any
ุุ5 8
(
ุุ8 9
)
ุุ9 :
)
ุุ: ;
{
ูู 
if
ฺฺ 
(
ฺฺ 
designPatterns
ฺฺ "
==
ฺฺ# %
null
ฺฺ& *
||
ฺฺ+ -
!
ฺฺ. /
designPatterns
ฺฺ/ =
.
ฺฺ= >
Any
ฺฺ> A
(
ฺฺA B
)
ฺฺB C
)
ฺฺC D
{
 
doc
 
.
 

AppendLine
 "
(
" #
$str
# 2
)
2 3
;
3 4
}
 
doc
 
.
 

AppendLine
 
(
 
$str
 C
)
C D
;
D E
doc
฿฿ 
.
฿฿ 

AppendLine
฿฿ 
(
฿฿ 
$str
฿฿ ;
)
฿฿; <
;
฿฿< =
foreach
เเ 
(
เเ 
var
เเ 

dependency
เเ '
in
เเ( *
dependencies
เเ+ 7
)
เเ7 8
{
แแ 
doc
โโ 
.
โโ 

AppendLine
โโ "
(
โโ" #
$"
โโ# %
$str
โโ% /
{
โโ/ 0

dependency
โโ0 :
}
โโ: ;
$str
โโ; B
"
โโB C
)
โโC D
;
โโD E
}
ใใ 
doc
ไไ 
.
ไไ 

AppendLine
ไไ 
(
ไไ 
$str
ไไ ,
)
ไไ, -
;
ไไ- .
if
ๅๅ 
(
ๅๅ 
designPatterns
ๅๅ "
==
ๅๅ# %
null
ๅๅ& *
||
ๅๅ+ -
!
ๅๅ. /
designPatterns
ๅๅ/ =
.
ๅๅ= >
Any
ๅๅ> A
(
ๅๅA B
)
ๅๅB C
)
ๅๅC D
{
ๆๆ 
doc
็็ 
.
็็ 

AppendLine
็็ "
(
็็" #
$str
็็# 3
)
็็3 4
;
็็4 5
}
่่ 
}
้้ 
return
๋๋ 
doc
๋๋ 
.
๋๋ 
ToString
๋๋ 
(
๋๋  
)
๋๋  !
;
๋๋! "
}
์์ 	
public
๔๔ 
static
๔๔ 
bool
๔๔ "
UpdateInlineComments
๔๔ /
(
๔๔/ 0
string
๕๕ 
filePath
๕๕ 
,
๕๕ 
CommentStyle
๖๖ 
commentStyle
๖๖ %
=
๖๖& '
CommentStyle
๖๖( 4
.
๖๖4 5
Explanatory
๖๖5 @
)
๗๗ 	
{
๘๘ 	
try
๙๙ 
{
๚๚ 
if
๛๛ 
(
๛๛ 
!
๛๛ 
File
๛๛ 
.
๛๛ 
Exists
๛๛  
(
๛๛  !
filePath
๛๛! )
)
๛๛) *
)
๛๛* +
{
 
return
 
false
  
;
  !
}
 
var
 
content
 
=
 
File
 "
.
" #
ReadAllText
# .
(
. /
filePath
/ 7
,
7 8
Encoding
9 A
.
A B
UTF8
B F
)
F G
;
G H
var
 
originalContent
 #
=
$ %
content
& -
;
- .
content
 
=
 
AddMethodComments
 +
(
+ ,
content
, 3
,
3 4
commentStyle
5 A
)
A B
;
B C
content
 
=
 $
AddComplexCodeComments
 0
(
0 1
content
1 8
,
8 9
commentStyle
: F
)
F G
;
G H
content
 
=
 !
AddVariableComments
 -
(
- .
content
. 5
,
5 6
commentStyle
7 C
)
C D
;
D E
if
 
(
 
content
 
!=
 
originalContent
 .
)
. /
{
 
File
 
.
 
WriteAllText
 %
(
% &
filePath
& .
,
. /
content
0 7
,
7 8
Encoding
9 A
.
A B
UTF8
B F
)
F G
;
G H
return
 
true
 
;
  
}
 
return
 
false
 
;
 
}
 
catch
 
(
 
	Exception
 
)
 
{
 
return
 
false
 
;
 
}
 
}
 	
private
 
static
 
string
 
AddMethodComments
 /
(
/ 0
string
0 6
content
7 >
,
> ?
CommentStyle
@ L
style
M R
)
R S
{
 	
var
 
methodMatches
 
=
 "
MethodSignatureRegex
  4
.
4 5
Matches
5 <
(
< =
content
= D
)
D E
;
E F
var
 
updatedContent
 
=
  
content
! (
;
( )
foreach
กก 
(
กก 
Match
กก 
match
กก  
in
กก! #
methodMatches
กก$ 1
)
กก1 2
{
ขข 
var
ฃฃ 
methodStart
ฃฃ 
=
ฃฃ  !
match
ฃฃ" '
.
ฃฃ' (
Index
ฃฃ( -
;
ฃฃ- .
var
คค 

methodName
คค 
=
คค  
match
คค! &
.
คค& '
Groups
คค' -
[
คค- .
$num
คค. /
]
คค/ 0
.
คค0 1
Value
คค1 6
;
คค6 7
var
งง 
beforeMethod
งง  
=
งง! "
content
งง# *
.
งง* +
	Substring
งง+ 4
(
งง4 5
$num
งง5 6
,
งง6 7
methodStart
งง8 C
)
งงC D
;
งงD E
if
จจ 
(
จจ 
!
จจ 
beforeMethod
จจ !
.
จจ! "
TrimEnd
จจ" )
(
จจ) *
)
จจ* +
.
จจ+ ,
EndsWith
จจ, 4
(
จจ4 5
$str
จจ5 E
)
จจE F
)
จจF G
{
ฉฉ 
var
ชช 
comment
ชช 
=
ชช  !#
GenerateMethodComment
ชช" 7
(
ชช7 8

methodName
ชช8 B
,
ชชB C
style
ชชD I
)
ชชI J
;
ชชJ K
var
ซซ 
indentation
ซซ #
=
ซซ$ %
GetIndentation
ซซ& 4
(
ซซ4 5
content
ซซ5 <
,
ซซ< =
methodStart
ซซ> I
)
ซซI J
;
ซซJ K
updatedContent
ฌฌ "
=
ฌฌ# $
updatedContent
ฌฌ% 3
.
ฌฌ3 4
Insert
ฌฌ4 :
(
ฌฌ: ;
methodStart
ญญ #
,
ญญ# $
$"
ฎฎ 
{
ฎฎ 
indentation
ฎฎ &
}
ฎฎ& '
{
ฎฎ' (
comment
ฎฎ( /
}
ฎฎ/ 0
$str
ฎฎ0 2
"
ฎฎ2 3
)
ฏฏ 
;
ฏฏ 
}
ฐฐ 
}
ฑฑ 
return
ณณ 
updatedContent
ณณ !
;
ณณ! "
}
ดด 	
private
ผผ 
static
ผผ 
string
ผผ $
AddComplexCodeComments
ผผ 4
(
ผผ4 5
string
ผผ5 ;
content
ผผ< C
,
ผผC D
CommentStyle
ผผE Q
style
ผผR W
)
ผผW X
{
ฝฝ 	
var
ฟฟ 
patterns
ฟฟ 
=
ฟฟ 
new
ฟฟ 
[
ฟฟ 
]
ฟฟ  
{
ภภ 
new
มม 
Regex
มม 
(
มม 
$str
มม 0
,
มม0 1
RegexOptions
มม2 >
.
มม> ?

IgnoreCase
มม? I
)
มมI J
,
มมJ K
new
ยย 
Regex
ยย 
(
ยย 
$str
ยย 2
,
ยย2 3
RegexOptions
ยย4 @
.
ยย@ A

IgnoreCase
ยยA K
)
ยยK L
,
ยยL M
new
รร 
Regex
รร 
(
รร 
$str
รร 2
,
รร2 3
RegexOptions
รร4 @
.
รร@ A

IgnoreCase
รรA K
)
รรK L
,
รรL M
new
ฤฤ 
Regex
ฤฤ 
(
ฤฤ 
$str
ฤฤ /
,
ฤฤ/ 0
RegexOptions
ฤฤ1 =
.
ฤฤ= >

IgnoreCase
ฤฤ> H
)
ฤฤH I
,
ฤฤI J
}
ลล 
;
ลล 
var
วว 
updatedContent
วว 
=
วว  
content
วว! (
;
วว( )
foreach
ษษ 
(
ษษ 
var
ษษ 
pattern
ษษ  
in
ษษ! #
patterns
ษษ$ ,
)
ษษ, -
{
สส 
var
หห 
matches
หห 
=
หห 
pattern
หห %
.
หห% &
Matches
หห& -
(
หห- .
content
หห. 5
)
หห5 6
;
หห6 7
foreach
ฬฬ 
(
ฬฬ 
Match
ฬฬ 
match
ฬฬ $
in
ฬฬ% '
matches
ฬฬ( /
)
ฬฬ/ 0
{
ออ 
var
ฮฮ 
comment
ฮฮ 
=
ฮฮ  !(
GenerateComplexCodeComment
ฮฮ" <
(
ฮฮ< =
match
ฮฮ= B
.
ฮฮB C
Value
ฮฮC H
,
ฮฮH I
style
ฮฮJ O
)
ฮฮO P
;
ฮฮP Q
if
ฯฯ 
(
ฯฯ 
!
ฯฯ 
string
ฯฯ 
.
ฯฯ  
IsNullOrEmpty
ฯฯ  -
(
ฯฯ- .
comment
ฯฯ. 5
)
ฯฯ5 6
)
ฯฯ6 7
{
ะะ 
var
ัั 
indentation
ัั '
=
ัั( )
GetIndentation
ัั* 8
(
ัั8 9
content
ัั9 @
,
ัั@ A
match
ััB G
.
ััG H
Index
ััH M
)
ััM N
;
ััN O
updatedContent
าา &
=
าา' (
updatedContent
าา) 7
.
าา7 8
Insert
าา8 >
(
าา> ?
match
ำำ !
.
ำำ! "
Index
ำำ" '
,
ำำ' (
$"
ิิ 
{
ิิ 
indentation
ิิ *
}
ิิ* +
$str
ิิ+ .
{
ิิ. /
comment
ิิ/ 6
}
ิิ6 7
$str
ิิ7 9
"
ิิ9 :
)
ีี 
;
ีี 
}
ึึ 
}
ืื 
}
ุุ 
return
ฺฺ 
updatedContent
ฺฺ !
;
ฺฺ! "
}
 	
private
ใใ 
static
ใใ 
string
ใใ !
AddVariableComments
ใใ 1
(
ใใ1 2
string
ใใ2 8
content
ใใ9 @
,
ใใ@ A
CommentStyle
ใใB N
style
ใใO T
)
ใใT U
{
ไไ 	
var
ๆๆ 
variablePattern
ๆๆ 
=
ๆๆ  !
new
ๆๆ" %
Regex
ๆๆ& +
(
ๆๆ+ ,
$str
ๆๆ, I
,
ๆๆI J
RegexOptions
ๆๆK W
.
ๆๆW X

IgnoreCase
ๆๆX b
)
ๆๆb c
;
ๆๆc d
var
็็ 
matches
็็ 
=
็็ 
variablePattern
็็ )
.
็็) *
Matches
็็* 1
(
็็1 2
content
็็2 9
)
็็9 :
;
็็: ;
var
่่ 
updatedContent
่่ 
=
่่  
content
่่! (
;
่่( )
foreach
๊๊ 
(
๊๊ 
Match
๊๊ 
match
๊๊  
in
๊๊! #
matches
๊๊$ +
)
๊๊+ ,
{
๋๋ 
var
์์ 
variableName
์์  
=
์์! "
match
์์# (
.
์์( )
Groups
์์) /
[
์์/ 0
$num
์์0 1
]
์์1 2
.
์์2 3
Value
์์3 8
;
์์8 9
var
ํํ 

assignment
ํํ 
=
ํํ  
match
ํํ! &
.
ํํ& '
Groups
ํํ' -
[
ํํ- .
$num
ํํ. /
]
ํํ/ 0
.
ํํ0 1
Value
ํํ1 6
;
ํํ6 7
if
๏๏ 
(
๏๏ !
IsComplexAssignment
๏๏ '
(
๏๏' (

assignment
๏๏( 2
)
๏๏2 3
)
๏๏3 4
{
๐๐ 
var
๑๑ 
comment
๑๑ 
=
๑๑  !%
GenerateVariableComment
๑๑" 9
(
๑๑9 :
variableName
๑๑: F
,
๑๑F G

assignment
๑๑H R
,
๑๑R S
style
๑๑T Y
)
๑๑Y Z
;
๑๑Z [
var
๒๒ 
indentation
๒๒ #
=
๒๒$ %
GetIndentation
๒๒& 4
(
๒๒4 5
content
๒๒5 <
,
๒๒< =
match
๒๒> C
.
๒๒C D
Index
๒๒D I
)
๒๒I J
;
๒๒J K
updatedContent
๓๓ "
=
๓๓# $
updatedContent
๓๓% 3
.
๓๓3 4
Insert
๓๓4 :
(
๓๓: ;
match
๔๔ 
.
๔๔ 
Index
๔๔ #
,
๔๔# $
$"
๕๕ 
{
๕๕ 
indentation
๕๕ &
}
๕๕& '
$str
๕๕' *
{
๕๕* +
comment
๕๕+ 2
}
๕๕2 3
$str
๕๕3 5
"
๕๕5 6
)
๖๖ 
;
๖๖ 
}
๗๗ 
}
๘๘ 
return
๚๚ 
updatedContent
๚๚ !
;
๚๚! "
}
๛๛ 	
private
 
static
 
void
 !
InitializeTemplates
 /
(
/ 0
)
0 1
{
 	
	Templates
 
[
 
$str
 !
]
! "
=
# $
$str
 
;
 
	Templates
 
[
 
$str
 
]
  
=
! "
$str
ฑ 
;
ฑฑ 
	Templates
ณณ 
[
ณณ 
$str
ณณ 
]
ณณ  
=
ณณ! "
$str
ดฟ 
;
ฟฟ 
}
ภภ 	
public
ศศ 
static
ศศ 
string
ศศ "
GenerateFromTemplate
ศศ 1
(
ศศ1 2
string
ษษ 
templateName
ษษ 
,
ษษ  

Dictionary
สส 
<
สส 
string
สส 
,
สส 
string
สส %
>
สส% &

parameters
สส' 1
)
หห 	
{
ฬฬ 	
if
ออ 
(
ออ 
!
ออ 
	Templates
ออ 
.
ออ 
ContainsKey
ออ &
(
ออ& '
templateName
ออ' 3
)
ออ3 4
)
ออ4 5
{
ฮฮ 
return
ฯฯ 
null
ฯฯ 
;
ฯฯ 
}
ะะ 
var
าา 
template
าา 
=
าา 
	Templates
าา $
[
าา$ %
templateName
าา% 1
]
าา1 2
;
าา2 3
foreach
ำำ 
(
ำำ 
var
ำำ 
	parameter
ำำ "
in
ำำ# %

parameters
ำำ& 0
)
ำำ0 1
{
ิิ 
template
ีี 
=
ีี 
template
ีี #
.
ีี# $
Replace
ีี$ +
(
ีี+ ,
$"
ีี, .
$str
ีี. 0
{
ีี0 1
	parameter
ีี1 :
.
ีี: ;
Key
ีี; >
}
ีี> ?
$str
ีี? A
"
ีีA B
,
ีีB C
	parameter
ีีD M
.
ีีM N
Value
ีีN S
)
ีีS T
;
ีีT U
}
ึึ 
return
ุุ 
template
ุุ 
;
ุุ 
}
ูู 	
private
เเ 
static
เเ 
List
เเ 
<
เเ 
ParameterInfo
เเ )
>
เเ) *
ParseParameters
เเ+ :
(
เเ: ;
string
เเ; A

parameters
เเB L
)
เเL M
{
แแ 	
var
โโ 
result
โโ 
=
โโ 
new
โโ 
List
โโ !
<
โโ! "
ParameterInfo
โโ" /
>
โโ/ 0
(
โโ0 1
)
โโ1 2
;
โโ2 3
var
ใใ 
parts
ใใ 
=
ใใ 

parameters
ใใ "
.
ใใ" #
Split
ใใ# (
(
ใใ( )
$char
ใใ) ,
)
ใใ, -
;
ใใ- .
foreach
ๅๅ 
(
ๅๅ 
var
ๅๅ 
part
ๅๅ 
in
ๅๅ  
parts
ๅๅ! &
)
ๅๅ& '
{
ๆๆ 
var
็็ 
trimmed
็็ 
=
็็ 
part
็็ "
.
็็" #
Trim
็็# '
(
็็' (
)
็็( )
;
็็) *
if
่่ 
(
่่ 
string
่่ 
.
่่  
IsNullOrWhiteSpace
่่ -
(
่่- .
trimmed
่่. 5
)
่่5 6
)
่่6 7
continue
้้ 
;
้้ 
var
๋๋ 
words
๋๋ 
=
๋๋ 
trimmed
๋๋ #
.
๋๋# $
Split
๋๋$ )
(
๋๋) *
$char
๋๋* -
)
๋๋- .
;
๋๋. /
if
์์ 
(
์์ 
words
์์ 
.
์์ 
Length
์์  
>=
์์! #
$num
์์$ %
)
์์% &
{
ํํ 
var
๎๎ 
type
๎๎ 
=
๎๎ 
words
๎๎ $
[
๎๎$ %
words
๎๎% *
.
๎๎* +
Length
๎๎+ 1
-
๎๎2 3
$num
๎๎4 5
]
๎๎5 6
;
๎๎6 7
var
๏๏ 
name
๏๏ 
=
๏๏ 
words
๏๏ $
[
๏๏$ %
words
๏๏% *
.
๏๏* +
Length
๏๏+ 1
-
๏๏2 3
$num
๏๏4 5
]
๏๏5 6
;
๏๏6 7
result
๐๐ 
.
๐๐ 
Add
๐๐ 
(
๐๐ 
new
๐๐ "
ParameterInfo
๐๐# 0
{
๐๐1 2
Name
๐๐3 7
=
๐๐8 9
name
๐๐: >
,
๐๐> ?
Type
๐๐@ D
=
๐๐E F
type
๐๐G K
}
๐๐L M
)
๐๐M N
;
๐๐N O
}
๑๑ 
}
๒๒ 
return
๔๔ 
result
๔๔ 
;
๔๔ 
}
๕๕ 	
private
 
static
 
string
 *
GenerateParameterDescription
 :
(
: ;
ParameterInfo
; H
param
I N
)
N O
{
 	
return
 
$"
 
{
 
param
 
.
 
Type
  
}
  !
$str
! ,
{
, -
param
- 2
.
2 3
Name
3 7
.
7 8
ToLowerInvariant
8 H
(
H I
)
I J
}
J K
"
K L
;
L M
}
 	
private
 
static
 
string
 '
GenerateReturnDescription
 7
(
7 8
string
8 >

returnType
? I
,
I J
string
K Q

methodName
R \
)
\ ]
{
 	
if
 
(
 

returnType
 
==
 
$str
 $
||
% '

returnType
( 2
==
3 5
$str
6 ?
)
? @
{
 
return
 
$"
 
$str
 !
{
! "

methodName
" ,
.
, -
ToLowerInvariant
- =
(
= >
)
> ?
}
? @
$str
@ _
"
_ `
;
` a
}
 
return
 
$"
 
{
 

returnType
  
}
  !
$str
! ,
{
, -

methodName
- 7
.
7 8
ToLowerInvariant
8 H
(
H I
)
I J
}
J K
$str
K U
"
U V
;
V W
}
 	
private
 
static
 
string
 (
GenerateBooleanDescription
 8
(
8 9
string
9 ?
propertyName
@ L
)
L M
{
 	
var
 
name
 
=
 
propertyName
 #
.
# $
ToLowerInvariant
$ 4
(
4 5
)
5 6
;
6 7
if
 
(
 
name
 
.
 

StartsWith
 
(
  
$str
  $
)
$ %
)
% &
{
 
return
 
name
 
.
 
	Substring
 %
(
% &
$num
& '
)
' (
.
( )
ToLowerInvariant
) 9
(
9 :
)
: ;
;
; <
}
 
if
 
(
 
name
 
.
 

StartsWith
 
(
  
$str
  %
)
% &
)
& '
{
 
return
 
$"
 
$str
 
{
 
name
 "
.
" #
	Substring
# ,
(
, -
$num
- .
)
. /
.
/ 0
ToLowerInvariant
0 @
(
@ A
)
A B
}
B C
"
C D
;
D E
}
 
if
กก 
(
กก 
name
กก 
.
กก 

StartsWith
กก 
(
กก  
$str
กก  %
)
กก% &
)
กก& '
{
ขข 
return
ฃฃ 
$"
ฃฃ 
$str
ฃฃ 
{
ฃฃ 
name
ฃฃ "
.
ฃฃ" #
	Substring
ฃฃ# ,
(
ฃฃ, -
$num
ฃฃ- .
)
ฃฃ. /
.
ฃฃ/ 0
ToLowerInvariant
ฃฃ0 @
(
ฃฃ@ A
)
ฃฃA B
}
ฃฃB C
"
ฃฃC D
;
ฃฃD E
}
คค 
return
ฆฆ 
name
ฆฆ 
;
ฆฆ 
}
งง 	
private
ฏฏ 
static
ฏฏ 
string
ฏฏ &
GenerateValueDescription
ฏฏ 6
(
ฏฏ6 7
string
ฏฏ7 =
type
ฏฏ> B
,
ฏฏB C
string
ฏฏD J
propertyName
ฏฏK W
)
ฏฏW X
{
ฐฐ 	
return
ฑฑ 
$"
ฑฑ 
{
ฑฑ 
type
ฑฑ 
}
ฑฑ 
$str
ฑฑ /
{
ฑฑ/ 0
propertyName
ฑฑ0 <
.
ฑฑ< =
ToLowerInvariant
ฑฑ= M
(
ฑฑM N
)
ฑฑN O
}
ฑฑO P
"
ฑฑP Q
;
ฑฑQ R
}
ฒฒ 	
private
นน 
static
นน 
string
นน  
ExtractGenericType
นน 0
(
นน0 1
string
นน1 7
type
นน8 <
)
นน< =
{
บบ 	
var
ปป 
match
ปป 
=
ปป 
Regex
ปป 
.
ปป 
Match
ปป #
(
ปป# $
type
ปป$ (
,
ปป( )
$str
ปป* 6
)
ปป6 7
;
ปป7 8
return
ผผ 
match
ผผ 
.
ผผ 
Success
ผผ  
?
ผผ! "
match
ผผ# (
.
ผผ( )
Groups
ผผ) /
[
ผผ/ 0
$num
ผผ0 1
]
ผผ1 2
.
ผผ2 3
Value
ผผ3 8
:
ผผ9 :
$str
ผผ; C
;
ผผC D
}
ฝฝ 	
private
ลล 
static
ลล 
string
ลล 
GetIndentation
ลล ,
(
ลล, -
string
ลล- 3
content
ลล4 ;
,
ลล; <
int
ลล= @
position
ลลA I
)
ลลI J
{
ฦฦ 	
var
วว 
	lineStart
วว 
=
วว 
content
วว #
.
วว# $
LastIndexOf
วว$ /
(
วว/ 0
$char
วว0 4
,
วว4 5
position
วว6 >
)
วว> ?
+
วว@ A
$num
ววB C
;
ววC D
var
ศศ 
lineEnd
ศศ 
=
ศศ 
content
ศศ !
.
ศศ! "
IndexOf
ศศ" )
(
ศศ) *
$char
ศศ* .
,
ศศ. /
position
ศศ0 8
)
ศศ8 9
;
ศศ9 :
if
ษษ 
(
ษษ 
lineEnd
ษษ 
==
ษษ 
-
ษษ 
$num
ษษ 
)
ษษ 
lineEnd
สส 
=
สส 
content
สส !
.
สส! "
Length
สส" (
;
สส( )
var
ฬฬ 
line
ฬฬ 
=
ฬฬ 
content
ฬฬ 
.
ฬฬ 
	Substring
ฬฬ (
(
ฬฬ( )
	lineStart
ฬฬ) 2
,
ฬฬ2 3
lineEnd
ฬฬ4 ;
-
ฬฬ< =
	lineStart
ฬฬ> G
)
ฬฬG H
;
ฬฬH I
var
ออ 
indentLength
ออ 
=
ออ 
$num
ออ  
;
ออ  !
foreach
ฯฯ 
(
ฯฯ 
var
ฯฯ 
c
ฯฯ 
in
ฯฯ 
line
ฯฯ "
)
ฯฯ" #
{
ะะ 
if
ัั 
(
ัั 
c
ัั 
==
ัั 
$char
ัั 
||
ัั 
c
ัั  !
==
ัั" $
$char
ัั% )
)
ัั) *
{
าา 
indentLength
ำำ  
++
ำำ  "
;
ำำ" #
}
ิิ 
else
ีี 
{
ึึ 
break
ืื 
;
ืื 
}
ุุ 
}
ูู 
return
 
new
 
string
 
(
 
$char
 !
,
! "
indentLength
# /
)
/ 0
;
0 1
}
 	
private
ไไ 
static
ไไ 
string
ไไ #
GenerateMethodComment
ไไ 3
(
ไไ3 4
string
ไไ4 :

methodName
ไไ; E
,
ไไE F
CommentStyle
ไไG S
style
ไไT Y
)
ไไY Z
{
ๅๅ 	
switch
ๆๆ 
(
ๆๆ 
style
ๆๆ 
)
ๆๆ 
{
็็ 
case
่่ 
CommentStyle
่่ !
.
่่! "
Explanatory
่่" -
:
่่- .
return
้้ 
$"
้้ 
$str
้้ )
{
้้) *

methodName
้้* 4
.
้้4 5
ToLowerInvariant
้้5 E
(
้้E F
)
้้F G
}
้้G H
$str
้้H R
"
้้R S
;
้้S T
case
๊๊ 
CommentStyle
๊๊ !
.
๊๊! "
	Technical
๊๊" +
:
๊๊+ ,
return
๋๋ 
$"
๋๋ 
$str
๋๋ (
{
๋๋( )

methodName
๋๋) 3
}
๋๋3 4
"
๋๋4 5
;
๋๋5 6
case
์์ 
CommentStyle
์์ !
.
์์! "
Business
์์" *
:
์์* +
return
ํํ 
$"
ํํ 
$str
ํํ 3
{
ํํ3 4

methodName
ํํ4 >
.
ํํ> ?
ToLowerInvariant
ํํ? O
(
ํํO P
)
ํํP Q
}
ํํQ R
"
ํํR S
;
ํํS T
default
๎๎ 
:
๎๎ 
return
๏๏ 
$"
๏๏ 
$str
๏๏  
{
๏๏  !

methodName
๏๏! +
}
๏๏+ ,
"
๏๏, -
;
๏๏- .
}
๐๐ 
}
๑๑ 	
private
๙๙ 
static
๙๙ 
string
๙๙ (
GenerateComplexCodeComment
๙๙ 8
(
๙๙8 9
string
๙๙9 ?
code
๙๙@ D
,
๙๙D E
CommentStyle
๙๙F R
style
๙๙S X
)
๙๙X Y
{
๚๚ 	
if
๛๛ 
(
๛๛ 
code
๛๛ 
.
๛๛ 
Contains
๛๛ 
(
๛๛ 
$str
๛๛ #
)
๛๛# $
)
๛๛$ %
{
 
return
 
$str
 3
;
3 4
}
 
if
 
(
 
code
 
.
 
Contains
 
(
 
$str
 %
)
% &
)
& '
{
 
return
 
$str
 8
;
8 9
}
 
if
 
(
 
code
 
.
 
Contains
 
(
 
$str
 "
)
" #
&&
$ &
code
' +
.
+ ,
Contains
, 4
(
4 5
$str
5 9
)
9 :
)
: ;
{
 
return
 
$str
 2
;
2 3
}
 
if
 
(
 
code
 
.
 
Contains
 
(
 
$str
 &
)
& '
)
' (
{
 
return
 
$str
 /
;
/ 0
}
 
return
 
null
 
;
 
}
 	
private
 
static
 
string
 %
GenerateVariableComment
 5
(
5 6
string
 
variableName
 
,
  
string
 

assignment
 
,
 
CommentStyle
 
style
 
)
 	
{
 	
return
 
$"
 
$str
  
{
  !
variableName
! -
}
- .
$str
. 4
{
4 5

assignment
5 ?
}
? @
"
@ A
;
A B
}
 	
private
คค 
static
คค 
bool
คค !
IsComplexAssignment
คค /
(
คค/ 0
string
คค0 6

assignment
คค7 A
)
คคA B
{
ฅฅ 	
return
ฆฆ 

assignment
ฆฆ 
.
ฆฆ 
Length
ฆฆ $
>
ฆฆ% &
$num
ฆฆ' )
||
งง 

assignment
งง 
.
งง 
Contains
งง &
(
งง& '
$str
งง' ,
)
งง, -
||
จจ 

assignment
จจ 
.
จจ 
Contains
จจ &
(
จจ& '
$str
จจ' *
)
จจ* +
||
ฉฉ 

assignment
ฉฉ 
.
ฉฉ 
Contains
ฉฉ &
(
ฉฉ& '
$str
ฉฉ' *
)
ฉฉ* +
;
ฉฉ+ ,
}
ชช 	
private
ฑฑ 
class
ฑฑ 
ParameterInfo
ฑฑ #
{
ฒฒ 	
public
ณณ 
string
ณณ 
Name
ณณ 
{
ณณ  
get
ณณ! $
;
ณณ$ %
set
ณณ& )
;
ณณ) *
}
ณณ+ ,
public
ดด 
string
ดด 
Type
ดด 
{
ดด  
get
ดด! $
;
ดด$ %
set
ดด& )
;
ดด) *
}
ดด+ ,
}
ตต 	
}
ธธ 
public
ฝฝ 

enum
ฝฝ 
CommentStyle
ฝฝ 
{
พพ 
Explanatory
ยย 
,
ยย 
	Technical
วว 
,
วว 
Business
ฬฬ 
,
ฬฬ 
}
ออ 
}ฮฮ ๕พ
AC:\Playnite\_github\OstPlayer\source\DevTools\AIAssistantHooks.cs
	namespaceZZ 	
	OstPlayerZZ
 
.ZZ 
DevToolsZZ 
{[[ 
public__ 

static__ 
class__ 
AIAssistantHooks__ (
{`` 
privatebb 
staticbb 
readonlybb 

Dictionarybb  *
<bb* +
stringbb+ 1
,bb1 2
Listbb3 7
<bb7 8
Funcbb8 <
<bb< =
stringbb= C
,bbC D
TaskbbE I
>bbI J
>bbJ K
>bbK L
FileChangeHooksbbM \
=bb] ^
newcc 

Dictionarycc 
<cc 
stringcc !
,cc! "
Listcc# '
<cc' (
Funccc( ,
<cc, -
stringcc- 3
,cc3 4
Taskcc5 9
>cc9 :
>cc: ;
>cc; <
(cc< =
)cc= >
;cc> ?
privatedd 
staticdd 
readonlydd 

Dictionarydd  *
<dd* +
stringdd+ 1
,dd1 2
Listdd3 7
<dd7 8
Funcdd8 <
<dd< =
	AIContextdd= F
,ddF G
TaskddH L
>ddL M
>ddM N
>ddN O
ContextHooksddP \
=dd] ^
newee 

Dictionaryee 
<ee 
stringee !
,ee! "
Listee# '
<ee' (
Funcee( ,
<ee, -
	AIContextee- 6
,ee6 7
Taskee8 <
>ee< =
>ee= >
>ee> ?
(ee? @
)ee@ A
;eeA B
privatehh 
statichh 
readonlyhh 
Listhh  $
<hh$ %
AIActionhh% -
>hh- .
	ActionLoghh/ 8
=hh9 :
newhh; >
Listhh? C
<hhC D
AIActionhhD L
>hhL M
(hhM N
)hhN O
;hhO P
privatekk 
statickk 
	AIContextkk  
_currentContextkk! 0
;kk0 1
privatenn 
staticnn 
boolnn 
_hooksEnablednn )
=nn* +
truenn, 0
;nn0 1
privateoo 
staticoo 
intoo 
_maxLogEntriesoo )
=oo* +
$numoo, 0
;oo0 1
publicxx 
staticxx 
voidxx "
RegisterFileChangeHookxx 1
(xx1 2
stringxx2 8
patternxx9 @
,xx@ A
FuncxxB F
<xxF G
stringxxG M
,xxM N
TaskxxO S
>xxS T
handlerxxU \
)xx\ ]
{yy 	
ifzz 
(zz 
!zz 
FileChangeHookszz  
.zz  !
ContainsKeyzz! ,
(zz, -
patternzz- 4
)zz4 5
)zz5 6
{{{ 
FileChangeHooks|| 
[||  
pattern||  '
]||' (
=||) *
new||+ .
List||/ 3
<||3 4
Func||4 8
<||8 9
string||9 ?
,||? @
Task||A E
>||E F
>||F G
(||G H
)||H I
;||I J
}}} 
FileChangeHooks 
[ 
pattern #
]# $
.$ %
Add% (
(( )
handler) 0
)0 1
;1 2
LogAIAction
 
(
 
$str
 0
,
0 1
true
2 6
,
6 7
$"
8 :
$str
: W
{
W X
pattern
X _
}
_ `
"
` a
)
a b
;
b c
}
 	
public
 
static
 
void
 !
RegisterContextHook
 .
(
. /
string
/ 5
	eventType
6 ?
,
? @
Func
A E
<
E F
	AIContext
F O
,
O P
Task
Q U
>
U V
handler
W ^
)
^ _
{
 	
if
 
(
 
!
 
ContextHooks
 
.
 
ContainsKey
 )
(
) *
	eventType
* 3
)
3 4
)
4 5
{
 
ContextHooks
 
[
 
	eventType
 &
]
& '
=
( )
new
* -
List
. 2
<
2 3
Func
3 7
<
7 8
	AIContext
8 A
,
A B
Task
C G
>
G H
>
H I
(
I J
)
J K
;
K L
}
 
ContextHooks
 
[
 
	eventType
 "
]
" #
.
# $
Add
$ '
(
' (
handler
( /
)
/ 0
;
0 1
LogAIAction
 
(
 
$str
 %
,
% &
true
 
,
 
$"
 
$str
 2
{
2 3
	eventType
3 <
}
< =
"
= >
)
 
;
 
}
 	
public
 
static
 
void
 '
UnregisterFileChangeHooks
 4
(
4 5
string
5 ;
pattern
< C
)
C D
{
 	
if
 
(
 
FileChangeHooks
 
.
  
ContainsKey
  +
(
+ ,
pattern
, 3
)
3 4
)
4 5
{
 
FileChangeHooks
กก 
.
กก  
Remove
กก  &
(
กก& '
pattern
กก' .
)
กก. /
;
กก/ 0
LogAIAction
ขข 
(
ขข 
$str
ฃฃ /
,
ฃฃ/ 0
true
คค 
,
คค 
$"
ฅฅ 
$str
ฅฅ 6
{
ฅฅ6 7
pattern
ฅฅ7 >
}
ฅฅ> ?
"
ฅฅ? @
)
ฆฆ 
;
ฆฆ 
}
งง 
}
จจ 	
public
ณณ 
static
ณณ 
async
ณณ 
Task
ณณ  (
TriggerDocumentationUpdate
ณณ! ;
(
ณณ; <
string
ณณ< B
reason
ณณC I
,
ณณI J
string
ณณK Q
[
ณณQ R
]
ณณR S
affectedFiles
ณณT a
)
ณณa b
{
ดด 	
if
ตต 
(
ตต 
!
ตต 
_hooksEnabled
ตต 
)
ตต 
{
ถถ 
return
ทท 
;
ทท 
}
ธธ 
try
บบ 
{
ปป 
LogAIAction
ผผ 
(
ผผ 
$str
ฝฝ 0
,
ฝฝ0 1
true
พพ 
,
พพ 
$"
ฟฟ 
$str
ฟฟ $
{
ฟฟ$ %
reason
ฟฟ% +
}
ฟฟ+ ,
$str
ฟฟ, 5
{
ฟฟ5 6
string
ฟฟ6 <
.
ฟฟ< =
Join
ฟฟ= A
(
ฟฟA B
$str
ฟฟB F
,
ฟฟF G
affectedFiles
ฟฟH U
)
ฟฟU V
}
ฟฟV W
"
ฟฟW X
)
ภภ 
;
ภภ 
UpdateContext
รร 
(
รร 
$str
ฤฤ )
,
ฤฤ) *
new
ลล 

Dictionary
ลล "
<
ลล" #
string
ลล# )
,
ลล) *
object
ลล+ 1
>
ลล1 2
{
ฦฦ 
[
วว 
$str
วว !
]
วว! "
=
วว# $
reason
วว% +
,
วว+ ,
[
ศศ 
$str
ศศ (
]
ศศ( )
=
ศศ* +
affectedFiles
ศศ, 9
,
ศศ9 :
[
ษษ 
$str
ษษ $
]
ษษ$ %
=
ษษ& '
DateTime
ษษ( 0
.
ษษ0 1
Now
ษษ1 4
,
ษษ4 5
}
สส 
)
หห 
;
หห 
await
ฮฮ !
ExecuteContextHooks
ฮฮ )
(
ฮฮ) *
$str
ฮฮ* ?
)
ฮฮ? @
;
ฮฮ@ A
await
ัั 2
$PerformAutomaticDocumentationUpdates
ัั :
(
ัั: ;
affectedFiles
ัั; H
,
ััH I
reason
ััJ P
)
ััP Q
;
ััQ R
}
าา 
catch
ำำ 
(
ำำ 
	Exception
ำำ 
ex
ำำ 
)
ำำ  
{
ิิ 
LogAIAction
ีี 
(
ีี 
$str
ีี 8
,
ีี8 9
false
ีี: ?
,
ีี? @
$"
ีีA C
$str
ีีC J
{
ีีJ K
ex
ีีK M
.
ีีM N
Message
ีีN U
}
ีีU V
"
ีีV W
)
ีีW X
;
ีีX Y
}
ึึ 
}
ืื 	
public
 
static
 
async
 
Task
  #
TriggerCodeGeneration
! 6
(
6 7
string
฿฿ 
generationType
฿฿ !
,
฿฿! "

Dictionary
เเ 
<
เเ 
string
เเ 
,
เเ 
object
เเ %
>
เเ% &
context
เเ' .
)
แแ 	
{
โโ 	
if
ใใ 
(
ใใ 
!
ใใ 
_hooksEnabled
ใใ 
)
ใใ 
{
ไไ 
return
ๅๅ 
;
ๅๅ 
}
ๆๆ 
try
่่ 
{
้้ 
LogAIAction
๊๊ 
(
๊๊ 
$str
๊๊ 3
,
๊๊3 4
true
๊๊5 9
,
๊๊9 :
$"
๊๊; =
$str
๊๊= C
{
๊๊C D
generationType
๊๊D R
}
๊๊R S
"
๊๊S T
)
๊๊T U
;
๊๊U V
UpdateContext
ํํ 
(
ํํ 
$str
ํํ .
,
ํํ. /
context
ํํ0 7
)
ํํ7 8
;
ํํ8 9
await
๐๐ !
ExecuteContextHooks
๐๐ )
(
๐๐) *
$str
๐๐* :
)
๐๐: ;
;
๐๐; <
await
๓๓  
ProvideSuggestions
๓๓ (
(
๓๓( )
generationType
๓๓) 7
,
๓๓7 8
context
๓๓9 @
)
๓๓@ A
;
๓๓A B
}
๔๔ 
catch
๕๕ 
(
๕๕ 
	Exception
๕๕ 
ex
๕๕ 
)
๕๕  
{
๖๖ 
LogAIAction
๗๗ 
(
๗๗ 
$str
๗๗ 3
,
๗๗3 4
false
๗๗5 :
,
๗๗: ;
$"
๗๗< >
$str
๗๗> E
{
๗๗E F
ex
๗๗F H
.
๗๗H I
Message
๗๗I P
}
๗๗P Q
"
๗๗Q R
)
๗๗R S
;
๗๗S T
}
๘๘ 
}
๙๙ 	
public
 
static
 
async
 
Task
  !
TriggerFileAnalysis
! 4
(
4 5
string
 
filePath
 
,
 
string
 
analysisType
 
=
  !
$str
" +
)
 	
{
 	
if
 
(
 
!
 
_hooksEnabled
 
)
 
{
 
return
 
;
 
}
 
try
 
{
 
LogAIAction
 
(
 
$str
 1
,
1 2
true
3 7
,
7 8
$"
9 ;
$str
; A
{
A B
filePath
B J
}
J K
$str
K S
{
S T
analysisType
T `
}
` a
"
a b
)
b c
;
c d
await
 $
ExecuteFileChangeHooks
 ,
(
, -
filePath
- 5
)
5 6
;
6 7
await
 "
UpdateProjectContext
 *
(
* +
filePath
+ 3
)
3 4
;
4 5
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
LogAIAction
 
(
 
$str
 1
,
1 2
false
3 8
,
8 9
$"
: <
$str
< C
{
C D
ex
D F
.
F G
Message
G N
}
N O
"
O P
)
P Q
;
Q R
}
 
}
 	
public
ขข 
static
ขข 
	AIContext
ขข 
GetCurrentContext
ขข  1
(
ขข1 2
)
ขข2 3
{
ฃฃ 	
if
คค 
(
คค 
_currentContext
คค 
==
คค  "
null
คค# '
)
คค' (
{
ฅฅ 
_currentContext
ฆฆ 
=
ฆฆ  !"
CreateDefaultContext
ฆฆ" 6
(
ฆฆ6 7
)
ฆฆ7 8
;
ฆฆ8 9
}
งง 
return
ฉฉ 
_currentContext
ฉฉ "
;
ฉฉ" #
}
ชช 	
public
ฑฑ 
static
ฑฑ 
void
ฑฑ 
UpdateContext
ฑฑ (
(
ฑฑ( )
string
ฑฑ) /
	operation
ฑฑ0 9
,
ฑฑ9 :

Dictionary
ฑฑ; E
<
ฑฑE F
string
ฑฑF L
,
ฑฑL M
object
ฑฑN T
>
ฑฑT U
data
ฑฑV Z
)
ฑฑZ [
{
ฒฒ 	
if
ณณ 
(
ณณ 
_currentContext
ณณ 
==
ณณ  "
null
ณณ# '
)
ณณ' (
{
ดด 
_currentContext
ตต 
=
ตต  !"
CreateDefaultContext
ตต" 6
(
ตต6 7
)
ตต7 8
;
ตต8 9
}
ถถ 
_currentContext
ธธ 
.
ธธ 
CurrentOperation
ธธ ,
=
ธธ- .
	operation
ธธ/ 8
;
ธธ8 9
_currentContext
นน 
.
นน 
LastUpdated
นน '
=
นน( )
DateTime
นน* 2
.
นน2 3
Now
นน3 6
;
นน6 7
foreach
ผผ 
(
ผผ 
var
ผผ 
item
ผผ 
in
ผผ  
data
ผผ! %
)
ผผ% &
{
ฝฝ 
_currentContext
พพ 
.
พพ  
Data
พพ  $
[
พพ$ %
item
พพ% )
.
พพ) *
Key
พพ* -
]
พพ- .
=
พพ/ 0
item
พพ1 5
.
พพ5 6
Value
พพ6 ;
;
พพ; <
}
ฟฟ 
_currentContext
ยย 
.
ยย 
OperationHistory
ยย ,
.
ยย, -
Add
ยย- 0
(
ยย0 1
new
รร 
ContextOperation
รร $
{
ฤฤ 
	Operation
ลล 
=
ลล 
	operation
ลล  )
,
ลล) *
	Timestamp
ฦฦ 
=
ฦฦ 
DateTime
ฦฦ  (
.
ฦฦ( )
Now
ฦฦ) ,
,
ฦฦ, -
Data
วว 
=
วว 
new
วว 

Dictionary
วว )
<
วว) *
string
วว* 0
,
วว0 1
object
วว2 8
>
วว8 9
(
วว9 :
data
วว: >
)
วว> ?
,
วว? @
}
ศศ 
)
ษษ 
;
ษษ 
if
ฬฬ 
(
ฬฬ 
_currentContext
ฬฬ 
.
ฬฬ  
OperationHistory
ฬฬ  0
.
ฬฬ0 1
Count
ฬฬ1 6
>
ฬฬ7 8
$num
ฬฬ9 ;
)
ฬฬ; <
{
ออ 
_currentContext
ฮฮ 
.
ฮฮ  
OperationHistory
ฮฮ  0
.
ฮฮ0 1
RemoveAt
ฮฮ1 9
(
ฮฮ9 :
$num
ฮฮ: ;
)
ฮฮ; <
;
ฮฮ< =
}
ฯฯ 
}
ะะ 	
public
ีี 
static
ีี 
void
ีี 
ClearContext
ีี '
(
ีี' (
)
ีี( )
{
ึึ 	
_currentContext
ืื 
=
ืื "
CreateDefaultContext
ืื 2
(
ืื2 3
)
ืื3 4
;
ืื4 5
LogAIAction
ุุ 
(
ุุ 
$str
ุุ &
,
ุุ& '
true
ุุ( ,
,
ุุ, -
$str
ุุ. B
)
ุุB C
;
ุุC D
}
ูู 	
public
ๅๅ 
static
ๅๅ 
void
ๅๅ 
LogAIAction
ๅๅ &
(
ๅๅ& '
string
ๅๅ' -
action
ๅๅ. 4
,
ๅๅ4 5
bool
ๅๅ6 :
success
ๅๅ; B
,
ๅๅB C
string
ๅๅD J
details
ๅๅK R
=
ๅๅS T
null
ๅๅU Y
)
ๅๅY Z
{
ๆๆ 	
var
็็ 
aiAction
็็ 
=
็็ 
new
็็ 
AIAction
็็ '
{
่่ 
Action
้้ 
=
้้ 
action
้้ 
,
้้  
Success
๊๊ 
=
๊๊ 
success
๊๊ !
,
๊๊! "
Details
๋๋ 
=
๋๋ 
details
๋๋ !
,
๋๋! "
	Timestamp
์์ 
=
์์ 
DateTime
์์ $
.
์์$ %
Now
์์% (
,
์์( )
Context
ํํ 
=
ํํ 
_currentContext
ํํ )
?
ํํ) *
.
ํํ* +
CurrentOperation
ํํ+ ;
,
ํํ; <
}
๎๎ 
;
๎๎ 
	ActionLog
๐๐ 
.
๐๐ 
Add
๐๐ 
(
๐๐ 
aiAction
๐๐ "
)
๐๐" #
;
๐๐# $
if
๓๓ 
(
๓๓ 
	ActionLog
๓๓ 
.
๓๓ 
Count
๓๓ 
>
๓๓  !
_maxLogEntries
๓๓" 0
)
๓๓0 1
{
๔๔ 
	ActionLog
๕๕ 
.
๕๕ 
RemoveAt
๕๕ "
(
๕๕" #
$num
๕๕# $
)
๕๕$ %
;
๕๕% &
}
๖๖ 
}
๗๗ 	
public
 
static
 
List
 
<
 
AIAction
 #
>
# $
GetActionLog
% 1
(
1 2
int
2 5
count
6 ;
=
< =
$num
> A
)
A B
{
 	
if
 
(
 
	ActionLog
 
.
 
Count
 
<=
  "
count
# (
)
( )
{
 
return
 
new
 
List
 
<
  
AIAction
  (
>
( )
(
) *
	ActionLog
* 3
)
3 4
;
4 5
}
 
return
 
	ActionLog
 
.
 
Skip
 !
(
! "
	ActionLog
" +
.
+ ,
Count
, 1
-
2 3
count
4 9
)
9 :
.
: ;
ToList
; A
(
A B
)
B C
;
C D
}
 	
public
 
static
 

Dictionary
  
<
  !
string
! '
,
' (
object
) /
>
/ 0!
GetActionStatistics
1 D
(
D E
)
E F
{
 	
var
 
stats
 
=
 
new
 

Dictionary
 &
<
& '
string
' -
,
- .
object
/ 5
>
5 6
(
6 7
)
7 8
;
8 9
if
 
(
 
	ActionLog
 
.
 
Any
 
(
 
)
 
)
  
{
 
stats
 
[
 
$str
 $
]
$ %
=
& '
	ActionLog
( 1
.
1 2
Count
2 7
;
7 8
stats
 
[
 
$str
 )
]
) *
=
+ ,
	ActionLog
- 6
.
6 7
Count
7 <
(
< =
a
= >
=>
? A
a
B C
.
C D
Success
D K
)
K L
;
L M
stats
 
[
 
$str
 %
]
% &
=
' (
	ActionLog
) 2
.
2 3
Count
3 8
(
8 9
a
9 :
=>
; =
!
> ?
a
? @
.
@ A
Success
A H
)
H I
;
I J
stats
 
[
 
$str
 #
]
# $
=
% &
(
 
double
 
)
 
	ActionLog
 %
.
% &
Count
& +
(
+ ,
a
, -
=>
. 0
a
1 2
.
2 3
Success
3 :
)
: ;
/
< =
	ActionLog
> G
.
G H
Count
H M
*
N O
$num
P S
;
S T
stats
 
[
 
$str
 (
]
( )
=
* +
	ActionLog
, 5
.
 
GroupBy
 
(
 
a
 
=>
 !
a
" #
.
# $
Action
$ *
)
* +
.
 
OrderByDescending
 &
(
& '
g
' (
=>
) +
g
, -
.
- .
Count
. 3
(
3 4
)
4 5
)
5 6
.
 
FirstOrDefault
 #
(
# $
)
$ %
?
 
.
 
Key
 
;
 
stats
 
[
 
$str
 "
]
" #
=
$ %
	ActionLog
& /
.
/ 0
LastOrDefault
0 =
(
= >
)
> ?
?
? @
.
@ A
Action
A G
;
G H
stats
 
[
 
$str
 &
]
& '
=
( )
	ActionLog
* 3
.
3 4
LastOrDefault
4 A
(
A B
)
B C
?
C D
.
D E
	Timestamp
E N
;
N O
}
 
else
 
{
 
stats
กก 
[
กก 
$str
กก $
]
กก$ %
=
กก& '
$num
กก( )
;
กก) *
stats
ขข 
[
ขข 
$str
ขข )
]
ขข) *
=
ขข+ ,
$num
ขข- .
;
ขข. /
stats
ฃฃ 
[
ฃฃ 
$str
ฃฃ %
]
ฃฃ% &
=
ฃฃ' (
$num
ฃฃ) *
;
ฃฃ* +
stats
คค 
[
คค 
$str
คค #
]
คค# $
=
คค% &
$num
คค' *
;
คค* +
}
ฅฅ 
return
งง 
stats
งง 
;
งง 
}
จจ 	
public
ฒฒ 
static
ฒฒ 
void
ฒฒ 
SetHooksEnabled
ฒฒ *
(
ฒฒ* +
bool
ฒฒ+ /
enabled
ฒฒ0 7
)
ฒฒ7 8
{
ณณ 	
_hooksEnabled
ดด 
=
ดด 
enabled
ดด #
;
ดด# $
LogAIAction
ตต 
(
ตต 
$str
ตต )
,
ตต) *
true
ตต+ /
,
ตต/ 0
$"
ตต1 3
$str
ตต3 B
{
ตตB C
enabled
ตตC J
}
ตตJ K
"
ตตK L
)
ตตL M
;
ตตM N
}
ถถ 	
public
ผผ 
static
ผผ 
void
ผผ 
SetMaxLogEntries
ผผ +
(
ผผ+ ,
int
ผผ, /

maxEntries
ผผ0 :
)
ผผ: ;
{
ฝฝ 	
_maxLogEntries
พพ 
=
พพ 
Math
พพ !
.
พพ! "
Max
พพ" %
(
พพ% &
$num
พพ& )
,
พพ) *

maxEntries
พพ+ 5
)
พพ5 6
;
พพ6 7
while
มม 
(
มม 
	ActionLog
มม 
.
มม 
Count
มม "
>
มม# $
_maxLogEntries
มม% 3
)
มม3 4
{
ยย 
	ActionLog
รร 
.
รร 
RemoveAt
รร "
(
รร" #
$num
รร# $
)
รร$ %
;
รร% &
}
ฤฤ 
LogAIAction
ฦฦ 
(
ฦฦ 
$str
ฦฦ *
,
ฦฦ* +
true
ฦฦ, 0
,
ฦฦ0 1
$"
ฦฦ2 4
$str
ฦฦ4 H
{
ฦฦH I

maxEntries
ฦฦI S
}
ฦฦS T
"
ฦฦT U
)
ฦฦU V
;
ฦฦV W
}
วว 	
private
ัั 
static
ัั 
	AIContext
ัั  "
CreateDefaultContext
ัั! 5
(
ัั5 6
)
ัั6 7
{
าา 	
return
ำำ 
new
ำำ 
	AIContext
ำำ  
{
ิิ 
ProjectName
ีี 
=
ีี 
$str
ีี )
,
ีี) *
	Framework
ึึ 
=
ึึ 
$str
ึึ 2
,
ึึ2 3
Language
ืื 
=
ืื 
$str
ืื #
,
ืื# $
LastUpdated
ุุ 
=
ุุ 
DateTime
ุุ &
.
ุุ& '
Now
ุุ' *
,
ุุ* +
CurrentOperation
ูู  
=
ูู! "
$str
ูู# )
,
ูู) *
Data
ฺฺ 
=
ฺฺ 
new
ฺฺ 

Dictionary
ฺฺ %
<
ฺฺ% &
string
ฺฺ& ,
,
ฺฺ, -
object
ฺฺ. 4
>
ฺฺ4 5
(
ฺฺ5 6
)
ฺฺ6 7
,
ฺฺ7 8
OperationHistory
  
=
! "
new
# &
List
' +
<
+ ,
ContextOperation
, <
>
< =
(
= >
)
> ?
,
? @
}
 
;
 
}
 	
private
ใใ 
static
ใใ 
async
ใใ 
Task
ใใ !$
ExecuteFileChangeHooks
ใใ" 8
(
ใใ8 9
string
ใใ9 ?
filePath
ใใ@ H
)
ใใH I
{
ไไ 	
foreach
ๅๅ 
(
ๅๅ 
var
ๅๅ 
pattern
ๅๅ  
in
ๅๅ! #
FileChangeHooks
ๅๅ$ 3
.
ๅๅ3 4
Keys
ๅๅ4 8
)
ๅๅ8 9
{
ๆๆ 
if
็็ 
(
็็ 
MatchesPattern
็็ "
(
็็" #
filePath
็็# +
,
็็+ ,
pattern
็็- 4
)
็็4 5
)
็็5 6
{
่่ 
var
้้ 
hooks
้้ 
=
้้ 
FileChangeHooks
้้  /
[
้้/ 0
pattern
้้0 7
]
้้7 8
;
้้8 9
foreach
๊๊ 
(
๊๊ 
var
๊๊  
hook
๊๊! %
in
๊๊& (
hooks
๊๊) .
)
๊๊. /
{
๋๋ 
try
์์ 
{
ํํ 
await
๎๎ !
hook
๎๎" &
(
๎๎& '
filePath
๎๎' /
)
๎๎/ 0
;
๎๎0 1
}
๏๏ 
catch
๐๐ 
(
๐๐ 
	Exception
๐๐ (
ex
๐๐) +
)
๐๐+ ,
{
๑๑ 
LogAIAction
๒๒ '
(
๒๒' (
$str
๓๓  7
,
๓๓7 8
false
๔๔  %
,
๔๔% &
$"
๕๕  "
$str
๕๕" 1
{
๕๕1 2
filePath
๕๕2 :
}
๕๕: ;
$str
๕๕; =
{
๕๕= >
ex
๕๕> @
.
๕๕@ A
Message
๕๕A H
}
๕๕H I
"
๕๕I J
)
๖๖ 
;
๖๖ 
}
๗๗ 
}
๘๘ 
}
๙๙ 
}
๚๚ 
}
๛๛ 	
private
 
static
 
async
 
Task
 !!
ExecuteContextHooks
" 5
(
5 6
string
6 <
	eventType
= F
)
F G
{
 	
if
 
(
 
ContextHooks
 
.
 
ContainsKey
 (
(
( )
	eventType
) 2
)
2 3
)
3 4
{
 
var
 
hooks
 
=
 
ContextHooks
 (
[
( )
	eventType
) 2
]
2 3
;
3 4
foreach
 
(
 
var
 
hook
 !
in
" $
hooks
% *
)
* +
{
 
try
 
{
 
await
 
hook
 "
(
" #
_currentContext
# 2
)
2 3
;
3 4
}
 
catch
 
(
 
	Exception
 $
ex
% '
)
' (
{
 
LogAIAction
 #
(
# $
$str
 0
,
0 1
false
 !
,
! "
$"
 
$str
 5
{
5 6
	eventType
6 ?
}
? @
$str
@ B
{
B C
ex
C E
.
E F
Message
F M
}
M N
"
N O
)
 
;
 
}
 
}
 
}
 
}
 	
private
 
static
 
Task
 2
$PerformAutomaticDocumentationUpdates
 @
(
@ A
string
 
[
 
]
 
affectedFiles
 "
,
" #
string
 
reason
 
)
 	
{
กก 	
try
ขข 
{
ฃฃ 
var
ฅฅ 
docsToUpdate
ฅฅ  
=
ฅฅ! "
ProjectAnalyzer
ฅฅ# 2
.
ฅฅ2 3+
GetAffectedDocumentationFiles
ฅฅ3 P
(
ฅฅP Q
affectedFiles
ฅฅQ ^
)
ฅฅ^ _
;
ฅฅ_ `
foreach
งง 
(
งง 
var
งง 
docFile
งง $
in
งง% '
docsToUpdate
งง( 4
)
งง4 5
{
จจ 
if
ชช 
(
ชช 
docFile
ชช 
.
ชช  
EndsWith
ชช  (
(
ชช( )
$str
ชช) .
)
ชช. /
)
ชช/ 0
{
ซซ 

DateHelper
ฌฌ "
.
ฌฌ" #
UpdateFileHeader
ฌฌ# 3
(
ฌฌ3 4
docFile
ฌฌ4 ;
)
ฌฌ; <
;
ฌฌ< =
}
ญญ 
}
ฎฎ 
var
ฑฑ 
modules
ฑฑ 
=
ฑฑ 
affectedFiles
ฑฑ +
.
ฒฒ 
Select
ฒฒ 
(
ฒฒ 
f
ฒฒ 
=>
ฒฒ  
GetModuleFromPath
ฒฒ! 2
(
ฒฒ2 3
f
ฒฒ3 4
)
ฒฒ4 5
)
ฒฒ5 6
.
ณณ 
Where
ณณ 
(
ณณ 
m
ณณ 
=>
ณณ 
!
ณณ  !
string
ณณ! '
.
ณณ' (
IsNullOrEmpty
ณณ( 5
(
ณณ5 6
m
ณณ6 7
)
ณณ7 8
)
ณณ8 9
.
ดด 
Distinct
ดด 
(
ดด 
)
ดด 
;
ดด  
foreach
ถถ 
(
ถถ 
var
ถถ 
module
ถถ #
in
ถถ$ &
modules
ถถ' .
)
ถถ. /
{
ทท "
DocumentationManager
ธธ (
.
ธธ( )!
UpdateModuleSummary
ธธ) <
(
ธธ< =
module
ธธ= C
,
ธธC D
reason
ธธE K
)
ธธK L
;
ธธL M
}
นน 
LogAIAction
ปป 
(
ปป 
$str
ผผ :
,
ผผ: ;
true
ฝฝ 
,
ฝฝ 
$"
พพ 
$str
พพ '
{
พพ' (
docsToUpdate
พพ( 4
.
พพ4 5
Count
พพ5 :
}
พพ: ;
$str
พพ; A
"
พพA B
)
ฟฟ 
;
ฟฟ 
}
ภภ 
catch
มม 
(
มม 
	Exception
มม 
ex
มม 
)
มม  
{
ยย 
LogAIAction
รร 
(
รร 
$str
รร B
,
รรB C
false
รรD I
,
รรI J
$"
รรK M
$str
รรM T
{
รรT U
ex
รรU W
.
รรW X
Message
รรX _
}
รร_ `
"
รร` a
)
รรa b
;
รรb c
}
ฤฤ 
return
ฦฦ 
Task
ฦฦ 
.
ฦฦ 
CompletedTask
ฦฦ %
;
ฦฦ% &
}
วว 	
private
ฮฮ 
static
ฮฮ 
Task
ฮฮ  
ProvideSuggestions
ฮฮ .
(
ฮฮ. /
string
ฯฯ 
generationType
ฯฯ !
,
ฯฯ! "

Dictionary
ะะ 
<
ะะ 
string
ะะ 
,
ะะ 
object
ะะ %
>
ะะ% &
context
ะะ' .
)
ัั 	
{
าา 	
LogAIAction
ีี 
(
ีี 
$str
ีี ,
,
ีี, -
true
ีี. 2
,
ีี2 3
$"
ีี4 6
$str
ีี6 P
{
ีีP Q
generationType
ีีQ _
}
ีี_ `
"
ีี` a
)
ีีa b
;
ีีb c
_currentContext
ุุ 
.
ุุ 
Data
ุุ  
[
ุุ  !
$str
ุุ! 5
]
ุุ5 6
=
ุุ7 8
generationType
ุุ9 G
;
ุุG H
_currentContext
ูู 
.
ูู 
Data
ูู  
[
ูู  !
$str
ูู! 4
]
ูู4 5
=
ูู6 7
context
ูู8 ?
;
ูู? @
return
 
Task
 
.
 
CompletedTask
 %
;
% &
}
 	
private
โโ 
static
โโ 
Task
โโ "
UpdateProjectContext
โโ 0
(
โโ0 1
string
โโ1 7
filePath
โโ8 @
)
โโ@ A
{
ใใ 	
try
ไไ 
{
ๅๅ 
var
ๆๆ 
module
ๆๆ 
=
ๆๆ 
GetModuleFromPath
ๆๆ .
(
ๆๆ. /
filePath
ๆๆ/ 7
)
ๆๆ7 8
;
ๆๆ8 9
var
็็ 
fileType
็็ 
=
็็ 
Path
็็ #
.
็็# $
GetExtension
็็$ 0
(
็็0 1
filePath
็็1 9
)
็็9 :
;
็็: ;
_currentContext
้้ 
.
้้  
Data
้้  $
[
้้$ %
$str
้้% 7
]
้้7 8
=
้้9 :
filePath
้้; C
;
้้C D
_currentContext
๊๊ 
.
๊๊  
Data
๊๊  $
[
๊๊$ %
$str
๊๊% 9
]
๊๊9 :
=
๊๊; <
module
๊๊= C
;
๊๊C D
_currentContext
๋๋ 
.
๋๋  
Data
๋๋  $
[
๋๋$ %
$str
๋๋% ;
]
๋๋; <
=
๋๋= >
fileType
๋๋? G
;
๋๋G H
if
๎๎ 
(
๎๎ 
!
๎๎ 
_currentContext
๎๎ $
.
๎๎$ %
Data
๎๎% )
.
๎๎) *
ContainsKey
๎๎* 5
(
๎๎5 6
$str
๎๎6 J
)
๎๎J K
)
๎๎K L
{
๏๏ 
_currentContext
๐๐ #
.
๐๐# $
Data
๐๐$ (
[
๐๐( )
$str
๐๐) =
]
๐๐= >
=
๐๐? @
$num
๐๐A B
;
๐๐B C
}
๑๑ 
_currentContext
๓๓ 
.
๓๓  
Data
๓๓  $
[
๓๓$ %
$str
๓๓% 9
]
๓๓9 :
=
๓๓; <
(
๔๔ 
int
๔๔ 
)
๔๔ 
_currentContext
๔๔ (
.
๔๔( )
Data
๔๔) -
[
๔๔- .
$str
๔๔. B
]
๔๔B C
+
๔๔D E
$num
๔๔F G
;
๔๔G H
LogAIAction
๖๖ 
(
๖๖ 
$str
๖๖ 2
,
๖๖2 3
true
๖๖4 8
,
๖๖8 9
$"
๖๖: <
$str
๖๖< P
{
๖๖P Q
filePath
๖๖Q Y
}
๖๖Y Z
"
๖๖Z [
)
๖๖[ \
;
๖๖\ ]
}
๗๗ 
catch
๘๘ 
(
๘๘ 
	Exception
๘๘ 
ex
๘๘ 
)
๘๘  
{
๙๙ 
LogAIAction
๚๚ 
(
๚๚ 
$str
๚๚ 2
,
๚๚2 3
false
๚๚4 9
,
๚๚9 :
$"
๚๚; =
$str
๚๚= D
{
๚๚D E
ex
๚๚E G
.
๚๚G H
Message
๚๚H O
}
๚๚O P
"
๚๚P Q
)
๚๚Q R
;
๚๚R S
}
๛๛ 
return
 
Task
 
.
 
CompletedTask
 %
;
% &
}
 	
private
 
static
 
string
 
GetModuleFromPath
 /
(
/ 0
string
0 6
filePath
7 ?
)
? @
{
 	
var
 
	pathParts
 
=
 
filePath
 $
.
$ %
Replace
% ,
(
, -
$char
- 1
,
1 2
$char
3 6
)
6 7
.
7 8
Split
8 =
(
= >
$char
> A
)
A B
;
B C
var
 
modules
 
=
 
new
 
[
 
]
 
{
 
$str
 
,
 
$str
 
,
 
$str
 
,
 
$str
 
,
 
$str
 
,
 
$str
 
,
 
$str
 
,
 
$str
 
,
 
}
 
;
 
return
 
	pathParts
 
.
 
FirstOrDefault
 +
(
+ ,
part
, 0
=>
1 3
modules
 
.
 
Contains
  
(
  !
part
! %
,
% &
StringComparer
' 5
.
5 6
OrdinalIgnoreCase
6 G
)
G H
)
 
;
 
}
 	
private
 
static
 
bool
 
MatchesPattern
 *
(
* +
string
+ 1
filePath
2 :
,
: ;
string
< B
pattern
C J
)
J K
{
 	
if
ขข 
(
ขข 
pattern
ขข 
==
ขข 
$str
ขข 
)
ขข 
{
ฃฃ 
return
คค 
true
คค 
;
คค 
}
ฅฅ 
if
งง 
(
งง 
pattern
งง 
.
งง 

StartsWith
งง "
(
งง" #
$str
งง# '
)
งง' (
)
งง( )
{
จจ 
var
ฉฉ 
	extension
ฉฉ 
=
ฉฉ 
pattern
ฉฉ  '
.
ฉฉ' (
	Substring
ฉฉ( 1
(
ฉฉ1 2
$num
ฉฉ2 3
)
ฉฉ3 4
;
ฉฉ4 5
return
ชช 
filePath
ชช 
.
ชช  
EndsWith
ชช  (
(
ชช( )
	extension
ชช) 2
,
ชช2 3
StringComparison
ชช4 D
.
ชชD E
OrdinalIgnoreCase
ชชE V
)
ชชV W
;
ชชW X
}
ซซ 
if
ญญ 
(
ญญ 
pattern
ญญ 
.
ญญ 
EndsWith
ญญ  
(
ญญ  !
$str
ญญ! %
)
ญญ% &
)
ญญ& '
{
ฎฎ 
var
ฏฏ 
	directory
ฏฏ 
=
ฏฏ 
pattern
ฏฏ  '
.
ฏฏ' (
	Substring
ฏฏ( 1
(
ฏฏ1 2
$num
ฏฏ2 3
,
ฏฏ3 4
pattern
ฏฏ5 <
.
ฏฏ< =
Length
ฏฏ= C
-
ฏฏD E
$num
ฏฏF G
)
ฏฏG H
;
ฏฏH I
return
ฐฐ 
filePath
ฐฐ 
.
ฐฐ  
Contains
ฐฐ  (
(
ฐฐ( )
	directory
ฐฐ) 2
)
ฐฐ2 3
;
ฐฐ3 4
}
ฑฑ 
return
ณณ 
filePath
ณณ 
.
ณณ 
Contains
ณณ $
(
ณณ$ %
pattern
ณณ% ,
)
ณณ, -
;
ณณ- .
}
ดด 	
}
ทท 
public
ผผ 

class
ผผ 
	AIContext
ผผ 
{
ฝฝ 
public
มม 
string
มม 
ProjectName
มม !
{
มม" #
get
มม$ '
;
มม' (
set
มม) ,
;
มม, -
}
มม. /
public
ฦฦ 
string
ฦฦ 
	Framework
ฦฦ 
{
ฦฦ  !
get
ฦฦ" %
;
ฦฦ% &
set
ฦฦ' *
;
ฦฦ* +
}
ฦฦ, -
public
หห 
string
หห 
Language
หห 
{
หห  
get
หห! $
;
หห$ %
set
หห& )
;
หห) *
}
หห+ ,
public
ะะ 
DateTime
ะะ 
LastUpdated
ะะ #
{
ะะ$ %
get
ะะ& )
;
ะะ) *
set
ะะ+ .
;
ะะ. /
}
ะะ0 1
public
ีี 
string
ีี 
CurrentOperation
ีี &
{
ีี' (
get
ีี) ,
;
ีี, -
set
ีี. 1
;
ีี1 2
}
ีี3 4
public
ฺฺ 

Dictionary
ฺฺ 
<
ฺฺ 
string
ฺฺ  
,
ฺฺ  !
object
ฺฺ" (
>
ฺฺ( )
Data
ฺฺ* .
{
ฺฺ/ 0
get
ฺฺ1 4
;
ฺฺ4 5
set
ฺฺ6 9
;
ฺฺ9 :
}
ฺฺ; <
public
฿฿ 
List
฿฿ 
<
฿฿ 
ContextOperation
฿฿ $
>
฿฿$ %
OperationHistory
฿฿& 6
{
฿฿7 8
get
฿฿9 <
;
฿฿< =
set
฿฿> A
;
฿฿A B
}
฿฿C D
}
เเ 
public
ๅๅ 

class
ๅๅ 
ContextOperation
ๅๅ !
{
ๆๆ 
public
๊๊ 
string
๊๊ 
	Operation
๊๊ 
{
๊๊  !
get
๊๊" %
;
๊๊% &
set
๊๊' *
;
๊๊* +
}
๊๊, -
public
๏๏ 
DateTime
๏๏ 
	Timestamp
๏๏ !
{
๏๏" #
get
๏๏$ '
;
๏๏' (
set
๏๏) ,
;
๏๏, -
}
๏๏. /
public
๔๔ 

Dictionary
๔๔ 
<
๔๔ 
string
๔๔  
,
๔๔  !
object
๔๔" (
>
๔๔( )
Data
๔๔* .
{
๔๔/ 0
get
๔๔1 4
;
๔๔4 5
set
๔๔6 9
;
๔๔9 :
}
๔๔; <
}
๕๕ 
public
๚๚ 

class
๚๚ 
AIAction
๚๚ 
{
๛๛ 
public
 
string
 
Action
 
{
 
get
 "
;
" #
set
$ '
;
' (
}
) *
public
 
bool
 
Success
 
{
 
get
 !
;
! "
set
# &
;
& '
}
( )
public
 
string
 
Details
 
{
 
get
  #
;
# $
set
% (
;
( )
}
* +
public
 
DateTime
 
	Timestamp
 !
{
" #
get
$ '
;
' (
set
) ,
;
, -
}
. /
public
 
string
 
Context
 
{
 
get
  #
;
# $
set
% (
;
( )
}
* +
}
 
} 
LC:\Playnite\_github\OstPlayer\source\Converters\NullToVisibilityConverter.cs
	namespaceXX 	
	OstPlayerXX
 
.XX 

ConvertersXX 
{XX  
[mm 
ValueConversionmm 
(mm 
typeofmm 
(mm 
objectmm "
)mm" #
,mm# $
typeofmm% +
(mm+ ,

Visibilitymm, 6
)mm6 7
)mm7 8
]mm8 9
publicnn 

classnn %
NullToVisibilityConverternn *
:nn+ ,
IValueConverternn- <
{nn= >
public
 
object
 
Convert
 
(
 
object
 $
value
% *
,
* +
Type
, 0

targetType
1 ;
,
; <
object
= C
	parameter
D M
,
M N
CultureInfo
O Z
culture
[ b
)
b c
{
d e
return
 
value
 
==
 
null
  
?
! "

Visibility
# -
.
- .
Visible
. 5
:
6 7

Visibility
8 B
.
B C
	Collapsed
C L
;
L M
}
 	
public
ฃฃ 
object
ฃฃ 
ConvertBack
ฃฃ !
(
ฃฃ! "
object
ฃฃ" (
value
ฃฃ) .
,
ฃฃ. /
Type
ฃฃ0 4

targetType
ฃฃ5 ?
,
ฃฃ? @
object
ฃฃA G
	parameter
ฃฃH Q
,
ฃฃQ R
CultureInfo
ฃฃS ^
culture
ฃฃ_ f
)
ฃฃf g
{
ฃฃh i
throw
ฉฉ 
new
ฉฉ %
NotImplementedException
ฉฉ -
(
ฉฉ- .
$str
ชช R
+
ชชS T
$str
ซซ X
)
ซซX Y
;
ซซY Z
}
ฌฌ 	
}
ญญ 
}ฎฎ 
SC:\Playnite\_github\OstPlayer\source\Converters\NullOrEmptyToVisibilityConverter.cs
	namespaceXX 	
	OstPlayerXX
 
.XX 

ConvertersXX 
{XX  
[aa 
ValueConversionaa 
(aa 
typeofaa 
(aa 
stringaa "
)aa" #
,aa# $
typeofaa% +
(aa+ ,

Visibilityaa, 6
)aa6 7
)aa7 8
]aa8 9
publicbb 

classbb ,
 NullOrEmptyToVisibilityConverterbb 1
:bb2 3
IValueConverterbb4 C
{bbD E
publicff 
objectff 
Convertff 
(ff 
objectff $
valueff% *
,ff* +
Typeff, 0

targetTypeff1 ;
,ff; <
objectff= C
	parameterffD M
,ffM N
CultureInfoffO Z
cultureff[ b
)ffb c
{ffd e
vargg 
strgg 
=gg 
valuegg 
asgg 
stringgg %
;gg% &
returnhh 
stringhh 
.hh 
IsNullOrEmptyhh '
(hh' (
strhh( +
)hh+ ,
?hh- .

Visibilityhh/ 9
.hh9 :
	Collapsedhh: C
:hhD E

VisibilityhhF P
.hhP Q
VisiblehhQ X
;hhX Y
}ii 	
publicnn 
objectnn 
ConvertBacknn !
(nn! "
objectnn" (
valuenn) .
,nn. /
Typenn0 4

targetTypenn5 ?
,nn? @
objectnnA G
	parameternnH Q
,nnQ R
CultureInfonnS ^
culturenn_ f
)nnf g
{nnh i
throwoo 
newoo #
NotImplementedExceptionoo -
(oo- .
)oo. /
;oo/ 0
}pp 	
}qq 
}rr 
QC:\Playnite\_github\OstPlayer\source\Converters\Mp3GroupBoxVisibilityConverter.cs
	namespace`` 	
	OstPlayer``
 
.`` 

Converters`` 
{``  
publicii 

classii *
Mp3GroupBoxVisibilityConverterii /
:ii0 1 
IMultiValueConverterii2 F
{iiG H
publicmm 
objectmm 
Convertmm 
(mm 
objectmm $
[mm$ %
]mm% &
valuesmm' -
,mm- .
Typemm/ 3

targetTypemm4 >
,mm> ?
objectmm@ F
	parametermmG P
,mmP Q
CultureInfommR ]
culturemm^ e
)mme f
{mmg h
boolpp 
	isVisiblepp 
=pp 
valuespp #
[pp# $
$numpp$ %
]pp% &
ispp' )
boolpp* .
bpp/ 0
&&pp1 3
bpp4 5
;pp5 6
boolqq 
hasTitleqq 
=qq 
valuesqq "
[qq" #
$numqq# $
]qq$ %
isqq& (
stringqq) /
sqq0 1
&&qq2 4
!qq5 6
stringqq6 <
.qq< =
IsNullOrEmptyqq= J
(qqJ K
sqqK L
)qqL M
;qqM N
returnrr 
(rr 
	isVisiblerr 
&&rr  
hasTitlerr! )
)rr) *
?rr+ ,

Visibilityrr- 7
.rr7 8
Visiblerr8 ?
:rr@ A

VisibilityrrB L
.rrL M
	CollapsedrrM V
;rrV W
}ss 	
publicxx 
objectxx 
[xx 
]xx 
ConvertBackxx #
(xx# $
objectxx$ *
valuexx+ 0
,xx0 1
Typexx2 6
[xx6 7
]xx7 8
targetTypesxx9 D
,xxD E
objectxxF L
	parameterxxM V
,xxV W
CultureInfoxxX c
culturexxd k
)xxk l
{xxm n
throwyy 
newyy #
NotImplementedExceptionyy -
(yy- .
)yy. /
;yy/ 0
}zz 	
}{{ 
}|| ๖
OC:\Playnite\_github\OstPlayer\source\Converters\NotNullToVisibilityConverter.cs
	namespaceVV 	
	OstPlayerVV
 
.VV 

ConvertersVV 
{VV  
[`` 
ValueConversion`` 
(`` 
typeof`` 
(`` 
object`` "
)``" #
,``# $
typeof``% +
(``+ ,

Visibility``, 6
)``6 7
)``7 8
]``8 9
publicaa 

classaa (
NotNullToVisibilityConverteraa -
:aa. /
IValueConverteraa0 ?
{aa@ A
publicmm 
objectmm 
Convertmm 
(mm 
objectmm $
valuemm% *
,mm* +
Typemm, 0

targetTypemm1 ;
,mm; <
objectmm= C
	parametermmD M
,mmM N
CultureInfommO Z
culturemm[ b
)mmb c
{mmd e
returnnn 
valuenn 
!=nn 
nullnn  
?nn! "

Visibilitynn# -
.nn- .
Visiblenn. 5
:nn6 7

Visibilitynn8 B
.nnB C
	CollapsednnC L
;nnL M
}oo 	
public|| 
object|| 
ConvertBack|| !
(||! "
object||" (
value||) .
,||. /
Type||0 4

targetType||5 ?
,||? @
object||A G
	parameter||H Q
,||Q R
CultureInfo||S ^
culture||_ f
)||f g
{||h i
throw}} 
new}} #
NotImplementedException}} -
(}}- .
$str	}}. น
)
}}น บ
;
}}บ ป
}~~ 	
} 
} ๆ
KC:\Playnite\_github\OstPlayer\source\Converters\IntToVisibilityConverter.cs
	namespaceYY 	
	OstPlayerYY
 
.YY 

ConvertersYY 
{YY  
publiccc 

classcc $
IntToVisibilityConvertercc )
:cc* +
IValueConvertercc, ;
{cc< =
publicgg 
objectgg 
Convertgg 
(gg 
objectgg $
valuegg% *
,gg* +
Typegg, 0

targetTypegg1 ;
,gg; <
objectgg= C
	parameterggD M
,ggM N
CultureInfoggO Z
culturegg[ b
)ggb c
{ggd e
ifhh 
(hh 
valuehh 
==hh 
nullhh 
)hh 
returnii 

Visibilityii !
.ii! "
	Collapsedii" +
;ii+ ,
intjj 
intValuejj 
;jj 
ifkk 
(kk 
intkk 
.kk 
TryParsekk 
(kk 
valuekk "
.kk" #
ToStringkk# +
(kk+ ,
)kk, -
,kk- .
outkk/ 2
intValuekk3 ;
)kk; <
)kk< =
{kk> ?
returnll 
intValuell 
>ll  !
$numll" #
?ll$ %

Visibilityll& 0
.ll0 1
Visiblell1 8
:ll9 :

Visibilityll; E
.llE F
	CollapsedllF O
;llO P
}mm 
returnnn 

Visibilitynn 
.nn 
	Collapsednn '
;nn' (
}oo 	
publictt 
objecttt 
ConvertBacktt !
(tt! "
objecttt" (
valuett) .
,tt. /
Typett0 4

targetTypett5 ?
,tt? @
objectttA G
	parameterttH Q
,ttQ R
CultureInfottS ^
culturett_ f
)ttf g
{tth i
throwuu 
newuu #
NotImplementedExceptionuu -
(uu- .
)uu. /
;uu/ 0
}vv 	
}ww 
}xx อ
SC:\Playnite\_github\OstPlayer\source\Converters\InverseBoolToVisibilityConverter.cs
	namespaceYY 	
	OstPlayerYY
 
.YY 

ConvertersYY 
{YY  
publiccc 

classcc ,
 InverseBoolToVisibilityConvertercc 1
:cc2 3
IValueConvertercc4 C
{ccD E
publicgg 
objectgg 
Convertgg 
(gg 
objectgg $
valuegg% *
,gg* +
Typegg, 0

targetTypegg1 ;
,gg; <
objectgg= C
	parameterggD M
,ggM N
CultureInfoggO Z
culturegg[ b
)ggb c
{ggd e
ifhh 
(hh 
valuehh 
ishh 
boolhh 
bhh 
)hh  
returnii 
bii 
?ii 

Visibilityii %
.ii% &
	Collapsedii& /
:ii0 1

Visibilityii2 <
.ii< =
Visibleii= D
;iiD E
returnjj 

Visibilityjj 
.jj 
Visiblejj %
;jj% &
}kk 	
publicpp 
objectpp 
ConvertBackpp !
(pp! "
objectpp" (
valuepp) .
,pp. /
Typepp0 4

targetTypepp5 ?
,pp? @
objectppA G
	parameterppH Q
,ppQ R
CultureInfoppS ^
culturepp_ f
)ppf g
{pph i
ifqq 
(qq 
valueqq 
isqq 

Visibilityqq #
vqq$ %
)qq% &
returnrr 
vrr 
!=rr 

Visibilityrr &
.rr& '
Visiblerr' .
;rr. /
returnss 
truess 
;ss 
}tt 	
}uu 
}vv 
UC:\Playnite\_github\OstPlayer\source\Converters\DiscogsGroupBoxVisibilityConverter.cs
	namespace`` 	
	OstPlayer``
 
.`` 

Converters`` 
{``  
publicii 

classii .
"DiscogsGroupBoxVisibilityConverterii 3
:ii4 5 
IMultiValueConverterii6 J
{iiK L
publicmm 
objectmm 
Convertmm 
(mm 
objectmm $
[mm$ %
]mm% &
valuesmm' -
,mm- .
Typemm/ 3

targetTypemm4 >
,mm> ?
objectmm@ F
	parametermmG P
,mmP Q
CultureInfommR ]
culturemm^ e
)mme f
{mmg h
boolpp 
	isVisiblepp 
=pp 
valuespp #
[pp# $
$numpp$ %
]pp% &
ispp' )
boolpp* .
bpp/ 0
&&pp1 3
bpp4 5
;pp5 6
boolqq 
hasMetadataqq 
=qq 
valuesqq %
[qq% &
$numqq& '
]qq' (
!=qq) +
nullqq, 0
;qq0 1
returnrr 
(rr 
	isVisiblerr 
&&rr  
hasMetadatarr! ,
)rr, -
?rr. /

Visibilityrr0 :
.rr: ;
Visiblerr; B
:rrC D

VisibilityrrE O
.rrO P
	CollapsedrrP Y
;rrY Z
}ss 	
publicxx 
objectxx 
[xx 
]xx 
ConvertBackxx #
(xx# $
objectxx$ *
valuexx+ 0
,xx0 1
Typexx2 6
[xx6 7
]xx7 8
targetTypesxx9 D
,xxD E
objectxxF L
	parameterxxM V
,xxV W
CultureInfoxxX c
culturexxd k
)xxk l
{xxm n
throwyy 
newyy #
NotImplementedExceptionyy -
(yy- .
)yy. /
;yy/ 0
}zz 	
}{{ 
}|| 